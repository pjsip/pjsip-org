<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Test: Timestamp (2.13)</title>
<link href="/style/style.css" rel="stylesheet" type="text/css">
</head><body>
	<!--#include virtual="/header.html" -->
	<p><A HREF="/">Home</A> --&gt; <A HREF="/docs.htm">Documentations</A> --&gt; PJLIB Reference</p>
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Test: Timestamp </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >This file provides implementation of timestamp_test()</p>
<h1><a class="anchor" id="timestamp_test_sec"></a>
Scope of the Test</h1>
<p >This tests whether timestamp API works.</p>
<p >API tested:</p><ul>
<li><a class="el" href="group__PJ__TIMESTAMP.htm#ga08e3e11a5e8f68f3111e5ecf3bff0ac1">pj_get_timestamp_freq()</a></li>
<li><a class="el" href="group__PJ__TIMESTAMP.htm#gaa419b8448d1cb55db85aeac2e86fe11c">pj_get_timestamp()</a></li>
<li><a class="el" href="group__PJ__TIMESTAMP.htm#gad5a0323beb04de52474b59693b4b12ac">pj_elapsed_usec()</a></li>
<li><a class="el" href="group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG()</a></li>
</ul>
<p >This file is <b>pjlib-test/timestamp.c</b></p>
<div class="fragment"><div class="line"><span class="comment">/* </span></div>
<div class="line"><span class="comment"> * Copyright (C) 2008-2011 Teluu Inc. (http://www.teluu.com)</span></div>
<div class="line"><span class="comment"> * Copyright (C) 2003-2008 Benny Prijono &lt;benny@prijono.org&gt;</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This program is free software; you can redistribute it and/or modify</span></div>
<div class="line"><span class="comment"> * it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><span class="comment"> * the Free Software Foundation; either version 2 of the License, or</span></div>
<div class="line"><span class="comment"> * (at your option) any later version.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This program is distributed in the hope that it will be useful,</span></div>
<div class="line"><span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><span class="comment"> * GNU General Public License for more details.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * You should have received a copy of the GNU General Public License</span></div>
<div class="line"><span class="comment"> * along with this program; if not, write to the Free Software</span></div>
<div class="line"><span class="comment"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA </span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="preprocessor">#include &quot;test.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="os_8h.htm">pj/os.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="log_8h.htm">pj/log.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rand_8h.htm">pj/rand.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if INCLUDE_TIMESTAMP_TEST</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define THIS_FILE   &quot;timestamp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> timestamp_accuracy()</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_union" href="unionpj__timestamp.htm">pj_timestamp</a> freq, t1, t2;</div>
<div class="line">    <a class="code hl_struct" href="structpj__time__val.htm">pj_time_val</a> tv1, tv2, tvtmp;</div>
<div class="line">    pj_int64_t msec, tics;</div>
<div class="line">    pj_int64_t diff;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(3,(THIS_FILE, <span class="stringliteral">&quot;...testing frequency accuracy (pls wait)&quot;</span>));</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group__PJ__TIMESTAMP.htm#ga08e3e11a5e8f68f3111e5ecf3bff0ac1">pj_get_timestamp_freq</a>(&amp;freq);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Get the start time */</span></div>
<div class="line">    <a class="code hl_function" href="group__PJ__TIME.htm#ga0806df13f40d3153061f399ed86be856">pj_gettimeofday</a>(&amp;tvtmp);</div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        <a class="code hl_function" href="group__PJ__TIME.htm#ga0806df13f40d3153061f399ed86be856">pj_gettimeofday</a>(&amp;tv1);</div>
<div class="line">    } <span class="keywordflow">while</span> (<a class="code hl_define" href="group__PJ__TIME.htm#gabe181b183828aae6bc56c1cf4b593d59">PJ_TIME_VAL_EQ</a>(tvtmp, tv1));</div>
<div class="line">    <a class="code hl_function" href="group__PJ__TIMESTAMP.htm#gaa419b8448d1cb55db85aeac2e86fe11c">pj_get_timestamp</a>(&amp;t1);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Sleep for 10 seconds */</span></div>
<div class="line">    <a class="code hl_function" href="group__PJ__THREAD.htm#gad59cd6fd7390711758afcc0bde375d68">pj_thread_sleep</a>(10000);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Get end time */</span></div>
<div class="line">    <a class="code hl_function" href="group__PJ__TIME.htm#ga0806df13f40d3153061f399ed86be856">pj_gettimeofday</a>(&amp;tvtmp);</div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        <a class="code hl_function" href="group__PJ__TIME.htm#ga0806df13f40d3153061f399ed86be856">pj_gettimeofday</a>(&amp;tv2);</div>
<div class="line">    } <span class="keywordflow">while</span> (<a class="code hl_define" href="group__PJ__TIME.htm#gabe181b183828aae6bc56c1cf4b593d59">PJ_TIME_VAL_EQ</a>(tvtmp, tv2));</div>
<div class="line">    <a class="code hl_function" href="group__PJ__TIMESTAMP.htm#gaa419b8448d1cb55db85aeac2e86fe11c">pj_get_timestamp</a>(&amp;t2);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Get the elapsed time */</span></div>
<div class="line">    <a class="code hl_define" href="group__PJ__TIME.htm#gaec98fc019fc44b5a6f6b0b9137bcf272">PJ_TIME_VAL_SUB</a>(tv2, tv1);</div>
<div class="line">    msec = <a class="code hl_define" href="group__PJ__TIME.htm#gad015d440803cb8f62ff73878f35badaa">PJ_TIME_VAL_MSEC</a>(tv2);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Check that the frequency match the elapsed time */</span></div>
<div class="line">    tics = t2.u64 - t1.u64;</div>
<div class="line">    diff = tics - (msec * freq.u64 / 1000);</div>
<div class="line">    <span class="keywordflow">if</span> (diff &lt; 0)</div>
<div class="line">        diff = -diff;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Only allow 1 msec mismatch */</span></div>
<div class="line">    <span class="keywordflow">if</span> (diff &gt; (pj_int64_t)(freq.u64 / 1000)) {</div>
<div class="line">        <a class="code hl_define" href="group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(3,(THIS_FILE, <span class="stringliteral">&quot;....error: timestamp drifted by %d usec after &quot;</span></div>
<div class="line">                             <span class="stringliteral">&quot;%d msec&quot;</span>, </div>
<div class="line">                             (<a class="code hl_typedef" href="group__PJ__BASIC.htm#gafbfd2fd08c6041ea3cb217310c0b5b48">pj_uint32_t</a>)(diff * 1000000 / freq.u64), </div>
<div class="line">                             msec));</div>
<div class="line">        <span class="keywordflow">return</span> -2000;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Otherwise just print warning if timestamp drifted by &gt;1 usec */</span></div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (diff &gt; (pj_int64_t)(freq.u64 / 1000000)) {</div>
<div class="line">        <a class="code hl_define" href="group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(3,(THIS_FILE, <span class="stringliteral">&quot;....warning: timestamp drifted by %d usec after &quot;</span></div>
<div class="line">                             <span class="stringliteral">&quot;%d msec&quot;</span>, </div>
<div class="line">                             (<a class="code hl_typedef" href="group__PJ__BASIC.htm#gafbfd2fd08c6041ea3cb217310c0b5b48">pj_uint32_t</a>)(diff * 1000000 / freq.u64), </div>
<div class="line">                             msec));</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <a class="code hl_define" href="group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(3,(THIS_FILE, <span class="stringliteral">&quot;....good. Timestamp is accurate down to&quot;</span></div>
<div class="line">                             <span class="stringliteral">&quot; nearest usec.&quot;</span>));</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> timestamp_test(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">enum</span> { CONSECUTIVE_LOOP = 100 };</div>
<div class="line">    <span class="keyword">volatile</span> <span class="keywordtype">unsigned</span> i;</div>
<div class="line">    <a class="code hl_union" href="unionpj__timestamp.htm">pj_timestamp</a> freq, t1, t2;</div>
<div class="line">    <a class="code hl_struct" href="structpj__time__val.htm">pj_time_val</a> tv1, tv2;</div>
<div class="line">    <span class="keywordtype">unsigned</span> elapsed;</div>
<div class="line">    <a class="code hl_typedef" href="group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> rc;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(3,(THIS_FILE, <span class="stringliteral">&quot;...Testing timestamp (high res time)&quot;</span>));</div>
<div class="line">    </div>
<div class="line">    <span class="comment">/* Get and display timestamp frequency. */</span></div>
<div class="line">    <span class="keywordflow">if</span> ((rc=<a class="code hl_function" href="group__PJ__TIMESTAMP.htm#ga08e3e11a5e8f68f3111e5ecf3bff0ac1">pj_get_timestamp_freq</a>(&amp;freq)) != <a class="code hl_enumvalue" href="group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div>
<div class="line">        app_perror(<span class="stringliteral">&quot;...ERROR: get timestamp freq&quot;</span>, rc);</div>
<div class="line">        <span class="keywordflow">return</span> -1000;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(3,(THIS_FILE, <span class="stringliteral">&quot;....frequency: hiword=%lu loword=%lu&quot;</span>, </div>
<div class="line">                        freq.<a class="code hl_variable" href="unionpj__timestamp.htm#aff0c07d99e2c40a8ab1fb2d34276d81d">u32</a>.<a class="code hl_variable" href="unionpj__timestamp.htm#ad8d7dc97c37ef8ee2a7fac9960c85039">hi</a>, freq.<a class="code hl_variable" href="unionpj__timestamp.htm#aff0c07d99e2c40a8ab1fb2d34276d81d">u32</a>.<a class="code hl_variable" href="unionpj__timestamp.htm#a2108e6b2a0b25129da1dbaef8076c218">lo</a>));</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(3,(THIS_FILE, <span class="stringliteral">&quot;...checking if time can run backwards (pls wait)..&quot;</span>));</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">     * Check if consecutive readings should yield timestamp value</span></div>
<div class="line"><span class="comment">     * that is bigger than previous value.</span></div>
<div class="line"><span class="comment">     * First we get the first timestamp.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    rc = <a class="code hl_function" href="group__PJ__TIMESTAMP.htm#gaa419b8448d1cb55db85aeac2e86fe11c">pj_get_timestamp</a>(&amp;t1);</div>
<div class="line">    <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div>
<div class="line">        app_perror(<span class="stringliteral">&quot;...ERROR: pj_get_timestamp&quot;</span>, rc);</div>
<div class="line">        <span class="keywordflow">return</span> -1001;</div>
<div class="line">    }</div>
<div class="line">    rc = <a class="code hl_function" href="group__PJ__TIME.htm#ga0806df13f40d3153061f399ed86be856">pj_gettimeofday</a>(&amp;tv1);</div>
<div class="line">    <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div>
<div class="line">        app_perror(<span class="stringliteral">&quot;...ERROR: pj_gettimeofday&quot;</span>, rc);</div>
<div class="line">        <span class="keywordflow">return</span> -1002;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">for</span> (i=0; i&lt;CONSECUTIVE_LOOP; ++i) {</div>
<div class="line">        </div>
<div class="line">        <a class="code hl_function" href="group__PJ__THREAD.htm#gad59cd6fd7390711758afcc0bde375d68">pj_thread_sleep</a>(<a class="code hl_function" href="group__PJ__RAND.htm#ga654f8cb013a1312b87000df1a1d03398">pj_rand</a>() % 100);</div>
<div class="line"> </div>
<div class="line">        rc = <a class="code hl_function" href="group__PJ__TIMESTAMP.htm#gaa419b8448d1cb55db85aeac2e86fe11c">pj_get_timestamp</a>(&amp;t2);</div>
<div class="line">        <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div>
<div class="line">            app_perror(<span class="stringliteral">&quot;...ERROR: pj_get_timestamp&quot;</span>, rc);</div>
<div class="line">            <span class="keywordflow">return</span> -1003;</div>
<div class="line">        }</div>
<div class="line">        rc = <a class="code hl_function" href="group__PJ__TIME.htm#ga0806df13f40d3153061f399ed86be856">pj_gettimeofday</a>(&amp;tv2);</div>
<div class="line">        <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div>
<div class="line">            app_perror(<span class="stringliteral">&quot;...ERROR: pj_gettimeofday&quot;</span>, rc);</div>
<div class="line">            <span class="keywordflow">return</span> -1004;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* compare t2 with t1, expecting t2 &gt;= t1. */</span></div>
<div class="line">        <span class="keywordflow">if</span> (t2.<a class="code hl_variable" href="unionpj__timestamp.htm#aff0c07d99e2c40a8ab1fb2d34276d81d">u32</a>.<a class="code hl_variable" href="unionpj__timestamp.htm#ad8d7dc97c37ef8ee2a7fac9960c85039">hi</a> &lt; t1.<a class="code hl_variable" href="unionpj__timestamp.htm#aff0c07d99e2c40a8ab1fb2d34276d81d">u32</a>.<a class="code hl_variable" href="unionpj__timestamp.htm#ad8d7dc97c37ef8ee2a7fac9960c85039">hi</a> ||</div>
<div class="line">            (t2.<a class="code hl_variable" href="unionpj__timestamp.htm#aff0c07d99e2c40a8ab1fb2d34276d81d">u32</a>.<a class="code hl_variable" href="unionpj__timestamp.htm#ad8d7dc97c37ef8ee2a7fac9960c85039">hi</a> == t1.<a class="code hl_variable" href="unionpj__timestamp.htm#aff0c07d99e2c40a8ab1fb2d34276d81d">u32</a>.<a class="code hl_variable" href="unionpj__timestamp.htm#ad8d7dc97c37ef8ee2a7fac9960c85039">hi</a> &amp;&amp; t2.<a class="code hl_variable" href="unionpj__timestamp.htm#aff0c07d99e2c40a8ab1fb2d34276d81d">u32</a>.<a class="code hl_variable" href="unionpj__timestamp.htm#a2108e6b2a0b25129da1dbaef8076c218">lo</a> &lt; t1.<a class="code hl_variable" href="unionpj__timestamp.htm#aff0c07d99e2c40a8ab1fb2d34276d81d">u32</a>.<a class="code hl_variable" href="unionpj__timestamp.htm#a2108e6b2a0b25129da1dbaef8076c218">lo</a>))</div>
<div class="line">        {</div>
<div class="line">            <a class="code hl_define" href="group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(3,(THIS_FILE, <span class="stringliteral">&quot;...ERROR: timestamp run backwards!&quot;</span>));</div>
<div class="line">            <span class="keywordflow">return</span> -1005;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* compare tv2 with tv1, expecting tv2 &gt;= tv1. */</span></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code hl_define" href="group__PJ__TIME.htm#ga9dd4507187780ed1e83a10176dc845b8">PJ_TIME_VAL_LT</a>(tv2, tv1)) {</div>
<div class="line">            <a class="code hl_define" href="group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(3,(THIS_FILE, <span class="stringliteral">&quot;...ERROR: time run backwards!&quot;</span>));</div>
<div class="line">            <span class="keywordflow">return</span> -1006;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* </span></div>
<div class="line"><span class="comment">     * Simple test to time some loop. </span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <a class="code hl_define" href="group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(3,(THIS_FILE, <span class="stringliteral">&quot;....testing simple 1000000 loop&quot;</span>));</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Mark start time. */</span></div>
<div class="line">    <span class="keywordflow">if</span> ((rc=<a class="code hl_function" href="group__PJ__TIMESTAMP.htm#gaa419b8448d1cb55db85aeac2e86fe11c">pj_get_timestamp</a>(&amp;t1)) != <a class="code hl_enumvalue" href="group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div>
<div class="line">        app_perror(<span class="stringliteral">&quot;....error: cat&#39;t get timestamp&quot;</span>, rc);</div>
<div class="line">        <span class="keywordflow">return</span> -1010;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Loop.. */</span></div>
<div class="line">    <span class="keywordflow">for</span> (i=0; i&lt;1000000; ++i) {</div>
<div class="line">        <span class="comment">/* Try to do something so that smart compilers wont</span></div>
<div class="line"><span class="comment">         * remove this silly loop.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        null_func();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group__PJ__THREAD.htm#gad59cd6fd7390711758afcc0bde375d68">pj_thread_sleep</a>(0);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Mark end time. */</span></div>
<div class="line">    <a class="code hl_function" href="group__PJ__TIMESTAMP.htm#gaa419b8448d1cb55db85aeac2e86fe11c">pj_get_timestamp</a>(&amp;t2);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Get elapsed time in usec. */</span></div>
<div class="line">    elapsed = <a class="code hl_function" href="group__PJ__TIMESTAMP.htm#gad5a0323beb04de52474b59693b4b12ac">pj_elapsed_usec</a>(&amp;t1, &amp;t2);</div>
<div class="line">    <a class="code hl_define" href="group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(3,(THIS_FILE, <span class="stringliteral">&quot;....elapsed: %u usec&quot;</span>, (<span class="keywordtype">unsigned</span>)elapsed));</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* See if elapsed time is &quot;reasonable&quot;. </span></div>
<div class="line"><span class="comment">     * This should be good even on 50Mhz embedded powerpc.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keywordflow">if</span> (elapsed &lt; 1 || elapsed &gt; 1000000) {</div>
<div class="line">        <a class="code hl_define" href="group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(3,(THIS_FILE, <span class="stringliteral">&quot;....error: elapsed time outside window (%u, &quot;</span></div>
<div class="line">                             <span class="stringliteral">&quot;t1.u32.hi=%u, t1.u32.lo=%u, &quot;</span></div>
<div class="line">                             <span class="stringliteral">&quot;t2.u32.hi=%u, t2.u32.lo=%u)&quot;</span>,</div>
<div class="line">                             elapsed, </div>
<div class="line">                             t1.<a class="code hl_variable" href="unionpj__timestamp.htm#aff0c07d99e2c40a8ab1fb2d34276d81d">u32</a>.<a class="code hl_variable" href="unionpj__timestamp.htm#ad8d7dc97c37ef8ee2a7fac9960c85039">hi</a>, t1.<a class="code hl_variable" href="unionpj__timestamp.htm#aff0c07d99e2c40a8ab1fb2d34276d81d">u32</a>.<a class="code hl_variable" href="unionpj__timestamp.htm#a2108e6b2a0b25129da1dbaef8076c218">lo</a>, t2.<a class="code hl_variable" href="unionpj__timestamp.htm#aff0c07d99e2c40a8ab1fb2d34276d81d">u32</a>.<a class="code hl_variable" href="unionpj__timestamp.htm#ad8d7dc97c37ef8ee2a7fac9960c85039">hi</a>, t2.<a class="code hl_variable" href="unionpj__timestamp.htm#aff0c07d99e2c40a8ab1fb2d34276d81d">u32</a>.<a class="code hl_variable" href="unionpj__timestamp.htm#a2108e6b2a0b25129da1dbaef8076c218">lo</a>));</div>
<div class="line">        <span class="keywordflow">return</span> -1030;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Testing time/timestamp accuracy */</span></div>
<div class="line">    rc = timestamp_accuracy();</div>
<div class="line">    <span class="keywordflow">if</span> (rc != 0)</div>
<div class="line">        <span class="keywordflow">return</span> rc;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="comment">/* To prevent warning about &quot;translation unit is empty&quot;</span></div>
<div class="line"><span class="comment"> * when this test is disabled. </span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">int</span> dummy_timestamp_test;</div>
<div class="line"><span class="preprocessor">#endif  </span><span class="comment">/* INCLUDE_TIMESTAMP_TEST */</span><span class="preprocessor"></span></div>
<div class="line"> </div>
<div class="ttc" id="agroup__PJ__BASIC_htm_gab43ba3167bd2a2ab4580509dbf79200e"><div class="ttname"><a href="group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a></div><div class="ttdeci">int pj_status_t</div><div class="ttdef"><b>Definition:</b> types.h:68</div></div>
<div class="ttc" id="agroup__PJ__BASIC_htm_gafbfd2fd08c6041ea3cb217310c0b5b48"><div class="ttname"><a href="group__PJ__BASIC.htm#gafbfd2fd08c6041ea3cb217310c0b5b48">pj_uint32_t</a></div><div class="ttdeci">unsigned int pj_uint32_t</div><div class="ttdef"><b>Definition:</b> types.h:43</div></div>
<div class="ttc" id="agroup__PJ__BASIC_htm_gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935"><div class="ttname"><a href="group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a></div><div class="ttdeci">@ PJ_SUCCESS</div><div class="ttdef"><b>Definition:</b> types.h:93</div></div>
<div class="ttc" id="agroup__PJ__LOG_htm_ga767b9231bf7c2b57274771cdc4bca818"><div class="ttname"><a href="group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a></div><div class="ttdeci">#define PJ_LOG(level, arg)</div><div class="ttdef"><b>Definition:</b> log.h:106</div></div>
<div class="ttc" id="agroup__PJ__RAND_htm_ga654f8cb013a1312b87000df1a1d03398"><div class="ttname"><a href="group__PJ__RAND.htm#ga654f8cb013a1312b87000df1a1d03398">pj_rand</a></div><div class="ttdeci">int pj_rand(void)</div></div>
<div class="ttc" id="agroup__PJ__THREAD_htm_gad59cd6fd7390711758afcc0bde375d68"><div class="ttname"><a href="group__PJ__THREAD.htm#gad59cd6fd7390711758afcc0bde375d68">pj_thread_sleep</a></div><div class="ttdeci">pj_status_t pj_thread_sleep(unsigned msec)</div></div>
<div class="ttc" id="agroup__PJ__TIMESTAMP_htm_ga08e3e11a5e8f68f3111e5ecf3bff0ac1"><div class="ttname"><a href="group__PJ__TIMESTAMP.htm#ga08e3e11a5e8f68f3111e5ecf3bff0ac1">pj_get_timestamp_freq</a></div><div class="ttdeci">pj_status_t pj_get_timestamp_freq(pj_timestamp *freq)</div></div>
<div class="ttc" id="agroup__PJ__TIMESTAMP_htm_gaa419b8448d1cb55db85aeac2e86fe11c"><div class="ttname"><a href="group__PJ__TIMESTAMP.htm#gaa419b8448d1cb55db85aeac2e86fe11c">pj_get_timestamp</a></div><div class="ttdeci">pj_status_t pj_get_timestamp(pj_timestamp *ts)</div></div>
<div class="ttc" id="agroup__PJ__TIMESTAMP_htm_gad5a0323beb04de52474b59693b4b12ac"><div class="ttname"><a href="group__PJ__TIMESTAMP.htm#gad5a0323beb04de52474b59693b4b12ac">pj_elapsed_usec</a></div><div class="ttdeci">pj_uint32_t pj_elapsed_usec(const pj_timestamp *start, const pj_timestamp *stop)</div></div>
<div class="ttc" id="agroup__PJ__TIME_htm_ga0806df13f40d3153061f399ed86be856"><div class="ttname"><a href="group__PJ__TIME.htm#ga0806df13f40d3153061f399ed86be856">pj_gettimeofday</a></div><div class="ttdeci">pj_status_t pj_gettimeofday(pj_time_val *tv)</div></div>
<div class="ttc" id="agroup__PJ__TIME_htm_ga9dd4507187780ed1e83a10176dc845b8"><div class="ttname"><a href="group__PJ__TIME.htm#ga9dd4507187780ed1e83a10176dc845b8">PJ_TIME_VAL_LT</a></div><div class="ttdeci">#define PJ_TIME_VAL_LT(t1, t2)</div><div class="ttdef"><b>Definition:</b> types.h:463</div></div>
<div class="ttc" id="agroup__PJ__TIME_htm_gabe181b183828aae6bc56c1cf4b593d59"><div class="ttname"><a href="group__PJ__TIME.htm#gabe181b183828aae6bc56c1cf4b593d59">PJ_TIME_VAL_EQ</a></div><div class="ttdeci">#define PJ_TIME_VAL_EQ(t1, t2)</div><div class="ttdef"><b>Definition:</b> types.h:431</div></div>
<div class="ttc" id="agroup__PJ__TIME_htm_gad015d440803cb8f62ff73878f35badaa"><div class="ttname"><a href="group__PJ__TIME.htm#gad015d440803cb8f62ff73878f35badaa">PJ_TIME_VAL_MSEC</a></div><div class="ttdeci">#define PJ_TIME_VAL_MSEC(t)</div><div class="ttdef"><b>Definition:</b> types.h:421</div></div>
<div class="ttc" id="agroup__PJ__TIME_htm_gaec98fc019fc44b5a6f6b0b9137bcf272"><div class="ttname"><a href="group__PJ__TIME.htm#gaec98fc019fc44b5a6f6b0b9137bcf272">PJ_TIME_VAL_SUB</a></div><div class="ttdeci">#define PJ_TIME_VAL_SUB(t1, t2)</div><div class="ttdef"><b>Definition:</b> types.h:498</div></div>
<div class="ttc" id="alog_8h_htm"><div class="ttname"><a href="log_8h.htm">log.h</a></div><div class="ttdoc">Logging Utility.</div></div>
<div class="ttc" id="aos_8h_htm"><div class="ttname"><a href="os_8h.htm">os.h</a></div><div class="ttdoc">OS dependent functions.</div></div>
<div class="ttc" id="arand_8h_htm"><div class="ttname"><a href="rand_8h.htm">rand.h</a></div><div class="ttdoc">Random Number Generator.</div></div>
<div class="ttc" id="astructpj__time__val_htm"><div class="ttname"><a href="structpj__time__val.htm">pj_time_val</a></div><div class="ttdef"><b>Definition:</b> types.h:397</div></div>
<div class="ttc" id="aunionpj__timestamp_htm"><div class="ttname"><a href="unionpj__timestamp.htm">pj_timestamp</a></div><div class="ttdef"><b>Definition:</b> types.h:134</div></div>
<div class="ttc" id="aunionpj__timestamp_htm_a2108e6b2a0b25129da1dbaef8076c218"><div class="ttname"><a href="unionpj__timestamp.htm#a2108e6b2a0b25129da1dbaef8076c218">pj_timestamp::lo</a></div><div class="ttdeci">pj_uint32_t lo</div><div class="ttdef"><b>Definition:</b> types.h:142</div></div>
<div class="ttc" id="aunionpj__timestamp_htm_ad8d7dc97c37ef8ee2a7fac9960c85039"><div class="ttname"><a href="unionpj__timestamp.htm#ad8d7dc97c37ef8ee2a7fac9960c85039">pj_timestamp::hi</a></div><div class="ttdeci">pj_uint32_t hi</div><div class="ttdef"><b>Definition:</b> types.h:141</div></div>
<div class="ttc" id="aunionpj__timestamp_htm_aff0c07d99e2c40a8ab1fb2d34276d81d"><div class="ttname"><a href="unionpj__timestamp.htm#aff0c07d99e2c40a8ab1fb2d34276d81d">pj_timestamp::u32</a></div><div class="ttdeci">struct pj_timestamp::@9 u32</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<p>&nbsp;</p>
<hr><center>
PJLIB Open Source, high performance, small footprint, and very very portable framework<br>
Copyright (C) 2006-2009 Teluu Inc.
</center>
<!--#include virtual="/footer.html" -->
</BODY>
</HTML>
