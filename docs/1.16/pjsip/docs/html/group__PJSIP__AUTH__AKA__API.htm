<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>PJSIP Reference: Digest AKAv1 and AKAv2 Authentication API (1.16)</title>
<link href="/style/style.css" rel="stylesheet" type="text/css">
</head><body>
	<!--#include virtual="/header.html" -->
	<p><A HREF="/">Home</A> --&gt; <A HREF="/docs.htm">Documentations</A> --&gt; PJSIP Reference</p>

<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.htm"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.htm"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.htm"><span>Modules</span></a></li>
      <li><a href="annotated.htm"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.htm"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<h1>Digest AKAv1 and AKAv2 Authentication API<br/>
<small>
[<a class="el" href="group__PJSIP__AUTH__API.htm">Authentication API's</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>Digest AKAv1 and AKAv2 Authentication API.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__PJSIP__AUTH__AKA__API.htm#ga6cba7aeaf5c646162ec57489ca9642ac">PJSIP_AKA_AKLEN</a>&nbsp;&nbsp;&nbsp;6</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__PJSIP__AUTH__AKA__API.htm#ga52e27a99617a50b8f261126a73965e61">PJSIP_AKA_AMFLEN</a>&nbsp;&nbsp;&nbsp;2</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__PJSIP__AUTH__AKA__API.htm#ga4bc81b12d79cf4735ef6665062e317dc">PJSIP_AKA_AUTNLEN</a>&nbsp;&nbsp;&nbsp;16</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__PJSIP__AUTH__AKA__API.htm#ga84104059d32457bc72b2ddc280f17105">PJSIP_AKA_CKLEN</a>&nbsp;&nbsp;&nbsp;16</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__PJSIP__AUTH__AKA__API.htm#ga9abe84690a8b0070c85459326f3d9ee6">PJSIP_AKA_IKLEN</a>&nbsp;&nbsp;&nbsp;16</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__PJSIP__AUTH__AKA__API.htm#ga96bf2a9d3940ee550ccfb9046b6526f8">PJSIP_AKA_KLEN</a>&nbsp;&nbsp;&nbsp;16</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__PJSIP__AUTH__AKA__API.htm#ga59994534d378362a50645df58bd74c67">PJSIP_AKA_MACLEN</a>&nbsp;&nbsp;&nbsp;8</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__PJSIP__AUTH__AKA__API.htm#ga0e306dff4fb54448b83fc0d7738b9ac3">PJSIP_AKA_OPLEN</a>&nbsp;&nbsp;&nbsp;16</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__PJSIP__AUTH__AKA__API.htm#gaf47e8b65fd7e1e5ef303695bb661193c">PJSIP_AKA_RANDLEN</a>&nbsp;&nbsp;&nbsp;16</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__PJSIP__AUTH__AKA__API.htm#ga4fab69a38db314f90992971d17c02530">PJSIP_AKA_RESLEN</a>&nbsp;&nbsp;&nbsp;8</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__PJSIP__AUTH__AKA__API.htm#gad19cf3d430bfc94fa998dd8f8e4895bc">PJSIP_AKA_SQNLEN</a>&nbsp;&nbsp;&nbsp;6</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="elRef" doxygen="pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__PJSIP__AUTH__AKA__API.htm#gaafe9da8c3964f2dff4441854d7be7a1f">pjsip_auth_create_aka_response</a> (<a class="elRef" doxygen="pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__pool__t.htm">pj_pool_t</a> *pool, const <a class="el" href="structpjsip__digest__challenge.htm">pjsip_digest_challenge</a> *chal, const <a class="el" href="structpjsip__cred__info.htm">pjsip_cred_info</a> *cred, const <a class="elRef" doxygen="pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__str__t.htm">pj_str_t</a> *method, <a class="el" href="structpjsip__digest__credential.htm">pjsip_digest_credential</a> *auth)</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>This module implements HTTP digest authentication using Authentication and Key Agreement (AKA) version 1 and version 2 (AKAv1-MD5 and AKAv2-MD5), as specified in RFC 3310 and RFC 4169. SIP AKA authentication is used by 3GPP and IMS systems.</p>
<h2><a class="anchor" id="pjsip_aka_using"></a>
Using Digest AKA Authentication</h2>
<p>Support for digest AKA authentication is currently made optional, so application needs to declare <em>PJSIP_HAS_DIGEST_AKA_AUTH</em> to non-zero in <code>config_site.h</code> to enable AKA support:</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">   #define PJSIP_HAS_DIGEST_AKA_AUTH   1</span>
</pre></div><p>In addition, application would need to link with <b>libmilenage</b> library from <em>third_party</em> directory.</p>
<p>Application then specifies digest AKA credential by initializing the authentication credential as follows:</p>
<div class="fragment"><pre class="fragment">    <a class="code" href="structpjsip__cred__info.htm">pjsip_cred_info</a> cred;

    <a class="codeRef" doxygen="pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#gafa92001573289c87313c660146369fa3">pj_bzero</a>(&amp;cred, <span class="keyword">sizeof</span>(cred));

    cred.<a class="code" href="structpjsip__cred__info.htm#ae31c9ec1c99fb1ffa20be5954ee995a7">scheme</a> = <a class="codeRef" doxygen="pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a>(<span class="stringliteral">&quot;Digest&quot;</span>);
    cred.<a class="code" href="structpjsip__cred__info.htm#a96eee6bdc2b0e7e3b7eea9b4e1c15674">realm</a> = <a class="codeRef" doxygen="pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a>(<span class="stringliteral">&quot;ims-domain.test&quot;</span>);
    cred.<a class="code" href="structpjsip__cred__info.htm#a3e1f72a171886985c6dfcd57d4bc4f17">username</a> = <a class="codeRef" doxygen="pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a>(<span class="stringliteral">&quot;user@ims-domain.test&quot;</span>);
    cred.<a class="code" href="structpjsip__cred__info.htm#a8b1e563c814bdf8012f0bdf966d0ad9d">data_type</a> = <a class="code" href="group__PJSIP__AUTH__API.htm#ggaf9ec66dd77133258711d6759fd31a7caad5f0fcf79abef3be6232fe7878173505">PJSIP_CRED_DATA_PLAIN_PASSWD</a> | PJSIP_CRED_DATA_EXT_AKA;
    cred.<a class="code" href="structpjsip__cred__info.htm#ab3947a7800c51d28a1b25f4fdaea78bd">data</a> = <a class="codeRef" doxygen="pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a>(<span class="stringliteral">&quot;password&quot;</span>);

    <span class="comment">// AKA extended info</span>
    cred.<a class="code" href="structpjsip__cred__info.htm#a821c65d42d094a7bc824b3b2442e365e">ext</a>.<a class="code" href="structpjsip__cred__info.htm#a506a779d27479717b9fcb66c50fe625e">aka</a>.k = <a class="codeRef" doxygen="pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a>(<span class="stringliteral">&quot;password&quot;</span>);
    cred.<a class="code" href="structpjsip__cred__info.htm#a821c65d42d094a7bc824b3b2442e365e">ext</a>.<a class="code" href="structpjsip__cred__info.htm#a506a779d27479717b9fcb66c50fe625e">aka</a>.cb = &amp;<a class="code" href="group__PJSIP__AUTH__AKA__API.htm#gaafe9da8c3964f2dff4441854d7be7a1f">pjsip_auth_create_aka_response</a>
</pre></div><p>Description:</p>
<ul>
<li>To support AKA, application adds <em>PJSIP_CRED_DATA_EXT_AKA</em> flag in the <em>data_type</em> field. This indicates that extended information specific to AKA authentication is available in the credential, and that response digest computation will use the callback function instead of the usual MD5 digest computation.</li>
</ul>
<ul>
<li>The <em>scheme</em> for the credential is "Digest".</li>
</ul>
<ul>
<li>The <em>realm</em> is the expected realm in the challenge. Application may also specify wildcard realm ("*") if it wishes to respond to any realms in the challenge.</li>
</ul>
<ul>
<li>The <em>data</em> field is optional. Application may fill this with the password if it wants to support both MD5 and AKA MD5 in a single credential. The <a class="el" href="group__PJSIP__AUTH__AKA__API.htm#gaafe9da8c3964f2dff4441854d7be7a1f">pjsip_auth_create_aka_response()</a> function will use this field if the challenge indicates "MD5" as the algorithm instead of "AKAv1-MD5" or "AKAv2-MD5".</li>
</ul>
<ul>
<li>The <em>ext.aka.k</em> field specifies the permanent subscriber key to be used for AKA authentication. Application may specify binary password containing NULL character in this key, since the length of the key is indicated in the <em>slen</em> field of the string.</li>
</ul>
<ul>
<li>The <em>ext.aka.cb</em> field specifies the callback function to calculate the response digest. Application can specify <a class="el" href="group__PJSIP__AUTH__AKA__API.htm#gaafe9da8c3964f2dff4441854d7be7a1f">pjsip_auth_create_aka_response()</a> in this field to use PJSIP's implementation, but it's free to provide it's own function.</li>
</ul>
<ul>
<li>Optionally application may set <em>ext.aka.op</em> and <em>ext.aka.amf</em> in the credential to specify AKA Operator variant key and AKA Authentication Management Field information. </li>
</ul>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="ga6cba7aeaf5c646162ec57489ca9642ac"></a><!-- doxytag: member="sip_auth_aka.h::PJSIP_AKA_AKLEN" ref="ga6cba7aeaf5c646162ec57489ca9642ac" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PJSIP_AKA_AKLEN&nbsp;&nbsp;&nbsp;6</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Length of Authentication Key (AK) in bytes. </p>

</div>
</div>
<a class="anchor" id="ga52e27a99617a50b8f261126a73965e61"></a><!-- doxytag: member="sip_auth_aka.h::PJSIP_AKA_AMFLEN" ref="ga52e27a99617a50b8f261126a73965e61" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PJSIP_AKA_AMFLEN&nbsp;&nbsp;&nbsp;2</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Length of Authentication Management Field (AMF) in bytes. </p>

</div>
</div>
<a class="anchor" id="ga4bc81b12d79cf4735ef6665062e317dc"></a><!-- doxytag: member="sip_auth_aka.h::PJSIP_AKA_AUTNLEN" ref="ga4bc81b12d79cf4735ef6665062e317dc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PJSIP_AKA_AUTNLEN&nbsp;&nbsp;&nbsp;16</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Length of AUTN in bytes. </p>

</div>
</div>
<a class="anchor" id="ga84104059d32457bc72b2ddc280f17105"></a><!-- doxytag: member="sip_auth_aka.h::PJSIP_AKA_CKLEN" ref="ga84104059d32457bc72b2ddc280f17105" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PJSIP_AKA_CKLEN&nbsp;&nbsp;&nbsp;16</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Length of Confidentiality Key (CK) in bytes. </p>

</div>
</div>
<a class="anchor" id="ga9abe84690a8b0070c85459326f3d9ee6"></a><!-- doxytag: member="sip_auth_aka.h::PJSIP_AKA_IKLEN" ref="ga9abe84690a8b0070c85459326f3d9ee6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PJSIP_AKA_IKLEN&nbsp;&nbsp;&nbsp;16</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Length of Integrity Key (AK) in bytes. </p>

</div>
</div>
<a class="anchor" id="ga96bf2a9d3940ee550ccfb9046b6526f8"></a><!-- doxytag: member="sip_auth_aka.h::PJSIP_AKA_KLEN" ref="ga96bf2a9d3940ee550ccfb9046b6526f8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PJSIP_AKA_KLEN&nbsp;&nbsp;&nbsp;16</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Length of permanent/subscriber Key (K) in bytes. </p>

</div>
</div>
<a class="anchor" id="ga59994534d378362a50645df58bd74c67"></a><!-- doxytag: member="sip_auth_aka.h::PJSIP_AKA_MACLEN" ref="ga59994534d378362a50645df58bd74c67" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PJSIP_AKA_MACLEN&nbsp;&nbsp;&nbsp;8</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Length of AKA authentication code in bytes. </p>

</div>
</div>
<a class="anchor" id="ga0e306dff4fb54448b83fc0d7738b9ac3"></a><!-- doxytag: member="sip_auth_aka.h::PJSIP_AKA_OPLEN" ref="ga0e306dff4fb54448b83fc0d7738b9ac3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PJSIP_AKA_OPLEN&nbsp;&nbsp;&nbsp;16</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Length of operator key in bytes. </p>

</div>
</div>
<a class="anchor" id="gaf47e8b65fd7e1e5ef303695bb661193c"></a><!-- doxytag: member="sip_auth_aka.h::PJSIP_AKA_RANDLEN" ref="gaf47e8b65fd7e1e5ef303695bb661193c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PJSIP_AKA_RANDLEN&nbsp;&nbsp;&nbsp;16</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Length of random challenge (RAND) in bytes. </p>

</div>
</div>
<a class="anchor" id="ga4fab69a38db314f90992971d17c02530"></a><!-- doxytag: member="sip_auth_aka.h::PJSIP_AKA_RESLEN" ref="ga4fab69a38db314f90992971d17c02530" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PJSIP_AKA_RESLEN&nbsp;&nbsp;&nbsp;8</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Length of response digest in bytes. </p>

</div>
</div>
<a class="anchor" id="gad19cf3d430bfc94fa998dd8f8e4895bc"></a><!-- doxytag: member="sip_auth_aka.h::PJSIP_AKA_SQNLEN" ref="gad19cf3d430bfc94fa998dd8f8e4895bc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PJSIP_AKA_SQNLEN&nbsp;&nbsp;&nbsp;6</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Length of sequence number (SQN) in bytes. </p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="gaafe9da8c3964f2dff4441854d7be7a1f"></a><!-- doxytag: member="sip_auth_aka.h::pjsip_auth_create_aka_response" ref="gaafe9da8c3964f2dff4441854d7be7a1f" args="(pj_pool_t *pool, const pjsip_digest_challenge *chal, const pjsip_cred_info *cred, const pj_str_t *method, pjsip_digest_credential *auth)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="elRef" doxygen="pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> pjsip_auth_create_aka_response </td>
          <td>(</td>
          <td class="paramtype"><a class="elRef" doxygen="pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__pool__t.htm">pj_pool_t</a> *&nbsp;</td>
          <td class="paramname"> <em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structpjsip__digest__challenge.htm">pjsip_digest_challenge</a> *&nbsp;</td>
          <td class="paramname"> <em>chal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structpjsip__cred__info.htm">pjsip_cred_info</a> *&nbsp;</td>
          <td class="paramname"> <em>cred</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="elRef" doxygen="pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__str__t.htm">pj_str_t</a> *&nbsp;</td>
          <td class="paramname"> <em>method</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structpjsip__digest__credential.htm">pjsip_digest_credential</a> *&nbsp;</td>
          <td class="paramname"> <em>auth</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function creates MD5, AKAv1-MD5, or AKAv2-MD5 response for the specified challenge in <em>chal</em>, according to the algorithm specified in the challenge, and based on the information in the credential <em>cred</em>.</p>
<p>Application may register this function as <em>ext.aka.cb</em> field of <a class="el" href="structpjsip__cred__info.htm">pjsip_cred_info</a> structure to make PJSIP automatically call this function to calculate the response digest. To do so, it needs to add <em>PJSIP_CRED_DATA_EXT_AKA</em> flag in the <em>data_type</em> field of the credential, and fills up other AKA specific information in the credential.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pool</em>&nbsp;</td><td>Pool to allocate memory. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>chal</em>&nbsp;</td><td>The authentication challenge sent by server in 401 or 401 response, as either Proxy-Authenticate or WWW-Authenticate header. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>cred</em>&nbsp;</td><td>The credential to be used. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>method</em>&nbsp;</td><td>The request method. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>auth</em>&nbsp;</td><td>The digest credential where the digest response will be placed to. Upon calling this function, the nonce, nc, cnonce, qop, uri, and realm fields of this structure must have been set by caller. Upon return, the <em>response</em> field will be initialized by this function.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>PJ_SUCCESS if response has been created successfully. </dd></dl>

</div>
</div>
</div>
<p>&nbsp;</p>
<hr><center>
PJSIP Open Source, high performance, small footprint, and very very portable SIP stack<br>
Copyright (C) 2006-2008 Teluu Inc.
</center>
<!--#include virtual="/footer.html" -->

</BODY>
</HTML>
