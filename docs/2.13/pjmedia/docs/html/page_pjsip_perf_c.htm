<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Samples: SIP Performance Benchmark (2.13)</title>
<link href="/style/style.css" rel="stylesheet" type="text/css">
</head><body>
	<!--#include virtual="/header.html" -->
	<p><A HREF="/">Home</A> --&gt; <A HREF="/docs.htm">Documentations</A> --&gt; PJMEDIA Reference</p>
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Samples: SIP Performance Benchmark </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><b>pjsip-perf</b> is a complete program to measure the performance of PJSIP or other SIP endpoints. It consists of two parts:</p><ul>
<li>the server, to respond incoming requests, and</li>
<li>the client, who actively submits requests and measure the performance of the server.</li>
</ul>
<p >Both server and client part can run simultaneously, to measure the performance when both endpoints are co-located in a single program.</p>
<p >The server accepts both INVITE and non-INVITE requests. The server exports several different types of URL, which would control how the request would be handled by the server:</p><ul>
<li>URL with "0" as the user part will be handled statelessly. It should not be used with INVITE method.</li>
<li>URL with "1" as the user part will be handled statefully. If the request is an INVITE request, INVITE transaction will be created and 200/OK response will be sent, along with a valid SDP body. However, the SDP is just a static text body, and is not a proper SDP generated by PJMEDIA.</li>
<li>URL with "2" as the user part is only meaningful for INVITE requests, as it would be handled <b>call-statefully</b> by the server. For this URL, the server also would generate SDP dynamically and perform a proper SDP negotiation for the incoming call. Also for every call, server will limit the call duration to 10 seconds, on which the call will be terminated if the client doesn't hangup the call.</li>
</ul>
<p >This file is pjsip-apps/src/samples/pjsip-perf.c</p>
<div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">/* </span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment"> * Copyright (C) 2008-2011 Teluu Inc. (http://www.teluu.com)</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment"> * Copyright (C) 2003-2008 Benny Prijono &lt;benny@prijono.org&gt;</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment"> *</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment"> * This program is free software; you can redistribute it and/or modify</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment"> * it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment"> * the Free Software Foundation; either version 2 of the License, or</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="comment"> * (at your option) any later version.</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment"> *</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment"> * This program is distributed in the hope that it will be useful,</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="comment"> * GNU General Public License for more details.</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="comment"> *</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="comment"> * You should have received a copy of the GNU General Public License</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="comment"> * along with this program; if not, write to the Free Software</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="comment"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA </span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="comment"> */</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span> </div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span> </div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span><span class="comment">/* Include all headers. */</span></div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span><span class="preprocessor">#include &lt;pjsip.h&gt;</span></div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span><span class="preprocessor">#include &lt;<a class="code" href="pjmedia_8h.htm">pjmedia.h</a>&gt;</span></div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span><span class="preprocessor">#include &lt;<a class="code" href="pjmedia-codec_8h.htm">pjmedia-codec.h</a>&gt;</span></div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span><span class="preprocessor">#include &lt;pjsip_ua.h&gt;</span></div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span><span class="preprocessor">#include &lt;pjsip_simple.h&gt;</span></div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span><span class="preprocessor">#include &lt;pjlib-util.h&gt;</span></div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span><span class="preprocessor">#include &lt;pjlib.h&gt;</span></div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span> </div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span><span class="preprocessor">#if (defined(PJ_WIN32) &amp;&amp; PJ_WIN32!=0) || (defined(PJ_WIN64) &amp;&amp; PJ_WIN64!=0)</span></div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span><span class="preprocessor">#  include &lt;windows.h&gt;</span></div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span> </div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span><span class="preprocessor">#define THIS_FILE           &quot;pjsip-perf.c&quot;</span></div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span><span class="preprocessor">#define DEFAULT_COUNT       (pjsip_cfg()-&gt;tsx.max_count/2&gt;10000?10000:pjsip_cfg()-&gt;tsx.max_count/2)</span></div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span><span class="preprocessor">#define JOB_WINDOW          1000</span></div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span><span class="preprocessor">#define TERMINATE_TSX(x,c)</span></div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span> </div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span> </div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span><span class="preprocessor">#ifndef CACHING_POOL_SIZE</span></div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span><span class="preprocessor">#   define CACHING_POOL_SIZE   (256*1024*1024)</span></div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span> </div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span> </div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span><span class="comment">/* Static message body for INVITE, when stateful processing is</span></div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span><span class="comment"> * invoked (instead of call-stateful, where SDP is generated</span></div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span><span class="comment"> * dynamically.</span></div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span><span class="comment"> */</span></div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span><span class="keyword">static</span> <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__str__t.htm">pj_str_t</a> dummy_sdp_str = </div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>{</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>    <span class="stringliteral">&quot;v=0\r\n&quot;</span></div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>    <span class="stringliteral">&quot;o=- 3360842071 3360842071 IN IP4 192.168.0.68\r\n&quot;</span></div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>    <span class="stringliteral">&quot;s=pjmedia\r\n&quot;</span></div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>    <span class="stringliteral">&quot;c=IN IP4 192.168.0.68\r\n&quot;</span></div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>    <span class="stringliteral">&quot;t=0 0\r\n&quot;</span></div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>    <span class="stringliteral">&quot;m=audio 4000 RTP/AVP 0 8 3 103 102 101\r\n&quot;</span></div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>    <span class="stringliteral">&quot;a=rtcp:4001 IN IP4 192.168.0.68\r\n&quot;</span></div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>    <span class="stringliteral">&quot;a=rtpmap:103 speex/16000\r\n&quot;</span></div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>    <span class="stringliteral">&quot;a=rtpmap:102 speex/8000\r\n&quot;</span></div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>    <span class="stringliteral">&quot;a=rtpmap:3 GSM/8000\r\n&quot;</span></div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>    <span class="stringliteral">&quot;a=rtpmap:0 PCMU/8000\r\n&quot;</span></div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>    <span class="stringliteral">&quot;a=rtpmap:8 PCMA/8000\r\n&quot;</span></div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>    <span class="stringliteral">&quot;a=sendrecv\r\n&quot;</span></div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>    <span class="stringliteral">&quot;a=rtpmap:101 telephone-event/8000\r\n&quot;</span></div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>    <span class="stringliteral">&quot;a=fmtp:101 0-15\r\n&quot;</span>,</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>    0</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>};</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span> </div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span><span class="keyword">static</span> <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__str__t.htm">pj_str_t</a> mime_application = { <span class="stringliteral">&quot;application&quot;</span>, 11};</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span><span class="keyword">static</span> <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__str__t.htm">pj_str_t</a> mime_sdp = {<span class="stringliteral">&quot;sdp&quot;</span>, 3};</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span> </div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span> </div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span><span class="keyword">struct </span><a class="code hl_struct" href="structsrv__state.htm">srv_state</a></div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>{</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>    <span class="keywordtype">unsigned</span>        stateless_cnt;</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>    <span class="keywordtype">unsigned</span>        stateful_cnt;</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>    <span class="keywordtype">unsigned</span>        call_cnt;</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>};</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span> </div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span> </div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span><span class="keyword">struct </span>app</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>{</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>    <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__caching__pool.htm">pj_caching_pool</a>      cp;</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>    <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__pool__t.htm">pj_pool_t</a>           *pool;</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>    <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga1dc7a356fb36bd2dee2bc7d6c7e817e4">pj_bool_t</a>            use_tcp;</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>    <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__str__t.htm">pj_str_t</a>             local_addr;</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>    <span class="keywordtype">int</span>                  local_port;</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>    pjsip_endpoint      *sip_endpt;</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>    <a class="code hl_typedef" href="group__PJMEDIA__TYPES.htm#ga7c3623d8e90e22b7184a6e42dc24f6f5">pjmedia_endpt</a>       *med_endpt;</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>    <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__str__t.htm">pj_str_t</a>             local_uri;</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>    <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__str__t.htm">pj_str_t</a>             local_contact;</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>    <span class="keywordtype">unsigned</span>             skinfo_cnt;</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>    <a class="code hl_struct" href="structpjmedia__sock__info.htm">pjmedia_sock_info</a>    skinfo[8];</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span> </div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>    <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga1dc7a356fb36bd2dee2bc7d6c7e817e4">pj_bool_t</a>            thread_quit;</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>    <span class="keywordtype">unsigned</span>             thread_count;</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>    <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gacb9d46aed6813bf142efc1c3db7a2d17">pj_thread_t</a>         *thread[16];</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span> </div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>    <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga1dc7a356fb36bd2dee2bc7d6c7e817e4">pj_bool_t</a>            real_sdp;</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>    <a class="code hl_struct" href="structpjmedia__sdp__session.htm">pjmedia_sdp_session</a> *dummy_sdp;</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span> </div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>    <span class="keywordtype">int</span>                  log_level;</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span> </div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>    <span class="keyword">struct </span>{</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>        pjsip_method         method;</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>        <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__str__t.htm">pj_str_t</a>             dst_uri;</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>        <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga1dc7a356fb36bd2dee2bc7d6c7e817e4">pj_bool_t</a>            stateless;</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>        <span class="keywordtype">unsigned</span>             timeout;</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>        <span class="keywordtype">unsigned</span>             job_count,</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>                             job_submitted, </div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>                             job_finished,</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>                             job_window;</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>        <span class="keywordtype">unsigned</span>             stat_max_window;</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>        <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__time__val.htm">pj_time_val</a>          first_request;</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>        <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__time__val.htm">pj_time_val</a>          requests_sent;</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>        <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__time__val.htm">pj_time_val</a>          last_completion;</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>        <span class="keywordtype">unsigned</span>             total_responses;</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>        <span class="keywordtype">unsigned</span>             response_codes[800];</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>    } client;</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span> </div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>    <span class="keyword">struct </span>{</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>        <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga1dc7a356fb36bd2dee2bc7d6c7e817e4">pj_bool_t</a> send_trying;</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>        <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga1dc7a356fb36bd2dee2bc7d6c7e817e4">pj_bool_t</a> send_ringing;</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>        <span class="keywordtype">unsigned</span> delay;</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>        <span class="keyword">struct </span><a class="code hl_struct" href="structsrv__state.htm">srv_state</a> prev_state;</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>        <span class="keyword">struct </span><a class="code hl_struct" href="structsrv__state.htm">srv_state</a> cur_state;</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>    } server;</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span> </div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span> </div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>} app;</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span> </div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span><span class="keyword">struct </span><a class="code hl_struct" href="structcall.htm">call</a></div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>{</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>    pjsip_inv_session   *inv;</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>    <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__timer__entry.htm">pj_timer_entry</a>       ans_timer;</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>};</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span> </div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span> </div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span><span class="keyword">static</span> <span class="keywordtype">void</span> app_perror(<span class="keyword">const</span> <span class="keywordtype">char</span> *sender, <span class="keyword">const</span> <span class="keywordtype">char</span> *title, </div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>                       <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> status)</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>{</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>    <span class="keywordtype">char</span> errmsg[<a class="code hl_defineRef" href="../../../pjlib/docs/html/group__pj__errno.htm#ga314a8edfdcec54a086a401e97b5b0bd0">PJ_ERR_MSG_SIZE</a>];</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span> </div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>    <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__pj__errno.htm#ga7d2616aded0d61924fb31f4fd6ee45c0">pj_strerror</a>(status, errmsg, <span class="keyword">sizeof</span>(errmsg));</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>    <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(1,(sender, <span class="stringliteral">&quot;%s: %s [code=%d]&quot;</span>, title, errmsg, status));</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>}</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span> </div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span> </div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span><span class="comment">/**************************************************************************</span></div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span><span class="comment"> * STATELESS SERVER</span></div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span><span class="comment"> */</span></div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span><span class="keyword">static</span> <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga1dc7a356fb36bd2dee2bc7d6c7e817e4">pj_bool_t</a> mod_stateless_on_rx_request(pjsip_rx_data *rdata);</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span> </div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span><span class="comment">/* Module to handle incoming requests statelessly.</span></div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span><span class="comment"> */</span></div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span><span class="keyword">static</span> pjsip_module mod_stateless_server =</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>{</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>    NULL, NULL,                     <span class="comment">/* prev, next.              */</span></div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>    { <span class="stringliteral">&quot;mod-stateless-server&quot;</span>, 20 }, <span class="comment">/* Name.                    */</span></div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>    -1,                             <span class="comment">/* Id                       */</span></div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>    PJSIP_MOD_PRIORITY_APPLICATION, <span class="comment">/* Priority                 */</span></div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>    NULL,                           <span class="comment">/* load()                   */</span></div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>    NULL,                           <span class="comment">/* start()                  */</span></div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>    NULL,                           <span class="comment">/* stop()                   */</span></div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>    NULL,                           <span class="comment">/* unload()                 */</span></div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>    &amp;mod_stateless_on_rx_request,   <span class="comment">/* on_rx_request()          */</span></div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>    NULL,                           <span class="comment">/* on_rx_response()         */</span></div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>    NULL,                           <span class="comment">/* on_tx_request.           */</span></div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>    NULL,                           <span class="comment">/* on_tx_response()         */</span></div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>    NULL,                           <span class="comment">/* on_tsx_state()           */</span></div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>};</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span> </div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span> </div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span><span class="keyword">static</span> <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga1dc7a356fb36bd2dee2bc7d6c7e817e4">pj_bool_t</a> mod_stateless_on_rx_request(pjsip_rx_data *rdata)</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>{</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>    <span class="keyword">const</span> <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__str__t.htm">pj_str_t</a> stateless_user = { <span class="stringliteral">&quot;0&quot;</span>, 1 };</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>    pjsip_uri *uri;</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>    pjsip_sip_uri *sip_uri;</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span> </div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>    uri = pjsip_uri_get_uri(rdata-&gt;msg_info.msg-&gt;line.req.uri);</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span> </div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>    <span class="comment">/* Only want to receive SIP/SIPS scheme */</span></div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>    <span class="keywordflow">if</span> (!PJSIP_URI_SCHEME_IS_SIP(uri) &amp;&amp; !PJSIP_URI_SCHEME_IS_SIPS(uri))</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>        <span class="keywordflow">return</span> <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead95511b40a74f4625b161dd9e42c6e6e">PJ_FALSE</a>;</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span> </div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>    sip_uri = (pjsip_sip_uri*) uri;</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span> </div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>    <span class="comment">/* Check for matching user part */</span></div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>    <span class="keywordflow">if</span> (<a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga521ddd312725bf6fa77e91d0dd4aec34">pj_strcmp</a>(&amp;sip_uri-&gt;user, &amp;stateless_user)!=0)</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>        <span class="keywordflow">return</span> <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead95511b40a74f4625b161dd9e42c6e6e">PJ_FALSE</a>;</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span> </div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>    <span class="comment">/*</span></div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span><span class="comment">     * Yes, this is for us.</span></div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span><span class="comment">     */</span></div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span> </div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>    <span class="comment">/* Ignore ACK request */</span></div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>    <span class="keywordflow">if</span> (rdata-&gt;msg_info.msg-&gt;line.req.method.id == PJSIP_ACK_METHOD)</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>        <span class="keywordflow">return</span> <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead235b21a623d982cc561fb12bffa87c0">PJ_TRUE</a>;</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span> </div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>    <span class="comment">/*</span></div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span><span class="comment">     * Respond statelessly with 200/OK.</span></div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span><span class="comment">     */</span></div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>    pjsip_endpt_respond_stateless(app.sip_endpt, rdata, 200, NULL,</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>                                  NULL, NULL);</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>    app.server.cur_state.stateless_cnt++;</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>    <span class="keywordflow">return</span> <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead235b21a623d982cc561fb12bffa87c0">PJ_TRUE</a>;</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>}</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span> </div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span> </div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span><span class="comment">/**************************************************************************</span></div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span><span class="comment"> * STATEFUL SERVER</span></div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span><span class="comment"> */</span></div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span><span class="keyword">static</span> <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga1dc7a356fb36bd2dee2bc7d6c7e817e4">pj_bool_t</a> mod_stateful_on_rx_request(pjsip_rx_data *rdata);</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span> </div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span><span class="comment">/* Module to handle incoming requests statefully.</span></div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span><span class="comment"> */</span></div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span><span class="keyword">static</span> pjsip_module mod_stateful_server =</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>{</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>    NULL, NULL,                     <span class="comment">/* prev, next.              */</span></div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>    { <span class="stringliteral">&quot;mod-stateful-server&quot;</span>, 19 },  <span class="comment">/* Name.                    */</span></div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>    -1,                             <span class="comment">/* Id                       */</span></div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>    PJSIP_MOD_PRIORITY_APPLICATION, <span class="comment">/* Priority                 */</span></div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>    NULL,                           <span class="comment">/* load()                   */</span></div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>    NULL,                           <span class="comment">/* start()                  */</span></div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>    NULL,                           <span class="comment">/* stop()                   */</span></div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>    NULL,                           <span class="comment">/* unload()                 */</span></div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>    &amp;mod_stateful_on_rx_request,   <span class="comment">/* on_rx_request()           */</span></div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>    NULL,                           <span class="comment">/* on_rx_response()         */</span></div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>    NULL,                           <span class="comment">/* on_tx_request.           */</span></div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>    NULL,                           <span class="comment">/* on_tx_response()         */</span></div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>    NULL,                           <span class="comment">/* on_tsx_state()           */</span></div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>};</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span> </div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span> </div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span><span class="keyword">static</span> <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga1dc7a356fb36bd2dee2bc7d6c7e817e4">pj_bool_t</a> mod_stateful_on_rx_request(pjsip_rx_data *rdata)</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>{</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>    <span class="keyword">const</span> <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__str__t.htm">pj_str_t</a> stateful_user = { <span class="stringliteral">&quot;1&quot;</span>, 1 };</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>    pjsip_uri *uri;</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>    pjsip_sip_uri *sip_uri;</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span> </div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>    uri = pjsip_uri_get_uri(rdata-&gt;msg_info.msg-&gt;line.req.uri);</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span> </div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>    <span class="comment">/* Only want to receive SIP/SIPS scheme */</span></div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>    <span class="keywordflow">if</span> (!PJSIP_URI_SCHEME_IS_SIP(uri) &amp;&amp; !PJSIP_URI_SCHEME_IS_SIPS(uri))</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>        <span class="keywordflow">return</span> <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead95511b40a74f4625b161dd9e42c6e6e">PJ_FALSE</a>;</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span> </div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>    sip_uri = (pjsip_sip_uri*) uri;</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span> </div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>    <span class="comment">/* Check for matching user part */</span></div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>    <span class="keywordflow">if</span> (<a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga521ddd312725bf6fa77e91d0dd4aec34">pj_strcmp</a>(&amp;sip_uri-&gt;user, &amp;stateful_user)!=0)</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>        <span class="keywordflow">return</span> <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead95511b40a74f4625b161dd9e42c6e6e">PJ_FALSE</a>;</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span> </div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>    <span class="comment">/*</span></div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span><span class="comment">     * Yes, this is for us.</span></div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span><span class="comment">     * Respond statefully with 200/OK.</span></div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span><span class="comment">     */</span></div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>    <span class="keywordflow">switch</span> (rdata-&gt;msg_info.msg-&gt;line.req.method.id) {</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>    <span class="keywordflow">case</span> PJSIP_INVITE_METHOD:</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>        {</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>            pjsip_msg_body *body;</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span> </div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>            <span class="keywordflow">if</span> (dummy_sdp_str.<a class="code hl_variableRef" href="../../../pjlib/docs/html/structpj__str__t.htm#a46788480bdb4080083dcc8965811e015">slen</a> == 0)</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>                dummy_sdp_str.<a class="code hl_variableRef" href="../../../pjlib/docs/html/structpj__str__t.htm#a46788480bdb4080083dcc8965811e015">slen</a> = pj_ansi_strlen(dummy_sdp_str.<a class="code hl_variableRef" href="../../../pjlib/docs/html/structpj__str__t.htm#a4eb3153e4363a93f65f5c728911168d4">ptr</a>);</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span> </div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>            body = pjsip_msg_body_create(rdata-&gt;tp_info.pool, </div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>                                         &amp;mime_application, &amp;mime_sdp, </div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>                                         &amp;dummy_sdp_str);</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>            pjsip_endpt_respond(app.sip_endpt, &amp;mod_stateful_server, rdata,</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>                                200, NULL, NULL, body, NULL);</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>        }</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>    <span class="keywordflow">case</span> PJSIP_ACK_METHOD:</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>        <span class="keywordflow">return</span> <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead235b21a623d982cc561fb12bffa87c0">PJ_TRUE</a>;</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>        pjsip_endpt_respond(app.sip_endpt, &amp;mod_stateful_server, rdata,</div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>                            200, NULL, NULL, NULL, NULL);</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>    }</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span> </div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>    app.server.cur_state.stateful_cnt++;</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>    <span class="keywordflow">return</span> <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead235b21a623d982cc561fb12bffa87c0">PJ_TRUE</a>;</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>}</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span> </div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span> </div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span><span class="comment">/**************************************************************************</span></div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span><span class="comment"> * CALL SERVER</span></div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span><span class="comment"> */</span></div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span><span class="keyword">static</span> <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga1dc7a356fb36bd2dee2bc7d6c7e817e4">pj_bool_t</a> mod_call_on_rx_request(pjsip_rx_data *rdata);</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span> </div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span><span class="comment">/* Module to handle incoming requests callly.</span></div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span><span class="comment"> */</span></div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span><span class="keyword">static</span> pjsip_module mod_call_server =</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>{</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>    NULL, NULL,                     <span class="comment">/* prev, next.              */</span></div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>    { <span class="stringliteral">&quot;mod-call-server&quot;</span>, 15 },      <span class="comment">/* Name.                    */</span></div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>    -1,                             <span class="comment">/* Id                       */</span></div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>    PJSIP_MOD_PRIORITY_APPLICATION, <span class="comment">/* Priority                 */</span></div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>    NULL,                           <span class="comment">/* load()                   */</span></div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>    NULL,                           <span class="comment">/* start()                  */</span></div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>    NULL,                           <span class="comment">/* stop()                   */</span></div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>    NULL,                           <span class="comment">/* unload()                 */</span></div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>    &amp;mod_call_on_rx_request,        <span class="comment">/* on_rx_request()          */</span></div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>    NULL,                           <span class="comment">/* on_rx_response()         */</span></div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>    NULL,                           <span class="comment">/* on_tx_request.           */</span></div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>    NULL,                           <span class="comment">/* on_tx_response()         */</span></div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>    NULL,                           <span class="comment">/* on_tsx_state()           */</span></div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>};</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span> </div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span> </div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span><span class="keyword">static</span> <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> send_response(pjsip_inv_session *inv, </div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>                                 pjsip_rx_data *rdata,</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>                                 <span class="keywordtype">int</span> code,</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>                                 <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga1dc7a356fb36bd2dee2bc7d6c7e817e4">pj_bool_t</a> *has_initial)</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>{</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>    pjsip_tx_data *tdata;</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>    <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> status;</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span> </div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>    <span class="keywordflow">if</span> (*has_initial) {</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>        status = pjsip_inv_answer(inv, code, NULL, NULL, &amp;tdata);</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>        status = pjsip_inv_initial_answer(inv, rdata, code, </div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>                                          NULL, NULL, &amp;tdata);</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>    }</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span> </div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>    <span class="keywordflow">if</span> (status != <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>        <span class="keywordflow">if</span> (*has_initial) {</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>            status = pjsip_inv_answer(inv, PJSIP_SC_NOT_ACCEPTABLE, </div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>                                      NULL, NULL, &amp;tdata);</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>            status = pjsip_inv_initial_answer(inv, rdata, </div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>                                              PJSIP_SC_NOT_ACCEPTABLE,</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>                                              NULL, NULL, &amp;tdata);</div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>        }</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span> </div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>        <span class="keywordflow">if</span> (status == <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>            *has_initial = <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead235b21a623d982cc561fb12bffa87c0">PJ_TRUE</a>;</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>            pjsip_inv_send_msg(inv, tdata); </div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>            pjsip_inv_terminate(inv, 500, <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead95511b40a74f4625b161dd9e42c6e6e">PJ_FALSE</a>);</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>            <span class="keywordflow">return</span> -1;</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>        }</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>        *has_initial = <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead235b21a623d982cc561fb12bffa87c0">PJ_TRUE</a>;</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span> </div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>        status = pjsip_inv_send_msg(inv, tdata); </div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>        <span class="keywordflow">if</span> (status != <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>            pjsip_tx_data_dec_ref(tdata);</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>            <span class="keywordflow">return</span> status;</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>        }</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>    }</div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span> </div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>    <span class="keywordflow">return</span> status;</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>}</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span> </div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span><span class="keyword">static</span> <span class="keywordtype">void</span> answer_timer_cb(<a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gaec8852c90e22c6868c83d44dcbdecb8a">pj_timer_heap_t</a> *h, <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__timer__entry.htm">pj_timer_entry</a> *entry)</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>{</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structcall.htm">call</a> *<a class="code hl_struct" href="structcall.htm">call</a> = entry-&gt;<a class="code hl_variableRef" href="../../../pjlib/docs/html/structpj__timer__entry.htm#a96ce07b4b890b820ccd1e8365b88add6">user_data</a>;</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>    <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga1dc7a356fb36bd2dee2bc7d6c7e817e4">pj_bool_t</a> has_initial = <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead235b21a623d982cc561fb12bffa87c0">PJ_TRUE</a>;</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span> </div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>    <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__pj__config.htm#ga7523f8576efd271c22b188eab05d7870">PJ_UNUSED_ARG</a>(h);</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span> </div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>    entry-&gt;<a class="code hl_variableRef" href="../../../pjlib/docs/html/structpj__timer__entry.htm#a70aed199d89e16a05bd9643efd3d665d">id</a> = 0;</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>    send_response(<a class="code hl_struct" href="structcall.htm">call</a>-&gt;inv, NULL, 200, &amp;has_initial);</div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>}</div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span> </div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span><span class="keyword">static</span> <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga1dc7a356fb36bd2dee2bc7d6c7e817e4">pj_bool_t</a> mod_call_on_rx_request(pjsip_rx_data *rdata)</div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>{</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>    <span class="keyword">const</span> <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__str__t.htm">pj_str_t</a> call_user = { <span class="stringliteral">&quot;2&quot;</span>, 1 };</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>    pjsip_uri *uri;</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>    pjsip_sip_uri *sip_uri;</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structcall.htm">call</a> *<a class="code hl_struct" href="structcall.htm">call</a>;</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>    pjsip_dialog *dlg;</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>    <a class="code hl_struct" href="structpjmedia__sdp__session.htm">pjmedia_sdp_session</a> *sdp;</div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>    pjsip_tx_data *tdata;</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>    <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga1dc7a356fb36bd2dee2bc7d6c7e817e4">pj_bool_t</a> has_initial = <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead95511b40a74f4625b161dd9e42c6e6e">PJ_FALSE</a>;</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>    <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> status;</div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span> </div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>    uri = pjsip_uri_get_uri(rdata-&gt;msg_info.msg-&gt;line.req.uri);</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span> </div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>    <span class="comment">/* Only want to receive SIP/SIPS scheme */</span></div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>    <span class="keywordflow">if</span> (!PJSIP_URI_SCHEME_IS_SIP(uri) &amp;&amp; !PJSIP_URI_SCHEME_IS_SIPS(uri))</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>        <span class="keywordflow">return</span> <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead95511b40a74f4625b161dd9e42c6e6e">PJ_FALSE</a>;</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span> </div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>    sip_uri = (pjsip_sip_uri*) uri;</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span> </div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>    <span class="comment">/* Only want to handle INVITE requests. */</span></div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>    <span class="keywordflow">if</span> (rdata-&gt;msg_info.msg-&gt;line.req.method.id != PJSIP_INVITE_METHOD) {</div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>        <span class="keywordflow">return</span> <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead95511b40a74f4625b161dd9e42c6e6e">PJ_FALSE</a>;</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>    }</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span> </div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span> </div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>    <span class="comment">/* Check for matching user part. Incoming requests will be handled </span></div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span><span class="comment">     * call-statefully if:</span></div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span><span class="comment">     *  - user part is &quot;2&quot;, or</span></div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span><span class="comment">     *  - user part is not &quot;0&quot; nor &quot;1&quot; and method is INVITE.</span></div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span><span class="comment">     */</span></div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>    <span class="keywordflow">if</span> (<a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga521ddd312725bf6fa77e91d0dd4aec34">pj_strcmp</a>(&amp;sip_uri-&gt;user, &amp;call_user) == 0 ||</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>        sip_uri-&gt;user.slen != 1 ||</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>        (*sip_uri-&gt;user.ptr != <span class="charliteral">&#39;0&#39;</span> &amp;&amp; *sip_uri-&gt;user.ptr != <span class="charliteral">&#39;1&#39;</span>))</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>    {</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>        <span class="comment">/* Match */</span></div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span> </div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>        <span class="keywordflow">return</span> <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead95511b40a74f4625b161dd9e42c6e6e">PJ_FALSE</a>;</div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span>    }</div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span> </div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span> </div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>    <span class="comment">/* Verify that we can handle the request. */</span></div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>    <span class="keywordflow">if</span> (app.real_sdp) {</div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>        <span class="keywordtype">unsigned</span> options = 0;</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>        status = pjsip_inv_verify_request(rdata, &amp;options, NULL, NULL,</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>                                          app.sip_endpt, &amp;tdata);</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>        <span class="keywordflow">if</span> (status != <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span> </div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>            <span class="comment">/*</span></div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span><span class="comment">             * No we can&#39;t handle the incoming INVITE request.</span></div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span><span class="comment">             */</span></div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span> </div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>            <span class="keywordflow">if</span> (tdata) {</div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>                pjsip_response_addr res_addr;</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span> </div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>                pjsip_get_response_addr(tdata-&gt;pool, rdata, &amp;res_addr);</div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>                status = pjsip_endpt_send_response(app.sip_endpt, &amp;res_addr, tdata, </div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>                                          NULL, NULL);</div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>                <span class="keywordflow">if</span> (status != <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) pjsip_tx_data_dec_ref(tdata);</div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>                <span class="comment">/* Respond with 500 (Internal Server Error) */</span></div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>                pjsip_endpt_respond_stateless(app.sip_endpt, rdata, 500, NULL,</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>                                              NULL, NULL);</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>            }</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span> </div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>            <span class="keywordflow">return</span> <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead235b21a623d982cc561fb12bffa87c0">PJ_TRUE</a>;</div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>        } </div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>    }</div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span> </div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>    <span class="comment">/* Create UAS dialog */</span></div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>    status = pjsip_dlg_create_uas_and_inc_lock( pjsip_ua_instance(), rdata,</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>                                                &amp;app.local_contact, &amp;dlg);</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>    <span class="keywordflow">if</span> (status != <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>        <span class="keyword">const</span> <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__str__t.htm">pj_str_t</a> reason = <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a>(<span class="stringliteral">&quot;Unable to create dialog&quot;</span>);</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>        pjsip_endpt_respond_stateless( app.sip_endpt, rdata, </div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>                                       500, &amp;reason,</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>                                       NULL, NULL);</div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>        <span class="keywordflow">return</span> <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead235b21a623d982cc561fb12bffa87c0">PJ_TRUE</a>;</div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>    }</div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span> </div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>    <span class="comment">/* Alloc call structure. */</span></div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>    <a class="code hl_struct" href="structcall.htm">call</a> = <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__POOL.htm#ga5bedca9c6066f4e1a7254cbb70b4afcc">pj_pool_zalloc</a>(dlg-&gt;pool, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code hl_struct" href="structcall.htm">call</a>));</div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span> </div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>    <span class="comment">/* Create SDP from PJMEDIA */</span></div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>    <span class="keywordflow">if</span> (app.real_sdp) {</div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>        status = <a class="code hl_function" href="group__PJMED__ENDPT.htm#gaa49360a690c292dddd722b39c2f8c8bb">pjmedia_endpt_create_sdp</a>(app.med_endpt, rdata-&gt;tp_info.pool, </div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>                                          app.skinfo_cnt, app.skinfo, </div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>                                          &amp;sdp);</div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>        sdp = app.dummy_sdp;</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>    }</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span> </div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>    <span class="comment">/* Create UAS invite session */</span></div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span>    status = pjsip_inv_create_uas( dlg, rdata, sdp, 0, &amp;<a class="code hl_struct" href="structcall.htm">call</a>-&gt;inv);</div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>    <span class="keywordflow">if</span> (status != <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>        pjsip_dlg_create_response(dlg, rdata, 500, NULL, &amp;tdata);</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>        pjsip_dlg_send_response(dlg, pjsip_rdata_get_tsx(rdata), tdata);</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>        pjsip_dlg_dec_lock(dlg);</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>        <span class="keywordflow">return</span> <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead235b21a623d982cc561fb12bffa87c0">PJ_TRUE</a>;</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>    }</div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>    </div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>    <span class="comment">/* Invite session has been created, decrement &amp; release dialog lock. */</span></div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>    pjsip_dlg_dec_lock(dlg);</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span> </div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>    <span class="comment">/* Send 100/Trying if needed */</span></div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>    <span class="keywordflow">if</span> (app.server.send_trying) {</div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>        status = send_response(<a class="code hl_struct" href="structcall.htm">call</a>-&gt;inv, rdata, 100, &amp;has_initial);</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>        <span class="keywordflow">if</span> (status != <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>)</div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>            <span class="keywordflow">return</span> <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead235b21a623d982cc561fb12bffa87c0">PJ_TRUE</a>;</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>    }</div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span> </div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>    <span class="comment">/* Send 180/Ringing if needed */</span></div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>    <span class="keywordflow">if</span> (app.server.send_ringing) {</div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>        status = send_response(<a class="code hl_struct" href="structcall.htm">call</a>-&gt;inv, rdata, 180, &amp;has_initial);</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span>        <span class="keywordflow">if</span> (status != <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>)</div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>            <span class="keywordflow">return</span> <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead235b21a623d982cc561fb12bffa87c0">PJ_TRUE</a>;</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>    }</div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span> </div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>    <span class="comment">/* Simulate call processing delay */</span></div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>    <span class="keywordflow">if</span> (app.server.delay) {</div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>        <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__time__val.htm">pj_time_val</a> delay;</div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span> </div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>        <a class="code hl_struct" href="structcall.htm">call</a>-&gt;ans_timer.<a class="code hl_variableRef" href="../../../pjlib/docs/html/structpj__timer__entry.htm#a70aed199d89e16a05bd9643efd3d665d">id</a> = 1;</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>        <a class="code hl_struct" href="structcall.htm">call</a>-&gt;ans_timer.<a class="code hl_variableRef" href="../../../pjlib/docs/html/structpj__timer__entry.htm#a96ce07b4b890b820ccd1e8365b88add6">user_data</a> = <a class="code hl_struct" href="structcall.htm">call</a>;</div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>        <a class="code hl_struct" href="structcall.htm">call</a>-&gt;ans_timer.<a class="code hl_variableRef" href="../../../pjlib/docs/html/structpj__timer__entry.htm#a13e63641afbb94298b79967585c0f642">cb</a> = &amp;answer_timer_cb;</div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>        </div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>        delay.<a class="code hl_variableRef" href="../../../pjlib/docs/html/structpj__time__val.htm#af2739d0c2189e9c902281c04fd1f4502">sec</a> = 0;</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>        delay.<a class="code hl_variableRef" href="../../../pjlib/docs/html/structpj__time__val.htm#ab9cc04663b258dd3dcb449a3110e0d82">msec</a> = app.server.delay;</div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>        <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__TIME.htm#ga0b28411e03320ad6bb5f3316125b461c">pj_time_val_normalize</a>(&amp;delay);</div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span> </div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>        pjsip_endpt_schedule_timer(app.sip_endpt, &amp;<a class="code hl_struct" href="structcall.htm">call</a>-&gt;ans_timer, &amp;delay);</div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span> </div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>        <span class="comment">/* Send the 200 response immediately . */</span>  </div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>        status = send_response(<a class="code hl_struct" href="structcall.htm">call</a>-&gt;inv, rdata, 200, &amp;has_initial);</div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>        <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__pj__assert.htm#ga9a6f79ac0dc0677698c5735474adfad7">PJ_ASSERT_ON_FAIL</a>(status == <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>, <span class="keywordflow">return</span> <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead235b21a623d982cc561fb12bffa87c0">PJ_TRUE</a>);</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>    }</div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span> </div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>    <span class="comment">/* Done */</span></div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>    app.server.cur_state.call_cnt++;</div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span> </div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>    <span class="keywordflow">return</span> <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead235b21a623d982cc561fb12bffa87c0">PJ_TRUE</a>;</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>}</div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span> </div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span> </div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span> </div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span><span class="comment">/**************************************************************************</span></div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span><span class="comment"> * Default handler when incoming request is not handled by any other</span></div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span><span class="comment"> * modules.</span></div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span><span class="comment"> */</span></div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span><span class="keyword">static</span> <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga1dc7a356fb36bd2dee2bc7d6c7e817e4">pj_bool_t</a> mod_responder_on_rx_request(pjsip_rx_data *rdata);</div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span> </div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span><span class="comment">/* Module to handle incoming requests statelessly.</span></div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span><span class="comment"> */</span></div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span><span class="keyword">static</span> pjsip_module mod_responder =</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>{</div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>    NULL, NULL,                     <span class="comment">/* prev, next.              */</span></div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>    { <span class="stringliteral">&quot;mod-responder&quot;</span>, 13 },        <span class="comment">/* Name.                    */</span></div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>    -1,                             <span class="comment">/* Id                       */</span></div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>    PJSIP_MOD_PRIORITY_APPLICATION+1, <span class="comment">/* Priority               */</span></div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>    NULL,                           <span class="comment">/* load()                   */</span></div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>    NULL,                           <span class="comment">/* start()                  */</span></div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>    NULL,                           <span class="comment">/* stop()                   */</span></div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>    NULL,                           <span class="comment">/* unload()                 */</span></div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>    &amp;mod_responder_on_rx_request,   <span class="comment">/* on_rx_request()          */</span></div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>    NULL,                           <span class="comment">/* on_rx_response()         */</span></div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>    NULL,                           <span class="comment">/* on_tx_request.           */</span></div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>    NULL,                           <span class="comment">/* on_tx_response()         */</span></div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>    NULL,                           <span class="comment">/* on_tsx_state()           */</span></div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>};</div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span> </div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span> </div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span><span class="keyword">static</span> <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga1dc7a356fb36bd2dee2bc7d6c7e817e4">pj_bool_t</a> mod_responder_on_rx_request(pjsip_rx_data *rdata)</div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>{</div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>    <span class="keyword">const</span> <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__str__t.htm">pj_str_t</a> reason = <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a>(<span class="stringliteral">&quot;Not expecting request at this URI&quot;</span>);</div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span> </div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>    <span class="comment">/*</span></div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span><span class="comment">     * Respond any requests (except ACK!) with 500.</span></div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span><span class="comment">     */</span></div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>    <span class="keywordflow">if</span> (rdata-&gt;msg_info.msg-&gt;line.req.method.id != PJSIP_ACK_METHOD) {</div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>        pjsip_endpt_respond_stateless(app.sip_endpt, rdata, 500, &amp;reason,</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>                                      NULL, NULL);</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>    }</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span> </div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>    <span class="keywordflow">return</span> <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead235b21a623d982cc561fb12bffa87c0">PJ_TRUE</a>;</div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>}</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span> </div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span> </div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span> </div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span><span class="comment">/*****************************************************************************</span></div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span><span class="comment"> * Below is a simple module to log all incoming and outgoing SIP messages</span></div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span><span class="comment"> */</span></div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span> </div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span> </div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span><span class="comment">/* Notification on incoming messages */</span></div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span><span class="keyword">static</span> <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga1dc7a356fb36bd2dee2bc7d6c7e817e4">pj_bool_t</a> logger_on_rx_msg(pjsip_rx_data *rdata)</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>{</div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>    <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(3,(THIS_FILE, <span class="stringliteral">&quot;RX %d bytes %s from %s %s:%d:\n&quot;</span></div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>                         <span class="stringliteral">&quot;%.*s\n&quot;</span></div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>                         <span class="stringliteral">&quot;--end msg--&quot;</span>,</div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>                         rdata-&gt;msg_info.len,</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>                         pjsip_rx_data_get_info(rdata),</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>                         rdata-&gt;tp_info.transport-&gt;type_name,</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>                         rdata-&gt;pkt_info.src_name,</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>                         rdata-&gt;pkt_info.src_port,</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>                         (<span class="keywordtype">int</span>)rdata-&gt;msg_info.len,</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>                         rdata-&gt;msg_info.msg_buf));</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>    </div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>    <span class="comment">/* Always return false, otherwise messages will not get processed! */</span></div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>    <span class="keywordflow">return</span> <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead95511b40a74f4625b161dd9e42c6e6e">PJ_FALSE</a>;</div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>}</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span> </div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span><span class="comment">/* Notification on outgoing messages */</span></div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span><span class="keyword">static</span> <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> logger_on_tx_msg(pjsip_tx_data *tdata)</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>{</div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>    </div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>    <span class="comment">/* Important note:</span></div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span><span class="comment">     *  tp_info field is only valid after outgoing messages has passed</span></div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span><span class="comment">     *  transport layer. So don&#39;t try to access tp_info when the module</span></div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span><span class="comment">     *  has lower priority than transport layer.</span></div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span><span class="comment">     */</span></div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span> </div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>    <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(3,(THIS_FILE, <span class="stringliteral">&quot;TX %d bytes %s to %s %s:%d:\n&quot;</span></div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>                         <span class="stringliteral">&quot;%.*s\n&quot;</span></div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>                         <span class="stringliteral">&quot;--end msg--&quot;</span>,</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>                         (tdata-&gt;buf.cur - tdata-&gt;buf.start),</div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>                         pjsip_tx_data_get_info(tdata),</div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>                         tdata-&gt;tp_info.transport-&gt;type_name,</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>                         tdata-&gt;tp_info.dst_name,</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>                         tdata-&gt;tp_info.dst_port,</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>                         (<span class="keywordtype">int</span>)(tdata-&gt;buf.cur - tdata-&gt;buf.start),</div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>                         tdata-&gt;buf.start));</div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span> </div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>    <span class="comment">/* Always return success, otherwise message will not get sent! */</span></div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>    <span class="keywordflow">return</span> <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>;</div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>}</div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span> </div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span><span class="comment">/* The module instance. */</span></div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span><span class="keyword">static</span> pjsip_module msg_logger = </div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>{</div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>    NULL, NULL,                         <span class="comment">/* prev, next.          */</span></div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>    { <span class="stringliteral">&quot;mod-siprtp-log&quot;</span>, 14 },           <span class="comment">/* Name.                */</span></div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>    -1,                                 <span class="comment">/* Id                   */</span></div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>    PJSIP_MOD_PRIORITY_TRANSPORT_LAYER-1,<span class="comment">/* Priority            */</span></div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>    NULL,                               <span class="comment">/* load()               */</span></div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>    NULL,                               <span class="comment">/* start()              */</span></div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>    NULL,                               <span class="comment">/* stop()               */</span></div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>    NULL,                               <span class="comment">/* unload()             */</span></div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>    &amp;logger_on_rx_msg,                  <span class="comment">/* on_rx_request()      */</span></div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>    &amp;logger_on_rx_msg,                  <span class="comment">/* on_rx_response()     */</span></div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>    &amp;logger_on_tx_msg,                  <span class="comment">/* on_tx_request.       */</span></div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>    &amp;logger_on_tx_msg,                  <span class="comment">/* on_tx_response()     */</span></div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>    NULL,                               <span class="comment">/* on_tsx_state()       */</span></div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span> </div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>};</div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span> </div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span> </div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span> </div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span><span class="comment">/**************************************************************************</span></div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span><span class="comment"> * Test Client.</span></div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span><span class="comment"> */</span></div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span> </div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span><span class="keyword">static</span> <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga1dc7a356fb36bd2dee2bc7d6c7e817e4">pj_bool_t</a> mod_test_on_rx_response(pjsip_rx_data *rdata);</div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span> </div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span><span class="keyword">static</span> <span class="keywordtype">void</span> call_on_media_update( pjsip_inv_session *inv,</div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>                                  <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> status);</div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span><span class="keyword">static</span> <span class="keywordtype">void</span> call_on_state_changed( pjsip_inv_session *inv, </div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span>                                   pjsip_event *e);</div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span><span class="keyword">static</span> <span class="keywordtype">void</span> call_on_forked(pjsip_inv_session *inv, pjsip_event *e);</div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span> </div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span> </div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span><span class="comment">/* Module to handle incoming requests callly.</span></div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span><span class="comment"> */</span></div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span><span class="keyword">static</span> pjsip_module mod_test =</div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span>{</div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>    NULL, NULL,                     <span class="comment">/* prev, next.              */</span></div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>    { <span class="stringliteral">&quot;mod-test&quot;</span>, 8 },              <span class="comment">/* Name.                    */</span></div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>    -1,                             <span class="comment">/* Id                       */</span></div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span>    PJSIP_MOD_PRIORITY_APPLICATION, <span class="comment">/* Priority                 */</span></div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>    NULL,                           <span class="comment">/* load()                   */</span></div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>    NULL,                           <span class="comment">/* start()                  */</span></div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>    NULL,                           <span class="comment">/* stop()                   */</span></div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span>    NULL,                           <span class="comment">/* unload()                 */</span></div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>    NULL,                           <span class="comment">/* on_rx_request()          */</span></div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>    &amp;mod_test_on_rx_response,       <span class="comment">/* on_rx_response()         */</span></div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span>    NULL,                           <span class="comment">/* on_tx_request.           */</span></div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span>    NULL,                           <span class="comment">/* on_tx_response()         */</span></div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>    NULL,                           <span class="comment">/* on_tsx_state()           */</span></div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>};</div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span> </div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span> </div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span><span class="keyword">static</span> <span class="keywordtype">void</span> report_completion(<span class="keywordtype">int</span> status_code)</div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>{</div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>    app.client.job_finished++;</div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span>    <span class="keywordflow">if</span> (status_code &gt;= 200 &amp;&amp; status_code &lt; 800)</div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>        app.client.response_codes[status_code]++;</div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span>    app.client.total_responses++;</div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span>    <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__TIME.htm#ga0806df13f40d3153061f399ed86be856">pj_gettimeofday</a>(&amp;app.client.last_completion);</div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span>}</div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span> </div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span> </div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span><span class="comment">/* Handler when response is received. */</span></div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span><span class="keyword">static</span> <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga1dc7a356fb36bd2dee2bc7d6c7e817e4">pj_bool_t</a> mod_test_on_rx_response(pjsip_rx_data *rdata)</div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span>{</div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>    <span class="keywordflow">if</span> (pjsip_rdata_get_tsx(rdata) == NULL) {</div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>        report_completion(rdata-&gt;msg_info.msg-&gt;line.status.code);</div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>    }</div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span> </div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span>    <span class="keywordflow">return</span> <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead235b21a623d982cc561fb12bffa87c0">PJ_TRUE</a>;</div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>}</div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span> </div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span> </div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span><span class="comment">/*</span></div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span><span class="comment"> * Create app</span></div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span><span class="comment"> */</span></div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span><span class="keyword">static</span> <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> create_app(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>{</div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>    <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> status;</div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span> </div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>    status = <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga069615152140fa2df009cebc8a36b769">pj_init</a>();</div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span>    <span class="keywordflow">if</span> (status != <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>        app_perror(THIS_FILE, <span class="stringliteral">&quot;Error initializing pjlib&quot;</span>, status);</div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span>        <span class="keywordflow">return</span> status;</div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span>    }</div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span> </div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>    <span class="comment">/* init PJLIB-UTIL: */</span></div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>    status = <a class="code hl_functionRef" href="../../../pjlib-util/docs/html/group__PJLIB__UTIL__BASE.htm#gafbef35a33e7641211c4b53f3dc1458c6">pjlib_util_init</a>();</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>    <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__pj__assert.htm#gac98bea768b573f53432076a387864fb3">PJ_ASSERT_RETURN</a>(status == <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>, status);</div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span> </div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>    <span class="comment">/* Must create a pool factory before we can allocate any memory. */</span></div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>    <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__CACHING__POOL.htm#gafbf5400f191e2095240bc6472754e94f">pj_caching_pool_init</a>(&amp;app.cp, &amp;<a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__POOL__FACTORY.htm#ga98cf758eafb888f318a8de7f396f47ca">pj_pool_factory_default_policy</a>, </div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>                         CACHING_POOL_SIZE);</div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span> </div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span>    <span class="comment">/* Create application pool for misc. */</span></div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>    app.pool = <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__POOL.htm#ga4634b31af5eb0a0178481536986f1d15">pj_pool_create</a>(&amp;app.cp.factory, <span class="stringliteral">&quot;app&quot;</span>, 1000, 1000, NULL);</div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span> </div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>    <span class="comment">/* Create the endpoint: */</span></div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>    status = pjsip_endpt_create(&amp;app.cp.factory, <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__SOCK.htm#ga541321c009325379021d91f0622df333">pj_gethostname</a>()-&gt;ptr, </div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span>                                &amp;app.sip_endpt);</div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>    <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__pj__assert.htm#gac98bea768b573f53432076a387864fb3">PJ_ASSERT_RETURN</a>(status == <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>, status);</div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span> </div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span> </div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>    <span class="keywordflow">return</span> status;</div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>}</div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span> </div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span> </div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span><span class="comment">/*</span></div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span><span class="comment"> * Init SIP stack</span></div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span><span class="comment"> */</span></div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span><span class="keyword">static</span> <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> init_sip()</div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span>{</div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>    <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> status = -1;</div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span> </div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span>    <span class="comment">/* Add UDP/TCP transport. */</span></div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span>    {</div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span>        <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__sockaddr__in.htm">pj_sockaddr_in</a> addr;</div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span>        pjsip_host_port addrname;</div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *transport_type = NULL;</div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span> </div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span>        <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#gafa92001573289c87313c660146369fa3">pj_bzero</a>(&amp;addr, <span class="keyword">sizeof</span>(addr));</div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span>        addr.<a class="code hl_variableRef" href="../../../pjlib/docs/html/structpj__sockaddr__in.htm#ab298fd61a3f2bf3036fe414740a53cc6">sin_family</a> = <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__PJ__SOCK.htm#ga8ea303b95fe973432a361e47e0459086">pj_AF_INET</a>();</div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span>        addr.<a class="code hl_variableRef" href="../../../pjlib/docs/html/structpj__sockaddr__in.htm#ad1ed5a34d99da0d23e65b3b3b5fad228">sin_addr</a>.s_addr = 0;</div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span>        addr.<a class="code hl_variableRef" href="../../../pjlib/docs/html/structpj__sockaddr__in.htm#a0e60b93d03fa052211bb6131e64bdda1">sin_port</a> = <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__SOCK.htm#ga25ce2f95b79d3556375804123a5eb77e">pj_htons</a>((<a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga47506d8dde1056c5c96d62f0df6ddf28">pj_uint16_t</a>)app.local_port);</div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span> </div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span>        <span class="keywordflow">if</span> (app.local_addr.slen) {</div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>            addrname.host = app.local_addr;</div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span>            addrname.port = 5060;</div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span>        } </div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span>        <span class="keywordflow">if</span> (app.local_port != 0)</div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span>            addrname.port = app.local_port;</div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span> </div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span>        <span class="keywordflow">if</span> (0) {</div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span><span class="preprocessor">#if defined(PJ_HAS_TCP) &amp;&amp; PJ_HAS_TCP!=0</span></div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (app.use_tcp) {</div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span>            <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__sockaddr__in.htm">pj_sockaddr_in</a> local_addr;</div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span>            pjsip_tpfactory *tpfactory;</div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span>            </div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span>            transport_type = <span class="stringliteral">&quot;tcp&quot;</span>;</div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span>            <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__SOCK.htm#gae6169f27eb956287681a46ca9fecdafc">pj_sockaddr_in_init</a>(&amp;local_addr, 0, (<a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga47506d8dde1056c5c96d62f0df6ddf28">pj_uint16_t</a>)app.local_port);</div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span>            status = pjsip_tcp_transport_start(app.sip_endpt, &amp;local_addr,</div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span>                                               app.thread_count, &amp;tpfactory);</div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span>            <span class="keywordflow">if</span> (status == <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span>                app.local_addr = tpfactory-&gt;addr_name.host;</div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span>                app.local_port = tpfactory-&gt;addr_name.port;</div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span>            }</div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span>            pjsip_transport *tp;</div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span> </div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>            transport_type = <span class="stringliteral">&quot;udp&quot;</span>;</div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span>            status = pjsip_udp_transport_start(app.sip_endpt, &amp;addr, </div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span>                                               (app.local_addr.slen ? &amp;addrname:NULL),</div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span>                                               app.thread_count, &amp;tp);</div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span>            <span class="keywordflow">if</span> (status == <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span>                app.local_addr = tp-&gt;local_name.host;</div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span>                app.local_port = tp-&gt;local_name.port;</div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>            }</div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span> </div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span>        }</div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span>        <span class="keywordflow">if</span> (status != <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span>            app_perror(THIS_FILE, <span class="stringliteral">&quot;Unable to start transport&quot;</span>, status);</div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>            <span class="keywordflow">return</span> status;</div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span>        }</div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span> </div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span>        app.local_uri.ptr = <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__POOL.htm#ga14798f6ba0d0858e4f36cc8a4904bbd9">pj_pool_alloc</a>(app.pool, 128);</div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>        app.local_uri.slen = pj_ansi_sprintf(app.local_uri.ptr, </div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span>                                             <span class="stringliteral">&quot;&lt;sip:pjsip-perf@%.*s:%d;transport=%s&gt;&quot;</span>,</div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span>                                             (<span class="keywordtype">int</span>)app.local_addr.slen,</div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span>                                             app.local_addr.ptr,</div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span>                                             app.local_port,</div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span>                                             transport_type);</div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span> </div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span>        app.local_contact = app.local_uri;</div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>    }</div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span> </div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span>    <span class="comment">/* </span></div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span><span class="comment">     * Init transaction layer.</span></div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span><span class="comment">     * This will create/initialize transaction hash tables etc.</span></div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span><span class="comment">     */</span></div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span>    status = pjsip_tsx_layer_init_module(app.sip_endpt);</div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span>    <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__pj__assert.htm#gac98bea768b573f53432076a387864fb3">PJ_ASSERT_RETURN</a>(status == <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>, status);</div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span> </div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span>    <span class="comment">/*  Initialize UA layer. */</span></div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span>    status = pjsip_ua_init_module( app.sip_endpt, NULL );</div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span>    <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__pj__assert.htm#gac98bea768b573f53432076a387864fb3">PJ_ASSERT_RETURN</a>(status == <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>, status);</div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span> </div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span>    <span class="comment">/* Initialize 100rel support */</span></div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span>    status = pjsip_100rel_init_module(app.sip_endpt);</div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span>    <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__pj__assert.htm#gac98bea768b573f53432076a387864fb3">PJ_ASSERT_RETURN</a>(status == <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>, status);</div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span> </div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>    <span class="comment">/*  Init invite session module. */</span></div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>    {</div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span>        pjsip_inv_callback inv_cb;</div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span> </div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>        <span class="comment">/* Init the callback for INVITE session: */</span></div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span>        <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#gafa92001573289c87313c660146369fa3">pj_bzero</a>(&amp;inv_cb, <span class="keyword">sizeof</span>(inv_cb));</div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span>        inv_cb.on_state_changed = &amp;call_on_state_changed;</div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span>        inv_cb.on_new_session = &amp;call_on_forked;</div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span>        inv_cb.on_media_update = &amp;call_on_media_update;</div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span> </div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span>        <span class="comment">/* Initialize invite session module:  */</span></div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span>        status = pjsip_inv_usage_init(app.sip_endpt, &amp;inv_cb);</div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span>        <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__pj__assert.htm#gac98bea768b573f53432076a387864fb3">PJ_ASSERT_RETURN</a>(status == <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>, 1);</div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>    }</div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span> </div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>    <span class="comment">/* Register our module to receive incoming requests. */</span></div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span>    status = pjsip_endpt_register_module( app.sip_endpt, &amp;mod_test);</div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span>    <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__pj__assert.htm#gac98bea768b573f53432076a387864fb3">PJ_ASSERT_RETURN</a>(status == <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>, status);</div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span> </div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span> </div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span>    <span class="comment">/* Register stateless server module */</span></div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span>    status = pjsip_endpt_register_module( app.sip_endpt, &amp;mod_stateless_server);</div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span>    <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__pj__assert.htm#gac98bea768b573f53432076a387864fb3">PJ_ASSERT_RETURN</a>(status == <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>, status);</div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span> </div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span>    <span class="comment">/* Register default responder module */</span></div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span>    status = pjsip_endpt_register_module( app.sip_endpt, &amp;mod_responder);</div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span>    <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__pj__assert.htm#gac98bea768b573f53432076a387864fb3">PJ_ASSERT_RETURN</a>(status == <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>, status);</div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span> </div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span>    <span class="comment">/* Register stateless server module */</span></div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span>    status = pjsip_endpt_register_module( app.sip_endpt, &amp;mod_stateful_server);</div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>    <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__pj__assert.htm#gac98bea768b573f53432076a387864fb3">PJ_ASSERT_RETURN</a>(status == <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>, status);</div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span> </div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span> </div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span>    <span class="comment">/* Register call server module */</span></div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span>    status = pjsip_endpt_register_module( app.sip_endpt, &amp;mod_call_server);</div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span>    <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__pj__assert.htm#gac98bea768b573f53432076a387864fb3">PJ_ASSERT_RETURN</a>(status == <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>, status);</div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span> </div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span> </div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>    <span class="comment">/* Done */</span></div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span>    <span class="keywordflow">return</span> <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>;</div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span>}</div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span> </div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span> </div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span><span class="comment">/*</span></div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span><span class="comment"> * Destroy SIP</span></div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span><span class="comment"> */</span></div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span><span class="keyword">static</span> <span class="keywordtype">void</span> destroy_app()</div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span>{</div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span>    <span class="keywordtype">unsigned</span> i;</div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span> </div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>    app.thread_quit = 1;</div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span>    <span class="keywordflow">for</span> (i=0; i&lt;app.thread_count; ++i) {</div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span>        <span class="keywordflow">if</span> (app.thread[i]) {</div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span>            <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__THREAD.htm#ga60d90ce08d2f7e92dcaa0443cf87912f">pj_thread_join</a>(app.thread[i]);</div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span>            <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__THREAD.htm#ga5435f79ad044f9ce2113af311bf2b777">pj_thread_destroy</a>(app.thread[i]);</div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span>            app.thread[i] = NULL;</div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span>        }</div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span>    }</div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span> </div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>    <span class="keywordflow">if</span> (app.sip_endpt) {</div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span>        pjsip_endpt_destroy(app.sip_endpt);</div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span>        app.sip_endpt = NULL;</div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span>    }</div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span> </div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span>    <span class="keywordflow">if</span> (app.pool) {</div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span>        <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__POOL.htm#gade0f14f6635ecfccb576ec41c57fede5">pj_pool_release</a>(app.pool);</div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span>        app.pool = NULL;</div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span>        <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(3,(THIS_FILE, <span class="stringliteral">&quot;Peak memory size: %uMB&quot;</span>,</div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span>                             app.cp.peak_used_size / 1000000));</div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span>        <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__CACHING__POOL.htm#ga4c912e7d9e08dae33c2fecea9f1949bc">pj_caching_pool_destroy</a>(&amp;app.cp);</div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span>    }</div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span> </div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span>    <span class="comment">/* Shutdown PJLIB */</span></div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span>    <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gad42209dcf11f957ed9f1790e30f519cd">pj_shutdown</a>();</div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span>}</div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span> </div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span> </div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span><span class="comment">/*</span></div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span><span class="comment"> * Init media stack.</span></div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span><span class="comment"> */</span></div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span><span class="keyword">static</span> <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> init_media()</div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span>{</div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span>    <span class="keywordtype">unsigned</span>    i;</div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno">  919</span>    <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga47506d8dde1056c5c96d62f0df6ddf28">pj_uint16_t</a> rtp_port;</div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span>    <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> status;</div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno">  921</span> </div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span> </div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span>    <span class="comment">/* Initialize media endpoint so that at least error subsystem is properly</span></div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span><span class="comment">     * initialized.</span></div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span><span class="comment">     */</span></div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span>    status = <a class="code hl_function" href="group__PJMED__ENDPT.htm#ga2865efcd255dbcb05ede33dbae5c27f5">pjmedia_endpt_create</a>(&amp;app.cp.factory, </div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span>                                  pjsip_endpt_get_ioqueue(app.sip_endpt), 0, </div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span>                                  &amp;app.med_endpt);</div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span>    <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__pj__assert.htm#gac98bea768b573f53432076a387864fb3">PJ_ASSERT_RETURN</a>(status == <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>, status);</div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span> </div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span> </div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno">  932</span>    <span class="comment">/* Must register all codecs to be supported */</span></div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span>    <a class="code hl_function" href="group__PJMEDIA__CODEC__REGISTER__ALL.htm#ga5ca86e134cdb27f14a59d134fcd3dec5">pjmedia_codec_register_audio_codecs</a>(app.med_endpt, NULL);</div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno">  934</span> </div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span>    <span class="comment">/* Init dummy socket addresses */</span></div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span>    app.skinfo_cnt = 0;</div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span>    <span class="keywordflow">for</span> (i=0, rtp_port=4000; i&lt;<a class="code hl_defineRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gacd8459212a1e5175eeb04e3a6cd76659">PJ_ARRAY_SIZE</a>(app.skinfo); ++i, rtp_port+=2) {</div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno">  938</span>        <a class="code hl_struct" href="structpjmedia__sock__info.htm">pjmedia_sock_info</a> *skinfo;</div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span> </div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span>        skinfo = &amp;app.skinfo[i];</div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span>        </div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span>        <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__SOCK.htm#gae6169f27eb956287681a46ca9fecdafc">pj_sockaddr_in_init</a>(&amp;skinfo-&gt;<a class="code hl_variable" href="structpjmedia__sock__info.htm#aa2cecdb5ff13922865a33d49f3ccd0c8">rtp_addr_name</a>.<a class="code hl_variableRef" href="../../../pjlib/docs/html/unionpj__sockaddr.htm#ab25ec448ae63acfdd2aa0f3ef2fd10b8">ipv4</a>, &amp;app.local_addr,</div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span>                            (<a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga47506d8dde1056c5c96d62f0df6ddf28">pj_uint16_t</a>)rtp_port);</div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span>        <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__SOCK.htm#gae6169f27eb956287681a46ca9fecdafc">pj_sockaddr_in_init</a>(&amp;skinfo-&gt;<a class="code hl_variable" href="structpjmedia__sock__info.htm#aa2cecdb5ff13922865a33d49f3ccd0c8">rtp_addr_name</a>.<a class="code hl_variableRef" href="../../../pjlib/docs/html/unionpj__sockaddr.htm#ab25ec448ae63acfdd2aa0f3ef2fd10b8">ipv4</a>, &amp;app.local_addr,</div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span>                            (<a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga47506d8dde1056c5c96d62f0df6ddf28">pj_uint16_t</a>)(rtp_port+1));</div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span>        app.skinfo_cnt++;</div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span>    }</div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span> </div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span>    <span class="comment">/* Generate dummy SDP */</span></div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span>    dummy_sdp_str.<a class="code hl_variableRef" href="../../../pjlib/docs/html/structpj__str__t.htm#a46788480bdb4080083dcc8965811e015">slen</a> = pj_ansi_strlen(dummy_sdp_str.<a class="code hl_variableRef" href="../../../pjlib/docs/html/structpj__str__t.htm#a4eb3153e4363a93f65f5c728911168d4">ptr</a>);</div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span>    status = <a class="code hl_function" href="group__PJMEDIA__SDP.htm#ga11acd6dd72b802c0133848ca83ace3b1">pjmedia_sdp_parse</a>(app.pool, dummy_sdp_str.<a class="code hl_variableRef" href="../../../pjlib/docs/html/structpj__str__t.htm#a4eb3153e4363a93f65f5c728911168d4">ptr</a>, dummy_sdp_str.<a class="code hl_variableRef" href="../../../pjlib/docs/html/structpj__str__t.htm#a46788480bdb4080083dcc8965811e015">slen</a>, </div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span>                               &amp;app.dummy_sdp);</div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span>    <span class="keywordflow">if</span> (status != <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span>        app_perror(THIS_FILE, <span class="stringliteral">&quot;Error parsing dummy SDP&quot;</span>, status);</div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span>        <span class="keywordflow">return</span> status;</div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span>    }</div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span> </div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span> </div>
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno">  959</span>    <span class="comment">/* Done */</span></div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span>    <span class="keywordflow">return</span> <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>;</div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno">  961</span>}</div>
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno">  962</span> </div>
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno">  963</span> </div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span><span class="comment">/* This is notification from the call about media negotiation</span></div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno">  965</span><span class="comment"> * status. This is called for client calls only.</span></div>
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno">  966</span><span class="comment"> */</span></div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno">  967</span><span class="keyword">static</span> <span class="keywordtype">void</span> call_on_media_update( pjsip_inv_session *inv,</div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span>                                  <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> status)</div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span>{</div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span>    <span class="keywordflow">if</span> (status != <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span>        pjsip_tx_data *tdata;</div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span>        <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> status2;</div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span> </div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span>        status2 = pjsip_inv_end_session(inv, PJSIP_SC_UNSUPPORTED_MEDIA_TYPE,</div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span>                                       NULL, &amp;tdata);</div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span>        <span class="keywordflow">if</span> (status2 == <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a> &amp;&amp; tdata)</div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span>            status2 = pjsip_inv_send_msg(inv, tdata);</div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span>    }</div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span>}</div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span> </div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span> </div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span><span class="comment">/* This is notification from the call when the call state has changed.</span></div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span><span class="comment"> * This is called for client calls only.</span></div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno">  984</span><span class="comment"> */</span></div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno">  985</span><span class="keyword">static</span> <span class="keywordtype">void</span> call_on_state_changed( pjsip_inv_session *inv, </div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span>                                   pjsip_event *e)</div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span>{</div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span>    <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__pj__config.htm#ga7523f8576efd271c22b188eab05d7870">PJ_UNUSED_ARG</a>(e);</div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span> </div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span>    <span class="comment">/* Bail out if the session has been counted before */</span></div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span>    <span class="keywordflow">if</span> (inv-&gt;mod_data[mod_test.id] != NULL)</div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span> </div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span>    <span class="comment">/* Bail out if this is not an outgoing call */</span></div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span>    <span class="keywordflow">if</span> (inv-&gt;role != PJSIP_UAC_ROLE)</div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno">  996</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno">  997</span> </div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span>    <span class="keywordflow">if</span> (inv-&gt;state == PJSIP_INV_STATE_CONFIRMED) {</div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span>        pjsip_tx_data *tdata;</div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span>        <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> status;</div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span> </div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"> 1002</span>        <span class="comment">//report_completion(200);</span></div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span>        <span class="comment">//inv-&gt;mod_data[mod_test.id] = (void*)1;</span></div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span> </div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span>        status = pjsip_inv_end_session(inv, PJSIP_SC_OK, NULL, &amp;tdata);</div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span>        <span class="keywordflow">if</span> (status == <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a> &amp;&amp; tdata)</div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span>            status = pjsip_inv_send_msg(inv, tdata);</div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"> 1008</span> </div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (inv-&gt;state == PJSIP_INV_STATE_DISCONNECTED) {</div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span>        report_completion(inv-&gt;cause);</div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span>        inv-&gt;mod_data[mod_test.id] = (<span class="keywordtype">void</span>*)(<a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga173588cd6381f3ad354c23c26929093a">pj_ssize_t</a>)1;</div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span>    }</div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span>}</div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span> </div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span> </div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span><span class="comment">/* Not implemented for now */</span></div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span><span class="keyword">static</span> <span class="keywordtype">void</span> call_on_forked(pjsip_inv_session *inv, pjsip_event *e)</div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span>{</div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span>    <span class="comment">/* Do nothing */</span></div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span>    <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__pj__config.htm#ga7523f8576efd271c22b188eab05d7870">PJ_UNUSED_ARG</a>(inv);</div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span>    <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__pj__config.htm#ga7523f8576efd271c22b188eab05d7870">PJ_UNUSED_ARG</a>(e);</div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span>}</div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span> </div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span> </div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span><span class="comment">/*</span></div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span><span class="comment"> * Make outgoing call.</span></div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span><span class="comment"> */</span></div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span><span class="keyword">static</span> <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> make_call(<span class="keyword">const</span> <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__str__t.htm">pj_str_t</a> *dst_uri)</div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span>{</div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"> 1030</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structcall.htm">call</a> *<a class="code hl_struct" href="structcall.htm">call</a>;</div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span>    pjsip_dialog *dlg;</div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span>    <a class="code hl_struct" href="structpjmedia__sdp__session.htm">pjmedia_sdp_session</a> *sdp;</div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"> 1033</span>    pjsip_tx_data *tdata;</div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"> 1034</span>    <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> status;</div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span> </div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"> 1036</span> </div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span>    <span class="comment">/* Create UAC dialog */</span></div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span>    status = pjsip_dlg_create_uac( pjsip_ua_instance(), </div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span>                                   &amp;app.local_uri,      <span class="comment">/* local URI        */</span></div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span>                                   &amp;app.local_contact,  <span class="comment">/* local Contact    */</span></div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span>                                   dst_uri,             <span class="comment">/* remote URI       */</span></div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span>                                   dst_uri,             <span class="comment">/* remote target    */</span></div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span>                                   &amp;dlg);               <span class="comment">/* dialog           */</span></div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span>    <span class="keywordflow">if</span> (status != <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span>        <span class="keywordflow">return</span> status;</div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span>    }</div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span> </div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"> 1048</span>    <span class="comment">/* Create call */</span></div>
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span>    <a class="code hl_struct" href="structcall.htm">call</a> = <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__POOL.htm#ga5bedca9c6066f4e1a7254cbb70b4afcc">pj_pool_zalloc</a>(dlg-&gt;pool, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code hl_struct" href="structcall.htm">call</a>));</div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span> </div>
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"> 1051</span>    <span class="comment">/* Create SDP */</span></div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span>    <span class="keywordflow">if</span> (app.real_sdp) {</div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"> 1053</span>        status = <a class="code hl_function" href="group__PJMED__ENDPT.htm#gaa49360a690c292dddd722b39c2f8c8bb">pjmedia_endpt_create_sdp</a>(app.med_endpt, dlg-&gt;pool, 1, </div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span>                                          app.skinfo, &amp;sdp);</div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span>        <span class="keywordflow">if</span> (status != <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span>            pjsip_dlg_terminate(dlg);</div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span>            <span class="keywordflow">return</span> status;</div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span>        }</div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span>    } <span class="keywordflow">else</span></div>
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"> 1060</span>        sdp = app.dummy_sdp;</div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span> </div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"> 1062</span>    <span class="comment">/* Create the INVITE session. */</span></div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>    status = pjsip_inv_create_uac( dlg, sdp, 0, &amp;<a class="code hl_struct" href="structcall.htm">call</a>-&gt;inv);</div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span>    <span class="keywordflow">if</span> (status != <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span>        pjsip_dlg_terminate(dlg);</div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span>        <span class="keywordflow">return</span> status;</div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span>    }</div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span> </div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span> </div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span>    <span class="comment">/* Create initial INVITE request.</span></div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span><span class="comment">     * This INVITE request will contain a perfectly good request and </span></div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span><span class="comment">     * an SDP body as well.</span></div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span><span class="comment">     */</span></div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"> 1074</span>    status = pjsip_inv_invite(<a class="code hl_struct" href="structcall.htm">call</a>-&gt;inv, &amp;tdata);</div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span>    <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__pj__assert.htm#gac98bea768b573f53432076a387864fb3">PJ_ASSERT_RETURN</a>(status == <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>, status);</div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span> </div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span> </div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span>    <span class="comment">/* Send initial INVITE request. </span></div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span><span class="comment">     * From now on, the invite session&#39;s state will be reported to us</span></div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span><span class="comment">     * via the invite session callbacks.</span></div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span><span class="comment">     */</span></div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span>    status = pjsip_inv_send_msg(<a class="code hl_struct" href="structcall.htm">call</a>-&gt;inv, tdata);</div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span>    <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__pj__assert.htm#gac98bea768b573f53432076a387864fb3">PJ_ASSERT_RETURN</a>(status == <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>, status);</div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span> </div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span> </div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span>    <span class="keywordflow">return</span> <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>;</div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span>}</div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span> </div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span> </div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span><span class="comment">/*</span></div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span><span class="comment"> * Verify that valid SIP url is given.</span></div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span><span class="comment"> */</span></div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span><span class="keyword">static</span> <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> verify_sip_url(<span class="keyword">const</span> <span class="keywordtype">char</span> *c_url)</div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span>{</div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span>    pjsip_uri *p;</div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span>    <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__pool__t.htm">pj_pool_t</a> *pool;</div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span>    <span class="keywordtype">char</span> *url;</div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span>    <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga9fdb3ceb491cd888cd30ca30d78026e8">pj_size_t</a> len = (c_url ? pj_ansi_strlen(c_url) : 0);</div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span> </div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span>    <span class="keywordflow">if</span> (!len) <span class="keywordflow">return</span> -1;</div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span> </div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span>    pool = <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__POOL.htm#ga4634b31af5eb0a0178481536986f1d15">pj_pool_create</a>(&amp;app.cp.factory, <span class="stringliteral">&quot;check%p&quot;</span>, 1024, 0, NULL);</div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span>    <span class="keywordflow">if</span> (!pool) <span class="keywordflow">return</span> <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__pj__errnum.htm#ga9a16214b8d54a8ee9d6bce378d116beb">PJ_ENOMEM</a>;</div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span> </div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span>    url = <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__POOL.htm#ga14798f6ba0d0858e4f36cc8a4904bbd9">pj_pool_alloc</a>(pool, len+1);</div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span>    pj_ansi_strcpy(url, c_url);</div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span>    url[len] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span> </div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span>    p = pjsip_parse_uri(pool, url, len, 0);</div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span>    <span class="keywordflow">if</span> (!p || <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga508848e33f034d920be8333ccdf7e077">pj_stricmp2</a>(pjsip_uri_get_scheme(p), <span class="stringliteral">&quot;sip&quot;</span>) != 0)</div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span>        p = NULL;</div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span> </div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span>    <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__POOL.htm#gade0f14f6635ecfccb576ec41c57fede5">pj_pool_release</a>(pool);</div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span>    <span class="keywordflow">return</span> p ? 0 : -1;</div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span>}</div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span> </div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"> 1117</span> </div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span><span class="keyword">static</span> <span class="keywordtype">void</span> usage(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span>{</div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span>    printf(</div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"> 1121</span>        <span class="stringliteral">&quot;Usage:\n&quot;</span></div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span>        <span class="stringliteral">&quot;   pjsip-perf [OPTIONS]        -- to start as server\n&quot;</span></div>
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"> 1123</span>        <span class="stringliteral">&quot;   pjsip-perf [OPTIONS] URL    -- to call server (possibly itself)\n&quot;</span></div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span>        <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a id="l01125" name="l01125"></a><span class="lineno"> 1125</span>        <span class="stringliteral">&quot;where:\n&quot;</span></div>
<div class="line"><a id="l01126" name="l01126"></a><span class="lineno"> 1126</span>        <span class="stringliteral">&quot;   URL                     The SIP URL to be contacted.\n&quot;</span></div>
<div class="line"><a id="l01127" name="l01127"></a><span class="lineno"> 1127</span>        <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a id="l01128" name="l01128"></a><span class="lineno"> 1128</span>        <span class="stringliteral">&quot;Client options:\n&quot;</span></div>
<div class="line"><a id="l01129" name="l01129"></a><span class="lineno"> 1129</span>        <span class="stringliteral">&quot;   --method=METHOD, -m     Set test method (set to INVITE for call benchmark)\n&quot;</span></div>
<div class="line"><a id="l01130" name="l01130"></a><span class="lineno"> 1130</span>        <span class="stringliteral">&quot;                           [default: OPTIONS]\n&quot;</span></div>
<div class="line"><a id="l01131" name="l01131"></a><span class="lineno"> 1131</span>        <span class="stringliteral">&quot;   --count=N, -n           Set total number of requests to initiate\n&quot;</span></div>
<div class="line"><a id="l01132" name="l01132"></a><span class="lineno"> 1132</span>        <span class="stringliteral">&quot;                           [default=%d]\n&quot;</span></div>
<div class="line"><a id="l01133" name="l01133"></a><span class="lineno"> 1133</span>        <span class="stringliteral">&quot;   --stateless, -s         Set to operate in stateless mode\n&quot;</span></div>
<div class="line"><a id="l01134" name="l01134"></a><span class="lineno"> 1134</span>        <span class="stringliteral">&quot;                           [default: stateful]\n&quot;</span></div>
<div class="line"><a id="l01135" name="l01135"></a><span class="lineno"> 1135</span>        <span class="stringliteral">&quot;   --timeout=SEC, -t       Set client timeout [default=60 sec]\n&quot;</span></div>
<div class="line"><a id="l01136" name="l01136"></a><span class="lineno"> 1136</span>        <span class="stringliteral">&quot;   --window=COUNT, -w      Set maximum outstanding job [default: %d]\n&quot;</span></div>
<div class="line"><a id="l01137" name="l01137"></a><span class="lineno"> 1137</span>        <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a id="l01138" name="l01138"></a><span class="lineno"> 1138</span>        <span class="stringliteral">&quot;SDP options (client and server):\n&quot;</span></div>
<div class="line"><a id="l01139" name="l01139"></a><span class="lineno"> 1139</span>        <span class="stringliteral">&quot;   --real-sdp              Generate real SDP from pjmedia, and also perform\n&quot;</span></div>
<div class="line"><a id="l01140" name="l01140"></a><span class="lineno"> 1140</span>        <span class="stringliteral">&quot;                           proper SDP negotiation [default: dummy]\n&quot;</span></div>
<div class="line"><a id="l01141" name="l01141"></a><span class="lineno"> 1141</span>        <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a id="l01142" name="l01142"></a><span class="lineno"> 1142</span>        <span class="stringliteral">&quot;Client and Server options:\n&quot;</span></div>
<div class="line"><a id="l01143" name="l01143"></a><span class="lineno"> 1143</span>        <span class="stringliteral">&quot;   --local-port=PORT, -p   Set local port [default: 5060]\n&quot;</span></div>
<div class="line"><a id="l01144" name="l01144"></a><span class="lineno"> 1144</span>        <span class="stringliteral">&quot;   --use-tcp, -T           Use TCP instead of UDP. Note that when started as\n&quot;</span></div>
<div class="line"><a id="l01145" name="l01145"></a><span class="lineno"> 1145</span>        <span class="stringliteral">&quot;                           client, you must add ;transport=tcp parameter to URL\n&quot;</span></div>
<div class="line"><a id="l01146" name="l01146"></a><span class="lineno"> 1146</span>        <span class="stringliteral">&quot;                           [default: no]\n&quot;</span></div>
<div class="line"><a id="l01147" name="l01147"></a><span class="lineno"> 1147</span>        <span class="stringliteral">&quot;   --thread-count=N        Set number of worker threads [default=1]\n&quot;</span></div>
<div class="line"><a id="l01148" name="l01148"></a><span class="lineno"> 1148</span>        <span class="stringliteral">&quot;   --trying                Send 100/Trying response (server, default no)\n&quot;</span></div>
<div class="line"><a id="l01149" name="l01149"></a><span class="lineno"> 1149</span>        <span class="stringliteral">&quot;   --ringing               Send 180/Ringing response (server, default no)\n&quot;</span></div>
<div class="line"><a id="l01150" name="l01150"></a><span class="lineno"> 1150</span>        <span class="stringliteral">&quot;   --delay=MS, -d          Delay answering call by MS (server, default no)\n&quot;</span></div>
<div class="line"><a id="l01151" name="l01151"></a><span class="lineno"> 1151</span>        <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a id="l01152" name="l01152"></a><span class="lineno"> 1152</span>        <span class="stringliteral">&quot;Misc options:\n&quot;</span></div>
<div class="line"><a id="l01153" name="l01153"></a><span class="lineno"> 1153</span>        <span class="stringliteral">&quot;   --help, -h              Display this screen\n&quot;</span></div>
<div class="line"><a id="l01154" name="l01154"></a><span class="lineno"> 1154</span>        <span class="stringliteral">&quot;   --verbose, -v           Verbose logging (put more than once for even more)\n&quot;</span></div>
<div class="line"><a id="l01155" name="l01155"></a><span class="lineno"> 1155</span>        <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a id="l01156" name="l01156"></a><span class="lineno"> 1156</span>        <span class="stringliteral">&quot;When started as server, pjsip-perf can be contacted on the following URIs:\n&quot;</span></div>
<div class="line"><a id="l01157" name="l01157"></a><span class="lineno"> 1157</span>        <span class="stringliteral">&quot;   - sip:0@server-addr     To handle requests statelessly.\n&quot;</span></div>
<div class="line"><a id="l01158" name="l01158"></a><span class="lineno"> 1158</span>        <span class="stringliteral">&quot;   - sip:1@server-addr     To handle requests statefully.\n&quot;</span></div>
<div class="line"><a id="l01159" name="l01159"></a><span class="lineno"> 1159</span>        <span class="stringliteral">&quot;   - sip:2@server-addr     To handle INVITE call.\n&quot;</span>,</div>
<div class="line"><a id="l01160" name="l01160"></a><span class="lineno"> 1160</span>        DEFAULT_COUNT, JOB_WINDOW);</div>
<div class="line"><a id="l01161" name="l01161"></a><span class="lineno"> 1161</span>}</div>
<div class="line"><a id="l01162" name="l01162"></a><span class="lineno"> 1162</span> </div>
<div class="line"><a id="l01163" name="l01163"></a><span class="lineno"> 1163</span> </div>
<div class="line"><a id="l01164" name="l01164"></a><span class="lineno"> 1164</span><span class="keyword">static</span> <span class="keywordtype">int</span> my_atoi(<span class="keyword">const</span> <span class="keywordtype">char</span> *s)</div>
<div class="line"><a id="l01165" name="l01165"></a><span class="lineno"> 1165</span>{</div>
<div class="line"><a id="l01166" name="l01166"></a><span class="lineno"> 1166</span>    <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__str__t.htm">pj_str_t</a> ss = <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a>((<span class="keywordtype">char</span>*)s);</div>
<div class="line"><a id="l01167" name="l01167"></a><span class="lineno"> 1167</span>    <span class="keywordflow">return</span> <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga0b12a5cc98e05ff6993aa02436246999">pj_strtoul</a>(&amp;ss);</div>
<div class="line"><a id="l01168" name="l01168"></a><span class="lineno"> 1168</span>}</div>
<div class="line"><a id="l01169" name="l01169"></a><span class="lineno"> 1169</span> </div>
<div class="line"><a id="l01170" name="l01170"></a><span class="lineno"> 1170</span> </div>
<div class="line"><a id="l01171" name="l01171"></a><span class="lineno"> 1171</span><span class="keyword">static</span> <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> init_options(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line"><a id="l01172" name="l01172"></a><span class="lineno"> 1172</span>{</div>
<div class="line"><a id="l01173" name="l01173"></a><span class="lineno"> 1173</span>    <span class="keyword">enum</span> { OPT_THREAD_COUNT = 1, OPT_REAL_SDP, OPT_TRYING, OPT_RINGING };</div>
<div class="line"><a id="l01174" name="l01174"></a><span class="lineno"> 1174</span>    <span class="keyword">struct </span><a class="code hl_structRef" href="../../../pjlib-util/docs/html/structpj__getopt__option.htm">pj_getopt_option</a> long_options[] = {</div>
<div class="line"><a id="l01175" name="l01175"></a><span class="lineno"> 1175</span>        { <span class="stringliteral">&quot;local-port&quot;</span>,     1, 0, <span class="charliteral">&#39;p&#39;</span> },</div>
<div class="line"><a id="l01176" name="l01176"></a><span class="lineno"> 1176</span>        { <span class="stringliteral">&quot;count&quot;</span>,          1, 0, <span class="charliteral">&#39;c&#39;</span> },</div>
<div class="line"><a id="l01177" name="l01177"></a><span class="lineno"> 1177</span>        { <span class="stringliteral">&quot;thread-count&quot;</span>,   1, 0, OPT_THREAD_COUNT },</div>
<div class="line"><a id="l01178" name="l01178"></a><span class="lineno"> 1178</span>        { <span class="stringliteral">&quot;method&quot;</span>,         1, 0, <span class="charliteral">&#39;m&#39;</span> },</div>
<div class="line"><a id="l01179" name="l01179"></a><span class="lineno"> 1179</span>        { <span class="stringliteral">&quot;help&quot;</span>,           0, 0, <span class="charliteral">&#39;h&#39;</span> },</div>
<div class="line"><a id="l01180" name="l01180"></a><span class="lineno"> 1180</span>        { <span class="stringliteral">&quot;stateless&quot;</span>,      0, 0, <span class="charliteral">&#39;s&#39;</span> },</div>
<div class="line"><a id="l01181" name="l01181"></a><span class="lineno"> 1181</span>        { <span class="stringliteral">&quot;timeout&quot;</span>,        1, 0, <span class="charliteral">&#39;t&#39;</span> },</div>
<div class="line"><a id="l01182" name="l01182"></a><span class="lineno"> 1182</span>        { <span class="stringliteral">&quot;real-sdp&quot;</span>,       0, 0, OPT_REAL_SDP },</div>
<div class="line"><a id="l01183" name="l01183"></a><span class="lineno"> 1183</span>        { <span class="stringliteral">&quot;verbose&quot;</span>,        0, 0, <span class="charliteral">&#39;v&#39;</span> },</div>
<div class="line"><a id="l01184" name="l01184"></a><span class="lineno"> 1184</span>        { <span class="stringliteral">&quot;use-tcp&quot;</span>,        0, 0, <span class="charliteral">&#39;T&#39;</span> },</div>
<div class="line"><a id="l01185" name="l01185"></a><span class="lineno"> 1185</span>        { <span class="stringliteral">&quot;window&quot;</span>,         1, 0, <span class="charliteral">&#39;w&#39;</span> },</div>
<div class="line"><a id="l01186" name="l01186"></a><span class="lineno"> 1186</span>        { <span class="stringliteral">&quot;delay&quot;</span>,          1, 0, <span class="charliteral">&#39;d&#39;</span> },</div>
<div class="line"><a id="l01187" name="l01187"></a><span class="lineno"> 1187</span>        { <span class="stringliteral">&quot;trying&quot;</span>,         0, 0, OPT_TRYING},</div>
<div class="line"><a id="l01188" name="l01188"></a><span class="lineno"> 1188</span>        { <span class="stringliteral">&quot;ringing&quot;</span>,        0, 0, OPT_RINGING},</div>
<div class="line"><a id="l01189" name="l01189"></a><span class="lineno"> 1189</span>        { NULL, 0, 0, 0 },</div>
<div class="line"><a id="l01190" name="l01190"></a><span class="lineno"> 1190</span>    };</div>
<div class="line"><a id="l01191" name="l01191"></a><span class="lineno"> 1191</span>    <span class="keywordtype">int</span> c;</div>
<div class="line"><a id="l01192" name="l01192"></a><span class="lineno"> 1192</span>    <span class="keywordtype">int</span> option_index;</div>
<div class="line"><a id="l01193" name="l01193"></a><span class="lineno"> 1193</span> </div>
<div class="line"><a id="l01194" name="l01194"></a><span class="lineno"> 1194</span>    <span class="comment">/* Init default application configs */</span></div>
<div class="line"><a id="l01195" name="l01195"></a><span class="lineno"> 1195</span>    app.local_port = 5060;</div>
<div class="line"><a id="l01196" name="l01196"></a><span class="lineno"> 1196</span>    app.thread_count = 1;</div>
<div class="line"><a id="l01197" name="l01197"></a><span class="lineno"> 1197</span>    app.client.job_count = DEFAULT_COUNT;</div>
<div class="line"><a id="l01198" name="l01198"></a><span class="lineno"> 1198</span>    app.client.method = *pjsip_get_options_method();</div>
<div class="line"><a id="l01199" name="l01199"></a><span class="lineno"> 1199</span>    app.client.job_window = c = JOB_WINDOW;</div>
<div class="line"><a id="l01200" name="l01200"></a><span class="lineno"> 1200</span>    app.client.timeout = 60;</div>
<div class="line"><a id="l01201" name="l01201"></a><span class="lineno"> 1201</span>    app.log_level = 3;</div>
<div class="line"><a id="l01202" name="l01202"></a><span class="lineno"> 1202</span> </div>
<div class="line"><a id="l01203" name="l01203"></a><span class="lineno"> 1203</span> </div>
<div class="line"><a id="l01204" name="l01204"></a><span class="lineno"> 1204</span>    <span class="comment">/* Parse options */</span></div>
<div class="line"><a id="l01205" name="l01205"></a><span class="lineno"> 1205</span>    pj_optind = 0;</div>
<div class="line"><a id="l01206" name="l01206"></a><span class="lineno"> 1206</span>    <span class="keywordflow">while</span>((c=pj_getopt_long(argc,argv, <span class="stringliteral">&quot;p:c:m:t:w:d:hsv&quot;</span>, </div>
<div class="line"><a id="l01207" name="l01207"></a><span class="lineno"> 1207</span>                            long_options, &amp;option_index))!=-1) </div>
<div class="line"><a id="l01208" name="l01208"></a><span class="lineno"> 1208</span>    {</div>
<div class="line"><a id="l01209" name="l01209"></a><span class="lineno"> 1209</span>        <span class="keywordflow">switch</span> (c) {</div>
<div class="line"><a id="l01210" name="l01210"></a><span class="lineno"> 1210</span>        <span class="keywordflow">case</span> <span class="charliteral">&#39;p&#39;</span>:</div>
<div class="line"><a id="l01211" name="l01211"></a><span class="lineno"> 1211</span>            app.local_port = my_atoi(pj_optarg);</div>
<div class="line"><a id="l01212" name="l01212"></a><span class="lineno"> 1212</span>            <span class="keywordflow">if</span> (app.local_port &lt; 0 || app.local_port &gt; 65535) {</div>
<div class="line"><a id="l01213" name="l01213"></a><span class="lineno"> 1213</span>                <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(3,(THIS_FILE, <span class="stringliteral">&quot;Invalid --local-port %s&quot;</span>, pj_optarg));</div>
<div class="line"><a id="l01214" name="l01214"></a><span class="lineno"> 1214</span>                <span class="keywordflow">return</span> -1;</div>
<div class="line"><a id="l01215" name="l01215"></a><span class="lineno"> 1215</span>            }</div>
<div class="line"><a id="l01216" name="l01216"></a><span class="lineno"> 1216</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01217" name="l01217"></a><span class="lineno"> 1217</span> </div>
<div class="line"><a id="l01218" name="l01218"></a><span class="lineno"> 1218</span>        <span class="keywordflow">case</span> <span class="charliteral">&#39;c&#39;</span>:</div>
<div class="line"><a id="l01219" name="l01219"></a><span class="lineno"> 1219</span>            app.client.job_count = my_atoi(pj_optarg);</div>
<div class="line"><a id="l01220" name="l01220"></a><span class="lineno"> 1220</span>            <span class="keywordflow">if</span> (app.client.job_count &gt; pjsip_cfg()-&gt;tsx.max_count)</div>
<div class="line"><a id="l01221" name="l01221"></a><span class="lineno"> 1221</span>                <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(3,(THIS_FILE, </div>
<div class="line"><a id="l01222" name="l01222"></a><span class="lineno"> 1222</span>                          <span class="stringliteral">&quot;Warning: --count value (%d) exceeds maximum &quot;</span></div>
<div class="line"><a id="l01223" name="l01223"></a><span class="lineno"> 1223</span>                          <span class="stringliteral">&quot;transaction count (%d)&quot;</span>, app.client.job_count,</div>
<div class="line"><a id="l01224" name="l01224"></a><span class="lineno"> 1224</span>                          pjsip_cfg()-&gt;tsx.max_count));</div>
<div class="line"><a id="l01225" name="l01225"></a><span class="lineno"> 1225</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01226" name="l01226"></a><span class="lineno"> 1226</span> </div>
<div class="line"><a id="l01227" name="l01227"></a><span class="lineno"> 1227</span>        <span class="keywordflow">case</span> OPT_THREAD_COUNT:</div>
<div class="line"><a id="l01228" name="l01228"></a><span class="lineno"> 1228</span>            app.thread_count = my_atoi(pj_optarg);</div>
<div class="line"><a id="l01229" name="l01229"></a><span class="lineno"> 1229</span>            <span class="keywordflow">if</span> (app.thread_count &lt; 1 || app.thread_count &gt; 16) {</div>
<div class="line"><a id="l01230" name="l01230"></a><span class="lineno"> 1230</span>                <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(3,(THIS_FILE, <span class="stringliteral">&quot;Invalid --thread-count %s&quot;</span>, pj_optarg));</div>
<div class="line"><a id="l01231" name="l01231"></a><span class="lineno"> 1231</span>                <span class="keywordflow">return</span> -1;</div>
<div class="line"><a id="l01232" name="l01232"></a><span class="lineno"> 1232</span>            }</div>
<div class="line"><a id="l01233" name="l01233"></a><span class="lineno"> 1233</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01234" name="l01234"></a><span class="lineno"> 1234</span> </div>
<div class="line"><a id="l01235" name="l01235"></a><span class="lineno"> 1235</span>        <span class="keywordflow">case</span> <span class="charliteral">&#39;m&#39;</span>:</div>
<div class="line"><a id="l01236" name="l01236"></a><span class="lineno"> 1236</span>            {</div>
<div class="line"><a id="l01237" name="l01237"></a><span class="lineno"> 1237</span>                <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__str__t.htm">pj_str_t</a> temp = <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a>((<span class="keywordtype">char</span>*)pj_optarg);</div>
<div class="line"><a id="l01238" name="l01238"></a><span class="lineno"> 1238</span>                pjsip_method_init_np(&amp;app.client.method, &amp;temp);</div>
<div class="line"><a id="l01239" name="l01239"></a><span class="lineno"> 1239</span>            }</div>
<div class="line"><a id="l01240" name="l01240"></a><span class="lineno"> 1240</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01241" name="l01241"></a><span class="lineno"> 1241</span> </div>
<div class="line"><a id="l01242" name="l01242"></a><span class="lineno"> 1242</span>        <span class="keywordflow">case</span> <span class="charliteral">&#39;h&#39;</span>:</div>
<div class="line"><a id="l01243" name="l01243"></a><span class="lineno"> 1243</span>            usage();</div>
<div class="line"><a id="l01244" name="l01244"></a><span class="lineno"> 1244</span>            <span class="keywordflow">return</span> -1;</div>
<div class="line"><a id="l01245" name="l01245"></a><span class="lineno"> 1245</span> </div>
<div class="line"><a id="l01246" name="l01246"></a><span class="lineno"> 1246</span>        <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>:</div>
<div class="line"><a id="l01247" name="l01247"></a><span class="lineno"> 1247</span>            app.client.stateless = <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead235b21a623d982cc561fb12bffa87c0">PJ_TRUE</a>;</div>
<div class="line"><a id="l01248" name="l01248"></a><span class="lineno"> 1248</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01249" name="l01249"></a><span class="lineno"> 1249</span> </div>
<div class="line"><a id="l01250" name="l01250"></a><span class="lineno"> 1250</span>        <span class="keywordflow">case</span> OPT_REAL_SDP:</div>
<div class="line"><a id="l01251" name="l01251"></a><span class="lineno"> 1251</span>            app.real_sdp = 1;</div>
<div class="line"><a id="l01252" name="l01252"></a><span class="lineno"> 1252</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01253" name="l01253"></a><span class="lineno"> 1253</span> </div>
<div class="line"><a id="l01254" name="l01254"></a><span class="lineno"> 1254</span>        <span class="keywordflow">case</span> <span class="charliteral">&#39;v&#39;</span>:</div>
<div class="line"><a id="l01255" name="l01255"></a><span class="lineno"> 1255</span>            app.log_level++;</div>
<div class="line"><a id="l01256" name="l01256"></a><span class="lineno"> 1256</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01257" name="l01257"></a><span class="lineno"> 1257</span> </div>
<div class="line"><a id="l01258" name="l01258"></a><span class="lineno"> 1258</span>        <span class="keywordflow">case</span> <span class="charliteral">&#39;t&#39;</span>:</div>
<div class="line"><a id="l01259" name="l01259"></a><span class="lineno"> 1259</span>            app.client.timeout = my_atoi(pj_optarg);</div>
<div class="line"><a id="l01260" name="l01260"></a><span class="lineno"> 1260</span>            <span class="keywordflow">if</span> (app.client.timeout &gt; 600) {</div>
<div class="line"><a id="l01261" name="l01261"></a><span class="lineno"> 1261</span>                <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(3,(THIS_FILE, <span class="stringliteral">&quot;Invalid --timeout %s&quot;</span>, pj_optarg));</div>
<div class="line"><a id="l01262" name="l01262"></a><span class="lineno"> 1262</span>                <span class="keywordflow">return</span> -1;</div>
<div class="line"><a id="l01263" name="l01263"></a><span class="lineno"> 1263</span>            }</div>
<div class="line"><a id="l01264" name="l01264"></a><span class="lineno"> 1264</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01265" name="l01265"></a><span class="lineno"> 1265</span> </div>
<div class="line"><a id="l01266" name="l01266"></a><span class="lineno"> 1266</span>        <span class="keywordflow">case</span> <span class="charliteral">&#39;w&#39;</span>:</div>
<div class="line"><a id="l01267" name="l01267"></a><span class="lineno"> 1267</span>            app.client.job_window = my_atoi(pj_optarg);</div>
<div class="line"><a id="l01268" name="l01268"></a><span class="lineno"> 1268</span>            <span class="keywordflow">if</span> (app.client.job_window &lt;= 0) {</div>
<div class="line"><a id="l01269" name="l01269"></a><span class="lineno"> 1269</span>                <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(3,(THIS_FILE, <span class="stringliteral">&quot;Invalid --window %s&quot;</span>, pj_optarg));</div>
<div class="line"><a id="l01270" name="l01270"></a><span class="lineno"> 1270</span>                <span class="keywordflow">return</span> -1;</div>
<div class="line"><a id="l01271" name="l01271"></a><span class="lineno"> 1271</span>            }</div>
<div class="line"><a id="l01272" name="l01272"></a><span class="lineno"> 1272</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01273" name="l01273"></a><span class="lineno"> 1273</span> </div>
<div class="line"><a id="l01274" name="l01274"></a><span class="lineno"> 1274</span>        <span class="keywordflow">case</span> <span class="charliteral">&#39;T&#39;</span>:</div>
<div class="line"><a id="l01275" name="l01275"></a><span class="lineno"> 1275</span>            app.use_tcp = <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead235b21a623d982cc561fb12bffa87c0">PJ_TRUE</a>;</div>
<div class="line"><a id="l01276" name="l01276"></a><span class="lineno"> 1276</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01277" name="l01277"></a><span class="lineno"> 1277</span> </div>
<div class="line"><a id="l01278" name="l01278"></a><span class="lineno"> 1278</span>        <span class="keywordflow">case</span> <span class="charliteral">&#39;d&#39;</span>:</div>
<div class="line"><a id="l01279" name="l01279"></a><span class="lineno"> 1279</span>            app.server.delay = my_atoi(pj_optarg);</div>
<div class="line"><a id="l01280" name="l01280"></a><span class="lineno"> 1280</span>            <span class="keywordflow">if</span> (app.server.delay &gt; 3600) {</div>
<div class="line"><a id="l01281" name="l01281"></a><span class="lineno"> 1281</span>                <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(3,(THIS_FILE, <span class="stringliteral">&quot;I think --delay %s is too long&quot;</span>, </div>
<div class="line"><a id="l01282" name="l01282"></a><span class="lineno"> 1282</span>                          pj_optarg));</div>
<div class="line"><a id="l01283" name="l01283"></a><span class="lineno"> 1283</span>                <span class="keywordflow">return</span> -1;</div>
<div class="line"><a id="l01284" name="l01284"></a><span class="lineno"> 1284</span>            }</div>
<div class="line"><a id="l01285" name="l01285"></a><span class="lineno"> 1285</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01286" name="l01286"></a><span class="lineno"> 1286</span> </div>
<div class="line"><a id="l01287" name="l01287"></a><span class="lineno"> 1287</span>        <span class="keywordflow">case</span> OPT_TRYING:</div>
<div class="line"><a id="l01288" name="l01288"></a><span class="lineno"> 1288</span>            app.server.send_trying = 1;</div>
<div class="line"><a id="l01289" name="l01289"></a><span class="lineno"> 1289</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01290" name="l01290"></a><span class="lineno"> 1290</span> </div>
<div class="line"><a id="l01291" name="l01291"></a><span class="lineno"> 1291</span>        <span class="keywordflow">case</span> OPT_RINGING:</div>
<div class="line"><a id="l01292" name="l01292"></a><span class="lineno"> 1292</span>            app.server.send_ringing = 1;</div>
<div class="line"><a id="l01293" name="l01293"></a><span class="lineno"> 1293</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01294" name="l01294"></a><span class="lineno"> 1294</span> </div>
<div class="line"><a id="l01295" name="l01295"></a><span class="lineno"> 1295</span>        <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l01296" name="l01296"></a><span class="lineno"> 1296</span>            <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(1,(THIS_FILE, </div>
<div class="line"><a id="l01297" name="l01297"></a><span class="lineno"> 1297</span>                      <span class="stringliteral">&quot;Invalid argument. Use --help to see help&quot;</span>));</div>
<div class="line"><a id="l01298" name="l01298"></a><span class="lineno"> 1298</span>            <span class="keywordflow">return</span> -1;</div>
<div class="line"><a id="l01299" name="l01299"></a><span class="lineno"> 1299</span>        }</div>
<div class="line"><a id="l01300" name="l01300"></a><span class="lineno"> 1300</span>    }</div>
<div class="line"><a id="l01301" name="l01301"></a><span class="lineno"> 1301</span> </div>
<div class="line"><a id="l01302" name="l01302"></a><span class="lineno"> 1302</span>    <span class="keywordflow">if</span> (pj_optind != argc) {</div>
<div class="line"><a id="l01303" name="l01303"></a><span class="lineno"> 1303</span> </div>
<div class="line"><a id="l01304" name="l01304"></a><span class="lineno"> 1304</span>        <span class="keywordflow">if</span> (verify_sip_url(argv[pj_optind]) != <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div>
<div class="line"><a id="l01305" name="l01305"></a><span class="lineno"> 1305</span>            <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(1,(THIS_FILE, <span class="stringliteral">&quot;Invalid SIP URI %s&quot;</span>, argv[pj_optind]));</div>
<div class="line"><a id="l01306" name="l01306"></a><span class="lineno"> 1306</span>            <span class="keywordflow">return</span> -1;</div>
<div class="line"><a id="l01307" name="l01307"></a><span class="lineno"> 1307</span>        }</div>
<div class="line"><a id="l01308" name="l01308"></a><span class="lineno"> 1308</span>        app.client.dst_uri = <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a>(argv[pj_optind]);</div>
<div class="line"><a id="l01309" name="l01309"></a><span class="lineno"> 1309</span>        </div>
<div class="line"><a id="l01310" name="l01310"></a><span class="lineno"> 1310</span>        pj_optind++;</div>
<div class="line"><a id="l01311" name="l01311"></a><span class="lineno"> 1311</span> </div>
<div class="line"><a id="l01312" name="l01312"></a><span class="lineno"> 1312</span>    }</div>
<div class="line"><a id="l01313" name="l01313"></a><span class="lineno"> 1313</span> </div>
<div class="line"><a id="l01314" name="l01314"></a><span class="lineno"> 1314</span>    <span class="keywordflow">if</span> (pj_optind != argc) {</div>
<div class="line"><a id="l01315" name="l01315"></a><span class="lineno"> 1315</span>        <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(1,(THIS_FILE, <span class="stringliteral">&quot;Error: unknown options %s&quot;</span>, argv[pj_optind]));</div>
<div class="line"><a id="l01316" name="l01316"></a><span class="lineno"> 1316</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a id="l01317" name="l01317"></a><span class="lineno"> 1317</span>    }</div>
<div class="line"><a id="l01318" name="l01318"></a><span class="lineno"> 1318</span> </div>
<div class="line"><a id="l01319" name="l01319"></a><span class="lineno"> 1319</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l01320" name="l01320"></a><span class="lineno"> 1320</span>}</div>
<div class="line"><a id="l01321" name="l01321"></a><span class="lineno"> 1321</span> </div>
<div class="line"><a id="l01322" name="l01322"></a><span class="lineno"> 1322</span> </div>
<div class="line"><a id="l01323" name="l01323"></a><span class="lineno"> 1323</span><span class="comment">/* Send one stateless request */</span></div>
<div class="line"><a id="l01324" name="l01324"></a><span class="lineno"> 1324</span><span class="keyword">static</span> <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> submit_stateless_job(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l01325" name="l01325"></a><span class="lineno"> 1325</span>{</div>
<div class="line"><a id="l01326" name="l01326"></a><span class="lineno"> 1326</span>    pjsip_tx_data *tdata;</div>
<div class="line"><a id="l01327" name="l01327"></a><span class="lineno"> 1327</span>    <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> status;</div>
<div class="line"><a id="l01328" name="l01328"></a><span class="lineno"> 1328</span> </div>
<div class="line"><a id="l01329" name="l01329"></a><span class="lineno"> 1329</span>    status = pjsip_endpt_create_request(app.sip_endpt, &amp;app.client.method, </div>
<div class="line"><a id="l01330" name="l01330"></a><span class="lineno"> 1330</span>                                        &amp;app.client.dst_uri, &amp;app.local_uri,</div>
<div class="line"><a id="l01331" name="l01331"></a><span class="lineno"> 1331</span>                                        &amp;app.client.dst_uri, &amp;app.local_contact,</div>
<div class="line"><a id="l01332" name="l01332"></a><span class="lineno"> 1332</span>                                        NULL, -1, NULL, &amp;tdata);</div>
<div class="line"><a id="l01333" name="l01333"></a><span class="lineno"> 1333</span>    <span class="keywordflow">if</span> (status != <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div>
<div class="line"><a id="l01334" name="l01334"></a><span class="lineno"> 1334</span>        app_perror(THIS_FILE, <span class="stringliteral">&quot;Error creating request&quot;</span>, status);</div>
<div class="line"><a id="l01335" name="l01335"></a><span class="lineno"> 1335</span>        report_completion(701);</div>
<div class="line"><a id="l01336" name="l01336"></a><span class="lineno"> 1336</span>        <span class="keywordflow">return</span> status;</div>
<div class="line"><a id="l01337" name="l01337"></a><span class="lineno"> 1337</span>    }</div>
<div class="line"><a id="l01338" name="l01338"></a><span class="lineno"> 1338</span> </div>
<div class="line"><a id="l01339" name="l01339"></a><span class="lineno"> 1339</span>    status = pjsip_endpt_send_request_stateless(app.sip_endpt, tdata, NULL,</div>
<div class="line"><a id="l01340" name="l01340"></a><span class="lineno"> 1340</span>                                                NULL);</div>
<div class="line"><a id="l01341" name="l01341"></a><span class="lineno"> 1341</span>    <span class="keywordflow">if</span> (status != <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div>
<div class="line"><a id="l01342" name="l01342"></a><span class="lineno"> 1342</span>        pjsip_tx_data_dec_ref(tdata);</div>
<div class="line"><a id="l01343" name="l01343"></a><span class="lineno"> 1343</span>        app_perror(THIS_FILE, <span class="stringliteral">&quot;Error sending stateless request&quot;</span>, status);</div>
<div class="line"><a id="l01344" name="l01344"></a><span class="lineno"> 1344</span>        report_completion(701);</div>
<div class="line"><a id="l01345" name="l01345"></a><span class="lineno"> 1345</span>        <span class="keywordflow">return</span> status;</div>
<div class="line"><a id="l01346" name="l01346"></a><span class="lineno"> 1346</span>    }</div>
<div class="line"><a id="l01347" name="l01347"></a><span class="lineno"> 1347</span> </div>
<div class="line"><a id="l01348" name="l01348"></a><span class="lineno"> 1348</span>    <span class="keywordflow">return</span> <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>;</div>
<div class="line"><a id="l01349" name="l01349"></a><span class="lineno"> 1349</span>}</div>
<div class="line"><a id="l01350" name="l01350"></a><span class="lineno"> 1350</span> </div>
<div class="line"><a id="l01351" name="l01351"></a><span class="lineno"> 1351</span> </div>
<div class="line"><a id="l01352" name="l01352"></a><span class="lineno"> 1352</span><span class="comment">/* This callback is called when client transaction state has changed */</span></div>
<div class="line"><a id="l01353" name="l01353"></a><span class="lineno"> 1353</span><span class="keyword">static</span> <span class="keywordtype">void</span> tsx_completion_cb(<span class="keywordtype">void</span> *token, pjsip_event *event)</div>
<div class="line"><a id="l01354" name="l01354"></a><span class="lineno"> 1354</span>{</div>
<div class="line"><a id="l01355" name="l01355"></a><span class="lineno"> 1355</span>    pjsip_transaction *tsx;</div>
<div class="line"><a id="l01356" name="l01356"></a><span class="lineno"> 1356</span> </div>
<div class="line"><a id="l01357" name="l01357"></a><span class="lineno"> 1357</span>    <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__pj__config.htm#ga7523f8576efd271c22b188eab05d7870">PJ_UNUSED_ARG</a>(token);</div>
<div class="line"><a id="l01358" name="l01358"></a><span class="lineno"> 1358</span> </div>
<div class="line"><a id="l01359" name="l01359"></a><span class="lineno"> 1359</span>    <span class="keywordflow">if</span> (event-&gt;type != PJSIP_EVENT_TSX_STATE)</div>
<div class="line"><a id="l01360" name="l01360"></a><span class="lineno"> 1360</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01361" name="l01361"></a><span class="lineno"> 1361</span> </div>
<div class="line"><a id="l01362" name="l01362"></a><span class="lineno"> 1362</span>    tsx = <span class="keyword">event</span>-&gt;body.tsx_state.tsx;</div>
<div class="line"><a id="l01363" name="l01363"></a><span class="lineno"> 1363</span> </div>
<div class="line"><a id="l01364" name="l01364"></a><span class="lineno"> 1364</span>    <span class="keywordflow">if</span> (tsx-&gt;mod_data[mod_test.id] != NULL) {</div>
<div class="line"><a id="l01365" name="l01365"></a><span class="lineno"> 1365</span>        <span class="comment">/* This transaction has been calculated before */</span></div>
<div class="line"><a id="l01366" name="l01366"></a><span class="lineno"> 1366</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01367" name="l01367"></a><span class="lineno"> 1367</span>    }</div>
<div class="line"><a id="l01368" name="l01368"></a><span class="lineno"> 1368</span> </div>
<div class="line"><a id="l01369" name="l01369"></a><span class="lineno"> 1369</span>    <span class="keywordflow">if</span> (tsx-&gt;state==PJSIP_TSX_STATE_TERMINATED) {</div>
<div class="line"><a id="l01370" name="l01370"></a><span class="lineno"> 1370</span>        report_completion(tsx-&gt;status_code);</div>
<div class="line"><a id="l01371" name="l01371"></a><span class="lineno"> 1371</span>        tsx-&gt;mod_data[mod_test.id] = (<span class="keywordtype">void</span>*)(<a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga173588cd6381f3ad354c23c26929093a">pj_ssize_t</a>)1;</div>
<div class="line"><a id="l01372" name="l01372"></a><span class="lineno"> 1372</span>    }</div>
<div class="line"><a id="l01373" name="l01373"></a><span class="lineno"> 1373</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tsx-&gt;method.id == PJSIP_INVITE_METHOD &amp;&amp;</div>
<div class="line"><a id="l01374" name="l01374"></a><span class="lineno"> 1374</span>             tsx-&gt;state == PJSIP_TSX_STATE_CONFIRMED) {</div>
<div class="line"><a id="l01375" name="l01375"></a><span class="lineno"> 1375</span> </div>
<div class="line"><a id="l01376" name="l01376"></a><span class="lineno"> 1376</span>        report_completion(tsx-&gt;status_code);</div>
<div class="line"><a id="l01377" name="l01377"></a><span class="lineno"> 1377</span>        tsx-&gt;mod_data[mod_test.id] = (<span class="keywordtype">void</span>*)(<a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga173588cd6381f3ad354c23c26929093a">pj_ssize_t</a>)1;</div>
<div class="line"><a id="l01378" name="l01378"></a><span class="lineno"> 1378</span>        </div>
<div class="line"><a id="l01379" name="l01379"></a><span class="lineno"> 1379</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tsx-&gt;state == PJSIP_TSX_STATE_COMPLETED) {</div>
<div class="line"><a id="l01380" name="l01380"></a><span class="lineno"> 1380</span> </div>
<div class="line"><a id="l01381" name="l01381"></a><span class="lineno"> 1381</span>        report_completion(tsx-&gt;status_code);</div>
<div class="line"><a id="l01382" name="l01382"></a><span class="lineno"> 1382</span>        tsx-&gt;mod_data[mod_test.id] = (<span class="keywordtype">void</span>*)(<a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga173588cd6381f3ad354c23c26929093a">pj_ssize_t</a>)1;</div>
<div class="line"><a id="l01383" name="l01383"></a><span class="lineno"> 1383</span> </div>
<div class="line"><a id="l01384" name="l01384"></a><span class="lineno"> 1384</span>        TERMINATE_TSX(tsx, tsx-&gt;status_code);</div>
<div class="line"><a id="l01385" name="l01385"></a><span class="lineno"> 1385</span>    }</div>
<div class="line"><a id="l01386" name="l01386"></a><span class="lineno"> 1386</span>}</div>
<div class="line"><a id="l01387" name="l01387"></a><span class="lineno"> 1387</span> </div>
<div class="line"><a id="l01388" name="l01388"></a><span class="lineno"> 1388</span> </div>
<div class="line"><a id="l01389" name="l01389"></a><span class="lineno"> 1389</span><span class="comment">/* Send one stateful request */</span></div>
<div class="line"><a id="l01390" name="l01390"></a><span class="lineno"> 1390</span><span class="keyword">static</span> <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> submit_job(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l01391" name="l01391"></a><span class="lineno"> 1391</span>{</div>
<div class="line"><a id="l01392" name="l01392"></a><span class="lineno"> 1392</span>    pjsip_tx_data *tdata;</div>
<div class="line"><a id="l01393" name="l01393"></a><span class="lineno"> 1393</span>    <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> status;</div>
<div class="line"><a id="l01394" name="l01394"></a><span class="lineno"> 1394</span> </div>
<div class="line"><a id="l01395" name="l01395"></a><span class="lineno"> 1395</span>    status = pjsip_endpt_create_request(app.sip_endpt, &amp;app.client.method, </div>
<div class="line"><a id="l01396" name="l01396"></a><span class="lineno"> 1396</span>                                        &amp;app.client.dst_uri, &amp;app.local_uri,</div>
<div class="line"><a id="l01397" name="l01397"></a><span class="lineno"> 1397</span>                                        &amp;app.client.dst_uri, &amp;app.local_contact,</div>
<div class="line"><a id="l01398" name="l01398"></a><span class="lineno"> 1398</span>                                        NULL, -1, NULL, &amp;tdata);</div>
<div class="line"><a id="l01399" name="l01399"></a><span class="lineno"> 1399</span>    <span class="keywordflow">if</span> (status != <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div>
<div class="line"><a id="l01400" name="l01400"></a><span class="lineno"> 1400</span>        app_perror(THIS_FILE, <span class="stringliteral">&quot;Error creating request&quot;</span>, status);</div>
<div class="line"><a id="l01401" name="l01401"></a><span class="lineno"> 1401</span>        report_completion(701);</div>
<div class="line"><a id="l01402" name="l01402"></a><span class="lineno"> 1402</span>        <span class="keywordflow">return</span> status;</div>
<div class="line"><a id="l01403" name="l01403"></a><span class="lineno"> 1403</span>    }</div>
<div class="line"><a id="l01404" name="l01404"></a><span class="lineno"> 1404</span> </div>
<div class="line"><a id="l01405" name="l01405"></a><span class="lineno"> 1405</span>    status = pjsip_endpt_send_request(app.sip_endpt, tdata, -1, NULL, </div>
<div class="line"><a id="l01406" name="l01406"></a><span class="lineno"> 1406</span>                                      &amp;tsx_completion_cb);</div>
<div class="line"><a id="l01407" name="l01407"></a><span class="lineno"> 1407</span>    <span class="keywordflow">if</span> (status != <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div>
<div class="line"><a id="l01408" name="l01408"></a><span class="lineno"> 1408</span>        app_perror(THIS_FILE, <span class="stringliteral">&quot;Error sending stateful request&quot;</span>, status);</div>
<div class="line"><a id="l01409" name="l01409"></a><span class="lineno"> 1409</span>        <span class="comment">//should have been reported by tsx_completion_cb().</span></div>
<div class="line"><a id="l01410" name="l01410"></a><span class="lineno"> 1410</span>        <span class="comment">//report_completion(701);</span></div>
<div class="line"><a id="l01411" name="l01411"></a><span class="lineno"> 1411</span>        <span class="comment">//No longer necessary (r777)</span></div>
<div class="line"><a id="l01412" name="l01412"></a><span class="lineno"> 1412</span>        <span class="comment">//pjsip_tx_data_dec_ref(tdata);</span></div>
<div class="line"><a id="l01413" name="l01413"></a><span class="lineno"> 1413</span>    }</div>
<div class="line"><a id="l01414" name="l01414"></a><span class="lineno"> 1414</span>    <span class="keywordflow">return</span> status;</div>
<div class="line"><a id="l01415" name="l01415"></a><span class="lineno"> 1415</span>}</div>
<div class="line"><a id="l01416" name="l01416"></a><span class="lineno"> 1416</span> </div>
<div class="line"><a id="l01417" name="l01417"></a><span class="lineno"> 1417</span> </div>
<div class="line"><a id="l01418" name="l01418"></a><span class="lineno"> 1418</span><span class="comment">/* Client worker thread */</span></div>
<div class="line"><a id="l01419" name="l01419"></a><span class="lineno"> 1419</span><span class="keyword">static</span> <span class="keywordtype">int</span> client_thread(<span class="keywordtype">void</span> *arg)</div>
<div class="line"><a id="l01420" name="l01420"></a><span class="lineno"> 1420</span>{</div>
<div class="line"><a id="l01421" name="l01421"></a><span class="lineno"> 1421</span>    <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__time__val.htm">pj_time_val</a> end_time, last_report, now;</div>
<div class="line"><a id="l01422" name="l01422"></a><span class="lineno"> 1422</span>    <span class="keywordtype">unsigned</span> thread_index = (unsigned)(<span class="keywordtype">long</span>)(<a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga173588cd6381f3ad354c23c26929093a">pj_ssize_t</a>)arg;</div>
<div class="line"><a id="l01423" name="l01423"></a><span class="lineno"> 1423</span>    <span class="keywordtype">unsigned</span> cycle = 0, last_cycle = 0;</div>
<div class="line"><a id="l01424" name="l01424"></a><span class="lineno"> 1424</span> </div>
<div class="line"><a id="l01425" name="l01425"></a><span class="lineno"> 1425</span>    <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__THREAD.htm#gad59cd6fd7390711758afcc0bde375d68">pj_thread_sleep</a>(100);</div>
<div class="line"><a id="l01426" name="l01426"></a><span class="lineno"> 1426</span> </div>
<div class="line"><a id="l01427" name="l01427"></a><span class="lineno"> 1427</span>    <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__TIME.htm#ga0806df13f40d3153061f399ed86be856">pj_gettimeofday</a>(&amp;end_time);</div>
<div class="line"><a id="l01428" name="l01428"></a><span class="lineno"> 1428</span>    end_time.<a class="code hl_variableRef" href="../../../pjlib/docs/html/structpj__time__val.htm#af2739d0c2189e9c902281c04fd1f4502">sec</a> += app.client.timeout;</div>
<div class="line"><a id="l01429" name="l01429"></a><span class="lineno"> 1429</span> </div>
<div class="line"><a id="l01430" name="l01430"></a><span class="lineno"> 1430</span>    <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__TIME.htm#ga0806df13f40d3153061f399ed86be856">pj_gettimeofday</a>(&amp;last_report);</div>
<div class="line"><a id="l01431" name="l01431"></a><span class="lineno"> 1431</span> </div>
<div class="line"><a id="l01432" name="l01432"></a><span class="lineno"> 1432</span>    <span class="keywordflow">if</span> (app.client.first_request.sec == 0) {</div>
<div class="line"><a id="l01433" name="l01433"></a><span class="lineno"> 1433</span>        <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__TIME.htm#ga0806df13f40d3153061f399ed86be856">pj_gettimeofday</a>(&amp;app.client.first_request);</div>
<div class="line"><a id="l01434" name="l01434"></a><span class="lineno"> 1434</span>    }</div>
<div class="line"><a id="l01435" name="l01435"></a><span class="lineno"> 1435</span> </div>
<div class="line"><a id="l01436" name="l01436"></a><span class="lineno"> 1436</span>    <span class="comment">/* Submit all jobs */</span></div>
<div class="line"><a id="l01437" name="l01437"></a><span class="lineno"> 1437</span>    <span class="keywordflow">while</span> (app.client.job_submitted &lt; app.client.job_count &amp;&amp; !app.thread_quit){</div>
<div class="line"><a id="l01438" name="l01438"></a><span class="lineno"> 1438</span>        <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__time__val.htm">pj_time_val</a> timeout = { 0, 1 };</div>
<div class="line"><a id="l01439" name="l01439"></a><span class="lineno"> 1439</span>        <span class="keywordtype">unsigned</span> i;</div>
<div class="line"><a id="l01440" name="l01440"></a><span class="lineno"> 1440</span>        <span class="keywordtype">int</span> outstanding;</div>
<div class="line"><a id="l01441" name="l01441"></a><span class="lineno"> 1441</span>        <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> status;</div>
<div class="line"><a id="l01442" name="l01442"></a><span class="lineno"> 1442</span> </div>
<div class="line"><a id="l01443" name="l01443"></a><span class="lineno"> 1443</span>        <span class="comment">/* Calculate current outstanding job */</span></div>
<div class="line"><a id="l01444" name="l01444"></a><span class="lineno"> 1444</span>        outstanding = app.client.job_submitted - app.client.job_finished;</div>
<div class="line"><a id="l01445" name="l01445"></a><span class="lineno"> 1445</span> </div>
<div class="line"><a id="l01446" name="l01446"></a><span class="lineno"> 1446</span>        <span class="comment">/* Update stats on max outstanding jobs */</span></div>
<div class="line"><a id="l01447" name="l01447"></a><span class="lineno"> 1447</span>        <span class="keywordflow">if</span> (outstanding &gt; (<span class="keywordtype">int</span>)app.client.stat_max_window)</div>
<div class="line"><a id="l01448" name="l01448"></a><span class="lineno"> 1448</span>            app.client.stat_max_window = outstanding;</div>
<div class="line"><a id="l01449" name="l01449"></a><span class="lineno"> 1449</span> </div>
<div class="line"><a id="l01450" name="l01450"></a><span class="lineno"> 1450</span>        <span class="comment">/* Wait if there are more pending jobs than allowed in the</span></div>
<div class="line"><a id="l01451" name="l01451"></a><span class="lineno"> 1451</span><span class="comment">         * window. But spawn a new job anyway if no events are happening</span></div>
<div class="line"><a id="l01452" name="l01452"></a><span class="lineno"> 1452</span><span class="comment">         * after we wait for some time.</span></div>
<div class="line"><a id="l01453" name="l01453"></a><span class="lineno"> 1453</span><span class="comment">         */</span></div>
<div class="line"><a id="l01454" name="l01454"></a><span class="lineno"> 1454</span>        <span class="keywordflow">for</span> (i=0; outstanding &gt; (int)app.client.job_window &amp;&amp; i&lt;1000; ++i) {</div>
<div class="line"><a id="l01455" name="l01455"></a><span class="lineno"> 1455</span>            <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__time__val.htm">pj_time_val</a> wait = { 0, 500 };</div>
<div class="line"><a id="l01456" name="l01456"></a><span class="lineno"> 1456</span>            <span class="keywordtype">unsigned</span> count = 0;</div>
<div class="line"><a id="l01457" name="l01457"></a><span class="lineno"> 1457</span> </div>
<div class="line"><a id="l01458" name="l01458"></a><span class="lineno"> 1458</span>            pjsip_endpt_handle_events2(app.sip_endpt, &amp;wait, &amp;count);</div>
<div class="line"><a id="l01459" name="l01459"></a><span class="lineno"> 1459</span>            outstanding = app.client.job_submitted - app.client.job_finished;</div>
<div class="line"><a id="l01460" name="l01460"></a><span class="lineno"> 1460</span> </div>
<div class="line"><a id="l01461" name="l01461"></a><span class="lineno"> 1461</span>            <span class="keywordflow">if</span> (count == 0)</div>
<div class="line"><a id="l01462" name="l01462"></a><span class="lineno"> 1462</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01463" name="l01463"></a><span class="lineno"> 1463</span> </div>
<div class="line"><a id="l01464" name="l01464"></a><span class="lineno"> 1464</span>            ++cycle;</div>
<div class="line"><a id="l01465" name="l01465"></a><span class="lineno"> 1465</span>        }</div>
<div class="line"><a id="l01466" name="l01466"></a><span class="lineno"> 1466</span> </div>
<div class="line"><a id="l01467" name="l01467"></a><span class="lineno"> 1467</span> </div>
<div class="line"><a id="l01468" name="l01468"></a><span class="lineno"> 1468</span>        <span class="comment">/* Submit one job */</span></div>
<div class="line"><a id="l01469" name="l01469"></a><span class="lineno"> 1469</span>        <span class="keywordflow">if</span> (app.client.method.id == PJSIP_INVITE_METHOD) {</div>
<div class="line"><a id="l01470" name="l01470"></a><span class="lineno"> 1470</span>            status = make_call(&amp;app.client.dst_uri);</div>
<div class="line"><a id="l01471" name="l01471"></a><span class="lineno"> 1471</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (app.client.stateless) {</div>
<div class="line"><a id="l01472" name="l01472"></a><span class="lineno"> 1472</span>            status = submit_stateless_job();</div>
<div class="line"><a id="l01473" name="l01473"></a><span class="lineno"> 1473</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01474" name="l01474"></a><span class="lineno"> 1474</span>            status = submit_job();</div>
<div class="line"><a id="l01475" name="l01475"></a><span class="lineno"> 1475</span>        }</div>
<div class="line"><a id="l01476" name="l01476"></a><span class="lineno"> 1476</span>        <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__pj__config.htm#ga7523f8576efd271c22b188eab05d7870">PJ_UNUSED_ARG</a>(status);</div>
<div class="line"><a id="l01477" name="l01477"></a><span class="lineno"> 1477</span> </div>
<div class="line"><a id="l01478" name="l01478"></a><span class="lineno"> 1478</span>        ++app.client.job_submitted;</div>
<div class="line"><a id="l01479" name="l01479"></a><span class="lineno"> 1479</span>        ++cycle;</div>
<div class="line"><a id="l01480" name="l01480"></a><span class="lineno"> 1480</span> </div>
<div class="line"><a id="l01481" name="l01481"></a><span class="lineno"> 1481</span>        <span class="comment">/* Handle event */</span></div>
<div class="line"><a id="l01482" name="l01482"></a><span class="lineno"> 1482</span>        pjsip_endpt_handle_events2(app.sip_endpt, &amp;timeout, NULL);</div>
<div class="line"><a id="l01483" name="l01483"></a><span class="lineno"> 1483</span> </div>
<div class="line"><a id="l01484" name="l01484"></a><span class="lineno"> 1484</span>        <span class="comment">/* Check for time out, also print report */</span></div>
<div class="line"><a id="l01485" name="l01485"></a><span class="lineno"> 1485</span>        <span class="keywordflow">if</span> (cycle - last_cycle &gt;= 500) {</div>
<div class="line"><a id="l01486" name="l01486"></a><span class="lineno"> 1486</span>            <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__TIME.htm#ga0806df13f40d3153061f399ed86be856">pj_gettimeofday</a>(&amp;now);</div>
<div class="line"><a id="l01487" name="l01487"></a><span class="lineno"> 1487</span>            <span class="keywordflow">if</span> (<a class="code hl_defineRef" href="../../../pjlib/docs/html/group__PJ__TIME.htm#gafe6b8b7461c59a2c9d1dbecd11a53d48">PJ_TIME_VAL_GTE</a>(now, end_time)) {</div>
<div class="line"><a id="l01488" name="l01488"></a><span class="lineno"> 1488</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01489" name="l01489"></a><span class="lineno"> 1489</span>            }</div>
<div class="line"><a id="l01490" name="l01490"></a><span class="lineno"> 1490</span>            last_cycle = cycle;</div>
<div class="line"><a id="l01491" name="l01491"></a><span class="lineno"> 1491</span> </div>
<div class="line"><a id="l01492" name="l01492"></a><span class="lineno"> 1492</span>            </div>
<div class="line"><a id="l01493" name="l01493"></a><span class="lineno"> 1493</span>            <span class="keywordflow">if</span> (thread_index == 0 &amp;&amp; now.<a class="code hl_variableRef" href="../../../pjlib/docs/html/structpj__time__val.htm#af2739d0c2189e9c902281c04fd1f4502">sec</a>-last_report.<a class="code hl_variableRef" href="../../../pjlib/docs/html/structpj__time__val.htm#af2739d0c2189e9c902281c04fd1f4502">sec</a> &gt;= 2) {</div>
<div class="line"><a id="l01494" name="l01494"></a><span class="lineno"> 1494</span>                printf(<span class="stringliteral">&quot;\r%d jobs started, %d completed...   &quot;</span>,</div>
<div class="line"><a id="l01495" name="l01495"></a><span class="lineno"> 1495</span>                       app.client.job_submitted, app.client.job_finished);</div>
<div class="line"><a id="l01496" name="l01496"></a><span class="lineno"> 1496</span>                fflush(stdout);</div>
<div class="line"><a id="l01497" name="l01497"></a><span class="lineno"> 1497</span>                last_report = now;</div>
<div class="line"><a id="l01498" name="l01498"></a><span class="lineno"> 1498</span>            }</div>
<div class="line"><a id="l01499" name="l01499"></a><span class="lineno"> 1499</span>        }</div>
<div class="line"><a id="l01500" name="l01500"></a><span class="lineno"> 1500</span>    }</div>
<div class="line"><a id="l01501" name="l01501"></a><span class="lineno"> 1501</span> </div>
<div class="line"><a id="l01502" name="l01502"></a><span class="lineno"> 1502</span>    <span class="keywordflow">if</span> (app.client.requests_sent.sec == 0) {</div>
<div class="line"><a id="l01503" name="l01503"></a><span class="lineno"> 1503</span>        <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__TIME.htm#ga0806df13f40d3153061f399ed86be856">pj_gettimeofday</a>(&amp;app.client.requests_sent);</div>
<div class="line"><a id="l01504" name="l01504"></a><span class="lineno"> 1504</span>    }</div>
<div class="line"><a id="l01505" name="l01505"></a><span class="lineno"> 1505</span> </div>
<div class="line"><a id="l01506" name="l01506"></a><span class="lineno"> 1506</span> </div>
<div class="line"><a id="l01507" name="l01507"></a><span class="lineno"> 1507</span>    <span class="keywordflow">if</span> (thread_index == 0) {</div>
<div class="line"><a id="l01508" name="l01508"></a><span class="lineno"> 1508</span>        printf(<span class="stringliteral">&quot;\r%d jobs started, %d completed%s\n&quot;</span>,</div>
<div class="line"><a id="l01509" name="l01509"></a><span class="lineno"> 1509</span>               app.client.job_submitted, app.client.job_finished,</div>
<div class="line"><a id="l01510" name="l01510"></a><span class="lineno"> 1510</span>               (app.client.job_submitted!=app.client.job_finished ? </div>
<div class="line"><a id="l01511" name="l01511"></a><span class="lineno"> 1511</span>                <span class="stringliteral">&quot;, waiting...&quot;</span> : <span class="stringliteral">&quot;.&quot;</span>) );</div>
<div class="line"><a id="l01512" name="l01512"></a><span class="lineno"> 1512</span>        fflush(stdout);</div>
<div class="line"><a id="l01513" name="l01513"></a><span class="lineno"> 1513</span>    }</div>
<div class="line"><a id="l01514" name="l01514"></a><span class="lineno"> 1514</span> </div>
<div class="line"><a id="l01515" name="l01515"></a><span class="lineno"> 1515</span>    <span class="comment">/* Wait until all jobs completes, or timed out */</span></div>
<div class="line"><a id="l01516" name="l01516"></a><span class="lineno"> 1516</span>    <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__TIME.htm#ga0806df13f40d3153061f399ed86be856">pj_gettimeofday</a>(&amp;now);</div>
<div class="line"><a id="l01517" name="l01517"></a><span class="lineno"> 1517</span>    <span class="keywordflow">while</span> (<a class="code hl_defineRef" href="../../../pjlib/docs/html/group__PJ__TIME.htm#ga9dd4507187780ed1e83a10176dc845b8">PJ_TIME_VAL_LT</a>(now, end_time) &amp;&amp; </div>
<div class="line"><a id="l01518" name="l01518"></a><span class="lineno"> 1518</span>           app.client.job_finished &lt; app.client.job_count &amp;&amp; </div>
<div class="line"><a id="l01519" name="l01519"></a><span class="lineno"> 1519</span>           !app.thread_quit) </div>
<div class="line"><a id="l01520" name="l01520"></a><span class="lineno"> 1520</span>    {</div>
<div class="line"><a id="l01521" name="l01521"></a><span class="lineno"> 1521</span>        <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__time__val.htm">pj_time_val</a> timeout = { 0, 1 };</div>
<div class="line"><a id="l01522" name="l01522"></a><span class="lineno"> 1522</span>        <span class="keywordtype">unsigned</span> i;</div>
<div class="line"><a id="l01523" name="l01523"></a><span class="lineno"> 1523</span> </div>
<div class="line"><a id="l01524" name="l01524"></a><span class="lineno"> 1524</span>        <span class="keywordflow">for</span> (i=0; i&lt;1000; ++i) {</div>
<div class="line"><a id="l01525" name="l01525"></a><span class="lineno"> 1525</span>            <span class="keywordtype">unsigned</span> count;</div>
<div class="line"><a id="l01526" name="l01526"></a><span class="lineno"> 1526</span>            count = 0;</div>
<div class="line"><a id="l01527" name="l01527"></a><span class="lineno"> 1527</span>            pjsip_endpt_handle_events2(app.sip_endpt, &amp;timeout, &amp;count);</div>
<div class="line"><a id="l01528" name="l01528"></a><span class="lineno"> 1528</span>            <span class="keywordflow">if</span> (count == 0)</div>
<div class="line"><a id="l01529" name="l01529"></a><span class="lineno"> 1529</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01530" name="l01530"></a><span class="lineno"> 1530</span>        }</div>
<div class="line"><a id="l01531" name="l01531"></a><span class="lineno"> 1531</span> </div>
<div class="line"><a id="l01532" name="l01532"></a><span class="lineno"> 1532</span>        <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__TIME.htm#ga0806df13f40d3153061f399ed86be856">pj_gettimeofday</a>(&amp;now);</div>
<div class="line"><a id="l01533" name="l01533"></a><span class="lineno"> 1533</span>    }</div>
<div class="line"><a id="l01534" name="l01534"></a><span class="lineno"> 1534</span> </div>
<div class="line"><a id="l01535" name="l01535"></a><span class="lineno"> 1535</span>    <span class="comment">/* Wait couple of seconds to let jobs completes (e.g. ACKs to be sent)  */</span></div>
<div class="line"><a id="l01536" name="l01536"></a><span class="lineno"> 1536</span>    <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__TIME.htm#ga0806df13f40d3153061f399ed86be856">pj_gettimeofday</a>(&amp;now);</div>
<div class="line"><a id="l01537" name="l01537"></a><span class="lineno"> 1537</span>    end_time = now;</div>
<div class="line"><a id="l01538" name="l01538"></a><span class="lineno"> 1538</span>    end_time.<a class="code hl_variableRef" href="../../../pjlib/docs/html/structpj__time__val.htm#af2739d0c2189e9c902281c04fd1f4502">sec</a> += 2;</div>
<div class="line"><a id="l01539" name="l01539"></a><span class="lineno"> 1539</span>    <span class="keywordflow">while</span> (<a class="code hl_defineRef" href="../../../pjlib/docs/html/group__PJ__TIME.htm#ga9dd4507187780ed1e83a10176dc845b8">PJ_TIME_VAL_LT</a>(now, end_time)) </div>
<div class="line"><a id="l01540" name="l01540"></a><span class="lineno"> 1540</span>    {</div>
<div class="line"><a id="l01541" name="l01541"></a><span class="lineno"> 1541</span>        <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__time__val.htm">pj_time_val</a> timeout = { 0, 1 };</div>
<div class="line"><a id="l01542" name="l01542"></a><span class="lineno"> 1542</span>        <span class="keywordtype">unsigned</span> i;</div>
<div class="line"><a id="l01543" name="l01543"></a><span class="lineno"> 1543</span> </div>
<div class="line"><a id="l01544" name="l01544"></a><span class="lineno"> 1544</span>        <span class="keywordflow">for</span> (i=0; i&lt;1000; ++i) {</div>
<div class="line"><a id="l01545" name="l01545"></a><span class="lineno"> 1545</span>            <span class="keywordtype">unsigned</span> count;</div>
<div class="line"><a id="l01546" name="l01546"></a><span class="lineno"> 1546</span>            count = 0;</div>
<div class="line"><a id="l01547" name="l01547"></a><span class="lineno"> 1547</span>            pjsip_endpt_handle_events2(app.sip_endpt, &amp;timeout, &amp;count);</div>
<div class="line"><a id="l01548" name="l01548"></a><span class="lineno"> 1548</span>            <span class="keywordflow">if</span> (count == 0)</div>
<div class="line"><a id="l01549" name="l01549"></a><span class="lineno"> 1549</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01550" name="l01550"></a><span class="lineno"> 1550</span>        }</div>
<div class="line"><a id="l01551" name="l01551"></a><span class="lineno"> 1551</span> </div>
<div class="line"><a id="l01552" name="l01552"></a><span class="lineno"> 1552</span>        <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__TIME.htm#ga0806df13f40d3153061f399ed86be856">pj_gettimeofday</a>(&amp;now);</div>
<div class="line"><a id="l01553" name="l01553"></a><span class="lineno"> 1553</span>    }</div>
<div class="line"><a id="l01554" name="l01554"></a><span class="lineno"> 1554</span> </div>
<div class="line"><a id="l01555" name="l01555"></a><span class="lineno"> 1555</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l01556" name="l01556"></a><span class="lineno"> 1556</span>}</div>
<div class="line"><a id="l01557" name="l01557"></a><span class="lineno"> 1557</span> </div>
<div class="line"><a id="l01558" name="l01558"></a><span class="lineno"> 1558</span> </div>
<div class="line"><a id="l01559" name="l01559"></a><span class="lineno"> 1559</span><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *good_number(<span class="keywordtype">char</span> *buf, <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gac65eeb4771a6fc34225302fee5bcb7e2">pj_int32_t</a> val)</div>
<div class="line"><a id="l01560" name="l01560"></a><span class="lineno"> 1560</span>{</div>
<div class="line"><a id="l01561" name="l01561"></a><span class="lineno"> 1561</span>    <span class="keywordflow">if</span> (val &lt; 1000) {</div>
<div class="line"><a id="l01562" name="l01562"></a><span class="lineno"> 1562</span>        pj_ansi_sprintf(buf, <span class="stringliteral">&quot;%d&quot;</span>, val);</div>
<div class="line"><a id="l01563" name="l01563"></a><span class="lineno"> 1563</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (val &lt; 1000000) {</div>
<div class="line"><a id="l01564" name="l01564"></a><span class="lineno"> 1564</span>        pj_ansi_sprintf(buf, <span class="stringliteral">&quot;%d.%dK&quot;</span>, </div>
<div class="line"><a id="l01565" name="l01565"></a><span class="lineno"> 1565</span>                        val / 1000,</div>
<div class="line"><a id="l01566" name="l01566"></a><span class="lineno"> 1566</span>                        (val % 1000) / 100);</div>
<div class="line"><a id="l01567" name="l01567"></a><span class="lineno"> 1567</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01568" name="l01568"></a><span class="lineno"> 1568</span>        pj_ansi_sprintf(buf, <span class="stringliteral">&quot;%d.%02dM&quot;</span>, </div>
<div class="line"><a id="l01569" name="l01569"></a><span class="lineno"> 1569</span>                        val / 1000000,</div>
<div class="line"><a id="l01570" name="l01570"></a><span class="lineno"> 1570</span>                        (val % 1000000) / 10000);</div>
<div class="line"><a id="l01571" name="l01571"></a><span class="lineno"> 1571</span>    }</div>
<div class="line"><a id="l01572" name="l01572"></a><span class="lineno"> 1572</span> </div>
<div class="line"><a id="l01573" name="l01573"></a><span class="lineno"> 1573</span>    <span class="keywordflow">return</span> buf;</div>
<div class="line"><a id="l01574" name="l01574"></a><span class="lineno"> 1574</span>}</div>
<div class="line"><a id="l01575" name="l01575"></a><span class="lineno"> 1575</span> </div>
<div class="line"><a id="l01576" name="l01576"></a><span class="lineno"> 1576</span> </div>
<div class="line"><a id="l01577" name="l01577"></a><span class="lineno"> 1577</span><span class="keyword">static</span> <span class="keywordtype">int</span> server_thread(<span class="keywordtype">void</span> *arg)</div>
<div class="line"><a id="l01578" name="l01578"></a><span class="lineno"> 1578</span>{</div>
<div class="line"><a id="l01579" name="l01579"></a><span class="lineno"> 1579</span>    <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__time__val.htm">pj_time_val</a> timeout = { 0, 1 };</div>
<div class="line"><a id="l01580" name="l01580"></a><span class="lineno"> 1580</span>    <span class="keywordtype">unsigned</span> thread_index = (unsigned)(<span class="keywordtype">long</span>)(<a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga173588cd6381f3ad354c23c26929093a">pj_ssize_t</a>)arg;</div>
<div class="line"><a id="l01581" name="l01581"></a><span class="lineno"> 1581</span>    <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__time__val.htm">pj_time_val</a> last_report, next_report;</div>
<div class="line"><a id="l01582" name="l01582"></a><span class="lineno"> 1582</span> </div>
<div class="line"><a id="l01583" name="l01583"></a><span class="lineno"> 1583</span>    <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__TIME.htm#ga0806df13f40d3153061f399ed86be856">pj_gettimeofday</a>(&amp;last_report);</div>
<div class="line"><a id="l01584" name="l01584"></a><span class="lineno"> 1584</span>    next_report = last_report;</div>
<div class="line"><a id="l01585" name="l01585"></a><span class="lineno"> 1585</span>    next_report.<a class="code hl_variableRef" href="../../../pjlib/docs/html/structpj__time__val.htm#af2739d0c2189e9c902281c04fd1f4502">sec</a>++;</div>
<div class="line"><a id="l01586" name="l01586"></a><span class="lineno"> 1586</span> </div>
<div class="line"><a id="l01587" name="l01587"></a><span class="lineno"> 1587</span>    <span class="keywordflow">while</span> (!app.thread_quit) {</div>
<div class="line"><a id="l01588" name="l01588"></a><span class="lineno"> 1588</span>        <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__time__val.htm">pj_time_val</a> now;</div>
<div class="line"><a id="l01589" name="l01589"></a><span class="lineno"> 1589</span>        <span class="keywordtype">unsigned</span> i;</div>
<div class="line"><a id="l01590" name="l01590"></a><span class="lineno"> 1590</span> </div>
<div class="line"><a id="l01591" name="l01591"></a><span class="lineno"> 1591</span>        <span class="keywordflow">for</span> (i=0; i&lt;100; ++i) {</div>
<div class="line"><a id="l01592" name="l01592"></a><span class="lineno"> 1592</span>            <span class="keywordtype">unsigned</span> count = 0;</div>
<div class="line"><a id="l01593" name="l01593"></a><span class="lineno"> 1593</span>            pjsip_endpt_handle_events2(app.sip_endpt, &amp;timeout, &amp;count);</div>
<div class="line"><a id="l01594" name="l01594"></a><span class="lineno"> 1594</span>            <span class="keywordflow">if</span> (count == 0)</div>
<div class="line"><a id="l01595" name="l01595"></a><span class="lineno"> 1595</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01596" name="l01596"></a><span class="lineno"> 1596</span>        }</div>
<div class="line"><a id="l01597" name="l01597"></a><span class="lineno"> 1597</span> </div>
<div class="line"><a id="l01598" name="l01598"></a><span class="lineno"> 1598</span>        <span class="keywordflow">if</span> (thread_index == 0) {</div>
<div class="line"><a id="l01599" name="l01599"></a><span class="lineno"> 1599</span>            <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__TIME.htm#ga0806df13f40d3153061f399ed86be856">pj_gettimeofday</a>(&amp;now);</div>
<div class="line"><a id="l01600" name="l01600"></a><span class="lineno"> 1600</span> </div>
<div class="line"><a id="l01601" name="l01601"></a><span class="lineno"> 1601</span>            <span class="keywordflow">if</span> (<a class="code hl_defineRef" href="../../../pjlib/docs/html/group__PJ__TIME.htm#gafe6b8b7461c59a2c9d1dbecd11a53d48">PJ_TIME_VAL_GTE</a>(now, next_report)) {</div>
<div class="line"><a id="l01602" name="l01602"></a><span class="lineno"> 1602</span>                <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__time__val.htm">pj_time_val</a> tmp;</div>
<div class="line"><a id="l01603" name="l01603"></a><span class="lineno"> 1603</span>                <span class="keywordtype">unsigned</span> msec;</div>
<div class="line"><a id="l01604" name="l01604"></a><span class="lineno"> 1604</span>                <span class="keywordtype">unsigned</span> stateless, stateful, <a class="code hl_struct" href="structcall.htm">call</a>;</div>
<div class="line"><a id="l01605" name="l01605"></a><span class="lineno"> 1605</span>                <span class="keywordtype">char</span> str_stateless[32], str_stateful[32], str_call[32];</div>
<div class="line"><a id="l01606" name="l01606"></a><span class="lineno"> 1606</span> </div>
<div class="line"><a id="l01607" name="l01607"></a><span class="lineno"> 1607</span>                tmp = now;</div>
<div class="line"><a id="l01608" name="l01608"></a><span class="lineno"> 1608</span>                <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__PJ__TIME.htm#gaec98fc019fc44b5a6f6b0b9137bcf272">PJ_TIME_VAL_SUB</a>(tmp, last_report);</div>
<div class="line"><a id="l01609" name="l01609"></a><span class="lineno"> 1609</span>                msec = <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__PJ__TIME.htm#gad015d440803cb8f62ff73878f35badaa">PJ_TIME_VAL_MSEC</a>(tmp);</div>
<div class="line"><a id="l01610" name="l01610"></a><span class="lineno"> 1610</span> </div>
<div class="line"><a id="l01611" name="l01611"></a><span class="lineno"> 1611</span>                last_report = now;</div>
<div class="line"><a id="l01612" name="l01612"></a><span class="lineno"> 1612</span>                next_report = last_report;</div>
<div class="line"><a id="l01613" name="l01613"></a><span class="lineno"> 1613</span>                next_report.<a class="code hl_variableRef" href="../../../pjlib/docs/html/structpj__time__val.htm#af2739d0c2189e9c902281c04fd1f4502">sec</a>++;</div>
<div class="line"><a id="l01614" name="l01614"></a><span class="lineno"> 1614</span> </div>
<div class="line"><a id="l01615" name="l01615"></a><span class="lineno"> 1615</span>                stateless = app.server.cur_state.stateless_cnt - app.server.prev_state.stateless_cnt;</div>
<div class="line"><a id="l01616" name="l01616"></a><span class="lineno"> 1616</span>                stateful = app.server.cur_state.stateful_cnt - app.server.prev_state.stateful_cnt;</div>
<div class="line"><a id="l01617" name="l01617"></a><span class="lineno"> 1617</span>                <a class="code hl_struct" href="structcall.htm">call</a> = app.server.cur_state.call_cnt - app.server.prev_state.call_cnt;</div>
<div class="line"><a id="l01618" name="l01618"></a><span class="lineno"> 1618</span> </div>
<div class="line"><a id="l01619" name="l01619"></a><span class="lineno"> 1619</span>                good_number(str_stateless, app.server.cur_state.stateless_cnt);</div>
<div class="line"><a id="l01620" name="l01620"></a><span class="lineno"> 1620</span>                good_number(str_stateful, app.server.cur_state.stateful_cnt);</div>
<div class="line"><a id="l01621" name="l01621"></a><span class="lineno"> 1621</span>                good_number(str_call, app.server.cur_state.call_cnt);</div>
<div class="line"><a id="l01622" name="l01622"></a><span class="lineno"> 1622</span> </div>
<div class="line"><a id="l01623" name="l01623"></a><span class="lineno"> 1623</span>                printf(<span class="stringliteral">&quot;Total(rate): stateless:%s (%d/s), statefull:%s (%d/s), call:%s (%d/s)       \r&quot;</span>,</div>
<div class="line"><a id="l01624" name="l01624"></a><span class="lineno"> 1624</span>                       str_stateless, stateless*1000/msec,</div>
<div class="line"><a id="l01625" name="l01625"></a><span class="lineno"> 1625</span>                       str_stateful, stateful*1000/msec,</div>
<div class="line"><a id="l01626" name="l01626"></a><span class="lineno"> 1626</span>                       str_call, <a class="code hl_struct" href="structcall.htm">call</a>*1000/msec);</div>
<div class="line"><a id="l01627" name="l01627"></a><span class="lineno"> 1627</span>                fflush(stdout);</div>
<div class="line"><a id="l01628" name="l01628"></a><span class="lineno"> 1628</span> </div>
<div class="line"><a id="l01629" name="l01629"></a><span class="lineno"> 1629</span>                app.server.prev_state = app.server.cur_state;</div>
<div class="line"><a id="l01630" name="l01630"></a><span class="lineno"> 1630</span>            }</div>
<div class="line"><a id="l01631" name="l01631"></a><span class="lineno"> 1631</span>        }</div>
<div class="line"><a id="l01632" name="l01632"></a><span class="lineno"> 1632</span>    }</div>
<div class="line"><a id="l01633" name="l01633"></a><span class="lineno"> 1633</span> </div>
<div class="line"><a id="l01634" name="l01634"></a><span class="lineno"> 1634</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l01635" name="l01635"></a><span class="lineno"> 1635</span>}</div>
<div class="line"><a id="l01636" name="l01636"></a><span class="lineno"> 1636</span> </div>
<div class="line"><a id="l01637" name="l01637"></a><span class="lineno"> 1637</span><span class="keyword">static</span> <span class="keywordtype">void</span> write_report(<span class="keyword">const</span> <span class="keywordtype">char</span> *msg)</div>
<div class="line"><a id="l01638" name="l01638"></a><span class="lineno"> 1638</span>{</div>
<div class="line"><a id="l01639" name="l01639"></a><span class="lineno"> 1639</span>    puts(msg);</div>
<div class="line"><a id="l01640" name="l01640"></a><span class="lineno"> 1640</span> </div>
<div class="line"><a id="l01641" name="l01641"></a><span class="lineno"> 1641</span><span class="preprocessor">#if (defined(PJ_WIN32) &amp;&amp; PJ_WIN32!=0) || (defined(PJ_WIN64) &amp;&amp; PJ_WIN64!=0)</span></div>
<div class="line"><a id="l01642" name="l01642"></a><span class="lineno"> 1642</span>    OutputDebugString(msg);</div>
<div class="line"><a id="l01643" name="l01643"></a><span class="lineno"> 1643</span>    OutputDebugString(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a id="l01644" name="l01644"></a><span class="lineno"> 1644</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01645" name="l01645"></a><span class="lineno"> 1645</span>}</div>
<div class="line"><a id="l01646" name="l01646"></a><span class="lineno"> 1646</span> </div>
<div class="line"><a id="l01647" name="l01647"></a><span class="lineno"> 1647</span> </div>
<div class="line"><a id="l01648" name="l01648"></a><span class="lineno"> 1648</span><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line"><a id="l01649" name="l01649"></a><span class="lineno"> 1649</span>{</div>
<div class="line"><a id="l01650" name="l01650"></a><span class="lineno"> 1650</span>    <span class="keyword">static</span> <span class="keywordtype">char</span> report[1024];</div>
<div class="line"><a id="l01651" name="l01651"></a><span class="lineno"> 1651</span> </div>
<div class="line"><a id="l01652" name="l01652"></a><span class="lineno"> 1652</span>    printf(<span class="stringliteral">&quot;PJSIP Performance Measurement Tool v%s\n&quot;</span></div>
<div class="line"><a id="l01653" name="l01653"></a><span class="lineno"> 1653</span>           <span class="stringliteral">&quot;(c)2006 pjsip.org\n\n&quot;</span>,</div>
<div class="line"><a id="l01654" name="l01654"></a><span class="lineno"> 1654</span>           PJ_VERSION);</div>
<div class="line"><a id="l01655" name="l01655"></a><span class="lineno"> 1655</span> </div>
<div class="line"><a id="l01656" name="l01656"></a><span class="lineno"> 1656</span>    <span class="keywordflow">if</span> (create_app() != 0)</div>
<div class="line"><a id="l01657" name="l01657"></a><span class="lineno"> 1657</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a id="l01658" name="l01658"></a><span class="lineno"> 1658</span> </div>
<div class="line"><a id="l01659" name="l01659"></a><span class="lineno"> 1659</span>    <span class="keywordflow">if</span> (init_options(argc, argv) != 0)</div>
<div class="line"><a id="l01660" name="l01660"></a><span class="lineno"> 1660</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a id="l01661" name="l01661"></a><span class="lineno"> 1661</span> </div>
<div class="line"><a id="l01662" name="l01662"></a><span class="lineno"> 1662</span>    <span class="keywordflow">if</span> (init_sip() != 0)</div>
<div class="line"><a id="l01663" name="l01663"></a><span class="lineno"> 1663</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a id="l01664" name="l01664"></a><span class="lineno"> 1664</span> </div>
<div class="line"><a id="l01665" name="l01665"></a><span class="lineno"> 1665</span>    <span class="keywordflow">if</span> (init_media() != 0)</div>
<div class="line"><a id="l01666" name="l01666"></a><span class="lineno"> 1666</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a id="l01667" name="l01667"></a><span class="lineno"> 1667</span> </div>
<div class="line"><a id="l01668" name="l01668"></a><span class="lineno"> 1668</span>    <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__LOG.htm#gab8f76697c525b7ce55a85da16442d0c1">pj_log_set_level</a>(app.log_level);</div>
<div class="line"><a id="l01669" name="l01669"></a><span class="lineno"> 1669</span> </div>
<div class="line"><a id="l01670" name="l01670"></a><span class="lineno"> 1670</span>    <span class="keywordflow">if</span> (app.log_level &gt; 4) {</div>
<div class="line"><a id="l01671" name="l01671"></a><span class="lineno"> 1671</span>        pjsip_endpt_register_module(app.sip_endpt, &amp;msg_logger);</div>
<div class="line"><a id="l01672" name="l01672"></a><span class="lineno"> 1672</span>    }</div>
<div class="line"><a id="l01673" name="l01673"></a><span class="lineno"> 1673</span> </div>
<div class="line"><a id="l01674" name="l01674"></a><span class="lineno"> 1674</span> </div>
<div class="line"><a id="l01675" name="l01675"></a><span class="lineno"> 1675</span>    <span class="comment">/* Misc infos */</span></div>
<div class="line"><a id="l01676" name="l01676"></a><span class="lineno"> 1676</span>    <span class="keywordflow">if</span> (app.client.dst_uri.slen != 0) {</div>
<div class="line"><a id="l01677" name="l01677"></a><span class="lineno"> 1677</span>        <span class="keywordflow">if</span> (app.client.method.id == PJSIP_INVITE_METHOD) {</div>
<div class="line"><a id="l01678" name="l01678"></a><span class="lineno"> 1678</span>            <span class="keywordflow">if</span> (app.client.stateless) {</div>
<div class="line"><a id="l01679" name="l01679"></a><span class="lineno"> 1679</span>                <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(3,(THIS_FILE, </div>
<div class="line"><a id="l01680" name="l01680"></a><span class="lineno"> 1680</span>                          <span class="stringliteral">&quot;Info: --stateless option makes no sense for INVITE,&quot;</span></div>
<div class="line"><a id="l01681" name="l01681"></a><span class="lineno"> 1681</span>                          <span class="stringliteral">&quot; ignored.&quot;</span>));</div>
<div class="line"><a id="l01682" name="l01682"></a><span class="lineno"> 1682</span>            }</div>
<div class="line"><a id="l01683" name="l01683"></a><span class="lineno"> 1683</span>        }</div>
<div class="line"><a id="l01684" name="l01684"></a><span class="lineno"> 1684</span> </div>
<div class="line"><a id="l01685" name="l01685"></a><span class="lineno"> 1685</span>    }</div>
<div class="line"><a id="l01686" name="l01686"></a><span class="lineno"> 1686</span> </div>
<div class="line"><a id="l01687" name="l01687"></a><span class="lineno"> 1687</span> </div>
<div class="line"><a id="l01688" name="l01688"></a><span class="lineno"> 1688</span> </div>
<div class="line"><a id="l01689" name="l01689"></a><span class="lineno"> 1689</span>    <span class="keywordflow">if</span> (app.client.dst_uri.slen) {</div>
<div class="line"><a id="l01690" name="l01690"></a><span class="lineno"> 1690</span>        <span class="comment">/* Client mode */</span></div>
<div class="line"><a id="l01691" name="l01691"></a><span class="lineno"> 1691</span>        <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> status;</div>
<div class="line"><a id="l01692" name="l01692"></a><span class="lineno"> 1692</span>        <span class="keywordtype">char</span> test_type[64];</div>
<div class="line"><a id="l01693" name="l01693"></a><span class="lineno"> 1693</span>        <span class="keywordtype">unsigned</span> msec_req, msec_res;</div>
<div class="line"><a id="l01694" name="l01694"></a><span class="lineno"> 1694</span>        <span class="keywordtype">unsigned</span> i;</div>
<div class="line"><a id="l01695" name="l01695"></a><span class="lineno"> 1695</span> </div>
<div class="line"><a id="l01696" name="l01696"></a><span class="lineno"> 1696</span>        <span class="comment">/* Get the job name */</span></div>
<div class="line"><a id="l01697" name="l01697"></a><span class="lineno"> 1697</span>        <span class="keywordflow">if</span> (app.client.method.id == PJSIP_INVITE_METHOD) {</div>
<div class="line"><a id="l01698" name="l01698"></a><span class="lineno"> 1698</span>            pj_ansi_strcpy(test_type, <span class="stringliteral">&quot;INVITE calls&quot;</span>);</div>
<div class="line"><a id="l01699" name="l01699"></a><span class="lineno"> 1699</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (app.client.stateless) {</div>
<div class="line"><a id="l01700" name="l01700"></a><span class="lineno"> 1700</span>            pj_ansi_sprintf(test_type, <span class="stringliteral">&quot;stateless %.*s requests&quot;</span>,</div>
<div class="line"><a id="l01701" name="l01701"></a><span class="lineno"> 1701</span>                            (<span class="keywordtype">int</span>)app.client.method.name.slen,</div>
<div class="line"><a id="l01702" name="l01702"></a><span class="lineno"> 1702</span>                            app.client.method.name.ptr);</div>
<div class="line"><a id="l01703" name="l01703"></a><span class="lineno"> 1703</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01704" name="l01704"></a><span class="lineno"> 1704</span>            pj_ansi_sprintf(test_type, <span class="stringliteral">&quot;stateful %.*s requests&quot;</span>,</div>
<div class="line"><a id="l01705" name="l01705"></a><span class="lineno"> 1705</span>                            (<span class="keywordtype">int</span>)app.client.method.name.slen,</div>
<div class="line"><a id="l01706" name="l01706"></a><span class="lineno"> 1706</span>                            app.client.method.name.ptr);</div>
<div class="line"><a id="l01707" name="l01707"></a><span class="lineno"> 1707</span>        }</div>
<div class="line"><a id="l01708" name="l01708"></a><span class="lineno"> 1708</span>        </div>
<div class="line"><a id="l01709" name="l01709"></a><span class="lineno"> 1709</span> </div>
<div class="line"><a id="l01710" name="l01710"></a><span class="lineno"> 1710</span>        printf(<span class="stringliteral">&quot;Sending %d %s to &#39;%.*s&#39; with %d maximum outstanding jobs, please wait..\n&quot;</span>, </div>
<div class="line"><a id="l01711" name="l01711"></a><span class="lineno"> 1711</span>                  app.client.job_count, test_type,</div>
<div class="line"><a id="l01712" name="l01712"></a><span class="lineno"> 1712</span>                  (<span class="keywordtype">int</span>)app.client.dst_uri.slen, app.client.dst_uri.ptr,</div>
<div class="line"><a id="l01713" name="l01713"></a><span class="lineno"> 1713</span>                  app.client.job_window);</div>
<div class="line"><a id="l01714" name="l01714"></a><span class="lineno"> 1714</span> </div>
<div class="line"><a id="l01715" name="l01715"></a><span class="lineno"> 1715</span>        <span class="keywordflow">for</span> (i=0; i&lt;app.thread_count; ++i) {</div>
<div class="line"><a id="l01716" name="l01716"></a><span class="lineno"> 1716</span>            status = <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__THREAD.htm#ga7b63533cf4f3ba0cba68cab49a22d722">pj_thread_create</a>(app.pool, NULL, &amp;client_thread, </div>
<div class="line"><a id="l01717" name="l01717"></a><span class="lineno"> 1717</span>                                      (<span class="keywordtype">void</span>*)(<a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga173588cd6381f3ad354c23c26929093a">pj_ssize_t</a>)i, 0, 0, </div>
<div class="line"><a id="l01718" name="l01718"></a><span class="lineno"> 1718</span>                                      &amp;app.thread[i]);</div>
<div class="line"><a id="l01719" name="l01719"></a><span class="lineno"> 1719</span>            <span class="keywordflow">if</span> (status != <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div>
<div class="line"><a id="l01720" name="l01720"></a><span class="lineno"> 1720</span>                app_perror(THIS_FILE, <span class="stringliteral">&quot;Unable to create thread&quot;</span>, status);</div>
<div class="line"><a id="l01721" name="l01721"></a><span class="lineno"> 1721</span>                <span class="keywordflow">return</span> 1;</div>
<div class="line"><a id="l01722" name="l01722"></a><span class="lineno"> 1722</span>            }</div>
<div class="line"><a id="l01723" name="l01723"></a><span class="lineno"> 1723</span>        }</div>
<div class="line"><a id="l01724" name="l01724"></a><span class="lineno"> 1724</span> </div>
<div class="line"><a id="l01725" name="l01725"></a><span class="lineno"> 1725</span>        <span class="keywordflow">for</span> (i=0; i&lt;app.thread_count; ++i) {</div>
<div class="line"><a id="l01726" name="l01726"></a><span class="lineno"> 1726</span>            <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__THREAD.htm#ga60d90ce08d2f7e92dcaa0443cf87912f">pj_thread_join</a>(app.thread[i]);</div>
<div class="line"><a id="l01727" name="l01727"></a><span class="lineno"> 1727</span>            app.thread[i] = NULL;</div>
<div class="line"><a id="l01728" name="l01728"></a><span class="lineno"> 1728</span>        }</div>
<div class="line"><a id="l01729" name="l01729"></a><span class="lineno"> 1729</span> </div>
<div class="line"><a id="l01730" name="l01730"></a><span class="lineno"> 1730</span>        <span class="keywordflow">if</span> (app.client.last_completion.sec) {</div>
<div class="line"><a id="l01731" name="l01731"></a><span class="lineno"> 1731</span>            <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__time__val.htm">pj_time_val</a> duration;</div>
<div class="line"><a id="l01732" name="l01732"></a><span class="lineno"> 1732</span>            duration = app.client.last_completion;</div>
<div class="line"><a id="l01733" name="l01733"></a><span class="lineno"> 1733</span>            <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__PJ__TIME.htm#gaec98fc019fc44b5a6f6b0b9137bcf272">PJ_TIME_VAL_SUB</a>(duration, app.client.first_request);</div>
<div class="line"><a id="l01734" name="l01734"></a><span class="lineno"> 1734</span>            msec_res = <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__PJ__TIME.htm#gad015d440803cb8f62ff73878f35badaa">PJ_TIME_VAL_MSEC</a>(duration);</div>
<div class="line"><a id="l01735" name="l01735"></a><span class="lineno"> 1735</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01736" name="l01736"></a><span class="lineno"> 1736</span>            msec_res = app.client.timeout * 1000;</div>
<div class="line"><a id="l01737" name="l01737"></a><span class="lineno"> 1737</span>        }</div>
<div class="line"><a id="l01738" name="l01738"></a><span class="lineno"> 1738</span> </div>
<div class="line"><a id="l01739" name="l01739"></a><span class="lineno"> 1739</span>        <span class="keywordflow">if</span> (msec_res == 0) msec_res = 1;</div>
<div class="line"><a id="l01740" name="l01740"></a><span class="lineno"> 1740</span> </div>
<div class="line"><a id="l01741" name="l01741"></a><span class="lineno"> 1741</span>        <span class="keywordflow">if</span> (app.client.requests_sent.sec) {</div>
<div class="line"><a id="l01742" name="l01742"></a><span class="lineno"> 1742</span>            <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__time__val.htm">pj_time_val</a> duration;</div>
<div class="line"><a id="l01743" name="l01743"></a><span class="lineno"> 1743</span>            duration = app.client.requests_sent;</div>
<div class="line"><a id="l01744" name="l01744"></a><span class="lineno"> 1744</span>            <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__PJ__TIME.htm#gaec98fc019fc44b5a6f6b0b9137bcf272">PJ_TIME_VAL_SUB</a>(duration, app.client.first_request);</div>
<div class="line"><a id="l01745" name="l01745"></a><span class="lineno"> 1745</span>            msec_req = <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__PJ__TIME.htm#gad015d440803cb8f62ff73878f35badaa">PJ_TIME_VAL_MSEC</a>(duration);</div>
<div class="line"><a id="l01746" name="l01746"></a><span class="lineno"> 1746</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01747" name="l01747"></a><span class="lineno"> 1747</span>            msec_req = app.client.timeout * 1000;</div>
<div class="line"><a id="l01748" name="l01748"></a><span class="lineno"> 1748</span>        }</div>
<div class="line"><a id="l01749" name="l01749"></a><span class="lineno"> 1749</span> </div>
<div class="line"><a id="l01750" name="l01750"></a><span class="lineno"> 1750</span>        <span class="keywordflow">if</span> (msec_req == 0) msec_req = 1;</div>
<div class="line"><a id="l01751" name="l01751"></a><span class="lineno"> 1751</span> </div>
<div class="line"><a id="l01752" name="l01752"></a><span class="lineno"> 1752</span>        <span class="keywordflow">if</span> (app.client.job_submitted &lt; app.client.job_count)</div>
<div class="line"><a id="l01753" name="l01753"></a><span class="lineno"> 1753</span>            puts(<span class="stringliteral">&quot;\ntimed-out!\n&quot;</span>);</div>
<div class="line"><a id="l01754" name="l01754"></a><span class="lineno"> 1754</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l01755" name="l01755"></a><span class="lineno"> 1755</span>            puts(<span class="stringliteral">&quot;\ndone.\n&quot;</span>);</div>
<div class="line"><a id="l01756" name="l01756"></a><span class="lineno"> 1756</span> </div>
<div class="line"><a id="l01757" name="l01757"></a><span class="lineno"> 1757</span>        pj_ansi_snprintf(</div>
<div class="line"><a id="l01758" name="l01758"></a><span class="lineno"> 1758</span>            report, <span class="keyword">sizeof</span>(report),</div>
<div class="line"><a id="l01759" name="l01759"></a><span class="lineno"> 1759</span>            <span class="stringliteral">&quot;Total %d %s sent in %d ms at rate of %d/sec\n&quot;</span></div>
<div class="line"><a id="l01760" name="l01760"></a><span class="lineno"> 1760</span>            <span class="stringliteral">&quot;Total %d responses received in %d ms at rate of %d/sec:&quot;</span>,</div>
<div class="line"><a id="l01761" name="l01761"></a><span class="lineno"> 1761</span>            app.client.job_submitted, test_type, msec_req, </div>
<div class="line"><a id="l01762" name="l01762"></a><span class="lineno"> 1762</span>            app.client.job_submitted * 1000 / msec_req,</div>
<div class="line"><a id="l01763" name="l01763"></a><span class="lineno"> 1763</span>            app.client.total_responses, msec_res,</div>
<div class="line"><a id="l01764" name="l01764"></a><span class="lineno"> 1764</span>            app.client.total_responses*1000/msec_res);</div>
<div class="line"><a id="l01765" name="l01765"></a><span class="lineno"> 1765</span>        write_report(report);</div>
<div class="line"><a id="l01766" name="l01766"></a><span class="lineno"> 1766</span> </div>
<div class="line"><a id="l01767" name="l01767"></a><span class="lineno"> 1767</span>        <span class="comment">/* Print detailed response code received */</span></div>
<div class="line"><a id="l01768" name="l01768"></a><span class="lineno"> 1768</span>        pj_ansi_sprintf(report, <span class="stringliteral">&quot;\nDetailed responses received:&quot;</span>);</div>
<div class="line"><a id="l01769" name="l01769"></a><span class="lineno"> 1769</span>        write_report(report);</div>
<div class="line"><a id="l01770" name="l01770"></a><span class="lineno"> 1770</span> </div>
<div class="line"><a id="l01771" name="l01771"></a><span class="lineno"> 1771</span>        <span class="keywordflow">for</span> (i=0; i&lt;<a class="code hl_defineRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gacd8459212a1e5175eeb04e3a6cd76659">PJ_ARRAY_SIZE</a>(app.client.response_codes); ++i) {</div>
<div class="line"><a id="l01772" name="l01772"></a><span class="lineno"> 1772</span>            <span class="keyword">const</span> <a class="code hl_structRef" href="../../../pjlib/docs/html/structpj__str__t.htm">pj_str_t</a> *reason;</div>
<div class="line"><a id="l01773" name="l01773"></a><span class="lineno"> 1773</span> </div>
<div class="line"><a id="l01774" name="l01774"></a><span class="lineno"> 1774</span>            <span class="keywordflow">if</span> (app.client.response_codes[i] == 0)</div>
<div class="line"><a id="l01775" name="l01775"></a><span class="lineno"> 1775</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01776" name="l01776"></a><span class="lineno"> 1776</span> </div>
<div class="line"><a id="l01777" name="l01777"></a><span class="lineno"> 1777</span>            reason = pjsip_get_status_text(i);</div>
<div class="line"><a id="l01778" name="l01778"></a><span class="lineno"> 1778</span>            pj_ansi_snprintf( report, <span class="keyword">sizeof</span>(report),</div>
<div class="line"><a id="l01779" name="l01779"></a><span class="lineno"> 1779</span>                              <span class="stringliteral">&quot; - %d responses:  %7d     (%.*s)&quot;</span>,</div>
<div class="line"><a id="l01780" name="l01780"></a><span class="lineno"> 1780</span>                              i, app.client.response_codes[i],</div>
<div class="line"><a id="l01781" name="l01781"></a><span class="lineno"> 1781</span>                              (<span class="keywordtype">int</span>)reason-&gt;<a class="code hl_variableRef" href="../../../pjlib/docs/html/structpj__str__t.htm#a46788480bdb4080083dcc8965811e015">slen</a>, reason-&gt;<a class="code hl_variableRef" href="../../../pjlib/docs/html/structpj__str__t.htm#a4eb3153e4363a93f65f5c728911168d4">ptr</a>);</div>
<div class="line"><a id="l01782" name="l01782"></a><span class="lineno"> 1782</span>            write_report(report);</div>
<div class="line"><a id="l01783" name="l01783"></a><span class="lineno"> 1783</span>        }</div>
<div class="line"><a id="l01784" name="l01784"></a><span class="lineno"> 1784</span> </div>
<div class="line"><a id="l01785" name="l01785"></a><span class="lineno"> 1785</span>        <span class="comment">/* Total responses and rate */</span></div>
<div class="line"><a id="l01786" name="l01786"></a><span class="lineno"> 1786</span>        pj_ansi_snprintf( report, <span class="keyword">sizeof</span>(report),</div>
<div class="line"><a id="l01787" name="l01787"></a><span class="lineno"> 1787</span>            <span class="stringliteral">&quot;                    ------\n&quot;</span></div>
<div class="line"><a id="l01788" name="l01788"></a><span class="lineno"> 1788</span>            <span class="stringliteral">&quot; TOTAL responses:  %7d (rate=%d/sec)\n&quot;</span>,</div>
<div class="line"><a id="l01789" name="l01789"></a><span class="lineno"> 1789</span>            app.client.total_responses, </div>
<div class="line"><a id="l01790" name="l01790"></a><span class="lineno"> 1790</span>            app.client.total_responses*1000/msec_res);</div>
<div class="line"><a id="l01791" name="l01791"></a><span class="lineno"> 1791</span> </div>
<div class="line"><a id="l01792" name="l01792"></a><span class="lineno"> 1792</span>        write_report(report);</div>
<div class="line"><a id="l01793" name="l01793"></a><span class="lineno"> 1793</span> </div>
<div class="line"><a id="l01794" name="l01794"></a><span class="lineno"> 1794</span>        pj_ansi_sprintf(report, <span class="stringliteral">&quot;Maximum outstanding job: %d&quot;</span>, </div>
<div class="line"><a id="l01795" name="l01795"></a><span class="lineno"> 1795</span>                        app.client.stat_max_window);</div>
<div class="line"><a id="l01796" name="l01796"></a><span class="lineno"> 1796</span>        write_report(report);</div>
<div class="line"><a id="l01797" name="l01797"></a><span class="lineno"> 1797</span> </div>
<div class="line"><a id="l01798" name="l01798"></a><span class="lineno"> 1798</span> </div>
<div class="line"><a id="l01799" name="l01799"></a><span class="lineno"> 1799</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01800" name="l01800"></a><span class="lineno"> 1800</span>        <span class="comment">/* Server mode */</span></div>
<div class="line"><a id="l01801" name="l01801"></a><span class="lineno"> 1801</span>        <span class="keywordtype">char</span> s[10], *unused;</div>
<div class="line"><a id="l01802" name="l01802"></a><span class="lineno"> 1802</span>        <a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> status;</div>
<div class="line"><a id="l01803" name="l01803"></a><span class="lineno"> 1803</span>        <span class="keywordtype">unsigned</span> i;</div>
<div class="line"><a id="l01804" name="l01804"></a><span class="lineno"> 1804</span> </div>
<div class="line"><a id="l01805" name="l01805"></a><span class="lineno"> 1805</span>        puts(<span class="stringliteral">&quot;pjsip-perf started in server-mode&quot;</span>);</div>
<div class="line"><a id="l01806" name="l01806"></a><span class="lineno"> 1806</span> </div>
<div class="line"><a id="l01807" name="l01807"></a><span class="lineno"> 1807</span>        printf(<span class="stringliteral">&quot;Receiving requests on the following URIs:\n&quot;</span></div>
<div class="line"><a id="l01808" name="l01808"></a><span class="lineno"> 1808</span>               <span class="stringliteral">&quot;  sip:0@%.*s:%d%s    for stateless handling\n&quot;</span></div>
<div class="line"><a id="l01809" name="l01809"></a><span class="lineno"> 1809</span>               <span class="stringliteral">&quot;  sip:1@%.*s:%d%s    for stateful handling\n&quot;</span></div>
<div class="line"><a id="l01810" name="l01810"></a><span class="lineno"> 1810</span>               <span class="stringliteral">&quot;  sip:2@%.*s:%d%s    for call handling\n&quot;</span>,</div>
<div class="line"><a id="l01811" name="l01811"></a><span class="lineno"> 1811</span>               (<span class="keywordtype">int</span>)app.local_addr.slen,</div>
<div class="line"><a id="l01812" name="l01812"></a><span class="lineno"> 1812</span>               app.local_addr.ptr,</div>
<div class="line"><a id="l01813" name="l01813"></a><span class="lineno"> 1813</span>               app.local_port,</div>
<div class="line"><a id="l01814" name="l01814"></a><span class="lineno"> 1814</span>               (app.use_tcp ? <span class="stringliteral">&quot;;transport=tcp&quot;</span> : <span class="stringliteral">&quot;&quot;</span>),</div>
<div class="line"><a id="l01815" name="l01815"></a><span class="lineno"> 1815</span>               (<span class="keywordtype">int</span>)app.local_addr.slen,</div>
<div class="line"><a id="l01816" name="l01816"></a><span class="lineno"> 1816</span>               app.local_addr.ptr,</div>
<div class="line"><a id="l01817" name="l01817"></a><span class="lineno"> 1817</span>               app.local_port,</div>
<div class="line"><a id="l01818" name="l01818"></a><span class="lineno"> 1818</span>               (app.use_tcp ? <span class="stringliteral">&quot;;transport=tcp&quot;</span> : <span class="stringliteral">&quot;&quot;</span>),</div>
<div class="line"><a id="l01819" name="l01819"></a><span class="lineno"> 1819</span>               (<span class="keywordtype">int</span>)app.local_addr.slen,</div>
<div class="line"><a id="l01820" name="l01820"></a><span class="lineno"> 1820</span>               app.local_addr.ptr,</div>
<div class="line"><a id="l01821" name="l01821"></a><span class="lineno"> 1821</span>               app.local_port,</div>
<div class="line"><a id="l01822" name="l01822"></a><span class="lineno"> 1822</span>               (app.use_tcp ? <span class="stringliteral">&quot;;transport=tcp&quot;</span> : <span class="stringliteral">&quot;&quot;</span>));</div>
<div class="line"><a id="l01823" name="l01823"></a><span class="lineno"> 1823</span>        printf(<span class="stringliteral">&quot;INVITE with non-matching user part will be handled call-statefully\n&quot;</span>);</div>
<div class="line"><a id="l01824" name="l01824"></a><span class="lineno"> 1824</span> </div>
<div class="line"><a id="l01825" name="l01825"></a><span class="lineno"> 1825</span>        <span class="keywordflow">for</span> (i=0; i&lt;app.thread_count; ++i) {</div>
<div class="line"><a id="l01826" name="l01826"></a><span class="lineno"> 1826</span>            status = <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__THREAD.htm#ga7b63533cf4f3ba0cba68cab49a22d722">pj_thread_create</a>(app.pool, NULL, &amp;server_thread, </div>
<div class="line"><a id="l01827" name="l01827"></a><span class="lineno"> 1827</span>                                      (<span class="keywordtype">void</span>*)(<a class="code hl_typedefRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga173588cd6381f3ad354c23c26929093a">pj_ssize_t</a>)i, 0, 0, </div>
<div class="line"><a id="l01828" name="l01828"></a><span class="lineno"> 1828</span>                                      &amp;app.thread[i]);</div>
<div class="line"><a id="l01829" name="l01829"></a><span class="lineno"> 1829</span>            <span class="keywordflow">if</span> (status != <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div>
<div class="line"><a id="l01830" name="l01830"></a><span class="lineno"> 1830</span>                app_perror(THIS_FILE, <span class="stringliteral">&quot;Unable to create thread&quot;</span>, status);</div>
<div class="line"><a id="l01831" name="l01831"></a><span class="lineno"> 1831</span>                <span class="keywordflow">return</span> 1;</div>
<div class="line"><a id="l01832" name="l01832"></a><span class="lineno"> 1832</span>            }</div>
<div class="line"><a id="l01833" name="l01833"></a><span class="lineno"> 1833</span>        }</div>
<div class="line"><a id="l01834" name="l01834"></a><span class="lineno"> 1834</span> </div>
<div class="line"><a id="l01835" name="l01835"></a><span class="lineno"> 1835</span>        puts(<span class="stringliteral">&quot;\nPress &lt;ENTER&gt; to quit\n&quot;</span>);</div>
<div class="line"><a id="l01836" name="l01836"></a><span class="lineno"> 1836</span>        fflush(stdout);</div>
<div class="line"><a id="l01837" name="l01837"></a><span class="lineno"> 1837</span>        unused = fgets(s, <span class="keyword">sizeof</span>(s), stdin);</div>
<div class="line"><a id="l01838" name="l01838"></a><span class="lineno"> 1838</span>        <a class="code hl_defineRef" href="../../../pjlib/docs/html/group__pj__config.htm#ga7523f8576efd271c22b188eab05d7870">PJ_UNUSED_ARG</a>(unused);</div>
<div class="line"><a id="l01839" name="l01839"></a><span class="lineno"> 1839</span> </div>
<div class="line"><a id="l01840" name="l01840"></a><span class="lineno"> 1840</span>        app.thread_quit = <a class="code hl_variableRef" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead235b21a623d982cc561fb12bffa87c0">PJ_TRUE</a>;</div>
<div class="line"><a id="l01841" name="l01841"></a><span class="lineno"> 1841</span>        <span class="keywordflow">for</span> (i=0; i&lt;app.thread_count; ++i) {</div>
<div class="line"><a id="l01842" name="l01842"></a><span class="lineno"> 1842</span>            <a class="code hl_functionRef" href="../../../pjlib/docs/html/group__PJ__THREAD.htm#ga60d90ce08d2f7e92dcaa0443cf87912f">pj_thread_join</a>(app.thread[i]);</div>
<div class="line"><a id="l01843" name="l01843"></a><span class="lineno"> 1843</span>            app.thread[i] = NULL;</div>
<div class="line"><a id="l01844" name="l01844"></a><span class="lineno"> 1844</span>        }</div>
<div class="line"><a id="l01845" name="l01845"></a><span class="lineno"> 1845</span> </div>
<div class="line"><a id="l01846" name="l01846"></a><span class="lineno"> 1846</span>        puts(<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a id="l01847" name="l01847"></a><span class="lineno"> 1847</span>    }</div>
<div class="line"><a id="l01848" name="l01848"></a><span class="lineno"> 1848</span> </div>
<div class="line"><a id="l01849" name="l01849"></a><span class="lineno"> 1849</span> </div>
<div class="line"><a id="l01850" name="l01850"></a><span class="lineno"> 1850</span>    destroy_app();</div>
<div class="line"><a id="l01851" name="l01851"></a><span class="lineno"> 1851</span> </div>
<div class="line"><a id="l01852" name="l01852"></a><span class="lineno"> 1852</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l01853" name="l01853"></a><span class="lineno"> 1853</span>}</div>
<div class="line"><a id="l01854" name="l01854"></a><span class="lineno"> 1854</span> </div>
<div class="ttc" id="agroup__PJLIB__UTIL__BASE_htm_gafbef35a33e7641211c4b53f3dc1458c6"><div class="ttname"><a href="../../../pjlib-util/docs/html/group__PJLIB__UTIL__BASE.htm#gafbef35a33e7641211c4b53f3dc1458c6">pjlib_util_init</a></div><div class="ttdeci">pj_status_t pjlib_util_init(void)</div></div>
<div class="ttc" id="agroup__PJMEDIA__CODEC__REGISTER__ALL_htm_ga5ca86e134cdb27f14a59d134fcd3dec5"><div class="ttname"><a href="group__PJMEDIA__CODEC__REGISTER__ALL.htm#ga5ca86e134cdb27f14a59d134fcd3dec5">pjmedia_codec_register_audio_codecs</a></div><div class="ttdeci">pj_status_t pjmedia_codec_register_audio_codecs(pjmedia_endpt *endpt, const pjmedia_audio_codec_config *c)</div></div>
<div class="ttc" id="agroup__PJMEDIA__SDP_htm_ga11acd6dd72b802c0133848ca83ace3b1"><div class="ttname"><a href="group__PJMEDIA__SDP.htm#ga11acd6dd72b802c0133848ca83ace3b1">pjmedia_sdp_parse</a></div><div class="ttdeci">pj_status_t pjmedia_sdp_parse(pj_pool_t *pool, char *buf, pj_size_t len, pjmedia_sdp_session **p_sdp)</div></div>
<div class="ttc" id="agroup__PJMEDIA__TYPES_htm_ga7c3623d8e90e22b7184a6e42dc24f6f5"><div class="ttname"><a href="group__PJMEDIA__TYPES.htm#ga7c3623d8e90e22b7184a6e42dc24f6f5">pjmedia_endpt</a></div><div class="ttdeci">struct pjmedia_endpt pjmedia_endpt</div><div class="ttdef"><b>Definition:</b> pjmedia/types.h:186</div></div>
<div class="ttc" id="agroup__PJMED__ENDPT_htm_ga2865efcd255dbcb05ede33dbae5c27f5"><div class="ttname"><a href="group__PJMED__ENDPT.htm#ga2865efcd255dbcb05ede33dbae5c27f5">pjmedia_endpt_create</a></div><div class="ttdeci">pj_status_t pjmedia_endpt_create(pj_pool_factory *pf, pj_ioqueue_t *ioqueue, unsigned worker_cnt, pjmedia_endpt **p_endpt)</div><div class="ttdef"><b>Definition:</b> endpoint.h:127</div></div>
<div class="ttc" id="agroup__PJMED__ENDPT_htm_gaa49360a690c292dddd722b39c2f8c8bb"><div class="ttname"><a href="group__PJMED__ENDPT.htm#gaa49360a690c292dddd722b39c2f8c8bb">pjmedia_endpt_create_sdp</a></div><div class="ttdeci">pj_status_t pjmedia_endpt_create_sdp(pjmedia_endpt *endpt, pj_pool_t *pool, unsigned stream_cnt, const pjmedia_sock_info sock_info[], pjmedia_sdp_session **p_sdp)</div></div>
<div class="ttc" id="agroup__PJ__BASIC_htm_ga069615152140fa2df009cebc8a36b769"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga069615152140fa2df009cebc8a36b769">pj_init</a></div><div class="ttdeci">pj_status_t pj_init(void)</div></div>
<div class="ttc" id="agroup__PJ__BASIC_htm_ga173588cd6381f3ad354c23c26929093a"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga173588cd6381f3ad354c23c26929093a">pj_ssize_t</a></div><div class="ttdeci">long pj_ssize_t</div></div>
<div class="ttc" id="agroup__PJ__BASIC_htm_ga1dc7a356fb36bd2dee2bc7d6c7e817e4"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga1dc7a356fb36bd2dee2bc7d6c7e817e4">pj_bool_t</a></div><div class="ttdeci">int pj_bool_t</div></div>
<div class="ttc" id="agroup__PJ__BASIC_htm_ga47506d8dde1056c5c96d62f0df6ddf28"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga47506d8dde1056c5c96d62f0df6ddf28">pj_uint16_t</a></div><div class="ttdeci">unsigned short pj_uint16_t</div></div>
<div class="ttc" id="agroup__PJ__BASIC_htm_ga9fdb3ceb491cd888cd30ca30d78026e8"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga9fdb3ceb491cd888cd30ca30d78026e8">pj_size_t</a></div><div class="ttdeci">size_t pj_size_t</div></div>
<div class="ttc" id="agroup__PJ__BASIC_htm_gab43ba3167bd2a2ab4580509dbf79200e"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a></div><div class="ttdeci">int pj_status_t</div></div>
<div class="ttc" id="agroup__PJ__BASIC_htm_gac65eeb4771a6fc34225302fee5bcb7e2"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gac65eeb4771a6fc34225302fee5bcb7e2">pj_int32_t</a></div><div class="ttdeci">int pj_int32_t</div></div>
<div class="ttc" id="agroup__PJ__BASIC_htm_gacb9d46aed6813bf142efc1c3db7a2d17"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gacb9d46aed6813bf142efc1c3db7a2d17">pj_thread_t</a></div><div class="ttdeci">struct pj_thread_t pj_thread_t</div></div>
<div class="ttc" id="agroup__PJ__BASIC_htm_gacd8459212a1e5175eeb04e3a6cd76659"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gacd8459212a1e5175eeb04e3a6cd76659">PJ_ARRAY_SIZE</a></div><div class="ttdeci">#define PJ_ARRAY_SIZE(a)</div></div>
<div class="ttc" id="agroup__PJ__BASIC_htm_gad42209dcf11f957ed9f1790e30f519cd"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gad42209dcf11f957ed9f1790e30f519cd">pj_shutdown</a></div><div class="ttdeci">void pj_shutdown(void)</div></div>
<div class="ttc" id="agroup__PJ__BASIC_htm_gaec8852c90e22c6868c83d44dcbdecb8a"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gaec8852c90e22c6868c83d44dcbdecb8a">pj_timer_heap_t</a></div><div class="ttdeci">struct pj_timer_heap_t pj_timer_heap_t</div></div>
<div class="ttc" id="agroup__PJ__BASIC_htm_gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a></div><div class="ttdeci">PJ_SUCCESS</div></div>
<div class="ttc" id="agroup__PJ__BASIC_htm_gga65c74a186d2c92fe9f088f3e1e8688bead235b21a623d982cc561fb12bffa87c0"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead235b21a623d982cc561fb12bffa87c0">PJ_TRUE</a></div><div class="ttdeci">PJ_TRUE</div></div>
<div class="ttc" id="agroup__PJ__BASIC_htm_gga65c74a186d2c92fe9f088f3e1e8688bead95511b40a74f4625b161dd9e42c6e6e"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead95511b40a74f4625b161dd9e42c6e6e">PJ_FALSE</a></div><div class="ttdeci">PJ_FALSE</div></div>
<div class="ttc" id="agroup__PJ__CACHING__POOL_htm_ga4c912e7d9e08dae33c2fecea9f1949bc"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__CACHING__POOL.htm#ga4c912e7d9e08dae33c2fecea9f1949bc">pj_caching_pool_destroy</a></div><div class="ttdeci">void pj_caching_pool_destroy(pj_caching_pool *ch_pool)</div></div>
<div class="ttc" id="agroup__PJ__CACHING__POOL_htm_gafbf5400f191e2095240bc6472754e94f"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__CACHING__POOL.htm#gafbf5400f191e2095240bc6472754e94f">pj_caching_pool_init</a></div><div class="ttdeci">void pj_caching_pool_init(pj_caching_pool *ch_pool, const pj_pool_factory_policy *policy, pj_size_t max_capacity)</div></div>
<div class="ttc" id="agroup__PJ__LOG_htm_ga767b9231bf7c2b57274771cdc4bca818"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a></div><div class="ttdeci">#define PJ_LOG(level, arg)</div></div>
<div class="ttc" id="agroup__PJ__LOG_htm_gab8f76697c525b7ce55a85da16442d0c1"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__LOG.htm#gab8f76697c525b7ce55a85da16442d0c1">pj_log_set_level</a></div><div class="ttdeci">void pj_log_set_level(int level)</div></div>
<div class="ttc" id="agroup__PJ__POOL__FACTORY_htm_ga98cf758eafb888f318a8de7f396f47ca"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__POOL__FACTORY.htm#ga98cf758eafb888f318a8de7f396f47ca">pj_pool_factory_default_policy</a></div><div class="ttdeci">pj_pool_factory_policy pj_pool_factory_default_policy</div></div>
<div class="ttc" id="agroup__PJ__POOL_htm_ga14798f6ba0d0858e4f36cc8a4904bbd9"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__POOL.htm#ga14798f6ba0d0858e4f36cc8a4904bbd9">pj_pool_alloc</a></div><div class="ttdeci">void * pj_pool_alloc(pj_pool_t *pool, pj_size_t size)</div></div>
<div class="ttc" id="agroup__PJ__POOL_htm_ga4634b31af5eb0a0178481536986f1d15"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__POOL.htm#ga4634b31af5eb0a0178481536986f1d15">pj_pool_create</a></div><div class="ttdeci">pj_pool_t * pj_pool_create(pj_pool_factory *factory, const char *name, pj_size_t initial_size, pj_size_t increment_size, pj_pool_callback *callback)</div></div>
<div class="ttc" id="agroup__PJ__POOL_htm_ga5bedca9c6066f4e1a7254cbb70b4afcc"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__POOL.htm#ga5bedca9c6066f4e1a7254cbb70b4afcc">pj_pool_zalloc</a></div><div class="ttdeci">void * pj_pool_zalloc(pj_pool_t *pool, pj_size_t size)</div></div>
<div class="ttc" id="agroup__PJ__POOL_htm_gade0f14f6635ecfccb576ec41c57fede5"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__POOL.htm#gade0f14f6635ecfccb576ec41c57fede5">pj_pool_release</a></div><div class="ttdeci">void pj_pool_release(pj_pool_t *pool)</div></div>
<div class="ttc" id="agroup__PJ__PSTR_htm_ga0b12a5cc98e05ff6993aa02436246999"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga0b12a5cc98e05ff6993aa02436246999">pj_strtoul</a></div><div class="ttdeci">unsigned long pj_strtoul(const pj_str_t *str)</div></div>
<div class="ttc" id="agroup__PJ__PSTR_htm_ga20fa0c4d9ccddd0822a775730cf4a867"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a></div><div class="ttdeci">pj_str_t pj_str(char *str)</div></div>
<div class="ttc" id="agroup__PJ__PSTR_htm_ga508848e33f034d920be8333ccdf7e077"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga508848e33f034d920be8333ccdf7e077">pj_stricmp2</a></div><div class="ttdeci">int pj_stricmp2(const pj_str_t *str1, const char *str2)</div></div>
<div class="ttc" id="agroup__PJ__PSTR_htm_ga521ddd312725bf6fa77e91d0dd4aec34"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga521ddd312725bf6fa77e91d0dd4aec34">pj_strcmp</a></div><div class="ttdeci">int pj_strcmp(const pj_str_t *str1, const pj_str_t *str2)</div></div>
<div class="ttc" id="agroup__PJ__PSTR_htm_gafa92001573289c87313c660146369fa3"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__PSTR.htm#gafa92001573289c87313c660146369fa3">pj_bzero</a></div><div class="ttdeci">void pj_bzero(void *dst, pj_size_t size)</div></div>
<div class="ttc" id="agroup__PJ__SOCK_htm_ga25ce2f95b79d3556375804123a5eb77e"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__SOCK.htm#ga25ce2f95b79d3556375804123a5eb77e">pj_htons</a></div><div class="ttdeci">pj_uint16_t pj_htons(pj_uint16_t hostshort)</div></div>
<div class="ttc" id="agroup__PJ__SOCK_htm_ga541321c009325379021d91f0622df333"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__SOCK.htm#ga541321c009325379021d91f0622df333">pj_gethostname</a></div><div class="ttdeci">const pj_str_t * pj_gethostname(void)</div></div>
<div class="ttc" id="agroup__PJ__SOCK_htm_ga8ea303b95fe973432a361e47e0459086"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__SOCK.htm#ga8ea303b95fe973432a361e47e0459086">pj_AF_INET</a></div><div class="ttdeci">#define pj_AF_INET()</div></div>
<div class="ttc" id="agroup__PJ__SOCK_htm_gae6169f27eb956287681a46ca9fecdafc"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__SOCK.htm#gae6169f27eb956287681a46ca9fecdafc">pj_sockaddr_in_init</a></div><div class="ttdeci">pj_status_t pj_sockaddr_in_init(pj_sockaddr_in *addr, const pj_str_t *cp, pj_uint16_t port)</div></div>
<div class="ttc" id="agroup__PJ__THREAD_htm_ga5435f79ad044f9ce2113af311bf2b777"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__THREAD.htm#ga5435f79ad044f9ce2113af311bf2b777">pj_thread_destroy</a></div><div class="ttdeci">pj_status_t pj_thread_destroy(pj_thread_t *thread)</div></div>
<div class="ttc" id="agroup__PJ__THREAD_htm_ga60d90ce08d2f7e92dcaa0443cf87912f"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__THREAD.htm#ga60d90ce08d2f7e92dcaa0443cf87912f">pj_thread_join</a></div><div class="ttdeci">pj_status_t pj_thread_join(pj_thread_t *thread)</div></div>
<div class="ttc" id="agroup__PJ__THREAD_htm_ga7b63533cf4f3ba0cba68cab49a22d722"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__THREAD.htm#ga7b63533cf4f3ba0cba68cab49a22d722">pj_thread_create</a></div><div class="ttdeci">pj_status_t pj_thread_create(pj_pool_t *pool, const char *thread_name, pj_thread_proc *proc, void *arg, pj_size_t stack_size, unsigned flags, pj_thread_t **thread)</div></div>
<div class="ttc" id="agroup__PJ__THREAD_htm_gad59cd6fd7390711758afcc0bde375d68"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__THREAD.htm#gad59cd6fd7390711758afcc0bde375d68">pj_thread_sleep</a></div><div class="ttdeci">pj_status_t pj_thread_sleep(unsigned msec)</div></div>
<div class="ttc" id="agroup__PJ__TIME_htm_ga0806df13f40d3153061f399ed86be856"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__TIME.htm#ga0806df13f40d3153061f399ed86be856">pj_gettimeofday</a></div><div class="ttdeci">pj_status_t pj_gettimeofday(pj_time_val *tv)</div></div>
<div class="ttc" id="agroup__PJ__TIME_htm_ga0b28411e03320ad6bb5f3316125b461c"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__TIME.htm#ga0b28411e03320ad6bb5f3316125b461c">pj_time_val_normalize</a></div><div class="ttdeci">void pj_time_val_normalize(pj_time_val *t)</div></div>
<div class="ttc" id="agroup__PJ__TIME_htm_ga9dd4507187780ed1e83a10176dc845b8"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__TIME.htm#ga9dd4507187780ed1e83a10176dc845b8">PJ_TIME_VAL_LT</a></div><div class="ttdeci">#define PJ_TIME_VAL_LT(t1, t2)</div></div>
<div class="ttc" id="agroup__PJ__TIME_htm_gad015d440803cb8f62ff73878f35badaa"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__TIME.htm#gad015d440803cb8f62ff73878f35badaa">PJ_TIME_VAL_MSEC</a></div><div class="ttdeci">#define PJ_TIME_VAL_MSEC(t)</div></div>
<div class="ttc" id="agroup__PJ__TIME_htm_gaec98fc019fc44b5a6f6b0b9137bcf272"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__TIME.htm#gaec98fc019fc44b5a6f6b0b9137bcf272">PJ_TIME_VAL_SUB</a></div><div class="ttdeci">#define PJ_TIME_VAL_SUB(t1, t2)</div></div>
<div class="ttc" id="agroup__PJ__TIME_htm_gafe6b8b7461c59a2c9d1dbecd11a53d48"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__TIME.htm#gafe6b8b7461c59a2c9d1dbecd11a53d48">PJ_TIME_VAL_GTE</a></div><div class="ttdeci">#define PJ_TIME_VAL_GTE(t1, t2)</div></div>
<div class="ttc" id="agroup__pj__assert_htm_ga9a6f79ac0dc0677698c5735474adfad7"><div class="ttname"><a href="../../../pjlib/docs/html/group__pj__assert.htm#ga9a6f79ac0dc0677698c5735474adfad7">PJ_ASSERT_ON_FAIL</a></div><div class="ttdeci">#define PJ_ASSERT_ON_FAIL(expr, exec_on_fail)</div></div>
<div class="ttc" id="agroup__pj__assert_htm_gac98bea768b573f53432076a387864fb3"><div class="ttname"><a href="../../../pjlib/docs/html/group__pj__assert.htm#gac98bea768b573f53432076a387864fb3">PJ_ASSERT_RETURN</a></div><div class="ttdeci">#define PJ_ASSERT_RETURN(expr, retval)</div></div>
<div class="ttc" id="agroup__pj__config_htm_ga7523f8576efd271c22b188eab05d7870"><div class="ttname"><a href="../../../pjlib/docs/html/group__pj__config.htm#ga7523f8576efd271c22b188eab05d7870">PJ_UNUSED_ARG</a></div><div class="ttdeci">#define PJ_UNUSED_ARG(arg)</div></div>
<div class="ttc" id="agroup__pj__errno_htm_ga314a8edfdcec54a086a401e97b5b0bd0"><div class="ttname"><a href="../../../pjlib/docs/html/group__pj__errno.htm#ga314a8edfdcec54a086a401e97b5b0bd0">PJ_ERR_MSG_SIZE</a></div><div class="ttdeci">#define PJ_ERR_MSG_SIZE</div></div>
<div class="ttc" id="agroup__pj__errno_htm_ga7d2616aded0d61924fb31f4fd6ee45c0"><div class="ttname"><a href="../../../pjlib/docs/html/group__pj__errno.htm#ga7d2616aded0d61924fb31f4fd6ee45c0">pj_strerror</a></div><div class="ttdeci">pj_str_t pj_strerror(pj_status_t statcode, char *buf, pj_size_t bufsize)</div></div>
<div class="ttc" id="agroup__pj__errnum_htm_ga9a16214b8d54a8ee9d6bce378d116beb"><div class="ttname"><a href="../../../pjlib/docs/html/group__pj__errnum.htm#ga9a16214b8d54a8ee9d6bce378d116beb">PJ_ENOMEM</a></div><div class="ttdeci">#define PJ_ENOMEM</div></div>
<div class="ttc" id="apjmedia-codec_8h_htm"><div class="ttname"><a href="pjmedia-codec_8h.htm">pjmedia-codec.h</a></div><div class="ttdoc">Include all codecs API in PJMEDIA-CODEC.</div></div>
<div class="ttc" id="apjmedia_8h_htm"><div class="ttname"><a href="pjmedia_8h.htm">pjmedia.h</a></div><div class="ttdoc">PJMEDIA main header file.</div></div>
<div class="ttc" id="astructcall_htm"><div class="ttname"><a href="structcall.htm">call</a></div><div class="ttdef"><b>Definition:</b> pjsip-perf.c:172</div></div>
<div class="ttc" id="astructpj__caching__pool_htm"><div class="ttname"><a href="../../../pjlib/docs/html/structpj__caching__pool.htm">pj_caching_pool</a></div></div>
<div class="ttc" id="astructpj__getopt__option_htm"><div class="ttname"><a href="../../../pjlib-util/docs/html/structpj__getopt__option.htm">pj_getopt_option</a></div></div>
<div class="ttc" id="astructpj__pool__t_htm"><div class="ttname"><a href="../../../pjlib/docs/html/structpj__pool__t.htm">pj_pool_t</a></div></div>
<div class="ttc" id="astructpj__sockaddr__in_htm"><div class="ttname"><a href="../../../pjlib/docs/html/structpj__sockaddr__in.htm">pj_sockaddr_in</a></div></div>
<div class="ttc" id="astructpj__sockaddr__in_htm_a0e60b93d03fa052211bb6131e64bdda1"><div class="ttname"><a href="../../../pjlib/docs/html/structpj__sockaddr__in.htm#a0e60b93d03fa052211bb6131e64bdda1">pj_sockaddr_in::sin_port</a></div><div class="ttdeci">pj_uint16_t sin_port</div></div>
<div class="ttc" id="astructpj__sockaddr__in_htm_ab298fd61a3f2bf3036fe414740a53cc6"><div class="ttname"><a href="../../../pjlib/docs/html/structpj__sockaddr__in.htm#ab298fd61a3f2bf3036fe414740a53cc6">pj_sockaddr_in::sin_family</a></div><div class="ttdeci">pj_uint16_t sin_family</div></div>
<div class="ttc" id="astructpj__sockaddr__in_htm_ad1ed5a34d99da0d23e65b3b3b5fad228"><div class="ttname"><a href="../../../pjlib/docs/html/structpj__sockaddr__in.htm#ad1ed5a34d99da0d23e65b3b3b5fad228">pj_sockaddr_in::sin_addr</a></div><div class="ttdeci">pj_in_addr sin_addr</div></div>
<div class="ttc" id="astructpj__str__t_htm"><div class="ttname"><a href="../../../pjlib/docs/html/structpj__str__t.htm">pj_str_t</a></div></div>
<div class="ttc" id="astructpj__str__t_htm_a46788480bdb4080083dcc8965811e015"><div class="ttname"><a href="../../../pjlib/docs/html/structpj__str__t.htm#a46788480bdb4080083dcc8965811e015">pj_str_t::slen</a></div><div class="ttdeci">pj_ssize_t slen</div></div>
<div class="ttc" id="astructpj__str__t_htm_a4eb3153e4363a93f65f5c728911168d4"><div class="ttname"><a href="../../../pjlib/docs/html/structpj__str__t.htm#a4eb3153e4363a93f65f5c728911168d4">pj_str_t::ptr</a></div><div class="ttdeci">char * ptr</div></div>
<div class="ttc" id="astructpj__time__val_htm"><div class="ttname"><a href="../../../pjlib/docs/html/structpj__time__val.htm">pj_time_val</a></div></div>
<div class="ttc" id="astructpj__time__val_htm_ab9cc04663b258dd3dcb449a3110e0d82"><div class="ttname"><a href="../../../pjlib/docs/html/structpj__time__val.htm#ab9cc04663b258dd3dcb449a3110e0d82">pj_time_val::msec</a></div><div class="ttdeci">long msec</div></div>
<div class="ttc" id="astructpj__time__val_htm_af2739d0c2189e9c902281c04fd1f4502"><div class="ttname"><a href="../../../pjlib/docs/html/structpj__time__val.htm#af2739d0c2189e9c902281c04fd1f4502">pj_time_val::sec</a></div><div class="ttdeci">long sec</div></div>
<div class="ttc" id="astructpj__timer__entry_htm"><div class="ttname"><a href="../../../pjlib/docs/html/structpj__timer__entry.htm">pj_timer_entry</a></div></div>
<div class="ttc" id="astructpj__timer__entry_htm_a13e63641afbb94298b79967585c0f642"><div class="ttname"><a href="../../../pjlib/docs/html/structpj__timer__entry.htm#a13e63641afbb94298b79967585c0f642">pj_timer_entry::cb</a></div><div class="ttdeci">pj_timer_heap_callback * cb</div></div>
<div class="ttc" id="astructpj__timer__entry_htm_a70aed199d89e16a05bd9643efd3d665d"><div class="ttname"><a href="../../../pjlib/docs/html/structpj__timer__entry.htm#a70aed199d89e16a05bd9643efd3d665d">pj_timer_entry::id</a></div><div class="ttdeci">int id</div></div>
<div class="ttc" id="astructpj__timer__entry_htm_a96ce07b4b890b820ccd1e8365b88add6"><div class="ttname"><a href="../../../pjlib/docs/html/structpj__timer__entry.htm#a96ce07b4b890b820ccd1e8365b88add6">pj_timer_entry::user_data</a></div><div class="ttdeci">void * user_data</div></div>
<div class="ttc" id="astructpjmedia__sdp__session_htm"><div class="ttname"><a href="structpjmedia__sdp__session.htm">pjmedia_sdp_session</a></div><div class="ttdef"><b>Definition:</b> sdp.h:665</div></div>
<div class="ttc" id="astructpjmedia__sock__info_htm"><div class="ttname"><a href="structpjmedia__sock__info.htm">pjmedia_sock_info</a></div><div class="ttdef"><b>Definition:</b> transport.h:276</div></div>
<div class="ttc" id="astructpjmedia__sock__info_htm_aa2cecdb5ff13922865a33d49f3ccd0c8"><div class="ttname"><a href="structpjmedia__sock__info.htm#aa2cecdb5ff13922865a33d49f3ccd0c8">pjmedia_sock_info::rtp_addr_name</a></div><div class="ttdeci">pj_sockaddr rtp_addr_name</div><div class="ttdef"><b>Definition:</b> transport.h:285</div></div>
<div class="ttc" id="astructsrv__state_htm"><div class="ttname"><a href="structsrv__state.htm">srv_state</a></div><div class="ttdef"><b>Definition:</b> pjsip-perf.c:113</div></div>
<div class="ttc" id="aunionpj__sockaddr_htm_ab25ec448ae63acfdd2aa0f3ef2fd10b8"><div class="ttname"><a href="../../../pjlib/docs/html/unionpj__sockaddr.htm#ab25ec448ae63acfdd2aa0f3ef2fd10b8">pj_sockaddr::ipv4</a></div><div class="ttdeci">pj_sockaddr_in ipv4</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<p>&nbsp;</p>
<hr><center>
PJMEDIA small footprint Open Source media stack<br>
Copyright (C) 2006-2008 Teluu Inc.
</center>
<!--#include virtual="/footer.html" -->
</BODY>
</HTML>
