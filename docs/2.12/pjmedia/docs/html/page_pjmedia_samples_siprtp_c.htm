<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Samples: Using SIP and Custom RTP/RTCP to Monitor Quality (2.12)</title>
<link href="/style/style.css" rel="stylesheet" type="text/css">
</head><body>
	<!--#include virtual="/header.html" -->
	<p><A HREF="/">Home</A> --&gt; <A HREF="/docs.htm">Documentations</A> --&gt; PJMEDIA Reference</p>
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Samples: Using SIP and Custom RTP/RTCP to Monitor Quality </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This source is an example to demonstrate using SIP and RTP/RTCP framework to measure the network quality/impairment from the SIP call. This program can be used to make calls or to receive calls from other SIP endpoint (or other siprtp program), and to display the media quality statistics at the end of the call.</p>
<p>Note that the remote peer must support RTCP.</p>
<p>The layout of the program has been designed so that custom reporting can be generated instead of plain human readable text.</p>
<p>The source code of the file is pjsip-apps/src/samples/siprtp.c</p>
<p>Screenshots on WinXP: </p><div class="image">
<img src="siprtp.jpg" alt="siprtp.jpg"/>
</div>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/* $Id$ */</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">/* </span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * Copyright (C) 2008-2011 Teluu Inc. (http://www.teluu.com)</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Copyright (C) 2003-2008 Benny Prijono &lt;benny@prijono.org&gt;</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * This program is free software; you can redistribute it and/or modify</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * it under the terms of the GNU General Public License as published by</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * the Free Software Foundation; either version 2 of the License, or</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * (at your option) any later version.</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * This program is distributed in the hope that it will be useful,</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * GNU General Public License for more details.</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * You should have received a copy of the GNU General Public License</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * along with this program; if not, write to the Free Software</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA </span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">/* Usage */</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *USAGE = </div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="stringliteral">&quot; PURPOSE:                                                                  \n&quot;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="stringliteral">&quot;   This program establishes SIP INVITE session and media, and calculate    \n&quot;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="stringliteral">&quot;   the media quality (packet lost, jitter, rtt, etc.). Unlike normal       \n&quot;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="stringliteral">&quot;   pjmedia applications, this program bypasses all pjmedia stream          \n&quot;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="stringliteral">&quot;   framework and transmit encoded RTP packets manually using own thread.   \n&quot;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="stringliteral">&quot;\n&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="stringliteral">&quot; USAGE:\n&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="stringliteral">&quot;   siprtp [options]        =&gt; to start in server mode\n&quot;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="stringliteral">&quot;   siprtp [options] URL    =&gt; to start in client mode\n&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="stringliteral">&quot;\n&quot;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="stringliteral">&quot; Program options:\n&quot;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="stringliteral">&quot;   --count=N,        -c    Set number of calls to create (default:1) \n&quot;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="stringliteral">&quot;   --gap=N           -g    Set call gapping to N msec (default:0)\n&quot;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="stringliteral">&quot;   --duration=SEC,   -d    Set maximum call duration (default:unlimited) \n&quot;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="stringliteral">&quot;   --auto-quit,      -q    Quit when calls have been completed (default:no)\n&quot;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="stringliteral">&quot;   --call-report     -R    Display report on call termination (default:yes)\n&quot;</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="stringliteral">&quot;\n&quot;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="stringliteral">&quot; Address and ports options:\n&quot;</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="stringliteral">&quot;   --local-port=PORT,-p    Set local SIP port (default: 5060)\n&quot;</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="stringliteral">&quot;   --rtp-port=PORT,  -r    Set start of RTP port (default: 4000)\n&quot;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="stringliteral">&quot;   --ip-addr=IP,     -i    Set local IP address to use (otherwise it will\n&quot;</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="stringliteral">&quot;                           try to determine local IP address from hostname)\n&quot;</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="stringliteral">&quot;\n&quot;</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="stringliteral">&quot; Logging Options:\n&quot;</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="stringliteral">&quot;   --log-level=N,    -l    Set log verbosity level (default=5)\n&quot;</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="stringliteral">&quot;   --app-log-level=N       Set app screen log verbosity (default=3)\n&quot;</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="stringliteral">&quot;   --log-file=FILE         Write log to file FILE\n&quot;</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="stringliteral">&quot;   --report-file=FILE      Write report to file FILE\n&quot;</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="stringliteral">&quot;\n&quot;</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">/* Don&#39;t support this anymore, because codec is properly examined in</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">   pjmedia_session_info_from_sdp() function.</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">&quot; Codec Options:\n&quot;</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">&quot;   --a-pt=PT               Set audio payload type to PT (default=0)\n&quot;</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">&quot;   --a-name=NAME           Set audio codec name to NAME (default=pcmu)\n&quot;</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">&quot;   --a-clock=RATE          Set audio codec rate to RATE Hz (default=8000Hz)\n&quot;</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">&quot;   --a-bitrate=BPS         Set audio codec bitrate to BPS (default=64000bps)\n&quot;</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">&quot;   --a-ptime=MS            Set audio frame time to MS msec (default=20ms)\n&quot;</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">/* Include all headers. */</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">#include &lt;pjsip.h&gt;</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="pjmedia_8h.htm">pjmedia.h</a>&gt;</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="pjmedia-codec_8h.htm">pjmedia-codec.h</a>&gt;</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="preprocessor">#include &lt;pjsip_ua.h&gt;</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor">#include &lt;pjsip_simple.h&gt;</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="preprocessor">#include &lt;pjlib-util.h&gt;</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="preprocessor">#include &lt;pjlib.h&gt;</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="preprocessor">#include &lt;stdlib.h&gt;</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">/* Uncomment these to disable threads.</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment"> * NOTE:</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment"> *   when threading is disabled, siprtp won&#39;t transmit any</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment"> *   RTP packets.</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">#undef PJ_HAS_THREADS</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">#define PJ_HAS_THREADS 0</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="preprocessor">#if PJ_HAS_HIGH_RES_TIMER==0</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="preprocessor">#   error &quot;High resolution timer is needed for this sample&quot;</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="preprocessor">#define THIS_FILE       &quot;siprtp.c&quot;</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="preprocessor">#define MAX_CALLS       1024</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="preprocessor">#define RTP_START_PORT  4000</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">/* Codec descriptor: */</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="keyword">struct </span><a class="code" href="structcodec.htm">codec</a></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;{</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="keywordtype">unsigned</span>    pt;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="keywordtype">char</span>*       name;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="keywordtype">unsigned</span>    clock_rate;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keywordtype">unsigned</span>    bit_rate;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="keywordtype">unsigned</span>    ptime;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keywordtype">char</span>*       description;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;};</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">/* A bidirectional media stream created when the call is active. */</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="keyword">struct </span><a class="code" href="structmedia__stream.htm">media_stream</a></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;{</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="comment">/* Static: */</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="keywordtype">unsigned</span>             call_index;        <span class="comment">/* Call owner.              */</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="keywordtype">unsigned</span>             media_index;       <span class="comment">/* Media index in call.     */</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <a class="code" href="structpjmedia__transport.htm">pjmedia_transport</a>   *transport;         <span class="comment">/* To send/recv RTP/RTCP    */</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="comment">/* Active? */</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga1dc7a356fb36bd2dee2bc7d6c7e817e4">pj_bool_t</a>            active;            <span class="comment">/* Non-zero if is in call.  */</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="comment">/* Current stream info: */</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <a class="code" href="structpjmedia__stream__info.htm">pjmedia_stream_info</a>  si;                <span class="comment">/* Current stream info.     */</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="comment">/* More info: */</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="keywordtype">unsigned</span>             clock_rate;        <span class="comment">/* clock rate               */</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keywordtype">unsigned</span>             samples_per_frame; <span class="comment">/* samples per frame        */</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordtype">unsigned</span>             bytes_per_frame;   <span class="comment">/* frame size.              */</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="comment">/* RTP session: */</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <a class="code" href="structpjmedia__rtp__session.htm">pjmedia_rtp_session</a>  out_sess;          <span class="comment">/* outgoing RTP session     */</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <a class="code" href="structpjmedia__rtp__session.htm">pjmedia_rtp_session</a>  in_sess;           <span class="comment">/* incoming RTP session     */</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="comment">/* RTCP stats: */</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <a class="code" href="structpjmedia__rtcp__session.htm">pjmedia_rtcp_session</a> rtcp;              <span class="comment">/* incoming RTCP session.   */</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="comment">/* Thread: */</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga1dc7a356fb36bd2dee2bc7d6c7e817e4">pj_bool_t</a>            thread_quit_flag;  <span class="comment">/* Stop media thread.       */</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gacb9d46aed6813bf142efc1c3db7a2d17">pj_thread_t</a>         *thread;            <span class="comment">/* Media thread.            */</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;};</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">/* This is a call structure that is created when the application starts</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment"> * and only destroyed when the application quits.</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="keyword">struct </span><a class="code" href="structcall.htm">call</a></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;{</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordtype">unsigned</span>             index;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    pjsip_inv_session   *inv;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keywordtype">unsigned</span>             media_count;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keyword">struct </span><a class="code" href="structmedia__stream.htm">media_stream</a>  media[1];</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__time__val.htm">pj_time_val</a>          start_time;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__time__val.htm">pj_time_val</a>          response_time;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__time__val.htm">pj_time_val</a>          connect_time;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__timer__entry.htm">pj_timer_entry</a>       d_timer;           </div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;};</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">/* Application&#39;s global variables */</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span>app</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;{</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordtype">unsigned</span>             max_calls;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keywordtype">unsigned</span>             call_gap;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga1dc7a356fb36bd2dee2bc7d6c7e817e4">pj_bool_t</a>            call_report;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keywordtype">unsigned</span>             uac_calls;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="keywordtype">unsigned</span>             duration;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga1dc7a356fb36bd2dee2bc7d6c7e817e4">pj_bool_t</a>            auto_quit;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordtype">unsigned</span>             thread_count;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordtype">int</span>                  sip_port;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordtype">int</span>                  rtp_start_port;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__str__t.htm">pj_str_t</a>             local_addr;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__str__t.htm">pj_str_t</a>             local_uri;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__str__t.htm">pj_str_t</a>             local_contact;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    </div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordtype">int</span>                  app_log_level;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keywordtype">int</span>                  log_level;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keywordtype">char</span>                *log_filename;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordtype">char</span>                *report_filename;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keyword">struct </span><a class="code" href="structcodec.htm">codec</a>         audio_codec;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__str__t.htm">pj_str_t</a>             uri_to_call;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__caching__pool.htm">pj_caching_pool</a>      cp;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__pool__t.htm">pj_pool_t</a>           *pool;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    pjsip_endpoint      *sip_endpt;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga1dc7a356fb36bd2dee2bc7d6c7e817e4">pj_bool_t</a>            thread_quit;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gacb9d46aed6813bf142efc1c3db7a2d17">pj_thread_t</a>         *sip_thread[1];</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <a class="code" href="group__PJMEDIA__TYPES.htm#ga7c3623d8e90e22b7184a6e42dc24f6f5">pjmedia_endpt</a>       *med_endpt;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keyword">struct </span><a class="code" href="structcall.htm">call</a>          <a class="code" href="structcall.htm">call</a>[MAX_CALLS];</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;} app;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment"> * Prototypes:</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">/* Callback to be called when SDP negotiation is done in the call: */</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> call_on_media_update( pjsip_inv_session *inv,</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                                  <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> status);</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">/* Callback to be called when invite session&#39;s state has changed: */</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> call_on_state_changed( pjsip_inv_session *inv, </div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                                   pjsip_event *e);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">/* Callback to be called when dialog has forked: */</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> call_on_forked(pjsip_inv_session *inv, pjsip_event *e);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">/* Callback to be called to handle incoming requests outside dialogs: */</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="keyword">static</span> <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga1dc7a356fb36bd2dee2bc7d6c7e817e4">pj_bool_t</a> on_rx_request( pjsip_rx_data *rdata );</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">/* Worker thread prototype */</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> sip_worker_thread(<span class="keywordtype">void</span> *arg);</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">/* Create SDP for call */</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="keyword">static</span> <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> create_sdp( <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__pool__t.htm">pj_pool_t</a> *pool,</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                               <span class="keyword">struct</span> <a class="code" href="structcall.htm">call</a> *<a class="code" href="structcall.htm">call</a>,</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                               <a class="code" href="structpjmedia__sdp__session.htm">pjmedia_sdp_session</a> **p_sdp);</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">/* Hangup call */</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> hangup_call(<span class="keywordtype">unsigned</span> index);</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">/* Destroy the call&#39;s media */</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> destroy_call_media(<span class="keywordtype">unsigned</span> call_index);</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">/* Destroy media. */</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> destroy_media();</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">/* This callback is called by media transport on receipt of RTP packet. */</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> on_rx_rtp(<span class="keywordtype">void</span> *<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__IOQUEUE.htm#gab06c131ab29b37c027f2400bd5be6045">user_data</a>, <span class="keywordtype">void</span> *pkt, <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga173588cd6381f3ad354c23c26929093a">pj_ssize_t</a> size);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">/* This callback is called by media transport on receipt of RTCP packet. */</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> on_rx_rtcp(<span class="keywordtype">void</span> *<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__IOQUEUE.htm#gab06c131ab29b37c027f2400bd5be6045">user_data</a>, <span class="keywordtype">void</span> *pkt, <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga173588cd6381f3ad354c23c26929093a">pj_ssize_t</a> size);</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">/* Display error */</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> app_perror(<span class="keyword">const</span> <span class="keywordtype">char</span> *sender, <span class="keyword">const</span> <span class="keywordtype">char</span> *title, </div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                       <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> status);</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">/* Print call */</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> print_call(<span class="keywordtype">int</span> call_index);</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">/* This is a PJSIP module to be registered by application to handle</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment"> * incoming requests outside any dialogs/transactions. The main purpose</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment"> * here is to handle incoming INVITE request message, where we will</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment"> * create a dialog and INVITE session for it.</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="keyword">static</span> pjsip_module mod_siprtp =</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;{</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    NULL, NULL,                     <span class="comment">/* prev, next.              */</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    { <span class="stringliteral">&quot;mod-siprtpapp&quot;</span>, 13 },        <span class="comment">/* Name.                    */</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    -1,                             <span class="comment">/* Id                       */</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    PJSIP_MOD_PRIORITY_APPLICATION, <span class="comment">/* Priority                 */</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    NULL,                           <span class="comment">/* load()                   */</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    NULL,                           <span class="comment">/* start()                  */</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    NULL,                           <span class="comment">/* stop()                   */</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    NULL,                           <span class="comment">/* unload()                 */</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    &amp;on_rx_request,                 <span class="comment">/* on_rx_request()          */</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    NULL,                           <span class="comment">/* on_rx_response()         */</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    NULL,                           <span class="comment">/* on_tx_request.           */</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    NULL,                           <span class="comment">/* on_tx_response()         */</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    NULL,                           <span class="comment">/* on_tsx_state()           */</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;};</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">/* Codec constants */</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="keyword">struct </span><a class="code" href="structcodec.htm">codec</a> audio_codecs[] = </div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;{</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    { 0,  <span class="stringliteral">&quot;PCMU&quot;</span>, 8000, 64000, 20, <span class="stringliteral">&quot;G.711 ULaw&quot;</span> },</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    { 3,  <span class="stringliteral">&quot;GSM&quot;</span>,  8000, 13200, 20, <span class="stringliteral">&quot;GSM&quot;</span> },</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    { 4,  <span class="stringliteral">&quot;G723&quot;</span>, 8000, 6400,  30, <span class="stringliteral">&quot;G.723.1&quot;</span> },</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    { 8,  <span class="stringliteral">&quot;PCMA&quot;</span>, 8000, 64000, 20, <span class="stringliteral">&quot;G.711 ALaw&quot;</span> },</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    { 18, <span class="stringliteral">&quot;G729&quot;</span>, 8000, 8000,  20, <span class="stringliteral">&quot;G.729&quot;</span> },</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;};</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment"> * Init SIP stack</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="keyword">static</span> <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> init_sip()</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;{</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="keywordtype">unsigned</span> i;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> status;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="comment">/* init PJLIB-UTIL: */</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    status = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib-util/docs/pjlib-util.tag:../../../pjlib-util/docs/html/" href="../../../pjlib-util/docs/html/group__PJLIB__UTIL__BASE.htm#gaf44fef477c4b0e38a99004965fc55110">pjlib_util_init</a>();</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__pj__assert.htm#gac98bea768b573f53432076a387864fb3">PJ_ASSERT_RETURN</a>(status == <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>, status);</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="comment">/* Must create a pool factory before we can allocate any memory. */</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__CACHING__POOL.htm#gafbf5400f191e2095240bc6472754e94f">pj_caching_pool_init</a>(&amp;app.cp, &amp;<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__POOL__FACTORY.htm#ga98cf758eafb888f318a8de7f396f47ca">pj_pool_factory_default_policy</a>, 0);</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="comment">/* Create application pool for misc. */</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    app.pool = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__POOL.htm#gaf58c3ba26a1314c0e0be103960ba4a5e">pj_pool_create</a>(&amp;app.cp.factory, <span class="stringliteral">&quot;app&quot;</span>, 1000, 1000, NULL);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="comment">/* Create the endpoint: */</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    status = pjsip_endpt_create(&amp;app.cp.factory, <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__SOCK.htm#ga47bc19975b9e88fc86d4bf43ffd2a17f">pj_gethostname</a>()-&gt;ptr, </div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                                &amp;app.sip_endpt);</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__pj__assert.htm#gac98bea768b573f53432076a387864fb3">PJ_ASSERT_RETURN</a>(status == <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>, status);</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="comment">/* Add UDP transport. */</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    {</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__sockaddr__in.htm">pj_sockaddr_in</a> addr;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        pjsip_host_port addrname;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        pjsip_transport *tp;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#gafa92001573289c87313c660146369fa3">pj_bzero</a>(&amp;addr, <span class="keyword">sizeof</span>(addr));</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        addr.<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__sockaddr__in.htm#ab298fd61a3f2bf3036fe414740a53cc6">sin_family</a> = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__SOCK.htm#ga8ea303b95fe973432a361e47e0459086">pj_AF_INET</a>();</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        addr.<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__sockaddr__in.htm#ad1ed5a34d99da0d23e65b3b3b5fad228">sin_addr</a>.s_addr = 0;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        addr.<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__sockaddr__in.htm#a0e60b93d03fa052211bb6131e64bdda1">sin_port</a> = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__SOCK.htm#ga25ce2f95b79d3556375804123a5eb77e">pj_htons</a>((<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga47506d8dde1056c5c96d62f0df6ddf28">pj_uint16_t</a>)app.sip_port);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        <span class="keywordflow">if</span> (app.local_addr.slen) {</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            addrname.host = app.local_addr;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            addrname.port = app.sip_port;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            status = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__SOCK.htm#gae6169f27eb956287681a46ca9fecdafc">pj_sockaddr_in_init</a>(&amp;addr, &amp;app.local_addr, </div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                                         (<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga47506d8dde1056c5c96d62f0df6ddf28">pj_uint16_t</a>)app.sip_port);</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;            <span class="keywordflow">if</span> (status != <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                app_perror(THIS_FILE, <span class="stringliteral">&quot;Unable to resolve IP interface&quot;</span>, status);</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                <span class="keywordflow">return</span> status;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            }</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        }</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        status = pjsip_udp_transport_start( app.sip_endpt, &amp;addr, </div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                                            (app.local_addr.slen ? &amp;addrname:NULL),</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                                            1, &amp;tp);</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <span class="keywordflow">if</span> (status != <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;            app_perror(THIS_FILE, <span class="stringliteral">&quot;Unable to start UDP transport&quot;</span>, status);</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;            <span class="keywordflow">return</span> status;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        }</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(3,(THIS_FILE, <span class="stringliteral">&quot;SIP UDP listening on %.*s:%d&quot;</span>,</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                  (<span class="keywordtype">int</span>)tp-&gt;local_name.host.slen, tp-&gt;local_name.host.ptr,</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                  tp-&gt;local_name.port));</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    }</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="comment">/* </span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">     * Init transaction layer.</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">     * This will create/initialize transaction hash tables etc.</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    status = pjsip_tsx_layer_init_module(app.sip_endpt);</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__pj__assert.htm#gac98bea768b573f53432076a387864fb3">PJ_ASSERT_RETURN</a>(status == <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>, status);</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="comment">/*  Initialize UA layer. */</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    status = pjsip_ua_init_module( app.sip_endpt, NULL );</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__pj__assert.htm#gac98bea768b573f53432076a387864fb3">PJ_ASSERT_RETURN</a>(status == <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>, status);</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="comment">/* Initialize 100rel support */</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    status = pjsip_100rel_init_module(app.sip_endpt);</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__pj__assert.htm#gac98bea768b573f53432076a387864fb3">PJ_ASSERT_RETURN</a>(status == <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>, status);</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="comment">/*  Init invite session module. */</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    {</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        pjsip_inv_callback inv_cb;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <span class="comment">/* Init the callback for INVITE session: */</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#gafa92001573289c87313c660146369fa3">pj_bzero</a>(&amp;inv_cb, <span class="keyword">sizeof</span>(inv_cb));</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        inv_cb.on_state_changed = &amp;call_on_state_changed;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        inv_cb.on_new_session = &amp;call_on_forked;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        inv_cb.on_media_update = &amp;call_on_media_update;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <span class="comment">/* Initialize invite session module:  */</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        status = pjsip_inv_usage_init(app.sip_endpt, &amp;inv_cb);</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__pj__assert.htm#gac98bea768b573f53432076a387864fb3">PJ_ASSERT_RETURN</a>(status == <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>, 1);</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    }</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="comment">/* Register our module to receive incoming requests. */</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    status = pjsip_endpt_register_module( app.sip_endpt, &amp;mod_siprtp);</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__pj__assert.htm#gac98bea768b573f53432076a387864fb3">PJ_ASSERT_RETURN</a>(status == <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>, status);</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="comment">/* Init calls */</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keywordflow">for</span> (i=0; i&lt;app.max_calls; ++i)</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        app.call[i].index = i;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="comment">/* Done */</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="keywordflow">return</span> <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;}</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment"> * Destroy SIP</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> destroy_sip()</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;{</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="keywordtype">unsigned</span> i;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    app.thread_quit = 1;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="keywordflow">for</span> (i=0; i&lt;app.thread_count; ++i) {</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        <span class="keywordflow">if</span> (app.sip_thread[i]) {</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;            <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__THREAD.htm#ga60d90ce08d2f7e92dcaa0443cf87912f">pj_thread_join</a>(app.sip_thread[i]);</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;            <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__THREAD.htm#ga5435f79ad044f9ce2113af311bf2b777">pj_thread_destroy</a>(app.sip_thread[i]);</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;            app.sip_thread[i] = NULL;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        }</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    }</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="keywordflow">if</span> (app.sip_endpt) {</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        pjsip_endpt_destroy(app.sip_endpt);</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        app.sip_endpt = NULL;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    }</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;}</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment"> * Init media stack.</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="keyword">static</span> <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> init_media()</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;{</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="keywordtype">unsigned</span>    i, count;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga47506d8dde1056c5c96d62f0df6ddf28">pj_uint16_t</a> rtp_port;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> status;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="comment">/* Initialize media endpoint so that at least error subsystem is properly</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">     * initialized.</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="preprocessor">#if PJ_HAS_THREADS</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    status = <a class="code" href="group__PJMED__ENDPT.htm#ga2865efcd255dbcb05ede33dbae5c27f5">pjmedia_endpt_create</a>(&amp;app.cp.factory, NULL, 1, &amp;app.med_endpt);</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    status = <a class="code" href="group__PJMED__ENDPT.htm#ga2865efcd255dbcb05ede33dbae5c27f5">pjmedia_endpt_create</a>(&amp;app.cp.factory, </div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                                  pjsip_endpt_get_ioqueue(app.sip_endpt),</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                                  0, &amp;app.med_endpt);</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__pj__assert.htm#gac98bea768b573f53432076a387864fb3">PJ_ASSERT_RETURN</a>(status == <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>, status);</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="comment">/* Must register codecs to be supported */</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="preprocessor">#if defined(PJMEDIA_HAS_G711_CODEC) &amp;&amp; PJMEDIA_HAS_G711_CODEC!=0</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <a class="code" href="group__PJMED__G711.htm#gaa4cc7591d63c308e1f2e7821240abf14">pjmedia_codec_g711_init</a>(app.med_endpt);</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="comment">/* RTP port counter */</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    rtp_port = (<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga47506d8dde1056c5c96d62f0df6ddf28">pj_uint16_t</a>)(app.rtp_start_port &amp; 0xFFFE);</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="comment">/* Init media transport for all calls. */</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="keywordflow">for</span> (i=0, count=0; i&lt;app.max_calls; ++i, ++count) {</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        <span class="keywordtype">unsigned</span> j;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        <span class="comment">/* Create transport for each media in the call */</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        <span class="keywordflow">for</span> (j=0; j&lt;<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gacd8459212a1e5175eeb04e3a6cd76659">PJ_ARRAY_SIZE</a>(app.call[0].media); ++j) {</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;            <span class="comment">/* Repeat binding media socket to next port when fails to bind</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment">             * to current port number.</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;            <span class="keywordtype">int</span> retry;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;            app.call[i].media[j].call_index = i;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;            app.call[i].media[j].media_index = j;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;            status = -1;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;            <span class="keywordflow">for</span> (retry=0; retry&lt;100; ++retry,rtp_port+=2)  {</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                <span class="keyword">struct </span><a class="code" href="structmedia__stream.htm">media_stream</a> *m = &amp;app.call[i].media[j];</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                </div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                status = <a class="code" href="group__PJMEDIA__TRANSPORT__UDP.htm#ga8baf23a6ec9268aed82a53ed6b1e366f">pjmedia_transport_udp_create2</a>(app.med_endpt, </div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                                                       <span class="stringliteral">&quot;siprtp&quot;</span>,</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                                                       &amp;app.local_addr,</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                                                       rtp_port, 0, </div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                                                       &amp;m-&gt;transport);</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                <span class="keywordflow">if</span> (status == <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                    rtp_port += 2;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                }</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;            }</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        }</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        <span class="keywordflow">if</span> (status != <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>)</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;            <span class="keywordflow">goto</span> on_error;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    }</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="comment">/* Done */</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordflow">return</span> <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;on_error:</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    destroy_media();</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="keywordflow">return</span> status;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;}</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment"> * Destroy media.</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> destroy_media()</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;{</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keywordtype">unsigned</span> i;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keywordflow">for</span> (i=0; i&lt;app.max_calls; ++i) {</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        <span class="keywordtype">unsigned</span> j;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        <span class="keywordflow">for</span> (j=0; j&lt;<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gacd8459212a1e5175eeb04e3a6cd76659">PJ_ARRAY_SIZE</a>(app.call[0].media); ++j) {</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;            <span class="keyword">struct </span><a class="code" href="structmedia__stream.htm">media_stream</a> *m = &amp;app.call[i].media[j];</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            <span class="keywordflow">if</span> (m-&gt;transport) {</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                <a class="code" href="group__PJMEDIA__TRANSPORT.htm#ga0114fa7e20cb17c645701b2dbda96452">pjmedia_transport_close</a>(m-&gt;transport);</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                m-&gt;transport = NULL;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;            }</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        }</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    }</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="keywordflow">if</span> (app.med_endpt) {</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        <a class="code" href="group__PJMED__ENDPT.htm#gae2304cc656a0e6a602f6cdaaec91bb19">pjmedia_endpt_destroy</a>(app.med_endpt);</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        app.med_endpt = NULL;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    }</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;}</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="comment"> * Make outgoing call.</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="keyword">static</span> <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> make_call(<span class="keyword">const</span> <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__str__t.htm">pj_str_t</a> *dst_uri)</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;{</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="keywordtype">unsigned</span> i;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="keyword">struct </span><a class="code" href="structcall.htm">call</a> *<a class="code" href="structcall.htm">call</a>;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    pjsip_dialog *dlg;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <a class="code" href="structpjmedia__sdp__session.htm">pjmedia_sdp_session</a> *sdp;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    pjsip_tx_data *tdata;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> status;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="comment">/* Find unused call slot */</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="keywordflow">for</span> (i=0; i&lt;app.max_calls; ++i) {</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <span class="keywordflow">if</span> (app.call[i].inv == NULL)</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    }</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="keywordflow">if</span> (i == app.max_calls)</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        <span class="keywordflow">return</span> <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__pj__errnum.htm#gadb73764809be94c12e84bb79ba1a25a4">PJ_ETOOMANY</a>;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    call = &amp;app.call[i];</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="comment">/* Create UAC dialog */</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    status = pjsip_dlg_create_uac( pjsip_ua_instance(), </div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                                   &amp;app.local_uri,      <span class="comment">/* local URI        */</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                                   &amp;app.local_contact,  <span class="comment">/* local Contact    */</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                                   dst_uri,             <span class="comment">/* remote URI       */</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                                   dst_uri,             <span class="comment">/* remote target    */</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                                   &amp;dlg);               <span class="comment">/* dialog           */</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="keywordflow">if</span> (status != <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        ++app.uac_calls;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        <span class="keywordflow">return</span> status;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    }</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="comment">/* Create SDP */</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    create_sdp( dlg-&gt;pool, call, &amp;sdp);</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <span class="comment">/* Create the INVITE session. */</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    status = pjsip_inv_create_uac( dlg, sdp, 0, &amp;call-&gt;inv);</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordflow">if</span> (status != <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        pjsip_dlg_terminate(dlg);</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        ++app.uac_calls;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        <span class="keywordflow">return</span> status;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    }</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="comment">/* Attach call data to invite session */</span></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    call-&gt;inv-&gt;mod_data[mod_siprtp.id] = call;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <span class="comment">/* Mark start of call */</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__TIME.htm#ga0806df13f40d3153061f399ed86be856">pj_gettimeofday</a>(&amp;call-&gt;start_time);</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="comment">/* Create initial INVITE request.</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment">     * This INVITE request will contain a perfectly good request and </span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="comment">     * an SDP body as well.</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    status = pjsip_inv_invite(call-&gt;inv, &amp;tdata);</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__pj__assert.htm#gac98bea768b573f53432076a387864fb3">PJ_ASSERT_RETURN</a>(status == <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>, status);</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="comment">/* Send initial INVITE request. </span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="comment">     * From now on, the invite session&#39;s state will be reported to us</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="comment">     * via the invite session callbacks.</span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    status = pjsip_inv_send_msg(call-&gt;inv, tdata);</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__pj__assert.htm#gac98bea768b573f53432076a387864fb3">PJ_ASSERT_RETURN</a>(status == <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>, status);</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <span class="keywordflow">return</span> <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;}</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="comment"> * Receive incoming call</span></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> process_incoming_call(pjsip_rx_data *rdata)</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;{</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="keywordtype">unsigned</span> i, options;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <span class="keyword">struct </span>call *call;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    pjsip_dialog *dlg;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <a class="code" href="structpjmedia__sdp__session.htm">pjmedia_sdp_session</a> *sdp;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    pjsip_tx_data *tdata;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> status;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="comment">/* Find free call slot */</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="keywordflow">for</span> (i=0; i&lt;app.max_calls; ++i) {</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        <span class="keywordflow">if</span> (app.call[i].inv == NULL)</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    }</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <span class="keywordflow">if</span> (i == app.max_calls) {</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        <span class="keyword">const</span> <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__str__t.htm">pj_str_t</a> reason = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a>(<span class="stringliteral">&quot;Too many calls&quot;</span>);</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        pjsip_endpt_respond_stateless( app.sip_endpt, rdata, </div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                                       500, &amp;reason,</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                                       NULL, NULL);</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    }</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    call = &amp;app.call[i];</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="comment">/* Verify that we can handle the request. */</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    options = 0;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    status = pjsip_inv_verify_request(rdata, &amp;options, NULL, NULL,</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                                   app.sip_endpt, &amp;tdata);</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="keywordflow">if</span> (status != <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="comment">         * No we can&#39;t handle the incoming INVITE request.</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        <span class="keywordflow">if</span> (tdata) {</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;            pjsip_response_addr res_addr;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;            </div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;            pjsip_get_response_addr(tdata-&gt;pool, rdata, &amp;res_addr);</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;            status = pjsip_endpt_send_response(app.sip_endpt, &amp;res_addr, tdata,</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                                                                                   NULL, NULL);</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;            <span class="keywordflow">if</span> (status != <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) pjsip_tx_data_dec_ref(tdata);</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;            </div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;            </div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;            <span class="comment">/* Respond with 500 (Internal Server Error) */</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;            pjsip_endpt_respond_stateless(app.sip_endpt, rdata, 500, NULL,</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                NULL, NULL);</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        }</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        </div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    }</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <span class="comment">/* Create UAS dialog */</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    status = pjsip_dlg_create_uas_and_inc_lock( pjsip_ua_instance(), rdata,</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                                                &amp;app.local_contact, &amp;dlg);</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    <span class="keywordflow">if</span> (status != <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        <span class="keyword">const</span> <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__str__t.htm">pj_str_t</a> reason = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a>(<span class="stringliteral">&quot;Unable to create dialog&quot;</span>);</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        pjsip_endpt_respond_stateless( app.sip_endpt, rdata, </div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                                       500, &amp;reason,</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                                       NULL, NULL);</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    }</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <span class="comment">/* Create SDP */</span></div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    create_sdp( dlg-&gt;pool, call, &amp;sdp);</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="comment">/* Create UAS invite session */</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    status = pjsip_inv_create_uas( dlg, rdata, sdp, 0, &amp;call-&gt;inv);</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <span class="keywordflow">if</span> (status != <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        pjsip_dlg_create_response(dlg, rdata, 500, NULL, &amp;tdata);</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        pjsip_dlg_send_response(dlg, pjsip_rdata_get_tsx(rdata), tdata);</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        pjsip_dlg_dec_lock(dlg);</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    }</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    </div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <span class="comment">/* Invite session has been created, decrement &amp; release dialog lock */</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    pjsip_dlg_dec_lock(dlg);</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <span class="comment">/* Attach call data to invite session */</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    call-&gt;inv-&gt;mod_data[mod_siprtp.id] = call;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="comment">/* Mark start of call */</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__TIME.htm#ga0806df13f40d3153061f399ed86be856">pj_gettimeofday</a>(&amp;call-&gt;start_time);</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    <span class="comment">/* Create 200 response .*/</span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    status = pjsip_inv_initial_answer(call-&gt;inv, rdata, 200, </div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                                      NULL, NULL, &amp;tdata);</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="keywordflow">if</span> (status != <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        status = pjsip_inv_initial_answer(call-&gt;inv, rdata, </div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;                                          PJSIP_SC_NOT_ACCEPTABLE,</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;                                          NULL, NULL, &amp;tdata);</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        <span class="keywordflow">if</span> (status == <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>)</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;            pjsip_inv_send_msg(call-&gt;inv, tdata); </div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;            pjsip_inv_terminate(call-&gt;inv, 500, <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead95511b40a74f4625b161dd9e42c6e6e">PJ_FALSE</a>);</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    }</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <span class="comment">/* Send the 200 response. */</span>  </div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    status = pjsip_inv_send_msg(call-&gt;inv, tdata); </div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__pj__assert.htm#ga9a6f79ac0dc0677698c5735474adfad7">PJ_ASSERT_ON_FAIL</a>(status == <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>, <span class="keywordflow">return</span>);</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <span class="comment">/* Done */</span></div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;}</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;<span class="comment">/* Callback to be called when dialog has forked: */</span></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> call_on_forked(pjsip_inv_session *inv, pjsip_event *e)</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;{</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__pj__config.htm#ga7523f8576efd271c22b188eab05d7870">PJ_UNUSED_ARG</a>(inv);</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__pj__config.htm#ga7523f8576efd271c22b188eab05d7870">PJ_UNUSED_ARG</a>(e);</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__pj__config.htm#ga5074ce869f2077ea0f53ef137cbe3a24">PJ_TODO</a>( HANDLE_FORKING );</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;}</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="comment">/* Callback to be called to handle incoming requests outside dialogs: */</span></div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;<span class="keyword">static</span> <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga1dc7a356fb36bd2dee2bc7d6c7e817e4">pj_bool_t</a> on_rx_request( pjsip_rx_data *rdata )</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;{</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    <span class="comment">/* Ignore strandled ACKs (must not send respone */</span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="keywordflow">if</span> (rdata-&gt;msg_info.msg-&gt;line.req.method.id == PJSIP_ACK_METHOD)</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        <span class="keywordflow">return</span> <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead95511b40a74f4625b161dd9e42c6e6e">PJ_FALSE</a>;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="comment">/* Respond (statelessly) any non-INVITE requests with 500  */</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <span class="keywordflow">if</span> (rdata-&gt;msg_info.msg-&gt;line.req.method.id != PJSIP_INVITE_METHOD) {</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__str__t.htm">pj_str_t</a> reason = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a>(<span class="stringliteral">&quot;Unsupported Operation&quot;</span>);</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        pjsip_endpt_respond_stateless( app.sip_endpt, rdata, </div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;                                       500, &amp;reason,</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;                                       NULL, NULL);</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        <span class="keywordflow">return</span> <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead235b21a623d982cc561fb12bffa87c0">PJ_TRUE</a>;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    }</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    <span class="comment">/* Handle incoming INVITE */</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    process_incoming_call(rdata);</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <span class="comment">/* Done */</span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="keywordflow">return</span> <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead235b21a623d982cc561fb12bffa87c0">PJ_TRUE</a>;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;}</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<span class="comment">/* Callback timer to disconnect call (limiting call duration) */</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> timer_disconnect_call( <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gaec8852c90e22c6868c83d44dcbdecb8a">pj_timer_heap_t</a> *timer_heap,</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;                                   <span class="keyword">struct</span> <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__timer__entry.htm">pj_timer_entry</a> *entry)</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;{</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <span class="keyword">struct </span>call *call = (<span class="keyword">struct </span>call *)(entry-&gt;<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__timer__entry.htm#a96ce07b4b890b820ccd1e8365b88add6">user_data</a>);</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__pj__config.htm#ga7523f8576efd271c22b188eab05d7870">PJ_UNUSED_ARG</a>(timer_heap);</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    entry-&gt;<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__timer__entry.htm#a70aed199d89e16a05bd9643efd3d665d">id</a> = 0;</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    hangup_call(call-&gt;index);</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;}</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="comment">/* Callback to be called when invite session&#39;s state has changed: */</span></div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> call_on_state_changed( pjsip_inv_session *inv, </div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                                   pjsip_event *e)</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;{</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    <span class="keyword">struct </span>call *call = (<span class="keyword">struct </span>call *)inv-&gt;mod_data[mod_siprtp.id];</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__pj__config.htm#ga7523f8576efd271c22b188eab05d7870">PJ_UNUSED_ARG</a>(e);</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    <span class="keywordflow">if</span> (!call)</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    <span class="keywordflow">if</span> (inv-&gt;state == PJSIP_INV_STATE_DISCONNECTED) {</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        </div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__time__val.htm">pj_time_val</a> null_time = {0, 0};</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        <span class="keywordflow">if</span> (call-&gt;<a class="code" href="structcall.htm#ab6cff6ed65f7f63136706c4a423d5d3d">d_timer</a>.<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__timer__entry.htm#a70aed199d89e16a05bd9643efd3d665d">id</a> != 0) {</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;            pjsip_endpt_cancel_timer(app.sip_endpt, &amp;call-&gt;<a class="code" href="structcall.htm#ab6cff6ed65f7f63136706c4a423d5d3d">d_timer</a>);</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;            call-&gt;<a class="code" href="structcall.htm#ab6cff6ed65f7f63136706c4a423d5d3d">d_timer</a>.<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__timer__entry.htm#a70aed199d89e16a05bd9643efd3d665d">id</a> = 0;</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        }</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(3,(THIS_FILE, <span class="stringliteral">&quot;Call #%d disconnected. Reason=%d (%.*s)&quot;</span>,</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;                  call-&gt;index,</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                  inv-&gt;cause,</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                  (<span class="keywordtype">int</span>)inv-&gt;cause_text.slen,</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                  inv-&gt;cause_text.ptr));</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        <span class="keywordflow">if</span> (app.call_report) {</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;            <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(3,(THIS_FILE, <span class="stringliteral">&quot;Call #%d statistics:&quot;</span>, call-&gt;index));</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;            print_call(call-&gt;index);</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;        }</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        call-&gt;inv = NULL;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        inv-&gt;mod_data[mod_siprtp.id] = NULL;</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        destroy_call_media(call-&gt;index);</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;        call-&gt;start_time = null_time;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        call-&gt;response_time = null_time;</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        call-&gt;connect_time = null_time;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        ++app.uac_calls;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (inv-&gt;state == PJSIP_INV_STATE_CONFIRMED) {</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__time__val.htm">pj_time_val</a> t;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__TIME.htm#ga0806df13f40d3153061f399ed86be856">pj_gettimeofday</a>(&amp;call-&gt;connect_time);</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        <span class="keywordflow">if</span> (call-&gt;response_time.<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__time__val.htm#af2739d0c2189e9c902281c04fd1f4502">sec</a> == 0)</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;            call-&gt;response_time = call-&gt;connect_time;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        t = call-&gt;connect_time;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__TIME.htm#gaec98fc019fc44b5a6f6b0b9137bcf272">PJ_TIME_VAL_SUB</a>(t, call-&gt;start_time);</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(3,(THIS_FILE, <span class="stringliteral">&quot;Call #%d connected in %d ms&quot;</span>, call-&gt;index,</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;                  <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__TIME.htm#gad015d440803cb8f62ff73878f35badaa">PJ_TIME_VAL_MSEC</a>(t)));</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        <span class="keywordflow">if</span> (app.duration != 0) {</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;            call-&gt;<a class="code" href="structcall.htm#ab6cff6ed65f7f63136706c4a423d5d3d">d_timer</a>.<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__timer__entry.htm#a70aed199d89e16a05bd9643efd3d665d">id</a> = 1;</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;            call-&gt;<a class="code" href="structcall.htm#ab6cff6ed65f7f63136706c4a423d5d3d">d_timer</a>.<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__timer__entry.htm#a96ce07b4b890b820ccd1e8365b88add6">user_data</a> = call;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;            call-&gt;<a class="code" href="structcall.htm#ab6cff6ed65f7f63136706c4a423d5d3d">d_timer</a>.<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__timer__entry.htm#a13e63641afbb94298b79967585c0f642">cb</a> = &amp;timer_disconnect_call;</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;            t.<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__time__val.htm#af2739d0c2189e9c902281c04fd1f4502">sec</a> = app.duration;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;            t.<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__time__val.htm#ab9cc04663b258dd3dcb449a3110e0d82">msec</a> = 0;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;            pjsip_endpt_schedule_timer(app.sip_endpt, &amp;call-&gt;<a class="code" href="structcall.htm#ab6cff6ed65f7f63136706c4a423d5d3d">d_timer</a>, &amp;t);</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        }</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( inv-&gt;state == PJSIP_INV_STATE_EARLY ||</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;                inv-&gt;state == PJSIP_INV_STATE_CONNECTING) {</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        <span class="keywordflow">if</span> (call-&gt;response_time.<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__time__val.htm#af2739d0c2189e9c902281c04fd1f4502">sec</a> == 0)</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;            <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__TIME.htm#ga0806df13f40d3153061f399ed86be856">pj_gettimeofday</a>(&amp;call-&gt;response_time);</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    }</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;}</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="comment">/* Utility */</span></div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> app_perror(<span class="keyword">const</span> <span class="keywordtype">char</span> *sender, <span class="keyword">const</span> <span class="keywordtype">char</span> *title, </div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;                       <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> status)</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;{</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <span class="keywordtype">char</span> errmsg[<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__pj__errno.htm#ga314a8edfdcec54a086a401e97b5b0bd0">PJ_ERR_MSG_SIZE</a>];</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__pj__errno.htm#ga7d2616aded0d61924fb31f4fd6ee45c0">pj_strerror</a>(status, errmsg, <span class="keyword">sizeof</span>(errmsg));</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(3,(sender, <span class="stringliteral">&quot;%s: %s [status=%d]&quot;</span>, title, errmsg, status));</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;}</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;<span class="comment">/* Worker thread for SIP */</span></div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> sip_worker_thread(<span class="keywordtype">void</span> *arg)</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;{</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__pj__config.htm#ga7523f8576efd271c22b188eab05d7870">PJ_UNUSED_ARG</a>(arg);</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    <span class="keywordflow">while</span> (!app.thread_quit) {</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__time__val.htm">pj_time_val</a> timeout = {0, 10};</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        pjsip_endpt_handle_events(app.sip_endpt, &amp;timeout);</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    }</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;}</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="comment">/* Init application options */</span></div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="keyword">static</span> <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> init_options(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;{</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">char</span> ip_addr[<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__SOCK.htm#ga4d4616a16aa2f3dd1be104091215fdc8">PJ_INET_ADDRSTRLEN</a>];</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">char</span> local_uri[64];</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <span class="keyword">enum</span> { OPT_START,</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;           OPT_APP_LOG_LEVEL, OPT_LOG_FILE, </div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;           OPT_A_PT, OPT_A_NAME, OPT_A_CLOCK, OPT_A_BITRATE, OPT_A_PTIME,</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;           OPT_REPORT_FILE };</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    <span class="keyword">struct </span><a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib-util/docs/pjlib-util.tag:../../../pjlib-util/docs/html/" href="../../../pjlib-util/docs/html/structpj__getopt__option.htm">pj_getopt_option</a> long_options[] = {</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        { <span class="stringliteral">&quot;count&quot;</span>,          1, 0, <span class="charliteral">&#39;c&#39;</span> },</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        { <span class="stringliteral">&quot;gap&quot;</span>,            1, 0, <span class="charliteral">&#39;g&#39;</span> },</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        { <span class="stringliteral">&quot;call-report&quot;</span>,    0, 0, <span class="charliteral">&#39;R&#39;</span> },</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;        { <span class="stringliteral">&quot;duration&quot;</span>,       1, 0, <span class="charliteral">&#39;d&#39;</span> },</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        { <span class="stringliteral">&quot;auto-quit&quot;</span>,      0, 0, <span class="charliteral">&#39;q&#39;</span> },</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        { <span class="stringliteral">&quot;local-port&quot;</span>,     1, 0, <span class="charliteral">&#39;p&#39;</span> },</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;        { <span class="stringliteral">&quot;rtp-port&quot;</span>,       1, 0, <span class="charliteral">&#39;r&#39;</span> },</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;        { <span class="stringliteral">&quot;ip-addr&quot;</span>,        1, 0, <span class="charliteral">&#39;i&#39;</span> },</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        { <span class="stringliteral">&quot;log-level&quot;</span>,      1, 0, <span class="charliteral">&#39;l&#39;</span> },</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        { <span class="stringliteral">&quot;app-log-level&quot;</span>,  1, 0, OPT_APP_LOG_LEVEL },</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        { <span class="stringliteral">&quot;log-file&quot;</span>,       1, 0, OPT_LOG_FILE },</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        { <span class="stringliteral">&quot;report-file&quot;</span>,    1, 0, OPT_REPORT_FILE },</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;        <span class="comment">/* Don&#39;t support this anymore, see comments in USAGE above.</span></div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;<span class="comment">        { &quot;a-pt&quot;,           1, 0, OPT_A_PT },</span></div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;<span class="comment">        { &quot;a-name&quot;,         1, 0, OPT_A_NAME },</span></div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;<span class="comment">        { &quot;a-clock&quot;,        1, 0, OPT_A_CLOCK },</span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;<span class="comment">        { &quot;a-bitrate&quot;,      1, 0, OPT_A_BITRATE },</span></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;<span class="comment">        { &quot;a-ptime&quot;,        1, 0, OPT_A_PTIME },</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;<span class="comment">        */</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;        { NULL, 0, 0, 0 },</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    };</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    <span class="keywordtype">int</span> c;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    <span class="keywordtype">int</span> option_index;</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    <span class="comment">/* Get local IP address for the default IP address */</span></div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    {</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;        <span class="keyword">const</span> <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__str__t.htm">pj_str_t</a> *hostname;</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__sockaddr__in.htm">pj_sockaddr_in</a> tmp_addr;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;        hostname = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__SOCK.htm#ga47bc19975b9e88fc86d4bf43ffd2a17f">pj_gethostname</a>();</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__SOCK.htm#gae6169f27eb956287681a46ca9fecdafc">pj_sockaddr_in_init</a>(&amp;tmp_addr, hostname, 0);</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__SOCK.htm#ga506ba0f8230021a6cdd1bdab22c32e2e">pj_inet_ntop</a>(<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__SOCK.htm#ga8ea303b95fe973432a361e47e0459086">pj_AF_INET</a>(), &amp;tmp_addr.<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__sockaddr__in.htm#ad1ed5a34d99da0d23e65b3b3b5fad228">sin_addr</a>, ip_addr,</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;                     <span class="keyword">sizeof</span>(ip_addr));</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    }</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    <span class="comment">/* Init defaults */</span></div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    app.max_calls = 1;</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    app.thread_count = 1;</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    app.sip_port = 5060;</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    app.rtp_start_port = RTP_START_PORT;</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    app.local_addr = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a>(ip_addr);</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    app.log_level = 5;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    app.app_log_level = 3;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    app.log_filename = NULL;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    <span class="comment">/* Default codecs: */</span></div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    app.audio_codec = audio_codecs[0];</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    <span class="comment">/* Parse options */</span></div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    pj_optind = 0;</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    <span class="keywordflow">while</span>((c=pj_getopt_long(argc,argv, <span class="stringliteral">&quot;c:d:p:r:i:l:g:qR&quot;</span>, </div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;                            long_options, &amp;option_index))!=-1) </div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    {</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        <span class="keywordflow">switch</span> (c) {</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;c&#39;</span>:</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;            app.max_calls = atoi(pj_optarg);</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;            <span class="keywordflow">if</span> (app.max_calls &gt; MAX_CALLS) {</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;                <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(3,(THIS_FILE,<span class="stringliteral">&quot;Invalid max calls value %s &quot;</span></div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;                                    <span class="stringliteral">&quot;(must be &lt;= %d)&quot;</span>, pj_optarg, MAX_CALLS));</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;                <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;            }</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;g&#39;</span>:</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;            app.call_gap = atoi(pj_optarg);</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;R&#39;</span>:</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;            app.call_report = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead235b21a623d982cc561fb12bffa87c0">PJ_TRUE</a>;</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;d&#39;</span>:</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;            app.duration = atoi(pj_optarg);</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;q&#39;</span>:</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;            app.auto_quit = 1;</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;p&#39;</span>:</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;            app.sip_port = atoi(pj_optarg);</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;r&#39;</span>:</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;            app.rtp_start_port = atoi(pj_optarg);</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;i&#39;</span>:</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;            app.local_addr = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a>(pj_optarg);</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;l&#39;</span>:</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;            app.log_level = atoi(pj_optarg);</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;        <span class="keywordflow">case</span> OPT_APP_LOG_LEVEL:</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;            app.app_log_level = atoi(pj_optarg);</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;        <span class="keywordflow">case</span> OPT_LOG_FILE:</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;            app.log_filename = pj_optarg;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;        <span class="keywordflow">case</span> OPT_A_PT:</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;            app.audio_codec.pt = atoi(pj_optarg);</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;        <span class="keywordflow">case</span> OPT_A_NAME:</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;            app.audio_codec.name = pj_optarg;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;        <span class="keywordflow">case</span> OPT_A_CLOCK:</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;            app.audio_codec.clock_rate = atoi(pj_optarg);</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;        <span class="keywordflow">case</span> OPT_A_BITRATE:</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;            app.audio_codec.bit_rate = atoi(pj_optarg);</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;        <span class="keywordflow">case</span> OPT_A_PTIME:</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;            app.audio_codec.ptime = atoi(pj_optarg);</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;        <span class="keywordflow">case</span> OPT_REPORT_FILE:</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;            app.report_filename = pj_optarg;</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;            puts(USAGE);</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;        }</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    }</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    <span class="comment">/* Check if URL is specified */</span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    <span class="keywordflow">if</span> (pj_optind &lt; argc)</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        app.uri_to_call = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a>(argv[pj_optind]);</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    <span class="comment">/* Build local URI and contact */</span></div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    pj_ansi_sprintf( local_uri, <span class="stringliteral">&quot;sip:%s:%d&quot;</span>, app.local_addr.ptr, app.sip_port);</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    app.local_uri = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a>(local_uri);</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    app.local_contact = app.local_uri;</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    <span class="keywordflow">return</span> <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>;</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;}</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;<span class="comment">/*****************************************************************************</span></div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;<span class="comment"> * MEDIA STUFFS</span></div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;<span class="comment"> * Create SDP session for a call.</span></div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="keyword">static</span> <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> create_sdp( <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__pool__t.htm">pj_pool_t</a> *pool,</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;                               <span class="keyword">struct</span> call *call,</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;                               <a class="code" href="structpjmedia__sdp__session.htm">pjmedia_sdp_session</a> **p_sdp)</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;{</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__time__val.htm">pj_time_val</a> tv;</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    <a class="code" href="structpjmedia__sdp__session.htm">pjmedia_sdp_session</a> *sdp;</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    <a class="code" href="structpjmedia__sdp__media.htm">pjmedia_sdp_media</a> *m;</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    <a class="code" href="structpjmedia__sdp__attr.htm">pjmedia_sdp_attr</a> *attr;</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    <a class="code" href="structpjmedia__transport__info.htm">pjmedia_transport_info</a> tpinfo;</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    <span class="keyword">struct </span><a class="code" href="structmedia__stream.htm">media_stream</a> *audio = &amp;call-&gt;media[0];</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__pj__assert.htm#gac98bea768b573f53432076a387864fb3">PJ_ASSERT_RETURN</a>(pool &amp;&amp; p_sdp, PJ_EINVAL);</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    <span class="comment">/* Get transport info */</span></div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    <a class="code" href="group__PJMEDIA__TRANSPORT.htm#gab293d1afad42d1f49745f3fcd235fa17">pjmedia_transport_info_init</a>(&amp;tpinfo);</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    <a class="code" href="group__PJMEDIA__TRANSPORT.htm#ga213beab16cd5d94437c2890b9f3fe75b">pjmedia_transport_get_info</a>(audio-&gt;transport, &amp;tpinfo);</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    <span class="comment">/* Create and initialize basic SDP session */</span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    sdp = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__POOL.htm#ga405d1dbb6728b1d1bd90ddadb9342b27">PJ_POOL_ZALLOC_T</a>(pool, <a class="code" href="structpjmedia__sdp__session.htm">pjmedia_sdp_session</a>);</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__TIME.htm#ga0806df13f40d3153061f399ed86be856">pj_gettimeofday</a>(&amp;tv);</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    sdp-&gt;<a class="code" href="structpjmedia__sdp__session.htm#a0760046cf7c2f33f2b2ed5bcd040220d">origin</a>.<a class="code" href="structpjmedia__sdp__session.htm#a855131c0a6f792bb2cb4794ad626d601">user</a> = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a>(<span class="stringliteral">&quot;pjsip-siprtp&quot;</span>);</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    sdp-&gt;<a class="code" href="structpjmedia__sdp__session.htm#a0760046cf7c2f33f2b2ed5bcd040220d">origin</a>.<a class="code" href="structpjmedia__sdp__session.htm#a6b8359db35cb0a317854555460009cad">version</a> = sdp-&gt;<a class="code" href="structpjmedia__sdp__session.htm#a0760046cf7c2f33f2b2ed5bcd040220d">origin</a>.<a class="code" href="structpjmedia__sdp__session.htm#a0384de666572cd66f7a281b7db63413c">id</a> = tv.<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__time__val.htm#af2739d0c2189e9c902281c04fd1f4502">sec</a> + 2208988800UL;</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    sdp-&gt;<a class="code" href="structpjmedia__sdp__session.htm#a0760046cf7c2f33f2b2ed5bcd040220d">origin</a>.<a class="code" href="structpjmedia__sdp__session.htm#a48233db45dc84704c95bf6175462d9e4">net_type</a> = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a>(<span class="stringliteral">&quot;IN&quot;</span>);</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    sdp-&gt;<a class="code" href="structpjmedia__sdp__session.htm#a0760046cf7c2f33f2b2ed5bcd040220d">origin</a>.<a class="code" href="structpjmedia__sdp__session.htm#a8668742094b041a4d5821d8dd0248be9">addr_type</a> = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a>(<span class="stringliteral">&quot;IP4&quot;</span>);</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    sdp-&gt;<a class="code" href="structpjmedia__sdp__session.htm#a0760046cf7c2f33f2b2ed5bcd040220d">origin</a>.<a class="code" href="structpjmedia__sdp__session.htm#ac4166d3ae2ffbd679edba7d9e351db29">addr</a> = *<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__SOCK.htm#ga47bc19975b9e88fc86d4bf43ffd2a17f">pj_gethostname</a>();</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    sdp-&gt;<a class="code" href="structpjmedia__sdp__session.htm#a70bb5508d177733dcaeda1e821593ec2">name</a> = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a>(<span class="stringliteral">&quot;pjsip&quot;</span>);</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    <span class="comment">/* Since we only support one media stream at present, put the</span></div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;<span class="comment">     * SDP connection line in the session level.</span></div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    sdp-&gt;<a class="code" href="structpjmedia__sdp__session.htm#a30c79db08d5d22d2fce2179717a7cfeb">conn</a> = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__POOL.htm#ga405d1dbb6728b1d1bd90ddadb9342b27">PJ_POOL_ZALLOC_T</a>(pool, <a class="code" href="structpjmedia__sdp__conn.htm">pjmedia_sdp_conn</a>);</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    sdp-&gt;<a class="code" href="structpjmedia__sdp__session.htm#a30c79db08d5d22d2fce2179717a7cfeb">conn</a>-&gt;<a class="code" href="structpjmedia__sdp__conn.htm#a8ed74cf5284dc14a5ab06bd09f204856">net_type</a> = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a>(<span class="stringliteral">&quot;IN&quot;</span>);</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    sdp-&gt;<a class="code" href="structpjmedia__sdp__session.htm#a30c79db08d5d22d2fce2179717a7cfeb">conn</a>-&gt;<a class="code" href="structpjmedia__sdp__conn.htm#aec4591c8dff072399537e741745b65b2">addr_type</a> = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a>(<span class="stringliteral">&quot;IP4&quot;</span>);</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    sdp-&gt;<a class="code" href="structpjmedia__sdp__session.htm#a30c79db08d5d22d2fce2179717a7cfeb">conn</a>-&gt;<a class="code" href="structpjmedia__sdp__conn.htm#ae603b165ba204743ab9b9fb5d22f1537">addr</a> = app.local_addr;</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    <span class="comment">/* SDP time and attributes. */</span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    sdp-&gt;<a class="code" href="structpjmedia__sdp__session.htm#a705e23a332b3647491b19e7bea893aea">time</a>.<a class="code" href="structpjmedia__sdp__session.htm#a6200bd90a6be57ec36aac452c45872c7">start</a> = sdp-&gt;<a class="code" href="structpjmedia__sdp__session.htm#a705e23a332b3647491b19e7bea893aea">time</a>.<a class="code" href="structpjmedia__sdp__session.htm#ae3b829717aa39e76d04e5f5e61284d1d">stop</a> = 0;</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    sdp-&gt;<a class="code" href="structpjmedia__sdp__session.htm#a0a8af45154f3f04823f1ff0ccc13bc54">attr_count</a> = 0;</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    <span class="comment">/* Create media stream 0: */</span></div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    sdp-&gt;<a class="code" href="structpjmedia__sdp__session.htm#ac39a49696a42f536ee2904aadcefb7d6">media_count</a> = 1;</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    m = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__POOL.htm#ga405d1dbb6728b1d1bd90ddadb9342b27">PJ_POOL_ZALLOC_T</a>(pool, <a class="code" href="structpjmedia__sdp__media.htm">pjmedia_sdp_media</a>);</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    sdp-&gt;<a class="code" href="structpjmedia__sdp__session.htm#ab10d483a2db7a29491a4cbf2ea08b56c">media</a>[0] = m;</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    <span class="comment">/* Standard media info: */</span></div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    m-&gt;<a class="code" href="structpjmedia__sdp__media.htm#ae891d90d8d33f1e44ffa26af62912f39">desc</a>.<a class="code" href="structpjmedia__sdp__media.htm#a0804e7ebf233f4e2950080927cbba57a">media</a> = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a>(<span class="stringliteral">&quot;audio&quot;</span>);</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    m-&gt;<a class="code" href="structpjmedia__sdp__media.htm#ae891d90d8d33f1e44ffa26af62912f39">desc</a>.<a class="code" href="structpjmedia__sdp__media.htm#ad468b2e8ec3371cc6c877d9dfde892b1">port</a> = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__SOCK.htm#ga879824dfc39cf8897aa2607e086ec013">pj_ntohs</a>(tpinfo.<a class="code" href="structpjmedia__transport__info.htm#a0d8a2639d0a981e9e025d71e200160cb">sock_info</a>.<a class="code" href="structpjmedia__sock__info.htm#aa2cecdb5ff13922865a33d49f3ccd0c8">rtp_addr_name</a>.<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/unionpj__sockaddr.htm#ab25ec448ae63acfdd2aa0f3ef2fd10b8">ipv4</a>.<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__sockaddr__in.htm#a0e60b93d03fa052211bb6131e64bdda1">sin_port</a>);</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    m-&gt;<a class="code" href="structpjmedia__sdp__media.htm#ae891d90d8d33f1e44ffa26af62912f39">desc</a>.<a class="code" href="structpjmedia__sdp__media.htm#a90a90fed8df5a0e1bfc7bc291421d812">port_count</a> = 1;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    m-&gt;<a class="code" href="structpjmedia__sdp__media.htm#ae891d90d8d33f1e44ffa26af62912f39">desc</a>.<a class="code" href="structpjmedia__sdp__media.htm#a260ceac6d572983b31b484c3697a575d">transport</a> = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a>(<span class="stringliteral">&quot;RTP/AVP&quot;</span>);</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;    <span class="comment">/* Add format and rtpmap for each codec. */</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    m-&gt;<a class="code" href="structpjmedia__sdp__media.htm#ae891d90d8d33f1e44ffa26af62912f39">desc</a>.<a class="code" href="structpjmedia__sdp__media.htm#a8834dacf968d51c3998a32ef4f30310f">fmt_count</a> = 1;</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;    m-&gt;<a class="code" href="structpjmedia__sdp__media.htm#a6801faf5ebb9919f1cb12842d5e4bc76">attr_count</a> = 0;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    {</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;        <a class="code" href="structpjmedia__sdp__rtpmap.htm">pjmedia_sdp_rtpmap</a> rtpmap;</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;        <span class="keywordtype">char</span> ptstr[10];</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;        sprintf(ptstr, <span class="stringliteral">&quot;%d&quot;</span>, app.audio_codec.pt);</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga96cdcaa39650b7f36fd850f53f4ebebf">pj_strdup2</a>(pool, &amp;m-&gt;<a class="code" href="structpjmedia__sdp__media.htm#ae891d90d8d33f1e44ffa26af62912f39">desc</a>.<a class="code" href="structpjmedia__sdp__media.htm#a9b9aeefe5e698a3d9c29069775bcc4f4">fmt</a>[0], ptstr);</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;        rtpmap.<a class="code" href="structpjmedia__sdp__rtpmap.htm#aa5ac5e66a6dcdbb9d9a16f4d6f7852c9">pt</a> = m-&gt;<a class="code" href="structpjmedia__sdp__media.htm#ae891d90d8d33f1e44ffa26af62912f39">desc</a>.<a class="code" href="structpjmedia__sdp__media.htm#a9b9aeefe5e698a3d9c29069775bcc4f4">fmt</a>[0];</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;        rtpmap.<a class="code" href="structpjmedia__sdp__rtpmap.htm#ae9d5c258976b6fbb4ef4b6793aba882c">clock_rate</a> = app.audio_codec.clock_rate;</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;        rtpmap.<a class="code" href="structpjmedia__sdp__rtpmap.htm#a569ae42e875e740d8ab5c3cdf50a6dd1">enc_name</a> = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a>(app.audio_codec.name);</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;        rtpmap.<a class="code" href="structpjmedia__sdp__rtpmap.htm#a572ff3d848f2588aeb45434bc48afd2b">param</a>.<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__str__t.htm#a46788480bdb4080083dcc8965811e015">slen</a> = 0;</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;        <a class="code" href="group__PJMEDIA__SDP.htm#ga35e2836c8694c99c0a8f5acf46a0afe8">pjmedia_sdp_rtpmap_to_attr</a>(pool, &amp;rtpmap, &amp;attr);</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;        m-&gt;<a class="code" href="structpjmedia__sdp__media.htm#a8b201f0cfeab12e32b581b335263e3b7">attr</a>[m-&gt;<a class="code" href="structpjmedia__sdp__media.htm#a6801faf5ebb9919f1cb12842d5e4bc76">attr_count</a>++] = attr;</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    }</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    <span class="comment">/* Add sendrecv attribute. */</span></div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    attr = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__POOL.htm#ga405d1dbb6728b1d1bd90ddadb9342b27">PJ_POOL_ZALLOC_T</a>(pool, <a class="code" href="structpjmedia__sdp__attr.htm">pjmedia_sdp_attr</a>);</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    attr-&gt;<a class="code" href="structpjmedia__sdp__attr.htm#ad9275c5178fcaccaace34c73315a2754">name</a> = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a>(<span class="stringliteral">&quot;sendrecv&quot;</span>);</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    m-&gt;<a class="code" href="structpjmedia__sdp__media.htm#a8b201f0cfeab12e32b581b335263e3b7">attr</a>[m-&gt;<a class="code" href="structpjmedia__sdp__media.htm#a6801faf5ebb9919f1cb12842d5e4bc76">attr_count</a>++] = attr;</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="preprocessor">#if 1</span></div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;<span class="comment">     * Add support telephony event</span></div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    m-&gt;<a class="code" href="structpjmedia__sdp__media.htm#ae891d90d8d33f1e44ffa26af62912f39">desc</a>.<a class="code" href="structpjmedia__sdp__media.htm#a9b9aeefe5e698a3d9c29069775bcc4f4">fmt</a>[m-&gt;<a class="code" href="structpjmedia__sdp__media.htm#ae891d90d8d33f1e44ffa26af62912f39">desc</a>.<a class="code" href="structpjmedia__sdp__media.htm#a8834dacf968d51c3998a32ef4f30310f">fmt_count</a>++] = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a>(<span class="stringliteral">&quot;121&quot;</span>);</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    <span class="comment">/* Add rtpmap. */</span></div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    attr = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__POOL.htm#ga405d1dbb6728b1d1bd90ddadb9342b27">PJ_POOL_ZALLOC_T</a>(pool, <a class="code" href="structpjmedia__sdp__attr.htm">pjmedia_sdp_attr</a>);</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    attr-&gt;<a class="code" href="structpjmedia__sdp__attr.htm#ad9275c5178fcaccaace34c73315a2754">name</a> = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a>(<span class="stringliteral">&quot;rtpmap&quot;</span>);</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;    attr-&gt;<a class="code" href="structpjmedia__sdp__attr.htm#a6ba49c6fc9556fe39cb39337a13bcb19">value</a> = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a>(<span class="stringliteral">&quot;121 telephone-event/8000&quot;</span>);</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    m-&gt;<a class="code" href="structpjmedia__sdp__media.htm#a8b201f0cfeab12e32b581b335263e3b7">attr</a>[m-&gt;<a class="code" href="structpjmedia__sdp__media.htm#a6801faf5ebb9919f1cb12842d5e4bc76">attr_count</a>++] = attr;</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    <span class="comment">/* Add fmtp */</span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    attr = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__POOL.htm#ga405d1dbb6728b1d1bd90ddadb9342b27">PJ_POOL_ZALLOC_T</a>(pool, <a class="code" href="structpjmedia__sdp__attr.htm">pjmedia_sdp_attr</a>);</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    attr-&gt;<a class="code" href="structpjmedia__sdp__attr.htm#ad9275c5178fcaccaace34c73315a2754">name</a> = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a>(<span class="stringliteral">&quot;fmtp&quot;</span>);</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    attr-&gt;<a class="code" href="structpjmedia__sdp__attr.htm#a6ba49c6fc9556fe39cb39337a13bcb19">value</a> = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a>(<span class="stringliteral">&quot;121 0-15&quot;</span>);</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    m-&gt;<a class="code" href="structpjmedia__sdp__media.htm#a8b201f0cfeab12e32b581b335263e3b7">attr</a>[m-&gt;<a class="code" href="structpjmedia__sdp__media.htm#a6801faf5ebb9919f1cb12842d5e4bc76">attr_count</a>++] = attr;</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    <span class="comment">/* Done */</span></div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    *p_sdp = sdp;</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    <span class="keywordflow">return</span> <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>;</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;}</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;<span class="preprocessor">#if (defined(PJ_WIN32) &amp;&amp; PJ_WIN32 != 0) || (defined(PJ_WIN64) &amp;&amp; PJ_WIN64 != 0)</span></div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;<span class="preprocessor">#include &lt;windows.h&gt;</span></div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> boost_priority(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;{</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;    SetPriorityClass( GetCurrentProcess(), REALTIME_PRIORITY_CLASS);</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;    SetThreadPriority(GetCurrentThread(), THREAD_PRIORITY_HIGHEST);</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;}</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;<span class="preprocessor">#elif defined(PJ_LINUX) &amp;&amp; PJ_LINUX != 0</span></div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;<span class="preprocessor">#include &lt;pthread.h&gt;</span></div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> boost_priority(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;{</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;<span class="preprocessor">#define POLICY  SCHED_FIFO</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    <span class="keyword">struct </span>sched_param tp;</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    <span class="keywordtype">int</span> max_prio;</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    <span class="keywordtype">int</span> policy;</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    <span class="keywordtype">int</span> rc;</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    <span class="keywordflow">if</span> (sched_get_priority_min(POLICY) &lt; sched_get_priority_max(POLICY))</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;        max_prio = sched_get_priority_max(POLICY)-1;</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;        max_prio = sched_get_priority_max(POLICY)+1;</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;<span class="comment">     * Adjust process scheduling algorithm and priority</span></div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    rc = sched_getparam(0, &amp;tp);</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    <span class="keywordflow">if</span> (rc != 0) {</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;        app_perror( THIS_FILE, <span class="stringliteral">&quot;sched_getparam error&quot;</span>,</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;                    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__pj__errno.htm#gacc85d9323301650f961ae38e689fefcd">PJ_RETURN_OS_ERROR</a>(rc));</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    }</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;    tp.sched_priority = max_prio;</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    rc = sched_setscheduler(0, POLICY, &amp;tp);</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;    <span class="keywordflow">if</span> (rc != 0) {</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;        app_perror( THIS_FILE, <span class="stringliteral">&quot;sched_setscheduler error&quot;</span>,</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;                    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__pj__errno.htm#gacc85d9323301650f961ae38e689fefcd">PJ_RETURN_OS_ERROR</a>(rc));</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    }</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(4, (THIS_FILE, <span class="stringliteral">&quot;New process policy=%d, priority=%d&quot;</span>,</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;              policy, tp.sched_priority));</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;<span class="comment">     * Adjust thread scheduling algorithm and priority</span></div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;    rc = pthread_getschedparam(pthread_self(), &amp;policy, &amp;tp);</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    <span class="keywordflow">if</span> (rc != 0) {</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;        app_perror( THIS_FILE, <span class="stringliteral">&quot;pthread_getschedparam error&quot;</span>,</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;                    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__pj__errno.htm#gacc85d9323301650f961ae38e689fefcd">PJ_RETURN_OS_ERROR</a>(rc));</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    }</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(4, (THIS_FILE, <span class="stringliteral">&quot;Old thread policy=%d, priority=%d&quot;</span>,</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;              policy, tp.sched_priority));</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;    policy = POLICY;</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    tp.sched_priority = max_prio;</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    rc = pthread_setschedparam(pthread_self(), policy, &amp;tp);</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    <span class="keywordflow">if</span> (rc != 0) {</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;        app_perror( THIS_FILE, <span class="stringliteral">&quot;pthread_setschedparam error&quot;</span>,</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;                    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__pj__errno.htm#gacc85d9323301650f961ae38e689fefcd">PJ_RETURN_OS_ERROR</a>(rc));</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    }</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(4, (THIS_FILE, <span class="stringliteral">&quot;New thread policy=%d, priority=%d&quot;</span>,</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;              policy, tp.sched_priority));</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;}</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;<span class="preprocessor">#  define boost_priority()</span></div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;<span class="comment"> * This callback is called by media transport on receipt of RTP packet.</span></div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> on_rx_rtp(<span class="keywordtype">void</span> *<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__IOQUEUE.htm#gab06c131ab29b37c027f2400bd5be6045">user_data</a>, <span class="keywordtype">void</span> *pkt, <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga173588cd6381f3ad354c23c26929093a">pj_ssize_t</a> size)</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;{</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    <span class="keyword">struct </span><a class="code" href="structmedia__stream.htm">media_stream</a> *strm;</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> status;</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    <span class="keyword">const</span> <a class="code" href="structpjmedia__rtp__hdr.htm">pjmedia_rtp_hdr</a> *hdr;</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">void</span> *payload;</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;    <span class="keywordtype">unsigned</span> payload_len;</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    strm = (<span class="keyword">struct </span><a class="code" href="structmedia__stream.htm">media_stream</a> *)user_data;</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;    <span class="comment">/* Discard packet if media is inactive */</span></div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    <span class="keywordflow">if</span> (!strm-&gt;active)</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    <span class="comment">/* Check for errors */</span></div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    <span class="keywordflow">if</span> (size &lt; 0) {</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;        app_perror(THIS_FILE, <span class="stringliteral">&quot;RTP recv() error&quot;</span>, (<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a>)-size);</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    }</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;    <span class="comment">/* Decode RTP packet. */</span></div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;    status = <a class="code" href="group__PJMED__RTP.htm#gaaa82e024f28c4796159d3d9bbe9c93ec">pjmedia_rtp_decode_rtp</a>(&amp;strm-&gt;in_sess, </div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;                                    pkt, (<span class="keywordtype">int</span>)size, </div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;                                    &amp;hdr, &amp;payload, &amp;payload_len);</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    <span class="keywordflow">if</span> (status != <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;        app_perror(THIS_FILE, <span class="stringliteral">&quot;RTP decode error&quot;</span>, status);</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    }</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    <span class="comment">//PJ_LOG(4,(THIS_FILE, &quot;Rx seq=%d&quot;, pj_ntohs(hdr-&gt;seq)));</span></div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;    <span class="comment">/* Update the RTCP session. */</span></div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    <a class="code" href="group__PJMED__RTCP.htm#ga7ce9e4e76674dba050c01cd295964bde">pjmedia_rtcp_rx_rtp</a>(&amp;strm-&gt;rtcp, <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__SOCK.htm#ga879824dfc39cf8897aa2607e086ec013">pj_ntohs</a>(hdr-&gt;<a class="code" href="structpjmedia__rtp__hdr.htm#ac7031a2645fb6986552be171fe3742be">seq</a>),</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;                        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__SOCK.htm#ga55c6836b3f858528c4a3855deb12154e">pj_ntohl</a>(hdr-&gt;<a class="code" href="structpjmedia__rtp__hdr.htm#a4afb857e88d1bf0c2dd4d457c215a837">ts</a>), payload_len);</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    <span class="comment">/* Update RTP session */</span></div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    <a class="code" href="group__PJMED__RTP.htm#ga9d9b33a67b04a25c38d625131809247f">pjmedia_rtp_session_update</a>(&amp;strm-&gt;in_sess, hdr, NULL);</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;}</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;<span class="comment"> * This callback is called by media transport on receipt of RTCP packet.</span></div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> on_rx_rtcp(<span class="keywordtype">void</span> *user_data, <span class="keywordtype">void</span> *pkt, <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga173588cd6381f3ad354c23c26929093a">pj_ssize_t</a> size)</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;{</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    <span class="keyword">struct </span><a class="code" href="structmedia__stream.htm">media_stream</a> *strm;</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;    strm = (<span class="keyword">struct </span><a class="code" href="structmedia__stream.htm">media_stream</a> *)user_data;</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;    <span class="comment">/* Discard packet if media is inactive */</span></div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;    <span class="keywordflow">if</span> (!strm-&gt;active)</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;    <span class="comment">/* Check for errors */</span></div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    <span class="keywordflow">if</span> (size &lt; 0) {</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;        app_perror(THIS_FILE, <span class="stringliteral">&quot;Error receiving RTCP packet&quot;</span>,(<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a>)-size);</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;    }</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;    <span class="comment">/* Update RTCP session */</span></div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    <a class="code" href="group__PJMED__RTCP.htm#ga42ed1b0fc1e7bd65aea78e67e8415dca">pjmedia_rtcp_rx_rtcp</a>(&amp;strm-&gt;rtcp, pkt, size);</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;}</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;<span class="comment">/* </span></div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;<span class="comment"> * Media thread </span></div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;<span class="comment"> * This is the thread to send and receive both RTP and RTCP packets.</span></div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> media_thread(<span class="keywordtype">void</span> *arg)</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;{</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    <span class="keyword">enum</span> { RTCP_INTERVAL = 5000, RTCP_RAND = 2000 };</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    <span class="keyword">struct </span><a class="code" href="structmedia__stream.htm">media_stream</a> *strm = (<span class="keyword">struct </span><a class="code" href="structmedia__stream.htm">media_stream</a> *)arg;</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;    <span class="keywordtype">char</span> packet[1500];</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;    <span class="keywordtype">unsigned</span> msec_interval;</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/unionpj__timestamp.htm">pj_timestamp</a> freq, next_rtp, next_rtcp;</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    <span class="comment">/* Boost thread priority if necessary */</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    boost_priority();</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    <span class="comment">/* Let things settle */</span></div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__THREAD.htm#gad59cd6fd7390711758afcc0bde375d68">pj_thread_sleep</a>(100);</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;    msec_interval = strm-&gt;samples_per_frame * 1000 / strm-&gt;clock_rate;</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__TIMESTAMP.htm#ga08e3e11a5e8f68f3111e5ecf3bff0ac1">pj_get_timestamp_freq</a>(&amp;freq);</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__TIMESTAMP.htm#gaa419b8448d1cb55db85aeac2e86fe11c">pj_get_timestamp</a>(&amp;next_rtp);</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;    next_rtp.u64 += (freq.u64 * msec_interval / 1000);</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;    next_rtcp = next_rtp;</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    next_rtcp.u64 += (freq.u64 * (RTCP_INTERVAL+(<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__RAND.htm#ga654f8cb013a1312b87000df1a1d03398">pj_rand</a>()%RTCP_RAND)) / 1000);</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    <span class="keywordflow">while</span> (!strm-&gt;thread_quit_flag) {</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/unionpj__timestamp.htm">pj_timestamp</a> now, lesser;</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__time__val.htm">pj_time_val</a> timeout;</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga1dc7a356fb36bd2dee2bc7d6c7e817e4">pj_bool_t</a> send_rtp, send_rtcp;</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;        send_rtp = send_rtcp = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead95511b40a74f4625b161dd9e42c6e6e">PJ_FALSE</a>;</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;        <span class="comment">/* Determine how long to sleep */</span></div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;        <span class="keywordflow">if</span> (next_rtp.u64 &lt; next_rtcp.u64) {</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;            lesser = next_rtp;</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;            send_rtp = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead235b21a623d982cc561fb12bffa87c0">PJ_TRUE</a>;</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;            lesser = next_rtcp;</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;            send_rtcp = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead235b21a623d982cc561fb12bffa87c0">PJ_TRUE</a>;</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;        }</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__TIMESTAMP.htm#gaa419b8448d1cb55db85aeac2e86fe11c">pj_get_timestamp</a>(&amp;now);</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;        <span class="keywordflow">if</span> (lesser.u64 &lt;= now.u64) {</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;            timeout.<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__time__val.htm#af2739d0c2189e9c902281c04fd1f4502">sec</a> = timeout.<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__time__val.htm#ab9cc04663b258dd3dcb449a3110e0d82">msec</a> = 0;</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;            <span class="comment">//printf(&quot;immediate &quot;); fflush(stdout);</span></div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;            pj_uint64_t tick_delay;</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;            tick_delay = lesser.u64 - now.u64;</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;            timeout.<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__time__val.htm#af2739d0c2189e9c902281c04fd1f4502">sec</a> = 0;</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;            timeout.<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__time__val.htm#ab9cc04663b258dd3dcb449a3110e0d82">msec</a> = (<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gafbfd2fd08c6041ea3cb217310c0b5b48">pj_uint32_t</a>)(tick_delay * 1000 / freq.u64);</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;            <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__TIME.htm#ga0b28411e03320ad6bb5f3316125b461c">pj_time_val_normalize</a>(&amp;timeout);</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;            <span class="comment">//printf(&quot;%d:%03d &quot;, timeout.sec, timeout.msec); fflush(stdout);</span></div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;        }</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;        <span class="comment">/* Wait for next interval */</span></div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;        <span class="comment">//if (timeout.sec!=0 &amp;&amp; timeout.msec!=0) {</span></div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;            <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__THREAD.htm#gad59cd6fd7390711758afcc0bde375d68">pj_thread_sleep</a>(<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__TIME.htm#gad015d440803cb8f62ff73878f35badaa">PJ_TIME_VAL_MSEC</a>(timeout));</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;            <span class="keywordflow">if</span> (strm-&gt;thread_quit_flag)</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;        <span class="comment">//}</span></div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__TIMESTAMP.htm#gaa419b8448d1cb55db85aeac2e86fe11c">pj_get_timestamp</a>(&amp;now);</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;        <span class="keywordflow">if</span> (send_rtp || next_rtp.u64 &lt;= now.u64) {</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;            <span class="comment">/*</span></div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;<span class="comment">             * Time to send RTP packet.</span></div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;            <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> status;</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">void</span> *p_hdr;</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;            <span class="keyword">const</span> <a class="code" href="structpjmedia__rtp__hdr.htm">pjmedia_rtp_hdr</a> *hdr;</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;            <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga173588cd6381f3ad354c23c26929093a">pj_ssize_t</a> size;</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;            <span class="keywordtype">int</span> hdrlen;</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;            <span class="comment">/* Format RTP header */</span></div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;            status = <a class="code" href="group__PJMED__RTP.htm#ga7052667cdb593ec24c95b98a46227ce2">pjmedia_rtp_encode_rtp</a>( &amp;strm-&gt;out_sess, strm-&gt;si.<a class="code" href="structpjmedia__stream__info.htm#a6390c7f49d9af342d947ea1f6d3cc118">tx_pt</a>,</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;                                             0, <span class="comment">/* marker bit */</span></div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;                                             strm-&gt;bytes_per_frame, </div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;                                             strm-&gt;samples_per_frame,</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;                                             &amp;p_hdr, &amp;hdrlen);</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;            <span class="keywordflow">if</span> (status == <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;                <span class="comment">//PJ_LOG(4,(THIS_FILE, &quot;\t\tTx seq=%d&quot;, pj_ntohs(hdr-&gt;seq)));</span></div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;                </div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;                hdr = (<span class="keyword">const</span> <a class="code" href="structpjmedia__rtp__hdr.htm">pjmedia_rtp_hdr</a>*) p_hdr;</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;                <span class="comment">/* Copy RTP header to packet */</span></div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;                <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga38d0ee03a9c582c627d44bfcb35fb6a8">pj_memcpy</a>(packet, hdr, hdrlen);</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;                <span class="comment">/* Zero the payload */</span></div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;                <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#gafa92001573289c87313c660146369fa3">pj_bzero</a>(packet+hdrlen, strm-&gt;bytes_per_frame);</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;                <span class="comment">/* Send RTP packet */</span></div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;                size = hdrlen + strm-&gt;bytes_per_frame;</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;                status = <a class="code" href="group__PJMEDIA__TRANSPORT.htm#ga79db5c82268501ec3bf7c1897c0b3626">pjmedia_transport_send_rtp</a>(strm-&gt;transport, </div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;                                                    packet, size);</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;                <span class="keywordflow">if</span> (status != <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>)</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;                    app_perror(THIS_FILE, <span class="stringliteral">&quot;Error sending RTP packet&quot;</span>, status);</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;                <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__pj__assert.htm#ga981d47a5e9d7e9655473244839f0f5d3">pj_assert</a>(!<span class="stringliteral">&quot;RTP encode() error&quot;</span>);</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;            }</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;            <span class="comment">/* Update RTCP SR */</span></div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;            <a class="code" href="group__PJMED__RTCP.htm#gaa0927538050a3cde5a51f32cb586f7d0">pjmedia_rtcp_tx_rtp</a>( &amp;strm-&gt;rtcp, (<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga47506d8dde1056c5c96d62f0df6ddf28">pj_uint16_t</a>)strm-&gt;bytes_per_frame);</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;            <span class="comment">/* Schedule next send */</span></div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;            next_rtp.u64 += (msec_interval * freq.u64 / 1000);</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;        }</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;        <span class="keywordflow">if</span> (send_rtcp || next_rtcp.u64 &lt;= now.u64) {</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;            <span class="comment">/*</span></div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;<span class="comment">             * Time to send RTCP packet.</span></div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;            <span class="keywordtype">void</span> *rtcp_pkt;</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;            <span class="keywordtype">int</span> rtcp_len;</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;            <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga173588cd6381f3ad354c23c26929093a">pj_ssize_t</a> size;</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;            <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> status;</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;            <span class="comment">/* Build RTCP packet */</span></div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;            <a class="code" href="group__PJMED__RTCP.htm#ga8f2568957839ac3ecd8be01d2bc2c148">pjmedia_rtcp_build_rtcp</a>(&amp;strm-&gt;rtcp, &amp;rtcp_pkt, &amp;rtcp_len);</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;    </div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;            <span class="comment">/* Send packet */</span></div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;            size = rtcp_len;</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;            status = <a class="code" href="group__PJMEDIA__TRANSPORT.htm#ga5fe97ac16287563420950a8b87d247b4">pjmedia_transport_send_rtcp</a>(strm-&gt;transport,</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;                                                 rtcp_pkt, size);</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;            <span class="keywordflow">if</span> (status != <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;                app_perror(THIS_FILE, <span class="stringliteral">&quot;Error sending RTCP packet&quot;</span>, status);</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;            }</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;            </div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;            <span class="comment">/* Schedule next send */</span></div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;            next_rtcp.u64 += (freq.u64 * (RTCP_INTERVAL+(<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__RAND.htm#ga654f8cb013a1312b87000df1a1d03398">pj_rand</a>()%RTCP_RAND)) /</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;                              1000);</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;        }</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    }</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;}</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;<span class="comment">/* Callback to be called when SDP negotiation is done in the call: */</span></div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> call_on_media_update( pjsip_inv_session *inv,</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;                                  <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> status)</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;{</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    <span class="keyword">struct </span>call *call;</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    <span class="keyword">struct </span><a class="code" href="structmedia__stream.htm">media_stream</a> *audio;</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    <span class="keyword">const</span> <a class="code" href="structpjmedia__sdp__session.htm">pjmedia_sdp_session</a> *local_sdp, *remote_sdp;</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    <span class="keyword">struct </span><a class="code" href="structcodec.htm">codec</a> *codec_desc = NULL;</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    <span class="keywordtype">unsigned</span> i;</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;    call = (<span class="keyword">struct </span>call *)inv-&gt;mod_data[mod_siprtp.id];</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;    audio = &amp;call-&gt;media[0];</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;    <span class="comment">/* If this is a mid-call media update, then destroy existing media */</span></div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;    if (audio-&gt;thread != NULL)</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;        destroy_call_media(call-&gt;index);</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    <span class="comment">/* Do nothing if media negotiation has failed */</span></div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    <span class="keywordflow">if</span> (status != <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;        app_perror(THIS_FILE, <span class="stringliteral">&quot;SDP negotiation failed&quot;</span>, status);</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;    }</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;    </div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    <span class="comment">/* Capture stream definition from the SDP */</span></div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    <a class="code" href="group__PJMEDIA__SDP__NEG.htm#gaa5fc5d38e7f2d9284ad352f251beecb3">pjmedia_sdp_neg_get_active_local</a>(inv-&gt;neg, &amp;local_sdp);</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;    <a class="code" href="group__PJMEDIA__SDP__NEG.htm#gab0ad3a803c7b2bf4ac840126619ff8ed">pjmedia_sdp_neg_get_active_remote</a>(inv-&gt;neg, &amp;remote_sdp);</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;    status = <a class="code" href="group__PJMEDIA__SESSION.htm#gae0400f365c07b6f141f202defe92f2a6">pjmedia_stream_info_from_sdp</a>(&amp;audio-&gt;si, inv-&gt;pool, app.med_endpt,</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;                                          local_sdp, remote_sdp, 0);</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;    <span class="keywordflow">if</span> (status != <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;        app_perror(THIS_FILE, <span class="stringliteral">&quot;Error creating stream info from SDP&quot;</span>, status);</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;    }</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;    <span class="comment">/* Get the remainder of codec information from codec descriptor */</span></div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;    <span class="keywordflow">if</span> (audio-&gt;si.<a class="code" href="structpjmedia__stream__info.htm#ad93e00b509242b950568d9430e639b1e">fmt</a>.<a class="code" href="structpjmedia__codec__info.htm#a3e3ae875043c693a1453b2a8d398f35a">pt</a> == app.audio_codec.pt)</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;        codec_desc = &amp;app.audio_codec;</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;        <span class="comment">/* Find the codec description in codec array */</span></div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;        <span class="keywordflow">for</span> (i=0; i&lt;<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gacd8459212a1e5175eeb04e3a6cd76659">PJ_ARRAY_SIZE</a>(audio_codecs); ++i) {</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;            <span class="keywordflow">if</span> (audio_codecs[i].pt == audio-&gt;si.<a class="code" href="structpjmedia__stream__info.htm#ad93e00b509242b950568d9430e639b1e">fmt</a>.<a class="code" href="structpjmedia__codec__info.htm#a3e3ae875043c693a1453b2a8d398f35a">pt</a>) {</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;                codec_desc = &amp;audio_codecs[i];</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;            }</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;        }</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;        <span class="keywordflow">if</span> (codec_desc == NULL) {</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;            <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(3, (THIS_FILE, <span class="stringliteral">&quot;Error: Invalid codec payload type&quot;</span>));</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;        }</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;    }</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    audio-&gt;clock_rate = audio-&gt;si.<a class="code" href="structpjmedia__stream__info.htm#ad93e00b509242b950568d9430e639b1e">fmt</a>.<a class="code" href="structpjmedia__codec__info.htm#a77f4c6139109ad8a15ed69444a258277">clock_rate</a>;</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;    audio-&gt;samples_per_frame = audio-&gt;clock_rate * codec_desc-&gt;ptime / 1000;</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    audio-&gt;bytes_per_frame = codec_desc-&gt;bit_rate * codec_desc-&gt;ptime / 1000 / 8;</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    <a class="code" href="group__PJMED__RTP.htm#gac5fc46bc1de6eb2620c2a28d20578c77">pjmedia_rtp_session_init</a>(&amp;audio-&gt;out_sess, audio-&gt;si.<a class="code" href="structpjmedia__stream__info.htm#a6390c7f49d9af342d947ea1f6d3cc118">tx_pt</a>, </div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;                             <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__RAND.htm#ga654f8cb013a1312b87000df1a1d03398">pj_rand</a>());</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;    <a class="code" href="group__PJMED__RTP.htm#gac5fc46bc1de6eb2620c2a28d20578c77">pjmedia_rtp_session_init</a>(&amp;audio-&gt;in_sess, audio-&gt;si.<a class="code" href="structpjmedia__stream__info.htm#ad93e00b509242b950568d9430e639b1e">fmt</a>.<a class="code" href="structpjmedia__codec__info.htm#a3e3ae875043c693a1453b2a8d398f35a">pt</a>, 0);</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;    <a class="code" href="group__PJMED__RTCP.htm#gacb5133d8da883347f3d87ec0b161dfb1">pjmedia_rtcp_init</a>(&amp;audio-&gt;rtcp, <span class="stringliteral">&quot;rtcp&quot;</span>, audio-&gt;clock_rate, </div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;                      audio-&gt;samples_per_frame, 0);</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    <span class="comment">/* Attach media to transport */</span></div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    status = <a class="code" href="group__PJMEDIA__TRANSPORT.htm#ga33a9285c010f2527e647f0b5871f881e">pjmedia_transport_attach</a>(audio-&gt;transport, audio, </div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;                                      &amp;audio-&gt;si.<a class="code" href="structpjmedia__stream__info.htm#a51935172b090b66042175846c0e96213">rem_addr</a>, </div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;                                      &amp;audio-&gt;si.<a class="code" href="structpjmedia__stream__info.htm#af9715928854d6cf2b9710856836acd36">rem_rtcp</a>, </div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;                                      <span class="keyword">sizeof</span>(<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__sockaddr__in.htm">pj_sockaddr_in</a>),</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;                                      &amp;on_rx_rtp,</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;                                      &amp;on_rx_rtcp);</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;    <span class="keywordflow">if</span> (status != <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;        app_perror(THIS_FILE, <span class="stringliteral">&quot;Error on pjmedia_transport_attach()&quot;</span>, status);</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    }</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;    <span class="comment">/* Start media transport */</span></div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    <a class="code" href="group__PJMEDIA__TRANSPORT.htm#ga74ab1c1b9b09d75865a231519bb58aa7">pjmedia_transport_media_start</a>(audio-&gt;transport, 0, 0, 0, 0);</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;    <span class="comment">/* Start media thread. */</span></div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;    audio-&gt;thread_quit_flag = 0;</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;<span class="preprocessor">#if PJ_HAS_THREADS</span></div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;    status = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__THREAD.htm#ga7b63533cf4f3ba0cba68cab49a22d722">pj_thread_create</a>( inv-&gt;pool, <span class="stringliteral">&quot;media&quot;</span>, &amp;media_thread, audio,</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;                               0, 0, &amp;audio-&gt;thread);</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;    <span class="keywordflow">if</span> (status != <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;        app_perror(THIS_FILE, <span class="stringliteral">&quot;Error creating media thread&quot;</span>, status);</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;    }</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;    <span class="comment">/* Set the media as active */</span></div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;    audio-&gt;active = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead235b21a623d982cc561fb12bffa87c0">PJ_TRUE</a>;</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;}</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;<span class="comment">/* Destroy call&#39;s media */</span></div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> destroy_call_media(<span class="keywordtype">unsigned</span> call_index)</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;{</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;    <span class="keyword">struct </span><a class="code" href="structmedia__stream.htm">media_stream</a> *audio = &amp;app.call[call_index].media[0];</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    <span class="keywordflow">if</span> (audio) {</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;        audio-&gt;active = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead95511b40a74f4625b161dd9e42c6e6e">PJ_FALSE</a>;</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;        <span class="keywordflow">if</span> (audio-&gt;thread) {</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;            audio-&gt;thread_quit_flag = 1;</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;            <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__THREAD.htm#ga60d90ce08d2f7e92dcaa0443cf87912f">pj_thread_join</a>(audio-&gt;thread);</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;            <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__THREAD.htm#ga5435f79ad044f9ce2113af311bf2b777">pj_thread_destroy</a>(audio-&gt;thread);</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;            audio-&gt;thread = NULL;</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;            audio-&gt;thread_quit_flag = 0;</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;        }</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;        <a class="code" href="group__PJMEDIA__TRANSPORT.htm#gad0b1f17d5920dd05b3832886b68d9c24">pjmedia_transport_detach</a>(audio-&gt;transport, audio);</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;    }</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;}</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160; </div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;<span class="comment">/*****************************************************************************</span></div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;<span class="comment"> * USER INTERFACE STUFFS</span></div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> call_get_duration(<span class="keywordtype">int</span> call_index, <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__time__val.htm">pj_time_val</a> *dur)</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;{</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;    <span class="keyword">struct </span>call *call = &amp;app.call[call_index];</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;    pjsip_inv_session *inv;</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;    dur-&gt;<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__time__val.htm#af2739d0c2189e9c902281c04fd1f4502">sec</a> = dur-&gt;<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__time__val.htm#ab9cc04663b258dd3dcb449a3110e0d82">msec</a> = 0;</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;    <span class="keywordflow">if</span> (!call)</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;    inv = call-&gt;inv;</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;    <span class="keywordflow">if</span> (!inv)</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;    <span class="keywordflow">if</span> (inv-&gt;state &gt;= PJSIP_INV_STATE_CONFIRMED &amp;&amp; call-&gt;connect_time.<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__time__val.htm#af2739d0c2189e9c902281c04fd1f4502">sec</a>) {</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__TIME.htm#ga0806df13f40d3153061f399ed86be856">pj_gettimeofday</a>(dur);</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__TIME.htm#gaec98fc019fc44b5a6f6b0b9137bcf272">PJ_TIME_VAL_SUB</a>((*dur), call-&gt;connect_time);</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;    }</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;}</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *good_number(<span class="keywordtype">char</span> *buf, <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gae9209fc12270380351afac527b6861b1">pj_int32_t</a> val)</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;{</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;    <span class="keywordflow">if</span> (val &lt; 1000) {</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;        pj_ansi_sprintf(buf, <span class="stringliteral">&quot;%d&quot;</span>, val);</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (val &lt; 1000000) {</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;        pj_ansi_sprintf(buf, <span class="stringliteral">&quot;%d.%02dK&quot;</span>, </div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;                        val / 1000,</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;                        (val % 1000) / 100);</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;        pj_ansi_sprintf(buf, <span class="stringliteral">&quot;%d.%02dM&quot;</span>, </div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;                        val / 1000000,</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;                        (val % 1000000) / 10000);</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;    }</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;    <span class="keywordflow">return</span> buf;</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;}</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> print_avg_stat(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;{</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;<span class="preprocessor">#define MIN_(var,val)      if ((int)val &lt; (int)var) var = val</span></div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;<span class="preprocessor">#define MAX_(var,val)      if ((int)val &gt; (int)var) var = val</span></div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;<span class="preprocessor">#define AVG_(var,val)      var = ( ((var * count) + val) / (count+1) )</span></div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;<span class="preprocessor">#define BIGVAL              0x7FFFFFFFL</span></div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;    <span class="keyword">struct </span>stat_entry</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;    {</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;        <span class="keywordtype">int</span> min, avg, max;</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;    };</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;    <span class="keyword">struct </span>stat_entry call_dur, call_pdd;</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    <a class="code" href="structpjmedia__rtcp__stat.htm">pjmedia_rtcp_stat</a> min_stat, avg_stat, max_stat;</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;    <span class="keywordtype">char</span> srx_min[16], srx_avg[16], srx_max[16];</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    <span class="keywordtype">char</span> brx_min[16], brx_avg[16], brx_max[16];</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;    <span class="keywordtype">char</span> stx_min[16], stx_avg[16], stx_max[16];</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;    <span class="keywordtype">char</span> btx_min[16], btx_avg[16], btx_max[16];</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;    <span class="keywordtype">unsigned</span> i, count;</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#gafa92001573289c87313c660146369fa3">pj_bzero</a>(&amp;call_dur, <span class="keyword">sizeof</span>(call_dur)); </div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;    call_dur.min = BIGVAL;</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#gafa92001573289c87313c660146369fa3">pj_bzero</a>(&amp;call_pdd, <span class="keyword">sizeof</span>(call_pdd)); </div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;    call_pdd.min = BIGVAL;</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#gafa92001573289c87313c660146369fa3">pj_bzero</a>(&amp;min_stat, <span class="keyword">sizeof</span>(min_stat));</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;    min_stat.rx.pkt = min_stat.tx.pkt = BIGVAL;</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;    min_stat.rx.bytes = min_stat.tx.bytes = BIGVAL;</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;    min_stat.rx.loss = min_stat.tx.loss = BIGVAL;</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;    min_stat.rx.dup = min_stat.tx.dup = BIGVAL;</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;    min_stat.rx.reorder = min_stat.tx.reorder = BIGVAL;</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;    min_stat.rx.jitter.min = min_stat.tx.jitter.min = BIGVAL;</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;    min_stat.rtt.min = BIGVAL;</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#gafa92001573289c87313c660146369fa3">pj_bzero</a>(&amp;avg_stat, <span class="keyword">sizeof</span>(avg_stat));</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__PSTR.htm#gafa92001573289c87313c660146369fa3">pj_bzero</a>(&amp;max_stat, <span class="keyword">sizeof</span>(max_stat));</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;    <span class="keywordflow">for</span> (i=0, count=0; i&lt;app.max_calls; ++i) {</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;        <span class="keyword">struct </span>call *call = &amp;app.call[i];</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;        <span class="keyword">struct </span><a class="code" href="structmedia__stream.htm">media_stream</a> *audio = &amp;call-&gt;media[0];</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__time__val.htm">pj_time_val</a> dur;</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;        <span class="keywordtype">unsigned</span> msec_dur;</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;        <span class="keywordflow">if</span> (call-&gt;inv == NULL || </div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;            call-&gt;inv-&gt;state &lt; PJSIP_INV_STATE_CONFIRMED ||</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;            call-&gt;connect_time.<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__time__val.htm#af2739d0c2189e9c902281c04fd1f4502">sec</a> == 0) </div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;        {</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;        }</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;        <span class="comment">/* Duration */</span></div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;        call_get_duration(i, &amp;dur);</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;        msec_dur = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__TIME.htm#gad015d440803cb8f62ff73878f35badaa">PJ_TIME_VAL_MSEC</a>(dur);</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;        MIN_(call_dur.min, msec_dur);</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;        MAX_(call_dur.max, msec_dur);</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;        AVG_(call_dur.avg, msec_dur);</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;        <span class="comment">/* Connect delay */</span></div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;        <span class="keywordflow">if</span> (call-&gt;connect_time.<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__time__val.htm#af2739d0c2189e9c902281c04fd1f4502">sec</a>) {</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;            <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__time__val.htm">pj_time_val</a> t = call-&gt;connect_time;</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;            <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__TIME.htm#gaec98fc019fc44b5a6f6b0b9137bcf272">PJ_TIME_VAL_SUB</a>(t, call-&gt;start_time);</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;            msec_dur = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__TIME.htm#gad015d440803cb8f62ff73878f35badaa">PJ_TIME_VAL_MSEC</a>(t);</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;            msec_dur = 10;</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;        }</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;        MIN_(call_pdd.min, msec_dur);</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;        MAX_(call_pdd.max, msec_dur);</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;        AVG_(call_pdd.avg, msec_dur);</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;        <span class="comment">/* RX Statistisc: */</span></div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;        <span class="comment">/* Packets */</span></div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;        MIN_(min_stat.rx.pkt, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#a6a783087dff8d922f3a85a33d6cf2b45">rx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#ade8c3575a4c42a7bee4e9cdfce48ac55">pkt</a>);</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;        MAX_(max_stat.rx.pkt, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#a6a783087dff8d922f3a85a33d6cf2b45">rx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#ade8c3575a4c42a7bee4e9cdfce48ac55">pkt</a>);</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;        AVG_(avg_stat.rx.pkt, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#a6a783087dff8d922f3a85a33d6cf2b45">rx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#ade8c3575a4c42a7bee4e9cdfce48ac55">pkt</a>);</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;        <span class="comment">/* Bytes */</span></div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;        MIN_(min_stat.rx.bytes, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#a6a783087dff8d922f3a85a33d6cf2b45">rx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#affde734834ce0313abbdb60ab0a0a199">bytes</a>);</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;        MAX_(max_stat.rx.bytes, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#a6a783087dff8d922f3a85a33d6cf2b45">rx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#affde734834ce0313abbdb60ab0a0a199">bytes</a>);</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;        AVG_(avg_stat.rx.bytes, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#a6a783087dff8d922f3a85a33d6cf2b45">rx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#affde734834ce0313abbdb60ab0a0a199">bytes</a>);</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;        <span class="comment">/* Packet loss */</span></div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;        MIN_(min_stat.rx.loss, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#a6a783087dff8d922f3a85a33d6cf2b45">rx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#ac16c34b6cb8adf2960519334b4b8bba4">loss</a>);</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;        MAX_(max_stat.rx.loss, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#a6a783087dff8d922f3a85a33d6cf2b45">rx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#ac16c34b6cb8adf2960519334b4b8bba4">loss</a>);</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;        AVG_(avg_stat.rx.loss, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#a6a783087dff8d922f3a85a33d6cf2b45">rx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#ac16c34b6cb8adf2960519334b4b8bba4">loss</a>);</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;        <span class="comment">/* Packet dup */</span></div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;        MIN_(min_stat.rx.dup, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#a6a783087dff8d922f3a85a33d6cf2b45">rx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#a6ce7c2013c4a7358912e2f10523e6db1">dup</a>);</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;        MAX_(max_stat.rx.dup, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#a6a783087dff8d922f3a85a33d6cf2b45">rx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#a6ce7c2013c4a7358912e2f10523e6db1">dup</a>);</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;        AVG_(avg_stat.rx.dup, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#a6a783087dff8d922f3a85a33d6cf2b45">rx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#a6ce7c2013c4a7358912e2f10523e6db1">dup</a>);</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;        <span class="comment">/* Packet reorder */</span></div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;        MIN_(min_stat.rx.reorder, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#a6a783087dff8d922f3a85a33d6cf2b45">rx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#a6b2222588e10045bbfb98605e8970465">reorder</a>);</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;        MAX_(max_stat.rx.reorder, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#a6a783087dff8d922f3a85a33d6cf2b45">rx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#a6b2222588e10045bbfb98605e8970465">reorder</a>);</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;        AVG_(avg_stat.rx.reorder, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#a6a783087dff8d922f3a85a33d6cf2b45">rx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#a6b2222588e10045bbfb98605e8970465">reorder</a>);</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;        <span class="comment">/* Jitter  */</span></div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;        MIN_(min_stat.rx.jitter.min, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#a6a783087dff8d922f3a85a33d6cf2b45">rx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#ab7b015e32617857558c45a30e2ae0928">jitter</a>.min);</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;        MAX_(max_stat.rx.jitter.max, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#a6a783087dff8d922f3a85a33d6cf2b45">rx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#ab7b015e32617857558c45a30e2ae0928">jitter</a>.max);</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;        AVG_(avg_stat.rx.jitter.mean, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#a6a783087dff8d922f3a85a33d6cf2b45">rx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#ab7b015e32617857558c45a30e2ae0928">jitter</a>.mean);</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;        <span class="comment">/* TX Statistisc: */</span></div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;        <span class="comment">/* Packets */</span></div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;        MIN_(min_stat.tx.pkt, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#abf3a62866b6e9f1ec3de831030f41a01">tx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#ade8c3575a4c42a7bee4e9cdfce48ac55">pkt</a>);</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;        MAX_(max_stat.tx.pkt, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#abf3a62866b6e9f1ec3de831030f41a01">tx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#ade8c3575a4c42a7bee4e9cdfce48ac55">pkt</a>);</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;        AVG_(avg_stat.tx.pkt, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#abf3a62866b6e9f1ec3de831030f41a01">tx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#ade8c3575a4c42a7bee4e9cdfce48ac55">pkt</a>);</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;        <span class="comment">/* Bytes */</span></div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;        MIN_(min_stat.tx.bytes, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#abf3a62866b6e9f1ec3de831030f41a01">tx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#affde734834ce0313abbdb60ab0a0a199">bytes</a>);</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;        MAX_(max_stat.tx.bytes, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#abf3a62866b6e9f1ec3de831030f41a01">tx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#affde734834ce0313abbdb60ab0a0a199">bytes</a>);</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;        AVG_(avg_stat.tx.bytes, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#abf3a62866b6e9f1ec3de831030f41a01">tx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#affde734834ce0313abbdb60ab0a0a199">bytes</a>);</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;        <span class="comment">/* Packet loss */</span></div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;        MIN_(min_stat.tx.loss, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#abf3a62866b6e9f1ec3de831030f41a01">tx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#ac16c34b6cb8adf2960519334b4b8bba4">loss</a>);</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;        MAX_(max_stat.tx.loss, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#abf3a62866b6e9f1ec3de831030f41a01">tx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#ac16c34b6cb8adf2960519334b4b8bba4">loss</a>);</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;        AVG_(avg_stat.tx.loss, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#abf3a62866b6e9f1ec3de831030f41a01">tx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#ac16c34b6cb8adf2960519334b4b8bba4">loss</a>);</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;        <span class="comment">/* Packet dup */</span></div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;        MIN_(min_stat.tx.dup, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#abf3a62866b6e9f1ec3de831030f41a01">tx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#a6ce7c2013c4a7358912e2f10523e6db1">dup</a>);</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;        MAX_(max_stat.tx.dup, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#abf3a62866b6e9f1ec3de831030f41a01">tx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#a6ce7c2013c4a7358912e2f10523e6db1">dup</a>);</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;        AVG_(avg_stat.tx.dup, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#abf3a62866b6e9f1ec3de831030f41a01">tx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#a6ce7c2013c4a7358912e2f10523e6db1">dup</a>);</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;        <span class="comment">/* Packet reorder */</span></div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;        MIN_(min_stat.tx.reorder, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#abf3a62866b6e9f1ec3de831030f41a01">tx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#a6b2222588e10045bbfb98605e8970465">reorder</a>);</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;        MAX_(max_stat.tx.reorder, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#abf3a62866b6e9f1ec3de831030f41a01">tx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#a6b2222588e10045bbfb98605e8970465">reorder</a>);</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;        AVG_(avg_stat.tx.reorder, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#abf3a62866b6e9f1ec3de831030f41a01">tx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#a6b2222588e10045bbfb98605e8970465">reorder</a>);</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;        <span class="comment">/* Jitter  */</span></div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;        MIN_(min_stat.tx.jitter.min, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#abf3a62866b6e9f1ec3de831030f41a01">tx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#ab7b015e32617857558c45a30e2ae0928">jitter</a>.min);</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;        MAX_(max_stat.tx.jitter.max, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#abf3a62866b6e9f1ec3de831030f41a01">tx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#ab7b015e32617857558c45a30e2ae0928">jitter</a>.max);</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;        AVG_(avg_stat.tx.jitter.mean, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#abf3a62866b6e9f1ec3de831030f41a01">tx</a>.<a class="code" href="structpjmedia__rtcp__stream__stat.htm#ab7b015e32617857558c45a30e2ae0928">jitter</a>.mean);</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;        <span class="comment">/* RTT */</span></div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;        MIN_(min_stat.rtt.min, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#a2d8a17e5f1fbf8cd551f33c007be590f">rtt</a>.min);</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;        MAX_(max_stat.rtt.max, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#a2d8a17e5f1fbf8cd551f33c007be590f">rtt</a>.max);</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;        AVG_(avg_stat.rtt.mean, audio-&gt;rtcp.<a class="code" href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">stat</a>.<a class="code" href="structpjmedia__rtcp__stat.htm#a2d8a17e5f1fbf8cd551f33c007be590f">rtt</a>.mean);</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;        ++count;</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;    }</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;    <span class="keywordflow">if</span> (count == 0) {</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;        puts(<span class="stringliteral">&quot;No active calls&quot;</span>);</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;    }</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;    printf(<span class="stringliteral">&quot;Total %d call(s) active.\n&quot;</span></div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;           <span class="stringliteral">&quot;                    Average Statistics\n&quot;</span></div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;           <span class="stringliteral">&quot;                    min     avg     max \n&quot;</span></div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;           <span class="stringliteral">&quot;                -----------------------\n&quot;</span></div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;           <span class="stringliteral">&quot; call duration: %7d %7d %7d %s\n&quot;</span></div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;           <span class="stringliteral">&quot; connect delay: %7d %7d %7d %s\n&quot;</span></div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;           <span class="stringliteral">&quot; RX stat:\n&quot;</span></div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;           <span class="stringliteral">&quot;       packets: %7s %7s %7s %s\n&quot;</span></div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;           <span class="stringliteral">&quot;       payload: %7s %7s %7s %s\n&quot;</span></div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;           <span class="stringliteral">&quot;          loss: %7d %7d %7d %s\n&quot;</span></div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;           <span class="stringliteral">&quot;  percent loss: %7.3f %7.3f %7.3f %s\n&quot;</span></div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;           <span class="stringliteral">&quot;           dup: %7d %7d %7d %s\n&quot;</span></div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;           <span class="stringliteral">&quot;       reorder: %7d %7d %7d %s\n&quot;</span></div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;           <span class="stringliteral">&quot;        jitter: %7.3f %7.3f %7.3f %s\n&quot;</span></div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;           <span class="stringliteral">&quot; TX stat:\n&quot;</span></div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;           <span class="stringliteral">&quot;       packets: %7s %7s %7s %s\n&quot;</span></div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;           <span class="stringliteral">&quot;       payload: %7s %7s %7s %s\n&quot;</span></div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;           <span class="stringliteral">&quot;          loss: %7d %7d %7d %s\n&quot;</span></div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;           <span class="stringliteral">&quot;  percent loss: %7.3f %7.3f %7.3f %s\n&quot;</span></div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;           <span class="stringliteral">&quot;           dup: %7d %7d %7d %s\n&quot;</span></div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;           <span class="stringliteral">&quot;       reorder: %7d %7d %7d %s\n&quot;</span></div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;           <span class="stringliteral">&quot;        jitter: %7.3f %7.3f %7.3f %s\n&quot;</span></div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;           <span class="stringliteral">&quot; RTT          : %7.3f %7.3f %7.3f %s\n&quot;</span></div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;           ,</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;           count,</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;           call_dur.min/1000, call_dur.avg/1000, call_dur.max/1000, </div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;           <span class="stringliteral">&quot;seconds&quot;</span>,</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;           call_pdd.min, call_pdd.avg, call_pdd.max, </div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;           <span class="stringliteral">&quot;ms&quot;</span>,</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;           <span class="comment">/* rx */</span></div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;           good_number(srx_min, min_stat.rx.pkt),</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;           good_number(srx_avg, avg_stat.rx.pkt),</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;           good_number(srx_max, max_stat.rx.pkt),</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;           <span class="stringliteral">&quot;packets&quot;</span>,</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;           good_number(brx_min, min_stat.rx.bytes),</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;           good_number(brx_avg, avg_stat.rx.bytes),</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;           good_number(brx_max, max_stat.rx.bytes),</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;           <span class="stringliteral">&quot;bytes&quot;</span>,</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;           min_stat.rx.loss, avg_stat.rx.loss, max_stat.rx.loss,</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;           <span class="stringliteral">&quot;packets&quot;</span>,</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;           </div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;           min_stat.rx.loss*100.0/(min_stat.rx.pkt+min_stat.rx.loss),</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;           avg_stat.rx.loss*100.0/(avg_stat.rx.pkt+avg_stat.rx.loss),</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;           max_stat.rx.loss*100.0/(max_stat.rx.pkt+max_stat.rx.loss),</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;           <span class="stringliteral">&quot;%&quot;</span>,</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;           min_stat.rx.dup, avg_stat.rx.dup, max_stat.rx.dup,</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;           <span class="stringliteral">&quot;packets&quot;</span>,</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;           min_stat.rx.reorder, avg_stat.rx.reorder, max_stat.rx.reorder,</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;           <span class="stringliteral">&quot;packets&quot;</span>,</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;           min_stat.rx.jitter.min/1000.0, </div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;           avg_stat.rx.jitter.mean/1000.0, </div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;           max_stat.rx.jitter.max/1000.0,</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;           <span class="stringliteral">&quot;ms&quot;</span>,</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;        </div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;           <span class="comment">/* tx */</span></div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;           good_number(stx_min, min_stat.tx.pkt),</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;           good_number(stx_avg, avg_stat.tx.pkt),</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;           good_number(stx_max, max_stat.tx.pkt),</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;           <span class="stringliteral">&quot;packets&quot;</span>,</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;           good_number(btx_min, min_stat.tx.bytes),</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;           good_number(btx_avg, avg_stat.tx.bytes),</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;           good_number(btx_max, max_stat.tx.bytes),</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;           <span class="stringliteral">&quot;bytes&quot;</span>,</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;           min_stat.tx.loss, avg_stat.tx.loss, max_stat.tx.loss,</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;           <span class="stringliteral">&quot;packets&quot;</span>,</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;           </div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;           min_stat.tx.loss*100.0/(min_stat.tx.pkt+min_stat.tx.loss),</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;           avg_stat.tx.loss*100.0/(avg_stat.tx.pkt+avg_stat.tx.loss),</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;           max_stat.tx.loss*100.0/(max_stat.tx.pkt+max_stat.tx.loss),</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;           <span class="stringliteral">&quot;%&quot;</span>,</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;           min_stat.tx.dup, avg_stat.tx.dup, max_stat.tx.dup,</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;           <span class="stringliteral">&quot;packets&quot;</span>,</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;           min_stat.tx.reorder, avg_stat.tx.reorder, max_stat.tx.reorder,</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;           <span class="stringliteral">&quot;packets&quot;</span>,</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;           min_stat.tx.jitter.min/1000.0, </div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;           avg_stat.tx.jitter.mean/1000.0, </div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;           max_stat.tx.jitter.max/1000.0,</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;           <span class="stringliteral">&quot;ms&quot;</span>,</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;           <span class="comment">/* rtt */</span></div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;           min_stat.rtt.min/1000.0, </div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;           avg_stat.rtt.mean/1000.0, </div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;           max_stat.rtt.max/1000.0,</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;           <span class="stringliteral">&quot;ms&quot;</span></div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;           );</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;}</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;<span class="preprocessor">#include &quot;siprtp_report.c&quot;</span></div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> list_calls()</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;{</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;    <span class="keywordtype">unsigned</span> i;</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;    puts(<span class="stringliteral">&quot;List all calls:&quot;</span>);</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;    <span class="keywordflow">for</span> (i=0; i&lt;app.max_calls; ++i) {</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;        <span class="keywordflow">if</span> (!app.call[i].inv)</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;        print_call(i);</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;    }</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;}</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> hangup_call(<span class="keywordtype">unsigned</span> index)</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;{</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;    pjsip_tx_data *tdata;</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> status;</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;    <span class="keywordflow">if</span> (app.call[index].inv == NULL)</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;    status = pjsip_inv_end_session(app.call[index].inv, 603, NULL, &amp;tdata);</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;    <span class="keywordflow">if</span> (status==<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a> &amp;&amp; tdata!=NULL)</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;        pjsip_inv_send_msg(app.call[index].inv, tdata);</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;}</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> hangup_all_calls()</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;{</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;    <span class="keywordtype">unsigned</span> i;</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;    <span class="keywordflow">for</span> (i=0; i&lt;app.max_calls; ++i) {</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;        <span class="keywordflow">if</span> (!app.call[i].inv)</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;        hangup_call(i);</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__THREAD.htm#gad59cd6fd7390711758afcc0bde375d68">pj_thread_sleep</a>(app.call_gap);</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;    }</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;    </div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;    <span class="comment">/* Wait until all calls are terminated */</span></div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;    <span class="keywordflow">for</span> (i=0; i&lt;app.max_calls; ++i) {</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;        <span class="keywordflow">while</span> (app.call[i].inv)</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;            <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__THREAD.htm#gad59cd6fd7390711758afcc0bde375d68">pj_thread_sleep</a>(10);</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;    }</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;}</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;<span class="keyword">static</span> <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga1dc7a356fb36bd2dee2bc7d6c7e817e4">pj_bool_t</a> simple_input(<span class="keyword">const</span> <span class="keywordtype">char</span> *title, <span class="keywordtype">char</span> *buf, <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga9fdb3ceb491cd888cd30ca30d78026e8">pj_size_t</a> len)</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;{</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;    <span class="keywordtype">char</span> *p;</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;    printf(<span class="stringliteral">&quot;%s (empty to cancel): &quot;</span>, title); fflush(stdout);</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;    <span class="keywordflow">if</span> (fgets(buf, (<span class="keywordtype">int</span>)len, stdin) == NULL)</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;        <span class="keywordflow">return</span> <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead95511b40a74f4625b161dd9e42c6e6e">PJ_FALSE</a>;</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;    <span class="comment">/* Remove trailing newlines. */</span></div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;    <span class="keywordflow">for</span> (p=buf; ; ++p) {</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;        <span class="keywordflow">if</span> (*p==<span class="charliteral">&#39;\r&#39;</span> || *p==<span class="charliteral">&#39;\n&#39;</span>) *p=<span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!*p) <span class="keywordflow">break</span>;</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;    }</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;    <span class="keywordflow">if</span> (!*buf)</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;        <span class="keywordflow">return</span> <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead95511b40a74f4625b161dd9e42c6e6e">PJ_FALSE</a>;</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;    </div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;    <span class="keywordflow">return</span> <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead235b21a623d982cc561fb12bffa87c0">PJ_TRUE</a>;</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;}</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *MENU =</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;<span class="stringliteral">&quot;\n&quot;</span></div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;<span class="stringliteral">&quot;Enter menu character:\n&quot;</span></div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;<span class="stringliteral">&quot;  s    Summary\n&quot;</span></div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;<span class="stringliteral">&quot;  l    List all calls\n&quot;</span></div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;<span class="stringliteral">&quot;  h    Hangup a call\n&quot;</span></div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;<span class="stringliteral">&quot;  H    Hangup all calls\n&quot;</span></div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;<span class="stringliteral">&quot;  q    Quit\n&quot;</span></div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;<span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;<span class="comment">/* Main screen menu */</span></div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> console_main()</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;{</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;    <span class="keywordtype">char</span> input1[10];</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;    <span class="keywordtype">unsigned</span> i;</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;    printf(<span class="stringliteral">&quot;%s&quot;</span>, MENU);</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;    <span class="keywordflow">for</span> (;;) {</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;        printf(<span class="stringliteral">&quot;&gt;&gt;&gt; &quot;</span>); fflush(stdout);</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;        <span class="keywordflow">if</span> (fgets(input1, <span class="keyword">sizeof</span>(input1), stdin) == NULL) {</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;            puts(<span class="stringliteral">&quot;EOF while reading stdin, will quit now..&quot;</span>);</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;        }</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;        <span class="keywordflow">switch</span> (input1[0]) {</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>:</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;            print_avg_stat();</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;l&#39;</span>:</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;            list_calls();</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;h&#39;</span>:</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;            <span class="keywordflow">if</span> (!simple_input(<span class="stringliteral">&quot;Call number to hangup&quot;</span>, input1, <span class="keyword">sizeof</span>(input1)))</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;            i = atoi(input1);</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;            hangup_call(i);</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;H&#39;</span>:</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;            hangup_all_calls();</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;q&#39;</span>:</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;            <span class="keywordflow">goto</span> on_exit;</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;            puts(<span class="stringliteral">&quot;Invalid command&quot;</span>);</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;            printf(<span class="stringliteral">&quot;%s&quot;</span>, MENU);</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;        }</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;        fflush(stdout);</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;    }</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;on_exit:</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;    hangup_all_calls();</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;}</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;<span class="comment">/*****************************************************************************</span></div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;<span class="comment"> * Below is a simple module to log all incoming and outgoing SIP messages</span></div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;<span class="comment">/* Notification on incoming messages */</span></div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;<span class="keyword">static</span> <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga1dc7a356fb36bd2dee2bc7d6c7e817e4">pj_bool_t</a> logger_on_rx_msg(pjsip_rx_data *rdata)</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;{</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(4,(THIS_FILE, <span class="stringliteral">&quot;RX %d bytes %s from %s:%d:\n&quot;</span></div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;                         <span class="stringliteral">&quot;%s\n&quot;</span></div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;                         <span class="stringliteral">&quot;--end msg--&quot;</span>,</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;                         rdata-&gt;msg_info.len,</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;                         pjsip_rx_data_get_info(rdata),</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;                         rdata-&gt;pkt_info.src_name,</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;                         rdata-&gt;pkt_info.src_port,</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;                         rdata-&gt;msg_info.msg_buf));</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;    </div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;    <span class="comment">/* Always return false, otherwise messages will not get processed! */</span></div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;    <span class="keywordflow">return</span> <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead95511b40a74f4625b161dd9e42c6e6e">PJ_FALSE</a>;</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;}</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;<span class="comment">/* Notification on outgoing messages */</span></div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;<span class="keyword">static</span> <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> logger_on_tx_msg(pjsip_tx_data *tdata)</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;{</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;    </div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;    <span class="comment">/* Important note:</span></div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;<span class="comment">     *  tp_info field is only valid after outgoing messages has passed</span></div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;<span class="comment">     *  transport layer. So don&#39;t try to access tp_info when the module</span></div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;<span class="comment">     *  has lower priority than transport layer.</span></div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(4,(THIS_FILE, <span class="stringliteral">&quot;TX %d bytes %s to %s:%d:\n&quot;</span></div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;                         <span class="stringliteral">&quot;%s\n&quot;</span></div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;                         <span class="stringliteral">&quot;--end msg--&quot;</span>,</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;                         (tdata-&gt;buf.cur - tdata-&gt;buf.start),</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;                         pjsip_tx_data_get_info(tdata),</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;                         tdata-&gt;tp_info.dst_name,</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;                         tdata-&gt;tp_info.dst_port,</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;                         tdata-&gt;buf.start));</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;    <span class="comment">/* Always return success, otherwise message will not get sent! */</span></div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;    <span class="keywordflow">return</span> <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>;</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;}</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;<span class="comment">/* The module instance. */</span></div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;<span class="keyword">static</span> pjsip_module msg_logger = </div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;{</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;    NULL, NULL,                         <span class="comment">/* prev, next.          */</span></div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;    { <span class="stringliteral">&quot;mod-siprtp-log&quot;</span>, 14 },           <span class="comment">/* Name.                */</span></div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;    -1,                                 <span class="comment">/* Id                   */</span></div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;    PJSIP_MOD_PRIORITY_TRANSPORT_LAYER-1,<span class="comment">/* Priority            */</span></div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;    NULL,                               <span class="comment">/* load()               */</span></div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;    NULL,                               <span class="comment">/* start()              */</span></div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;    NULL,                               <span class="comment">/* stop()               */</span></div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;    NULL,                               <span class="comment">/* unload()             */</span></div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;    &amp;logger_on_rx_msg,                  <span class="comment">/* on_rx_request()      */</span></div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;    &amp;logger_on_rx_msg,                  <span class="comment">/* on_rx_response()     */</span></div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;    &amp;logger_on_tx_msg,                  <span class="comment">/* on_tx_request.       */</span></div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;    &amp;logger_on_tx_msg,                  <span class="comment">/* on_tx_response()     */</span></div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;    NULL,                               <span class="comment">/* on_tsx_state()       */</span></div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;};</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;<span class="comment">/*****************************************************************************</span></div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;<span class="comment"> * Console application custom logging:</span></div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;<span class="keyword">static</span> FILE *log_file;</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> app_log_writer(<span class="keywordtype">int</span> level, <span class="keyword">const</span> <span class="keywordtype">char</span> *buffer, <span class="keywordtype">int</span> len)</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;{</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;    <span class="comment">/* Write to both stdout and file. */</span></div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;    <span class="keywordflow">if</span> (level &lt;= app.app_log_level)</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga075e8fbb519edef9750c45cfe6d456d7">pj_log_write</a>(level, buffer, len);</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;    <span class="keywordflow">if</span> (log_file) {</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga9fdb3ceb491cd888cd30ca30d78026e8">pj_size_t</a> count = fwrite(buffer, len, 1, log_file);</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__pj__config.htm#ga7523f8576efd271c22b188eab05d7870">PJ_UNUSED_ARG</a>(count);</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;        fflush(log_file);</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;    }</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;}</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> app_logging_init(<span class="keywordtype">void</span>)</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;{</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;    <span class="comment">/* Redirect log function to ours */</span></div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__LOG.htm#gaec15259dddf6896e4337abd528a8aad1">pj_log_set_log_func</a>( &amp;app_log_writer );</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;    <span class="comment">/* If output log file is desired, create the file: */</span></div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;    <span class="keywordflow">if</span> (app.log_filename) {</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;        log_file = fopen(app.log_filename, <span class="stringliteral">&quot;wt&quot;</span>);</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;        <span class="keywordflow">if</span> (log_file == NULL) {</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;            <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(1,(THIS_FILE, <span class="stringliteral">&quot;Unable to open log file %s&quot;</span>, </div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;                      app.log_filename));   </div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;        }</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;    }</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;    <span class="keywordflow">return</span> <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>;</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;}</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;<span class="keywordtype">void</span> app_logging_shutdown(<span class="keywordtype">void</span>)</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;{</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;    <span class="comment">/* Close logging file, if any: */</span></div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;    <span class="keywordflow">if</span> (log_file) {</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;        fclose(log_file);</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;        log_file = NULL;</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;    }</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;}</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;<span class="comment"> * main()</span></div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;{</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;    <span class="keywordtype">unsigned</span> i;</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> status;</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;    <span class="comment">/* Must init PJLIB first */</span></div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;    status = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga069615152140fa2df009cebc8a36b769">pj_init</a>();</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;    <span class="keywordflow">if</span> (status != <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>)</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;        <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;    <span class="comment">/* Get command line options */</span></div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;    status = init_options(argc, argv);</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;    <span class="keywordflow">if</span> (status != <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>)</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;        <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;    <span class="comment">/* Verify options: */</span></div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;    <span class="comment">/* Auto-quit can not be specified for UAS */</span></div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;    <span class="keywordflow">if</span> (app.auto_quit &amp;&amp; app.uri_to_call.slen == 0) {</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;        printf(<span class="stringliteral">&quot;Error: --auto-quit option only valid for outgoing &quot;</span></div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;               <span class="stringliteral">&quot;mode (UAC) only\n&quot;</span>);</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;        <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;    }</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;    <span class="comment">/* Init logging */</span></div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;    status = app_logging_init();</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;    <span class="keywordflow">if</span> (status != <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>)</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;        <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;    <span class="comment">/* Init SIP etc */</span></div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;    status = init_sip();</div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;    <span class="keywordflow">if</span> (status != <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;        app_perror(THIS_FILE, <span class="stringliteral">&quot;Initialization has failed&quot;</span>, status);</div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;        destroy_sip();</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;        <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;    }</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;    <span class="comment">/* Register module to log incoming/outgoing messages */</span></div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;    pjsip_endpt_register_module(app.sip_endpt, &amp;msg_logger);</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;    <span class="comment">/* Init media */</span></div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;    status = init_media();</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;    <span class="keywordflow">if</span> (status != <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;        app_perror(THIS_FILE, <span class="stringliteral">&quot;Media initialization failed&quot;</span>, status);</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;        destroy_sip();</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;        <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;    }</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;    <span class="comment">/* Start worker threads */</span></div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;<span class="preprocessor">#if PJ_HAS_THREADS</span></div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;    <span class="keywordflow">for</span> (i=0; i&lt;app.thread_count; ++i) {</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__THREAD.htm#ga7b63533cf4f3ba0cba68cab49a22d722">pj_thread_create</a>( app.pool, <span class="stringliteral">&quot;app&quot;</span>, &amp;sip_worker_thread, NULL,</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;                          0, 0, &amp;app.sip_thread[i]);</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;    }</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;    <span class="comment">/* If URL is specified, then make call immediately */</span></div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;    <span class="keywordflow">if</span> (app.uri_to_call.slen) {</div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(3,(THIS_FILE, <span class="stringliteral">&quot;Making %d calls to %s..&quot;</span>, app.max_calls,</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;                  app.uri_to_call.ptr));</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;        <span class="keywordflow">for</span> (i=0; i&lt;app.max_calls; ++i) {</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;            status = make_call(&amp;app.uri_to_call);</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;            <span class="keywordflow">if</span> (status != <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;                app_perror(THIS_FILE, <span class="stringliteral">&quot;Error making call&quot;</span>, status);</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;            }</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;            <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__THREAD.htm#gad59cd6fd7390711758afcc0bde375d68">pj_thread_sleep</a>(app.call_gap);</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;        }</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;        <span class="keywordflow">if</span> (app.auto_quit) {</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;            <span class="comment">/* Wait for calls to complete */</span></div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;            <span class="keywordflow">while</span> (app.uac_calls &lt; app.max_calls)</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;                <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__THREAD.htm#gad59cd6fd7390711758afcc0bde375d68">pj_thread_sleep</a>(100);</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;            <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__THREAD.htm#gad59cd6fd7390711758afcc0bde375d68">pj_thread_sleep</a>(200);</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;<span class="preprocessor">#if PJ_HAS_THREADS</span></div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;            <span class="comment">/* Start user interface loop */</span></div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;            console_main();</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;        }</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(3,(THIS_FILE, <span class="stringliteral">&quot;Ready for incoming calls (max=%d)&quot;</span>, </div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;                  app.max_calls));</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;<span class="preprocessor">#if PJ_HAS_THREADS</span></div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;        <span class="comment">/* Start user interface loop */</span></div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;        console_main();</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;    }</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;<span class="preprocessor">#if !PJ_HAS_THREADS</span></div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a>(3,(THIS_FILE, <span class="stringliteral">&quot;Press Ctrl-C to quit&quot;</span>));</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;    <span class="keywordflow">for</span> (;;) {</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__time__val.htm">pj_time_val</a> t = {0, 10};</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;        pjsip_endpt_handle_events(app.sip_endpt, &amp;t);</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;    }</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;    </div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;    <span class="comment">/* Shutting down... */</span></div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;    destroy_sip();</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;    destroy_media();</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;    <span class="keywordflow">if</span> (app.pool) {</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__POOL.htm#gade0f14f6635ecfccb576ec41c57fede5">pj_pool_release</a>(app.pool);</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;        app.pool = NULL;</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;        <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__CACHING__POOL.htm#ga4c912e7d9e08dae33c2fecea9f1949bc">pj_caching_pool_destroy</a>(&amp;app.cp);</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;    }</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;    app_logging_shutdown();</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;    <span class="comment">/* Shutdown PJLIB */</span></div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;    <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gad42209dcf11f957ed9f1790e30f519cd">pj_shutdown</a>();</div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;}</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;</div><div class="ttc" id="structpjmedia__codec__info_htm_a77f4c6139109ad8a15ed69444a258277"><div class="ttname"><a href="structpjmedia__codec__info.htm#a77f4c6139109ad8a15ed69444a258277">pjmedia_codec_info::clock_rate</a></div><div class="ttdeci">unsigned clock_rate</div><div class="ttdef"><b>Definition:</b> codec.h:240</div></div>
<div class="ttc" id="group__PJMEDIA__TRANSPORT_htm_ga0114fa7e20cb17c645701b2dbda96452"><div class="ttname"><a href="group__PJMEDIA__TRANSPORT.htm#ga0114fa7e20cb17c645701b2dbda96452">pjmedia_transport_close</a></div><div class="ttdeci">pj_status_t pjmedia_transport_close(pjmedia_transport *tp)</div><div class="ttdef"><b>Definition:</b> transport.h:1003</div></div>
<div class="ttc" id="group__PJMEDIA__SDP__NEG_htm_gaa5fc5d38e7f2d9284ad352f251beecb3"><div class="ttname"><a href="group__PJMEDIA__SDP__NEG.htm#gaa5fc5d38e7f2d9284ad352f251beecb3">pjmedia_sdp_neg_get_active_local</a></div><div class="ttdeci">pj_status_t pjmedia_sdp_neg_get_active_local(pjmedia_sdp_neg *neg, const pjmedia_sdp_session **local)</div></div>
<div class="ttc" id="group__PJ__LOG_htm_ga075e8fbb519edef9750c45cfe6d456d7"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga075e8fbb519edef9750c45cfe6d456d7">pj_log_write</a></div><div class="ttdeci">void pj_log_write(int level, const char *buffer, int len)</div></div>
<div class="ttc" id="structpj__sockaddr__in_htm_ab298fd61a3f2bf3036fe414740a53cc6"><div class="ttname"><a href="../../../pjlib/docs/html/structpj__sockaddr__in.htm#ab298fd61a3f2bf3036fe414740a53cc6">pj_sockaddr_in::sin_family</a></div><div class="ttdeci">pj_uint16_t sin_family</div></div>
<div class="ttc" id="structpjmedia__sdp__media_htm_ae891d90d8d33f1e44ffa26af62912f39"><div class="ttname"><a href="structpjmedia__sdp__media.htm#ae891d90d8d33f1e44ffa26af62912f39">pjmedia_sdp_media::desc</a></div><div class="ttdeci">struct pjmedia_sdp_media::@12 desc</div></div>
<div class="ttc" id="pjmedia_8h_htm"><div class="ttname"><a href="pjmedia_8h.htm">pjmedia.h</a></div><div class="ttdoc">PJMEDIA main header file. </div></div>
<div class="ttc" id="group__PJMEDIA__SDP__NEG_htm_gab0ad3a803c7b2bf4ac840126619ff8ed"><div class="ttname"><a href="group__PJMEDIA__SDP__NEG.htm#gab0ad3a803c7b2bf4ac840126619ff8ed">pjmedia_sdp_neg_get_active_remote</a></div><div class="ttdeci">pj_status_t pjmedia_sdp_neg_get_active_remote(pjmedia_sdp_neg *neg, const pjmedia_sdp_session **remote)</div></div>
<div class="ttc" id="group__PJ__BASIC_htm_gaec8852c90e22c6868c83d44dcbdecb8a"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gaec8852c90e22c6868c83d44dcbdecb8a">pj_timer_heap_t</a></div><div class="ttdeci">struct pj_timer_heap_t pj_timer_heap_t</div></div>
<div class="ttc" id="structpj__str__t_htm_a46788480bdb4080083dcc8965811e015"><div class="ttname"><a href="../../../pjlib/docs/html/structpj__str__t.htm#a46788480bdb4080083dcc8965811e015">pj_str_t::slen</a></div><div class="ttdeci">pj_ssize_t slen</div></div>
<div class="ttc" id="group__pj__assert_htm_gac98bea768b573f53432076a387864fb3"><div class="ttname"><a href="../../../pjlib/docs/html/group__pj__assert.htm#gac98bea768b573f53432076a387864fb3">PJ_ASSERT_RETURN</a></div><div class="ttdeci">#define PJ_ASSERT_RETURN(expr, retval)</div></div>
<div class="ttc" id="structpj__sockaddr__in_htm_ad1ed5a34d99da0d23e65b3b3b5fad228"><div class="ttname"><a href="../../../pjlib/docs/html/structpj__sockaddr__in.htm#ad1ed5a34d99da0d23e65b3b3b5fad228">pj_sockaddr_in::sin_addr</a></div><div class="ttdeci">pj_in_addr sin_addr</div></div>
<div class="ttc" id="group__PJ__LOG_htm_gaec15259dddf6896e4337abd528a8aad1"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__LOG.htm#gaec15259dddf6896e4337abd528a8aad1">pj_log_set_log_func</a></div><div class="ttdeci">void pj_log_set_log_func(pj_log_func *func)</div></div>
<div class="ttc" id="group__PJ__SOCK_htm_ga879824dfc39cf8897aa2607e086ec013"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__SOCK.htm#ga879824dfc39cf8897aa2607e086ec013">pj_ntohs</a></div><div class="ttdeci">pj_uint16_t pj_ntohs(pj_uint16_t netshort)</div></div>
<div class="ttc" id="structpjmedia__stream__info_htm_a6390c7f49d9af342d947ea1f6d3cc118"><div class="ttname"><a href="structpjmedia__stream__info.htm#a6390c7f49d9af342d947ea1f6d3cc118">pjmedia_stream_info::tx_pt</a></div><div class="ttdeci">unsigned tx_pt</div><div class="ttdef"><b>Definition:</b> stream.h:118</div></div>
<div class="ttc" id="group__PJMED__RTCP_htm_ga42ed1b0fc1e7bd65aea78e67e8415dca"><div class="ttname"><a href="group__PJMED__RTCP.htm#ga42ed1b0fc1e7bd65aea78e67e8415dca">pjmedia_rtcp_rx_rtcp</a></div><div class="ttdeci">void pjmedia_rtcp_rx_rtcp(pjmedia_rtcp_session *session, const void *rtcp_pkt, pj_size_t size)</div></div>
<div class="ttc" id="group__PJMED__RTCP_htm_ga8f2568957839ac3ecd8be01d2bc2c148"><div class="ttname"><a href="group__PJMED__RTCP.htm#ga8f2568957839ac3ecd8be01d2bc2c148">pjmedia_rtcp_build_rtcp</a></div><div class="ttdeci">void pjmedia_rtcp_build_rtcp(pjmedia_rtcp_session *session, void **rtcp_pkt, int *len)</div></div>
<div class="ttc" id="structpj__caching__pool_htm"><div class="ttname"><a href="../../../pjlib/docs/html/structpj__caching__pool.htm">pj_caching_pool</a></div></div>
<div class="ttc" id="structpjmedia__rtcp__stream__stat_htm_ade8c3575a4c42a7bee4e9cdfce48ac55"><div class="ttname"><a href="structpjmedia__rtcp__stream__stat.htm#ade8c3575a4c42a7bee4e9cdfce48ac55">pjmedia_rtcp_stream_stat::pkt</a></div><div class="ttdeci">pj_uint32_t pkt</div><div class="ttdef"><b>Definition:</b> rtcp.h:175</div></div>
<div class="ttc" id="group__PJMEDIA__TRANSPORT__UDP_htm_ga8baf23a6ec9268aed82a53ed6b1e366f"><div class="ttname"><a href="group__PJMEDIA__TRANSPORT__UDP.htm#ga8baf23a6ec9268aed82a53ed6b1e366f">pjmedia_transport_udp_create2</a></div><div class="ttdeci">pj_status_t pjmedia_transport_udp_create2(pjmedia_endpt *endpt, const char *name, const pj_str_t *addr, int port, unsigned options, pjmedia_transport **p_tp)</div></div>
<div class="ttc" id="group__PJ__BASIC_htm_gae9209fc12270380351afac527b6861b1"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gae9209fc12270380351afac527b6861b1">pj_int32_t</a></div><div class="ttdeci">PJ_BEGIN_DECL typedef int pj_int32_t</div></div>
<div class="ttc" id="group__PJMEDIA__TRANSPORT_htm_ga33a9285c010f2527e647f0b5871f881e"><div class="ttname"><a href="group__PJMEDIA__TRANSPORT.htm#ga33a9285c010f2527e647f0b5871f881e">pjmedia_transport_attach</a></div><div class="ttdeci">pj_status_t pjmedia_transport_attach(pjmedia_transport *tp, void *user_data, const pj_sockaddr_t *rem_addr, const pj_sockaddr_t *rem_rtcp, unsigned addr_len, void(*rtp_cb)(void *user_data, void *pkt, pj_ssize_t), void(*rtcp_cb)(void *usr_data, void *pkt, pj_ssize_t))</div><div class="ttdef"><b>Definition:</b> transport.h:769</div></div>
<div class="ttc" id="group__PJ__POOL_htm_gade0f14f6635ecfccb576ec41c57fede5"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__POOL.htm#gade0f14f6635ecfccb576ec41c57fede5">pj_pool_release</a></div><div class="ttdeci">void pj_pool_release(pj_pool_t *pool)</div></div>
<div class="ttc" id="group__PJ__BASIC_htm_ga1dc7a356fb36bd2dee2bc7d6c7e817e4"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga1dc7a356fb36bd2dee2bc7d6c7e817e4">pj_bool_t</a></div><div class="ttdeci">int pj_bool_t</div></div>
<div class="ttc" id="group__PJ__BASIC_htm_gacb9d46aed6813bf142efc1c3db7a2d17"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gacb9d46aed6813bf142efc1c3db7a2d17">pj_thread_t</a></div><div class="ttdeci">struct pj_thread_t pj_thread_t</div></div>
<div class="ttc" id="structpjmedia__sdp__attr_htm_a6ba49c6fc9556fe39cb39337a13bcb19"><div class="ttname"><a href="structpjmedia__sdp__attr.htm#a6ba49c6fc9556fe39cb39337a13bcb19">pjmedia_sdp_attr::value</a></div><div class="ttdeci">pj_str_t value</div><div class="ttdef"><b>Definition:</b> sdp.h:88</div></div>
<div class="ttc" id="group__PJ__IOQUEUE_htm_gab06c131ab29b37c027f2400bd5be6045"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__IOQUEUE.htm#gab06c131ab29b37c027f2400bd5be6045">user_data</a></div><div class="ttdeci">void * user_data</div></div>
<div class="ttc" id="group__PJMED__RTP_htm_ga9d9b33a67b04a25c38d625131809247f"><div class="ttname"><a href="group__PJMED__RTP.htm#ga9d9b33a67b04a25c38d625131809247f">pjmedia_rtp_session_update</a></div><div class="ttdeci">void pjmedia_rtp_session_update(pjmedia_rtp_session *ses, const pjmedia_rtp_hdr *hdr, pjmedia_rtp_status *seq_st)</div></div>
<div class="ttc" id="group__PJ__PSTR_htm_ga38d0ee03a9c582c627d44bfcb35fb6a8"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga38d0ee03a9c582c627d44bfcb35fb6a8">pj_memcpy</a></div><div class="ttdeci">void * pj_memcpy(void *dst, const void *src, pj_size_t size)</div></div>
<div class="ttc" id="structpj__sockaddr__in_htm_a0e60b93d03fa052211bb6131e64bdda1"><div class="ttname"><a href="../../../pjlib/docs/html/structpj__sockaddr__in.htm#a0e60b93d03fa052211bb6131e64bdda1">pj_sockaddr_in::sin_port</a></div><div class="ttdeci">pj_uint16_t sin_port</div></div>
<div class="ttc" id="structpjmedia__rtcp__stream__stat_htm_ac16c34b6cb8adf2960519334b4b8bba4"><div class="ttname"><a href="structpjmedia__rtcp__stream__stat.htm#ac16c34b6cb8adf2960519334b4b8bba4">pjmedia_rtcp_stream_stat::loss</a></div><div class="ttdeci">unsigned loss</div><div class="ttdef"><b>Definition:</b> rtcp.h:178</div></div>
<div class="ttc" id="structpjmedia__transport__info_htm"><div class="ttname"><a href="structpjmedia__transport__info.htm">pjmedia_transport_info</a></div><div class="ttdef"><b>Definition:</b> transport.h:550</div></div>
<div class="ttc" id="structpjmedia__stream__info_htm_ad93e00b509242b950568d9430e639b1e"><div class="ttname"><a href="structpjmedia__stream__info.htm#ad93e00b509242b950568d9430e639b1e">pjmedia_stream_info::fmt</a></div><div class="ttdeci">pjmedia_codec_info fmt</div><div class="ttdef"><b>Definition:</b> stream.h:116</div></div>
<div class="ttc" id="structpjmedia__sdp__rtpmap_htm_a572ff3d848f2588aeb45434bc48afd2b"><div class="ttname"><a href="structpjmedia__sdp__rtpmap.htm#a572ff3d848f2588aeb45434bc48afd2b">pjmedia_sdp_rtpmap::param</a></div><div class="ttdeci">pj_str_t param</div><div class="ttdef"><b>Definition:</b> sdp.h:217</div></div>
<div class="ttc" id="structpjmedia__sdp__session_htm_a855131c0a6f792bb2cb4794ad626d601"><div class="ttname"><a href="structpjmedia__sdp__session.htm#a855131c0a6f792bb2cb4794ad626d601">pjmedia_sdp_session::user</a></div><div class="ttdeci">pj_str_t user</div><div class="ttdef"><b>Definition:</b> sdp.h:669</div></div>
<div class="ttc" id="structpjmedia__rtcp__session_htm_a8e39b260b36a89bb731971a4df4d76fd"><div class="ttname"><a href="structpjmedia__rtcp__session.htm#a8e39b260b36a89bb731971a4df4d76fd">pjmedia_rtcp_session::stat</a></div><div class="ttdeci">pjmedia_rtcp_stat stat</div><div class="ttdef"><b>Definition:</b> rtcp.h:257</div></div>
<div class="ttc" id="group__PJMEDIA__TRANSPORT_htm_ga5fe97ac16287563420950a8b87d247b4"><div class="ttname"><a href="group__PJMEDIA__TRANSPORT.htm#ga5fe97ac16287563420950a8b87d247b4">pjmedia_transport_send_rtcp</a></div><div class="ttdeci">pj_status_t pjmedia_transport_send_rtcp(pjmedia_transport *tp, const void *pkt, pj_size_t size)</div><div class="ttdef"><b>Definition:</b> transport.h:858</div></div>
<div class="ttc" id="structpj__time__val_htm"><div class="ttname"><a href="../../../pjlib/docs/html/structpj__time__val.htm">pj_time_val</a></div></div>
<div class="ttc" id="structpj__getopt__option_htm"><div class="ttname"><a href="../../../pjlib-util/docs/html/structpj__getopt__option.htm">pj_getopt_option</a></div></div>
<div class="ttc" id="group__PJ__TIME_htm_gaec98fc019fc44b5a6f6b0b9137bcf272"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__TIME.htm#gaec98fc019fc44b5a6f6b0b9137bcf272">PJ_TIME_VAL_SUB</a></div><div class="ttdeci">#define PJ_TIME_VAL_SUB(t1, t2)</div></div>
<div class="ttc" id="group__PJMEDIA__TYPES_htm_ga7c3623d8e90e22b7184a6e42dc24f6f5"><div class="ttname"><a href="group__PJMEDIA__TYPES.htm#ga7c3623d8e90e22b7184a6e42dc24f6f5">pjmedia_endpt</a></div><div class="ttdeci">struct pjmedia_endpt pjmedia_endpt</div><div class="ttdef"><b>Definition:</b> types.h:187</div></div>
<div class="ttc" id="group__PJ__SOCK_htm_ga8ea303b95fe973432a361e47e0459086"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__SOCK.htm#ga8ea303b95fe973432a361e47e0459086">pj_AF_INET</a></div><div class="ttdeci">#define pj_AF_INET()</div></div>
<div class="ttc" id="group__PJ__TIMESTAMP_htm_gaa419b8448d1cb55db85aeac2e86fe11c"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__TIMESTAMP.htm#gaa419b8448d1cb55db85aeac2e86fe11c">pj_get_timestamp</a></div><div class="ttdeci">pj_status_t pj_get_timestamp(pj_timestamp *ts)</div></div>
<div class="ttc" id="unionpj__timestamp_htm"><div class="ttname"><a href="../../../pjlib/docs/html/unionpj__timestamp.htm">pj_timestamp</a></div></div>
<div class="ttc" id="structpjmedia__codec__info_htm_a3e3ae875043c693a1453b2a8d398f35a"><div class="ttname"><a href="structpjmedia__codec__info.htm#a3e3ae875043c693a1453b2a8d398f35a">pjmedia_codec_info::pt</a></div><div class="ttdeci">unsigned pt</div><div class="ttdef"><b>Definition:</b> codec.h:238</div></div>
<div class="ttc" id="structpjmedia__sdp__session_htm_ac4166d3ae2ffbd679edba7d9e351db29"><div class="ttname"><a href="structpjmedia__sdp__session.htm#ac4166d3ae2ffbd679edba7d9e351db29">pjmedia_sdp_session::addr</a></div><div class="ttdeci">pj_str_t addr</div><div class="ttdef"><b>Definition:</b> sdp.h:674</div></div>
<div class="ttc" id="group__PJ__TIME_htm_gad015d440803cb8f62ff73878f35badaa"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__TIME.htm#gad015d440803cb8f62ff73878f35badaa">PJ_TIME_VAL_MSEC</a></div><div class="ttdeci">#define PJ_TIME_VAL_MSEC(t)</div></div>
<div class="ttc" id="structpjmedia__sdp__media_htm_a0804e7ebf233f4e2950080927cbba57a"><div class="ttname"><a href="structpjmedia__sdp__media.htm#a0804e7ebf233f4e2950080927cbba57a">pjmedia_sdp_media::media</a></div><div class="ttdeci">pj_str_t media</div><div class="ttdef"><b>Definition:</b> sdp.h:465</div></div>
<div class="ttc" id="structpjmedia__transport_htm"><div class="ttname"><a href="structpjmedia__transport.htm">pjmedia_transport</a></div><div class="ttdef"><b>Definition:</b> transport.h:504</div></div>
<div class="ttc" id="group__PJ__POOL_htm_ga405d1dbb6728b1d1bd90ddadb9342b27"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__POOL.htm#ga405d1dbb6728b1d1bd90ddadb9342b27">PJ_POOL_ZALLOC_T</a></div><div class="ttdeci">#define PJ_POOL_ZALLOC_T(pool, type)</div></div>
<div class="ttc" id="group__PJMEDIA__SDP_htm_ga35e2836c8694c99c0a8f5acf46a0afe8"><div class="ttname"><a href="group__PJMEDIA__SDP.htm#ga35e2836c8694c99c0a8f5acf46a0afe8">pjmedia_sdp_rtpmap_to_attr</a></div><div class="ttdeci">pj_status_t pjmedia_sdp_rtpmap_to_attr(pj_pool_t *pool, const pjmedia_sdp_rtpmap *rtpmap, pjmedia_sdp_attr **p_attr)</div></div>
<div class="ttc" id="structpjmedia__sdp__media_htm_a260ceac6d572983b31b484c3697a575d"><div class="ttname"><a href="structpjmedia__sdp__media.htm#a260ceac6d572983b31b484c3697a575d">pjmedia_sdp_media::transport</a></div><div class="ttdeci">pj_str_t transport</div><div class="ttdef"><b>Definition:</b> sdp.h:468</div></div>
<div class="ttc" id="group__PJ__LOG_htm_ga767b9231bf7c2b57274771cdc4bca818"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__LOG.htm#ga767b9231bf7c2b57274771cdc4bca818">PJ_LOG</a></div><div class="ttdeci">#define PJ_LOG(level, arg)</div></div>
<div class="ttc" id="group__PJMEDIA__TRANSPORT_htm_ga213beab16cd5d94437c2890b9f3fe75b"><div class="ttname"><a href="group__PJMEDIA__TRANSPORT.htm#ga213beab16cd5d94437c2890b9f3fe75b">pjmedia_transport_get_info</a></div><div class="ttdeci">pj_status_t pjmedia_transport_get_info(pjmedia_transport *tp, pjmedia_transport_info *info)</div><div class="ttdef"><b>Definition:</b> transport.h:689</div></div>
<div class="ttc" id="structpjmedia__sdp__session_htm_a30c79db08d5d22d2fce2179717a7cfeb"><div class="ttname"><a href="structpjmedia__sdp__session.htm#a30c79db08d5d22d2fce2179717a7cfeb">pjmedia_sdp_session::conn</a></div><div class="ttdeci">pjmedia_sdp_conn * conn</div><div class="ttdef"><b>Definition:</b> sdp.h:678</div></div>
<div class="ttc" id="group__PJ__BASIC_htm_gab43ba3167bd2a2ab4580509dbf79200e"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a></div><div class="ttdeci">int pj_status_t</div></div>
<div class="ttc" id="group__PJ__SOCK_htm_ga25ce2f95b79d3556375804123a5eb77e"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__SOCK.htm#ga25ce2f95b79d3556375804123a5eb77e">pj_htons</a></div><div class="ttdeci">pj_uint16_t pj_htons(pj_uint16_t hostshort)</div></div>
<div class="ttc" id="group__PJ__THREAD_htm_ga7b63533cf4f3ba0cba68cab49a22d722"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__THREAD.htm#ga7b63533cf4f3ba0cba68cab49a22d722">pj_thread_create</a></div><div class="ttdeci">pj_status_t pj_thread_create(pj_pool_t *pool, const char *thread_name, pj_thread_proc *proc, void *arg, pj_size_t stack_size, unsigned flags, pj_thread_t **thread)</div></div>
<div class="ttc" id="structpjmedia__sdp__session_htm_a0a8af45154f3f04823f1ff0ccc13bc54"><div class="ttname"><a href="structpjmedia__sdp__session.htm#a0a8af45154f3f04823f1ff0ccc13bc54">pjmedia_sdp_session::attr_count</a></div><div class="ttdeci">unsigned attr_count</div><div class="ttdef"><b>Definition:</b> sdp.h:690</div></div>
<div class="ttc" id="group__PJMED__RTP_htm_gaaa82e024f28c4796159d3d9bbe9c93ec"><div class="ttname"><a href="group__PJMED__RTP.htm#gaaa82e024f28c4796159d3d9bbe9c93ec">pjmedia_rtp_decode_rtp</a></div><div class="ttdeci">pj_status_t pjmedia_rtp_decode_rtp(pjmedia_rtp_session *ses, const void *pkt, int pkt_len, const pjmedia_rtp_hdr **hdr, const void **payload, unsigned *payloadlen)</div></div>
<div class="ttc" id="structpjmedia__sdp__rtpmap_htm"><div class="ttname"><a href="structpjmedia__sdp__rtpmap.htm">pjmedia_sdp_rtpmap</a></div><div class="ttdef"><b>Definition:</b> sdp.h:212</div></div>
<div class="ttc" id="structpjmedia__transport__info_htm_a0d8a2639d0a981e9e025d71e200160cb"><div class="ttname"><a href="structpjmedia__transport__info.htm#a0d8a2639d0a981e9e025d71e200160cb">pjmedia_transport_info::sock_info</a></div><div class="ttdeci">pjmedia_sock_info sock_info</div><div class="ttdef"><b>Definition:</b> transport.h:555</div></div>
<div class="ttc" id="group__PJ__POOL__FACTORY_htm_ga98cf758eafb888f318a8de7f396f47ca"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__POOL__FACTORY.htm#ga98cf758eafb888f318a8de7f396f47ca">pj_pool_factory_default_policy</a></div><div class="ttdeci">pj_pool_factory_policy pj_pool_factory_default_policy</div></div>
<div class="ttc" id="structpj__str__t_htm"><div class="ttname"><a href="../../../pjlib/docs/html/structpj__str__t.htm">pj_str_t</a></div></div>
<div class="ttc" id="structpjmedia__sdp__session_htm_ab10d483a2db7a29491a4cbf2ea08b56c"><div class="ttname"><a href="structpjmedia__sdp__session.htm#ab10d483a2db7a29491a4cbf2ea08b56c">pjmedia_sdp_session::media</a></div><div class="ttdeci">pjmedia_sdp_media * media[16]</div><div class="ttdef"><b>Definition:</b> sdp.h:694</div></div>
<div class="ttc" id="structpjmedia__rtcp__session_htm"><div class="ttname"><a href="structpjmedia__rtcp__session.htm">pjmedia_rtcp_session</a></div><div class="ttdef"><b>Definition:</b> rtcp.h:232</div></div>
<div class="ttc" id="group__PJ__PSTR_htm_ga96cdcaa39650b7f36fd850f53f4ebebf"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga96cdcaa39650b7f36fd850f53f4ebebf">pj_strdup2</a></div><div class="ttdeci">pj_str_t * pj_strdup2(pj_pool_t *pool, pj_str_t *dst, const char *src)</div></div>
<div class="ttc" id="structpjmedia__sdp__session_htm_a8668742094b041a4d5821d8dd0248be9"><div class="ttname"><a href="structpjmedia__sdp__session.htm#a8668742094b041a4d5821d8dd0248be9">pjmedia_sdp_session::addr_type</a></div><div class="ttdeci">pj_str_t addr_type</div><div class="ttdef"><b>Definition:</b> sdp.h:673</div></div>
<div class="ttc" id="group__PJ__SOCK_htm_gae6169f27eb956287681a46ca9fecdafc"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__SOCK.htm#gae6169f27eb956287681a46ca9fecdafc">pj_sockaddr_in_init</a></div><div class="ttdeci">pj_status_t pj_sockaddr_in_init(pj_sockaddr_in *addr, const pj_str_t *cp, pj_uint16_t port)</div></div>
<div class="ttc" id="structpjmedia__sdp__conn_htm"><div class="ttname"><a href="structpjmedia__sdp__conn.htm">pjmedia_sdp_conn</a></div><div class="ttdef"><b>Definition:</b> sdp.h:381</div></div>
<div class="ttc" id="group__PJ__SOCK_htm_ga55c6836b3f858528c4a3855deb12154e"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__SOCK.htm#ga55c6836b3f858528c4a3855deb12154e">pj_ntohl</a></div><div class="ttdeci">pj_uint32_t pj_ntohl(pj_uint32_t netlong)</div></div>
<div class="ttc" id="group__PJ__BASIC_htm_gafbfd2fd08c6041ea3cb217310c0b5b48"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gafbfd2fd08c6041ea3cb217310c0b5b48">pj_uint32_t</a></div><div class="ttdeci">unsigned int pj_uint32_t</div></div>
<div class="ttc" id="structpjmedia__sdp__conn_htm_aec4591c8dff072399537e741745b65b2"><div class="ttname"><a href="structpjmedia__sdp__conn.htm#aec4591c8dff072399537e741745b65b2">pjmedia_sdp_conn::addr_type</a></div><div class="ttdeci">pj_str_t addr_type</div><div class="ttdef"><b>Definition:</b> sdp.h:384</div></div>
<div class="ttc" id="group__PJMEDIA__SESSION_htm_gae0400f365c07b6f141f202defe92f2a6"><div class="ttname"><a href="group__PJMEDIA__SESSION.htm#gae0400f365c07b6f141f202defe92f2a6">pjmedia_stream_info_from_sdp</a></div><div class="ttdeci">pj_status_t pjmedia_stream_info_from_sdp(pjmedia_stream_info *si, pj_pool_t *pool, pjmedia_endpt *endpt, const pjmedia_sdp_session *local, const pjmedia_sdp_session *remote, unsigned stream_idx)</div></div>
<div class="ttc" id="structpj__timer__entry_htm_a13e63641afbb94298b79967585c0f642"><div class="ttname"><a href="../../../pjlib/docs/html/structpj__timer__entry.htm#a13e63641afbb94298b79967585c0f642">pj_timer_entry::cb</a></div><div class="ttdeci">pj_timer_heap_callback * cb</div></div>
<div class="ttc" id="group__PJMED__RTCP_htm_ga7ce9e4e76674dba050c01cd295964bde"><div class="ttname"><a href="group__PJMED__RTCP.htm#ga7ce9e4e76674dba050c01cd295964bde">pjmedia_rtcp_rx_rtp</a></div><div class="ttdeci">void pjmedia_rtcp_rx_rtp(pjmedia_rtcp_session *session, unsigned seq, unsigned ts, unsigned payload)</div></div>
<div class="ttc" id="pjmedia-codec_8h_htm"><div class="ttname"><a href="pjmedia-codec_8h.htm">pjmedia-codec.h</a></div><div class="ttdoc">Include all codecs API in PJMEDIA-CODEC. </div></div>
<div class="ttc" id="group__PJ__TIME_htm_ga0b28411e03320ad6bb5f3316125b461c"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__TIME.htm#ga0b28411e03320ad6bb5f3316125b461c">pj_time_val_normalize</a></div><div class="ttdeci">void pj_time_val_normalize(pj_time_val *t)</div></div>
<div class="ttc" id="structpjmedia__sdp__rtpmap_htm_aa5ac5e66a6dcdbb9d9a16f4d6f7852c9"><div class="ttname"><a href="structpjmedia__sdp__rtpmap.htm#aa5ac5e66a6dcdbb9d9a16f4d6f7852c9">pjmedia_sdp_rtpmap::pt</a></div><div class="ttdeci">pj_str_t pt</div><div class="ttdef"><b>Definition:</b> sdp.h:214</div></div>
<div class="ttc" id="structmedia__stream_htm"><div class="ttname"><a href="structmedia__stream.htm">media_stream</a></div><div class="ttdef"><b>Definition:</b> siprtp.c:113</div></div>
<div class="ttc" id="group__pj__errnum_htm_gadb73764809be94c12e84bb79ba1a25a4"><div class="ttname"><a href="../../../pjlib/docs/html/group__pj__errnum.htm#gadb73764809be94c12e84bb79ba1a25a4">PJ_ETOOMANY</a></div><div class="ttdeci">#define PJ_ETOOMANY</div></div>
<div class="ttc" id="group__PJ__BASIC_htm_gga65c74a186d2c92fe9f088f3e1e8688bead235b21a623d982cc561fb12bffa87c0"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead235b21a623d982cc561fb12bffa87c0">PJ_TRUE</a></div><div class="ttdeci">PJ_TRUE</div></div>
<div class="ttc" id="structpjmedia__stream__info_htm"><div class="ttname"><a href="structpjmedia__stream__info.htm">pjmedia_stream_info</a></div><div class="ttdef"><b>Definition:</b> stream.h:93</div></div>
<div class="ttc" id="group__PJ__SOCK_htm_ga47bc19975b9e88fc86d4bf43ffd2a17f"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__SOCK.htm#ga47bc19975b9e88fc86d4bf43ffd2a17f">pj_gethostname</a></div><div class="ttdeci">const pj_str_t * pj_gethostname(void)</div></div>
<div class="ttc" id="structpjmedia__sdp__session_htm_a70bb5508d177733dcaeda1e821593ec2"><div class="ttname"><a href="structpjmedia__sdp__session.htm#a70bb5508d177733dcaeda1e821593ec2">pjmedia_sdp_session::name</a></div><div class="ttdeci">pj_str_t name</div><div class="ttdef"><b>Definition:</b> sdp.h:677</div></div>
<div class="ttc" id="structpjmedia__rtcp__stream__stat_htm_affde734834ce0313abbdb60ab0a0a199"><div class="ttname"><a href="structpjmedia__rtcp__stream__stat.htm#affde734834ce0313abbdb60ab0a0a199">pjmedia_rtcp_stream_stat::bytes</a></div><div class="ttdeci">pj_uint32_t bytes</div><div class="ttdef"><b>Definition:</b> rtcp.h:176</div></div>
<div class="ttc" id="group__pj__errno_htm_gacc85d9323301650f961ae38e689fefcd"><div class="ttname"><a href="../../../pjlib/docs/html/group__pj__errno.htm#gacc85d9323301650f961ae38e689fefcd">PJ_RETURN_OS_ERROR</a></div><div class="ttdeci">#define PJ_RETURN_OS_ERROR(os_code)</div></div>
<div class="ttc" id="structpjmedia__rtp__hdr_htm_a4afb857e88d1bf0c2dd4d457c215a837"><div class="ttname"><a href="structpjmedia__rtp__hdr.htm#a4afb857e88d1bf0c2dd4d457c215a837">pjmedia_rtp_hdr::ts</a></div><div class="ttdeci">pj_uint32_t ts</div><div class="ttdef"><b>Definition:</b> rtp.h:104</div></div>
<div class="ttc" id="group__PJMED__ENDPT_htm_ga2865efcd255dbcb05ede33dbae5c27f5"><div class="ttname"><a href="group__PJMED__ENDPT.htm#ga2865efcd255dbcb05ede33dbae5c27f5">pjmedia_endpt_create</a></div><div class="ttdeci">pj_status_t pjmedia_endpt_create(pj_pool_factory *pf, pj_ioqueue_t *ioqueue, unsigned worker_cnt, pjmedia_endpt **p_endpt)</div><div class="ttdef"><b>Definition:</b> endpoint.h:128</div></div>
<div class="ttc" id="group__pj__config_htm_ga5074ce869f2077ea0f53ef137cbe3a24"><div class="ttname"><a href="../../../pjlib/docs/html/group__pj__config.htm#ga5074ce869f2077ea0f53ef137cbe3a24">PJ_TODO</a></div><div class="ttdeci">#define PJ_TODO(id)</div></div>
<div class="ttc" id="structpjmedia__sdp__media_htm_a6801faf5ebb9919f1cb12842d5e4bc76"><div class="ttname"><a href="structpjmedia__sdp__media.htm#a6801faf5ebb9919f1cb12842d5e4bc76">pjmedia_sdp_media::attr_count</a></div><div class="ttdeci">unsigned attr_count</div><div class="ttdef"><b>Definition:</b> sdp.h:476</div></div>
<div class="ttc" id="group__PJMEDIA__TRANSPORT_htm_gab293d1afad42d1f49745f3fcd235fa17"><div class="ttname"><a href="group__PJMEDIA__TRANSPORT.htm#gab293d1afad42d1f49745f3fcd235fa17">pjmedia_transport_info_init</a></div><div class="ttdeci">void pjmedia_transport_info_init(pjmedia_transport_info *info)</div><div class="ttdef"><b>Definition:</b> transport.h:671</div></div>
<div class="ttc" id="structpjmedia__sdp__session_htm_a705e23a332b3647491b19e7bea893aea"><div class="ttname"><a href="structpjmedia__sdp__session.htm#a705e23a332b3647491b19e7bea893aea">pjmedia_sdp_session::time</a></div><div class="ttdeci">struct pjmedia_sdp_session::@14 time</div></div>
<div class="ttc" id="structcall_htm_ab6cff6ed65f7f63136706c4a423d5d3d"><div class="ttname"><a href="structcall.htm#ab6cff6ed65f7f63136706c4a423d5d3d">call::d_timer</a></div><div class="ttdeci">pj_timer_entry d_timer</div><div class="ttdef"><b>Definition:</b> siprtp.c:157</div></div>
<div class="ttc" id="structpjmedia__stream__info_htm_af9715928854d6cf2b9710856836acd36"><div class="ttname"><a href="structpjmedia__stream__info.htm#af9715928854d6cf2b9710856836acd36">pjmedia_stream_info::rem_rtcp</a></div><div class="ttdeci">pj_sockaddr rem_rtcp</div><div class="ttdef"><b>Definition:</b> stream.h:100</div></div>
<div class="ttc" id="structpj__timer__entry_htm_a96ce07b4b890b820ccd1e8365b88add6"><div class="ttname"><a href="../../../pjlib/docs/html/structpj__timer__entry.htm#a96ce07b4b890b820ccd1e8365b88add6">pj_timer_entry::user_data</a></div><div class="ttdeci">void * user_data</div></div>
<div class="ttc" id="group__PJ__PSTR_htm_ga20fa0c4d9ccddd0822a775730cf4a867"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__PSTR.htm#ga20fa0c4d9ccddd0822a775730cf4a867">pj_str</a></div><div class="ttdeci">pj_str_t pj_str(char *str)</div></div>
<div class="ttc" id="structpjmedia__sdp__session_htm_a48233db45dc84704c95bf6175462d9e4"><div class="ttname"><a href="structpjmedia__sdp__session.htm#a48233db45dc84704c95bf6175462d9e4">pjmedia_sdp_session::net_type</a></div><div class="ttdeci">pj_str_t net_type</div><div class="ttdef"><b>Definition:</b> sdp.h:672</div></div>
<div class="ttc" id="group__PJMED__RTCP_htm_gaa0927538050a3cde5a51f32cb586f7d0"><div class="ttname"><a href="group__PJMED__RTCP.htm#gaa0927538050a3cde5a51f32cb586f7d0">pjmedia_rtcp_tx_rtp</a></div><div class="ttdeci">void pjmedia_rtcp_tx_rtp(pjmedia_rtcp_session *session, unsigned ptsize)</div></div>
<div class="ttc" id="structpjmedia__sdp__media_htm_a8834dacf968d51c3998a32ef4f30310f"><div class="ttname"><a href="structpjmedia__sdp__media.htm#a8834dacf968d51c3998a32ef4f30310f">pjmedia_sdp_media::fmt_count</a></div><div class="ttdeci">unsigned fmt_count</div><div class="ttdef"><b>Definition:</b> sdp.h:469</div></div>
<div class="ttc" id="structpj__time__val_htm_ab9cc04663b258dd3dcb449a3110e0d82"><div class="ttname"><a href="../../../pjlib/docs/html/structpj__time__val.htm#ab9cc04663b258dd3dcb449a3110e0d82">pj_time_val::msec</a></div><div class="ttdeci">long msec</div></div>
<div class="ttc" id="group__PJ__CACHING__POOL_htm_gafbf5400f191e2095240bc6472754e94f"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__CACHING__POOL.htm#gafbf5400f191e2095240bc6472754e94f">pj_caching_pool_init</a></div><div class="ttdeci">void pj_caching_pool_init(pj_caching_pool *ch_pool, const pj_pool_factory_policy *policy, pj_size_t max_capacity)</div></div>
<div class="ttc" id="structpjmedia__rtcp__stat_htm"><div class="ttname"><a href="structpjmedia__rtcp__stat.htm">pjmedia_rtcp_stat</a></div><div class="ttdef"><b>Definition:</b> rtcp.h:197</div></div>
<div class="ttc" id="structpjmedia__sdp__media_htm_a8b201f0cfeab12e32b581b335263e3b7"><div class="ttname"><a href="structpjmedia__sdp__media.htm#a8b201f0cfeab12e32b581b335263e3b7">pjmedia_sdp_media::attr</a></div><div class="ttdeci">pjmedia_sdp_attr * attr[(32 *2+4)]</div><div class="ttdef"><b>Definition:</b> sdp.h:477</div></div>
<div class="ttc" id="structpjmedia__rtcp__stream__stat_htm_a6b2222588e10045bbfb98605e8970465"><div class="ttname"><a href="structpjmedia__rtcp__stream__stat.htm#a6b2222588e10045bbfb98605e8970465">pjmedia_rtcp_stream_stat::reorder</a></div><div class="ttdeci">unsigned reorder</div><div class="ttdef"><b>Definition:</b> rtcp.h:179</div></div>
<div class="ttc" id="group__PJ__BASIC_htm_ga173588cd6381f3ad354c23c26929093a"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga173588cd6381f3ad354c23c26929093a">pj_ssize_t</a></div><div class="ttdeci">long pj_ssize_t</div></div>
<div class="ttc" id="structpjmedia__sdp__conn_htm_ae603b165ba204743ab9b9fb5d22f1537"><div class="ttname"><a href="structpjmedia__sdp__conn.htm#ae603b165ba204743ab9b9fb5d22f1537">pjmedia_sdp_conn::addr</a></div><div class="ttdeci">pj_str_t addr</div><div class="ttdef"><b>Definition:</b> sdp.h:385</div></div>
<div class="ttc" id="group__PJLIB__UTIL__BASE_htm_gaf44fef477c4b0e38a99004965fc55110"><div class="ttname"><a href="../../../pjlib-util/docs/html/group__PJLIB__UTIL__BASE.htm#gaf44fef477c4b0e38a99004965fc55110">pjlib_util_init</a></div><div class="ttdeci">PJ_BEGIN_DECL pj_status_t pjlib_util_init(void)</div></div>
<div class="ttc" id="group__PJ__PSTR_htm_gafa92001573289c87313c660146369fa3"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__PSTR.htm#gafa92001573289c87313c660146369fa3">pj_bzero</a></div><div class="ttdeci">void pj_bzero(void *dst, pj_size_t size)</div></div>
<div class="ttc" id="structpjmedia__sdp__attr_htm"><div class="ttname"><a href="structpjmedia__sdp__attr.htm">pjmedia_sdp_attr</a></div><div class="ttdef"><b>Definition:</b> sdp.h:85</div></div>
<div class="ttc" id="structpjmedia__sdp__media_htm_a9b9aeefe5e698a3d9c29069775bcc4f4"><div class="ttname"><a href="structpjmedia__sdp__media.htm#a9b9aeefe5e698a3d9c29069775bcc4f4">pjmedia_sdp_media::fmt</a></div><div class="ttdeci">pj_str_t fmt[32]</div><div class="ttdef"><b>Definition:</b> sdp.h:470</div></div>
<div class="ttc" id="group__pj__errno_htm_ga7d2616aded0d61924fb31f4fd6ee45c0"><div class="ttname"><a href="../../../pjlib/docs/html/group__pj__errno.htm#ga7d2616aded0d61924fb31f4fd6ee45c0">pj_strerror</a></div><div class="ttdeci">pj_str_t pj_strerror(pj_status_t statcode, char *buf, pj_size_t bufsize)</div></div>
<div class="ttc" id="group__PJ__TIME_htm_ga0806df13f40d3153061f399ed86be856"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__TIME.htm#ga0806df13f40d3153061f399ed86be856">pj_gettimeofday</a></div><div class="ttdeci">pj_status_t pj_gettimeofday(pj_time_val *tv)</div></div>
<div class="ttc" id="structpjmedia__sdp__session_htm"><div class="ttname"><a href="structpjmedia__sdp__session.htm">pjmedia_sdp_session</a></div><div class="ttdef"><b>Definition:</b> sdp.h:664</div></div>
<div class="ttc" id="structpjmedia__rtp__session_htm"><div class="ttname"><a href="structpjmedia__rtp__session.htm">pjmedia_rtp_session</a></div><div class="ttdef"><b>Definition:</b> rtp.h:200</div></div>
<div class="ttc" id="structpjmedia__rtp__hdr_htm_ac7031a2645fb6986552be171fe3742be"><div class="ttname"><a href="structpjmedia__rtp__hdr.htm#ac7031a2645fb6986552be171fe3742be">pjmedia_rtp_hdr::seq</a></div><div class="ttdeci">pj_uint16_t seq</div><div class="ttdef"><b>Definition:</b> rtp.h:103</div></div>
<div class="ttc" id="structpjmedia__sdp__attr_htm_ad9275c5178fcaccaace34c73315a2754"><div class="ttname"><a href="structpjmedia__sdp__attr.htm#ad9275c5178fcaccaace34c73315a2754">pjmedia_sdp_attr::name</a></div><div class="ttdeci">pj_str_t name</div><div class="ttdef"><b>Definition:</b> sdp.h:87</div></div>
<div class="ttc" id="group__pj__assert_htm_ga981d47a5e9d7e9655473244839f0f5d3"><div class="ttname"><a href="../../../pjlib/docs/html/group__pj__assert.htm#ga981d47a5e9d7e9655473244839f0f5d3">pj_assert</a></div><div class="ttdeci">#define pj_assert(expr)</div></div>
<div class="ttc" id="structpj__pool__t_htm"><div class="ttname"><a href="../../../pjlib/docs/html/structpj__pool__t.htm">pj_pool_t</a></div></div>
<div class="ttc" id="structpjmedia__rtcp__stream__stat_htm_ab7b015e32617857558c45a30e2ae0928"><div class="ttname"><a href="structpjmedia__rtcp__stream__stat.htm#ab7b015e32617857558c45a30e2ae0928">pjmedia_rtcp_stream_stat::jitter</a></div><div class="ttdeci">pj_math_stat jitter</div><div class="ttdef"><b>Definition:</b> rtcp.h:189</div></div>
<div class="ttc" id="group__PJ__SOCK_htm_ga4d4616a16aa2f3dd1be104091215fdc8"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__SOCK.htm#ga4d4616a16aa2f3dd1be104091215fdc8">PJ_INET_ADDRSTRLEN</a></div><div class="ttdeci">#define PJ_INET_ADDRSTRLEN</div></div>
<div class="ttc" id="structpjmedia__rtcp__stat_htm_a6a783087dff8d922f3a85a33d6cf2b45"><div class="ttname"><a href="structpjmedia__rtcp__stat.htm#a6a783087dff8d922f3a85a33d6cf2b45">pjmedia_rtcp_stat::rx</a></div><div class="ttdeci">pjmedia_rtcp_stream_stat rx</div><div class="ttdef"><b>Definition:</b> rtcp.h:202</div></div>
<div class="ttc" id="group__PJ__BASIC_htm_gacd8459212a1e5175eeb04e3a6cd76659"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gacd8459212a1e5175eeb04e3a6cd76659">PJ_ARRAY_SIZE</a></div><div class="ttdeci">#define PJ_ARRAY_SIZE(a)</div></div>
<div class="ttc" id="structpjmedia__sdp__rtpmap_htm_ae9d5c258976b6fbb4ef4b6793aba882c"><div class="ttname"><a href="structpjmedia__sdp__rtpmap.htm#ae9d5c258976b6fbb4ef4b6793aba882c">pjmedia_sdp_rtpmap::clock_rate</a></div><div class="ttdeci">unsigned clock_rate</div><div class="ttdef"><b>Definition:</b> sdp.h:216</div></div>
<div class="ttc" id="structpjmedia__stream__info_htm_a51935172b090b66042175846c0e96213"><div class="ttname"><a href="structpjmedia__stream__info.htm#a51935172b090b66042175846c0e96213">pjmedia_stream_info::rem_addr</a></div><div class="ttdeci">pj_sockaddr rem_addr</div><div class="ttdef"><b>Definition:</b> stream.h:99</div></div>
<div class="ttc" id="structcall_htm"><div class="ttname"><a href="structcall.htm">call</a></div><div class="ttdef"><b>Definition:</b> pjsip-perf.c:172</div></div>
<div class="ttc" id="group__pj__errno_htm_ga314a8edfdcec54a086a401e97b5b0bd0"><div class="ttname"><a href="../../../pjlib/docs/html/group__pj__errno.htm#ga314a8edfdcec54a086a401e97b5b0bd0">PJ_ERR_MSG_SIZE</a></div><div class="ttdeci">#define PJ_ERR_MSG_SIZE</div></div>
<div class="ttc" id="group__PJ__POOL_htm_gaf58c3ba26a1314c0e0be103960ba4a5e"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__POOL.htm#gaf58c3ba26a1314c0e0be103960ba4a5e">pj_pool_create</a></div><div class="ttdeci">pj_pool_t * pj_pool_create(pj_pool_factory *factory, const char *name, pj_size_t initial_size, pj_size_t increment_size, pj_pool_callback *callback)</div></div>
<div class="ttc" id="structpjmedia__rtp__hdr_htm"><div class="ttname"><a href="structpjmedia__rtp__hdr.htm">pjmedia_rtp_hdr</a></div><div class="ttdef"><b>Definition:</b> rtp.h:86</div></div>
<div class="ttc" id="group__pj__assert_htm_ga9a6f79ac0dc0677698c5735474adfad7"><div class="ttname"><a href="../../../pjlib/docs/html/group__pj__assert.htm#ga9a6f79ac0dc0677698c5735474adfad7">PJ_ASSERT_ON_FAIL</a></div><div class="ttdeci">#define PJ_ASSERT_ON_FAIL(expr, exec_on_fail)</div></div>
<div class="ttc" id="structpj__timer__entry_htm_a70aed199d89e16a05bd9643efd3d665d"><div class="ttname"><a href="../../../pjlib/docs/html/structpj__timer__entry.htm#a70aed199d89e16a05bd9643efd3d665d">pj_timer_entry::id</a></div><div class="ttdeci">int id</div></div>
<div class="ttc" id="group__PJ__THREAD_htm_ga60d90ce08d2f7e92dcaa0443cf87912f"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__THREAD.htm#ga60d90ce08d2f7e92dcaa0443cf87912f">pj_thread_join</a></div><div class="ttdeci">pj_status_t pj_thread_join(pj_thread_t *thread)</div></div>
<div class="ttc" id="structpj__timer__entry_htm"><div class="ttname"><a href="../../../pjlib/docs/html/structpj__timer__entry.htm">pj_timer_entry</a></div></div>
<div class="ttc" id="group__PJMEDIA__TRANSPORT_htm_ga74ab1c1b9b09d75865a231519bb58aa7"><div class="ttname"><a href="group__PJMEDIA__TRANSPORT.htm#ga74ab1c1b9b09d75865a231519bb58aa7">pjmedia_transport_media_start</a></div><div class="ttdeci">pj_status_t pjmedia_transport_media_start(pjmedia_transport *tp, pj_pool_t *tmp_pool, const pjmedia_sdp_session *sdp_local, const pjmedia_sdp_session *sdp_remote, unsigned media_index)</div><div class="ttdef"><b>Definition:</b> transport.h:967</div></div>
<div class="ttc" id="structpjmedia__sdp__media_htm_ad468b2e8ec3371cc6c877d9dfde892b1"><div class="ttname"><a href="structpjmedia__sdp__media.htm#ad468b2e8ec3371cc6c877d9dfde892b1">pjmedia_sdp_media::port</a></div><div class="ttdeci">pj_uint16_t port</div><div class="ttdef"><b>Definition:</b> sdp.h:466</div></div>
<div class="ttc" id="group__PJ__THREAD_htm_ga5435f79ad044f9ce2113af311bf2b777"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__THREAD.htm#ga5435f79ad044f9ce2113af311bf2b777">pj_thread_destroy</a></div><div class="ttdeci">pj_status_t pj_thread_destroy(pj_thread_t *thread)</div></div>
<div class="ttc" id="structpjmedia__sdp__conn_htm_a8ed74cf5284dc14a5ab06bd09f204856"><div class="ttname"><a href="structpjmedia__sdp__conn.htm#a8ed74cf5284dc14a5ab06bd09f204856">pjmedia_sdp_conn::net_type</a></div><div class="ttdeci">pj_str_t net_type</div><div class="ttdef"><b>Definition:</b> sdp.h:383</div></div>
<div class="ttc" id="unionpj__sockaddr_htm_ab25ec448ae63acfdd2aa0f3ef2fd10b8"><div class="ttname"><a href="../../../pjlib/docs/html/unionpj__sockaddr.htm#ab25ec448ae63acfdd2aa0f3ef2fd10b8">pj_sockaddr::ipv4</a></div><div class="ttdeci">pj_sockaddr_in ipv4</div></div>
<div class="ttc" id="structpj__time__val_htm_af2739d0c2189e9c902281c04fd1f4502"><div class="ttname"><a href="../../../pjlib/docs/html/structpj__time__val.htm#af2739d0c2189e9c902281c04fd1f4502">pj_time_val::sec</a></div><div class="ttdeci">long sec</div></div>
<div class="ttc" id="structpjmedia__sdp__session_htm_ac39a49696a42f536ee2904aadcefb7d6"><div class="ttname"><a href="structpjmedia__sdp__session.htm#ac39a49696a42f536ee2904aadcefb7d6">pjmedia_sdp_session::media_count</a></div><div class="ttdeci">unsigned media_count</div><div class="ttdef"><b>Definition:</b> sdp.h:693</div></div>
<div class="ttc" id="group__PJ__BASIC_htm_gad42209dcf11f957ed9f1790e30f519cd"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gad42209dcf11f957ed9f1790e30f519cd">pj_shutdown</a></div><div class="ttdeci">void pj_shutdown(void)</div></div>
<div class="ttc" id="structpjmedia__sock__info_htm_aa2cecdb5ff13922865a33d49f3ccd0c8"><div class="ttname"><a href="structpjmedia__sock__info.htm#aa2cecdb5ff13922865a33d49f3ccd0c8">pjmedia_sock_info::rtp_addr_name</a></div><div class="ttdeci">pj_sockaddr rtp_addr_name</div><div class="ttdef"><b>Definition:</b> transport.h:286</div></div>
<div class="ttc" id="group__PJ__TIMESTAMP_htm_ga08e3e11a5e8f68f3111e5ecf3bff0ac1"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__TIMESTAMP.htm#ga08e3e11a5e8f68f3111e5ecf3bff0ac1">pj_get_timestamp_freq</a></div><div class="ttdeci">pj_status_t pj_get_timestamp_freq(pj_timestamp *freq)</div></div>
<div class="ttc" id="structcodec_htm"><div class="ttname"><a href="structcodec.htm">codec</a></div><div class="ttdef"><b>Definition:</b> siprtp.c:101</div></div>
<div class="ttc" id="structpjmedia__sdp__session_htm_a0384de666572cd66f7a281b7db63413c"><div class="ttname"><a href="structpjmedia__sdp__session.htm#a0384de666572cd66f7a281b7db63413c">pjmedia_sdp_session::id</a></div><div class="ttdeci">pj_uint32_t id</div><div class="ttdef"><b>Definition:</b> sdp.h:670</div></div>
<div class="ttc" id="group__PJ__THREAD_htm_gad59cd6fd7390711758afcc0bde375d68"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__THREAD.htm#gad59cd6fd7390711758afcc0bde375d68">pj_thread_sleep</a></div><div class="ttdeci">pj_status_t pj_thread_sleep(unsigned msec)</div></div>
<div class="ttc" id="structpjmedia__sdp__session_htm_a0760046cf7c2f33f2b2ed5bcd040220d"><div class="ttname"><a href="structpjmedia__sdp__session.htm#a0760046cf7c2f33f2b2ed5bcd040220d">pjmedia_sdp_session::origin</a></div><div class="ttdeci">struct pjmedia_sdp_session::@13 origin</div></div>
<div class="ttc" id="group__PJMED__RTP_htm_ga7052667cdb593ec24c95b98a46227ce2"><div class="ttname"><a href="group__PJMED__RTP.htm#ga7052667cdb593ec24c95b98a46227ce2">pjmedia_rtp_encode_rtp</a></div><div class="ttdeci">pj_status_t pjmedia_rtp_encode_rtp(pjmedia_rtp_session *ses, int pt, int m, int payload_len, int ts_len, const void **rtphdr, int *hdrlen)</div></div>
<div class="ttc" id="group__PJ__SOCK_htm_ga506ba0f8230021a6cdd1bdab22c32e2e"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__SOCK.htm#ga506ba0f8230021a6cdd1bdab22c32e2e">pj_inet_ntop</a></div><div class="ttdeci">pj_status_t pj_inet_ntop(int af, const void *src, char *dst, int size)</div></div>
<div class="ttc" id="structpj__sockaddr__in_htm"><div class="ttname"><a href="../../../pjlib/docs/html/structpj__sockaddr__in.htm">pj_sockaddr_in</a></div></div>
<div class="ttc" id="structpjmedia__sdp__session_htm_a6200bd90a6be57ec36aac452c45872c7"><div class="ttname"><a href="structpjmedia__sdp__session.htm#a6200bd90a6be57ec36aac452c45872c7">pjmedia_sdp_session::start</a></div><div class="ttdeci">pj_uint32_t start</div><div class="ttdef"><b>Definition:</b> sdp.h:686</div></div>
<div class="ttc" id="structpjmedia__sdp__media_htm"><div class="ttname"><a href="structpjmedia__sdp__media.htm">pjmedia_sdp_media</a></div><div class="ttdef"><b>Definition:</b> sdp.h:460</div></div>
<div class="ttc" id="group__PJMED__G711_htm_gaa4cc7591d63c308e1f2e7821240abf14"><div class="ttname"><a href="group__PJMED__G711.htm#gaa4cc7591d63c308e1f2e7821240abf14">pjmedia_codec_g711_init</a></div><div class="ttdeci">PJ_BEGIN_DECL pj_status_t pjmedia_codec_g711_init(pjmedia_endpt *endpt)</div></div>
<div class="ttc" id="group__PJ__BASIC_htm_gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a></div><div class="ttdeci">PJ_SUCCESS</div></div>
<div class="ttc" id="group__PJ__BASIC_htm_ga47506d8dde1056c5c96d62f0df6ddf28"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga47506d8dde1056c5c96d62f0df6ddf28">pj_uint16_t</a></div><div class="ttdeci">unsigned short pj_uint16_t</div></div>
<div class="ttc" id="structpjmedia__sdp__session_htm_a6b8359db35cb0a317854555460009cad"><div class="ttname"><a href="structpjmedia__sdp__session.htm#a6b8359db35cb0a317854555460009cad">pjmedia_sdp_session::version</a></div><div class="ttdeci">pj_uint32_t version</div><div class="ttdef"><b>Definition:</b> sdp.h:671</div></div>
<div class="ttc" id="structpjmedia__rtcp__stat_htm_a2d8a17e5f1fbf8cd551f33c007be590f"><div class="ttname"><a href="structpjmedia__rtcp__stat.htm#a2d8a17e5f1fbf8cd551f33c007be590f">pjmedia_rtcp_stat::rtt</a></div><div class="ttdeci">pj_math_stat rtt</div><div class="ttdef"><b>Definition:</b> rtcp.h:204</div></div>
<div class="ttc" id="group__PJMED__RTP_htm_gac5fc46bc1de6eb2620c2a28d20578c77"><div class="ttname"><a href="group__PJMED__RTP.htm#gac5fc46bc1de6eb2620c2a28d20578c77">pjmedia_rtp_session_init</a></div><div class="ttdeci">pj_status_t pjmedia_rtp_session_init(pjmedia_rtp_session *ses, int default_pt, pj_uint32_t sender_ssrc)</div></div>
<div class="ttc" id="group__PJMEDIA__TRANSPORT_htm_ga79db5c82268501ec3bf7c1897c0b3626"><div class="ttname"><a href="group__PJMEDIA__TRANSPORT.htm#ga79db5c82268501ec3bf7c1897c0b3626">pjmedia_transport_send_rtp</a></div><div class="ttdeci">pj_status_t pjmedia_transport_send_rtp(pjmedia_transport *tp, const void *pkt, pj_size_t size)</div><div class="ttdef"><b>Definition:</b> transport.h:838</div></div>
<div class="ttc" id="group__PJ__BASIC_htm_ga069615152140fa2df009cebc8a36b769"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga069615152140fa2df009cebc8a36b769">pj_init</a></div><div class="ttdeci">pj_status_t pj_init(void)</div></div>
<div class="ttc" id="structpjmedia__sdp__media_htm_a90a90fed8df5a0e1bfc7bc291421d812"><div class="ttname"><a href="structpjmedia__sdp__media.htm#a90a90fed8df5a0e1bfc7bc291421d812">pjmedia_sdp_media::port_count</a></div><div class="ttdeci">unsigned port_count</div><div class="ttdef"><b>Definition:</b> sdp.h:467</div></div>
<div class="ttc" id="structpjmedia__sdp__session_htm_ae3b829717aa39e76d04e5f5e61284d1d"><div class="ttname"><a href="structpjmedia__sdp__session.htm#ae3b829717aa39e76d04e5f5e61284d1d">pjmedia_sdp_session::stop</a></div><div class="ttdeci">pj_uint32_t stop</div><div class="ttdef"><b>Definition:</b> sdp.h:687</div></div>
<div class="ttc" id="group__PJMEDIA__TRANSPORT_htm_gad0b1f17d5920dd05b3832886b68d9c24"><div class="ttname"><a href="group__PJMEDIA__TRANSPORT.htm#gad0b1f17d5920dd05b3832886b68d9c24">pjmedia_transport_detach</a></div><div class="ttdeci">void pjmedia_transport_detach(pjmedia_transport *tp, void *user_data)</div><div class="ttdef"><b>Definition:</b> transport.h:819</div></div>
<div class="ttc" id="structpjmedia__rtcp__stream__stat_htm_a6ce7c2013c4a7358912e2f10523e6db1"><div class="ttname"><a href="structpjmedia__rtcp__stream__stat.htm#a6ce7c2013c4a7358912e2f10523e6db1">pjmedia_rtcp_stream_stat::dup</a></div><div class="ttdeci">unsigned dup</div><div class="ttdef"><b>Definition:</b> rtcp.h:180</div></div>
<div class="ttc" id="group__PJMED__ENDPT_htm_gae2304cc656a0e6a602f6cdaaec91bb19"><div class="ttname"><a href="group__PJMED__ENDPT.htm#gae2304cc656a0e6a602f6cdaaec91bb19">pjmedia_endpt_destroy</a></div><div class="ttdeci">pj_status_t pjmedia_endpt_destroy(pjmedia_endpt *endpt)</div><div class="ttdef"><b>Definition:</b> endpoint.h:169</div></div>
<div class="ttc" id="group__PJMED__RTCP_htm_gacb5133d8da883347f3d87ec0b161dfb1"><div class="ttname"><a href="group__PJMED__RTCP.htm#gacb5133d8da883347f3d87ec0b161dfb1">pjmedia_rtcp_init</a></div><div class="ttdeci">void pjmedia_rtcp_init(pjmedia_rtcp_session *session, char *name, unsigned clock_rate, unsigned samples_per_frame, pj_uint32_t ssrc)</div></div>
<div class="ttc" id="group__PJ__BASIC_htm_ga9fdb3ceb491cd888cd30ca30d78026e8"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga9fdb3ceb491cd888cd30ca30d78026e8">pj_size_t</a></div><div class="ttdeci">size_t pj_size_t</div></div>
<div class="ttc" id="group__PJ__BASIC_htm_gga65c74a186d2c92fe9f088f3e1e8688bead95511b40a74f4625b161dd9e42c6e6e"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead95511b40a74f4625b161dd9e42c6e6e">PJ_FALSE</a></div><div class="ttdeci">PJ_FALSE</div></div>
<div class="ttc" id="group__PJ__RAND_htm_ga654f8cb013a1312b87000df1a1d03398"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__RAND.htm#ga654f8cb013a1312b87000df1a1d03398">pj_rand</a></div><div class="ttdeci">int pj_rand(void)</div></div>
<div class="ttc" id="structpjmedia__sdp__rtpmap_htm_a569ae42e875e740d8ab5c3cdf50a6dd1"><div class="ttname"><a href="structpjmedia__sdp__rtpmap.htm#a569ae42e875e740d8ab5c3cdf50a6dd1">pjmedia_sdp_rtpmap::enc_name</a></div><div class="ttdeci">pj_str_t enc_name</div><div class="ttdef"><b>Definition:</b> sdp.h:215</div></div>
<div class="ttc" id="group__pj__config_htm_ga7523f8576efd271c22b188eab05d7870"><div class="ttname"><a href="../../../pjlib/docs/html/group__pj__config.htm#ga7523f8576efd271c22b188eab05d7870">PJ_UNUSED_ARG</a></div><div class="ttdeci">#define PJ_UNUSED_ARG(arg)</div></div>
<div class="ttc" id="structpjmedia__rtcp__stat_htm_abf3a62866b6e9f1ec3de831030f41a01"><div class="ttname"><a href="structpjmedia__rtcp__stat.htm#abf3a62866b6e9f1ec3de831030f41a01">pjmedia_rtcp_stat::tx</a></div><div class="ttdeci">pjmedia_rtcp_stream_stat tx</div><div class="ttdef"><b>Definition:</b> rtcp.h:201</div></div>
<div class="ttc" id="group__PJ__CACHING__POOL_htm_ga4c912e7d9e08dae33c2fecea9f1949bc"><div class="ttname"><a href="../../../pjlib/docs/html/group__PJ__CACHING__POOL.htm#ga4c912e7d9e08dae33c2fecea9f1949bc">pj_caching_pool_destroy</a></div><div class="ttdeci">void pj_caching_pool_destroy(pj_caching_pool *ch_pool)</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
<p>&nbsp;</p>
<hr><center>
PJMEDIA small footprint Open Source media stack<br>
Copyright (C) 2006-2008 Teluu Inc.
</center>
<!--#include virtual="/footer.html" -->
</BODY>
</HTML>
