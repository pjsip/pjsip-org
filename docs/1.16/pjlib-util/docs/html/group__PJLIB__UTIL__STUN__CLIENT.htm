<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>PJLIB-UTIL Reference: Simple STUN Helper (1.16)</title>
<link href="/style/style.css" rel="stylesheet" type="text/css">
</head><body>
	<!--#include virtual="/header.html" -->
	<p><A HREF="/">Home</A> --&gt; <A HREF="/docs.htm">Documentations</A> --&gt; PJLIB-UTIL Reference</p>


<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.htm"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.htm"><span>Modules</span></a></li>
      <li><a href="annotated.htm"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.htm"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<h1>Simple STUN Helper<br/>
<small>
[<a class="el" href="group__PJ__PROTOCOLS.htm">Protocols</a>]</small>
</h1>  </div>
</div>
<div class="contents">

<p>A simple and small footprint STUN resolution helper.  
<a href="#_details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="elRef" doxygen="pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__PJLIB__UTIL__STUN__CLIENT.htm#gaac0cc7867194f78245408c416242c3f5">pjstun_get_mapped_addr</a> (<a class="elRef" doxygen="pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__pool__factory.htm">pj_pool_factory</a> *pf, <a class="elRef" doxygen="pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__THREAD.htm#gab600dc33a20a0f36550a4538506d020e">int</a> sock_cnt, <a class="elRef" doxygen="pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga5ccc87de27d1236bc31ae3673d153984">pj_sock_t</a> sock[], const <a class="elRef" doxygen="pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__str__t.htm">pj_str_t</a> *srv1, <a class="elRef" doxygen="pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__THREAD.htm#gab600dc33a20a0f36550a4538506d020e">int</a> port1, const <a class="elRef" doxygen="pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__str__t.htm">pj_str_t</a> *srv2, <a class="elRef" doxygen="pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__THREAD.htm#gab600dc33a20a0f36550a4538506d020e">int</a> port2, <a class="elRef" doxygen="pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__sockaddr__in.htm">pj_sockaddr_in</a> mapped_addr[])</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>A simple and small footprint STUN resolution helper. </p>
<p>This is the older implementation of STUN client, with only one function provided (<a class="el" href="group__PJLIB__UTIL__STUN__CLIENT.htm#gaac0cc7867194f78245408c416242c3f5">pjstun_get_mapped_addr()</a>) to retrieve the public IP address of multiple sockets. </p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="gaac0cc7867194f78245408c416242c3f5"></a><!-- doxytag: member="stun_simple.h::pjstun_get_mapped_addr" ref="gaac0cc7867194f78245408c416242c3f5" args="(pj_pool_factory *pf, int sock_cnt, pj_sock_t sock[], const pj_str_t *srv1, int port1, const pj_str_t *srv2, int port2, pj_sockaddr_in mapped_addr[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="elRef" doxygen="pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> pjstun_get_mapped_addr </td>
          <td>(</td>
          <td class="paramtype"><a class="elRef" doxygen="pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__pool__factory.htm">pj_pool_factory</a> *&nbsp;</td>
          <td class="paramname"> <em>pf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="elRef" doxygen="pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__THREAD.htm#gab600dc33a20a0f36550a4538506d020e">int</a>&nbsp;</td>
          <td class="paramname"> <em>sock_cnt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="elRef" doxygen="pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#ga5ccc87de27d1236bc31ae3673d153984">pj_sock_t</a>&nbsp;</td>
          <td class="paramname"> <em>sock</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="elRef" doxygen="pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__str__t.htm">pj_str_t</a> *&nbsp;</td>
          <td class="paramname"> <em>srv1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="elRef" doxygen="pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__THREAD.htm#gab600dc33a20a0f36550a4538506d020e">int</a>&nbsp;</td>
          <td class="paramname"> <em>port1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="elRef" doxygen="pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__str__t.htm">pj_str_t</a> *&nbsp;</td>
          <td class="paramname"> <em>srv2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="elRef" doxygen="pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__THREAD.htm#gab600dc33a20a0f36550a4538506d020e">int</a>&nbsp;</td>
          <td class="paramname"> <em>port2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="elRef" doxygen="pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/structpj__sockaddr__in.htm">pj_sockaddr_in</a>&nbsp;</td>
          <td class="paramname"> <em>mapped_addr</em>[]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This is the main function to request the mapped address of local sockets to multiple STUN servers. This function is able to find the mapped addresses of multiple sockets simultaneously, and for each socket, two requests will be sent to two different STUN servers to see if both servers get the same public address for the same socket. (Note that application can specify the same address for the two servers, but still two requests will be sent for each server).</p>
<p>This function will perform necessary retransmissions of the requests if response is not received within a predetermined period. When all responses have been received, the function will compare the mapped addresses returned by the servers, and when both are equal, the address will be returned in <em>mapped_addr</em> argument.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pf</em>&nbsp;</td><td>The pool factory where memory will be allocated from. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>sock_cnt</em>&nbsp;</td><td>Number of sockets in the socket array. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>sock</em>&nbsp;</td><td>Array of local UDP sockets which public addresses are to be queried from the STUN servers. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>srv1</em>&nbsp;</td><td>Host name or IP address string of the first STUN server. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>port1</em>&nbsp;</td><td>The port number of the first STUN server. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>srv2</em>&nbsp;</td><td>Host name or IP address string of the second STUN server. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>port2</em>&nbsp;</td><td>The port number of the second STUN server. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mapped_addr</em>&nbsp;</td><td>Array to receive the mapped public address of the local UDP sockets, when the function returns PJ_SUCCESS.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>This functions returns PJ_SUCCESS if responses are received from all servers AND all servers returned the same mapped public address. Otherwise this function may return one of the following error codes:<ul>
<li>PJLIB_UTIL_ESTUNNOTRESPOND: no respons from servers.</li>
<li>PJLIB_UTIL_ESTUNSYMMETRIC: different mapped addresses are returned by servers.</li>
<li>etc. </li>
</ul>
</dd></dl>

</div>
</div>
</div>
<p>&nbsp;</p>
<hr><center>
PJLIB-UTIL Open Source, small footprint, and portable asynchronous/caching DNS resolver, text scanner, STUN client, and XML library<br>
Copyright (C) 2006-2009 Teluu Inc.
</center>


<!--#include virtual="/footer.html" -->

</BODY>
</HTML>
