<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Audio Device API (2.12)</title>
<link href="/style/style.css" rel="stylesheet" type="text/css">
</head><body>
	<!--#include virtual="/header.html" -->
	<p><A HREF="/">Home</A> --&gt; <A HREF="/docs.htm">Documentations</A> --&gt; PJMEDIA Reference</p>
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#groups">Modules</a>  </div>
  <div class="headertitle">
<div class="title">Audio Device API</div>  </div>
</div><!--header-->
<div class="contents">

<p>PJMEDIA audio device abstraction API.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:group__s2__audio__device__reference"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__s2__audio__device__reference.htm">Audio Device API Reference</a></td></tr>
<tr class="memdesc:group__s2__audio__device__reference"><td class="mdescLeft">&#160;</td><td class="mdescRight">Documentation and API Reference. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__s8__audio__device__implementors__api"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__s8__audio__device__implementors__api.htm">Audio Device Implementors API</a></td></tr>
<tr class="memdesc:group__s8__audio__device__implementors__api"><td class="mdescLeft">&#160;</td><td class="mdescRight">API for audio device implementors. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__s30__audio__test__utility"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__s30__audio__test__utility.htm">Audio tests utility.</a></td></tr>
<tr class="memdesc:group__s30__audio__test__utility"><td class="mdescLeft">&#160;</td><td class="mdescRight">Audio test utility. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__s1__audio__device__config"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__s1__audio__device__config.htm">Compile time configurations</a></td></tr>
<tr class="memdesc:group__s1__audio__device__config"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compile time configurations. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__error__codes"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__error__codes.htm">Error Codes</a></td></tr>
<tr class="memdesc:group__error__codes"><td class="mdescLeft">&#160;</td><td class="mdescRight">Audio devive library specific error codes. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>PJMEDIA Audio Device API is a cross-platform audio API appropriate for use with VoIP applications and many other types of audio streaming applications.</p>
<p>The API abstracts many different audio API's on various platforms, such as:</p><ul>
<li>PortAudio back-end for Win32, Windows Mobile, Linux, Unix, dan MacOS X.</li>
<li>native WMME audio for Win32 and Windows Mobile devices</li>
<li>native Symbian audio streaming/multimedia framework (MMF) implementation</li>
<li>native Nokia Audio Proxy Server (APS) implementation</li>
<li>null-audio implementation</li>
<li>and more to be implemented in the future</li>
</ul>
<p>The Audio Device API/library is an evolution from PJMEDIA <a class="el" href="group__PJMED__SND.htm">Portable Sound Hardware Abstraction</a> and contains many enhancements:</p>
<ul>
<li>Forward compatibility: <br />
 The new API has been designed to be extensible, it will support new API's as well as new features that may be introduced in the future without breaking compatibility with applications that use this API as well as compatibility with existing device implementations.</li>
<li>Device capabilities: <br />
 At the heart of the API is device capabilities management, where all possible audio capabilities of audio devices should be able to be handled in a generic manner. With this framework, new capabilities that may be discovered in the future can be handled in manner without breaking existing applications.</li>
<li>Built-in features: <br />
 The device capabilities framework enables applications to use and control audio features built-in in the device, such as:<ul>
<li>echo cancellation,</li>
<li>built-in codecs,</li>
<li>audio routing (e.g. to earpiece or loudspeaker),</li>
<li>volume control,</li>
<li>etc.</li>
</ul>
</li>
<li>Codec support: <br />
 Some audio devices such as Nokia/Symbian Audio Proxy Server (APS) and Nokia VoIP Audio Services (VAS) support built-in hardware audio codecs (e.g. G.729, iLBC, and AMR), and application can use the sound device in encoded mode to make use of these hardware codecs.</li>
<li>Multiple backends: <br />
 The new API supports multiple audio backends (called factories or drivers in the code) to be active simultaneously, and audio backends may be added or removed during run-time.</li>
</ul>
<h1><a class="anchor" id="using"></a>
Overview on using the API</h1>
<h2><a class="anchor" id="getting_started"></a>
Getting started</h2>
<ol type="1">
<li><b>Configure the application's project settings</b>.<br />
 Add the following include: <div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="pjmedia__audiodev_8h.htm">pjmedia_audiodev.h</a>&gt;</span></div></div><!-- fragment --><br />
 And add <b>pjmedia-audiodev</b> library to your application link specifications.<br />
</li>
<li><b>Compile time settings</b>.<br />
 Use the compile time settings to enable or disable specific audio drivers. For more information, please see <a class="el" href="group__s1__audio__device__config.htm">Compile time configurations</a>.</li>
<li><b>API initialization and cleaning up</b>.<br />
 Before anything else, application must initialize the API by calling: <div class="fragment"><div class="line"><a class="code" href="group__s2__audio__device__reference.htm#gaa66ec5427ffc9ede38c4902d165f1c91">pjmedia_aud_subsys_init</a>(pf);</div></div><!-- fragment --><br />
 And add this in the application cleanup sequence <div class="fragment"><div class="line"><a class="code" href="group__s2__audio__device__reference.htm#ga385d198c8d30dc0142970d9a84de10cf">pjmedia_aud_subsys_shutdown</a>();</div></div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="devices"></a>
Working with devices</h2>
<ol type="1">
<li>The following code prints the list of audio devices detected in the system. <div class="fragment"><div class="line"><span class="keywordtype">int</span> dev_count;</div><div class="line"><a class="code" href="group__s2__audio__device__reference.htm#ga20b636facbe0ed6ca914fb218b463db0">pjmedia_aud_dev_index</a> dev_idx;</div><div class="line"><a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> status;</div><div class="line"></div><div class="line">dev_count = <a class="code" href="group__s2__audio__device__reference.htm#gadb1b8058a1e0c4721b3781a1c92b15d8">pjmedia_aud_dev_count</a>();</div><div class="line">printf(<span class="stringliteral">&quot;Got %d audio devices\n&quot;</span>, dev_count);</div><div class="line"></div><div class="line"><span class="keywordflow">for</span> (dev_idx=0; dev_idx&lt;dev_count; ++i) {</div><div class="line">    <a class="code" href="structpjmedia__aud__dev__info.htm">pjmedia_aud_dev_info</a> <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__SYS__INFO.htm#ga5fdc2ee11d7ed4e87245acd50a87a838">info</a>;</div><div class="line"></div><div class="line">    status = <a class="code" href="group__s2__audio__device__reference.htm#ga9fde03fa273453a8356cca94d3489d2a">pjmedia_aud_dev_get_info</a>(dev_idx, &amp;info);</div><div class="line">    printf(<span class="stringliteral">&quot;%d. %s (in=%d, out=%d)\n&quot;</span>,</div><div class="line">           dev_idx, info.<a class="code" href="structpjmedia__aud__dev__info.htm#ac450407da12319514ba86111d479577a">name</a>, </div><div class="line">           info.<a class="code" href="structpjmedia__aud__dev__info.htm#a9eb6093474d5c96a80846b05fa9326c4">input_count</a>, info.<a class="code" href="structpjmedia__aud__dev__info.htm#a308e8d84d979ad812ec5c045867beb47">output_count</a>);</div><div class="line">}</div></div><!-- fragment --><br />
</li>
<li>Info: The <a class="el" href="group__s2__audio__device__reference.htm#gae2a0dd608f19f6e03dad2333c3a5048d">PJMEDIA_AUD_DEFAULT_CAPTURE_DEV</a> and <a class="el" href="group__s2__audio__device__reference.htm#gaefbac16734d02910357221414a7707e8">PJMEDIA_AUD_DEFAULT_PLAYBACK_DEV</a> constants are used to denote default capture and playback devices respectively.</li>
<li>Info: You may save the device and driver's name in your application setting, for example to specify the prefered devices to be used by your application. You can then retrieve the device index for the device by calling: <div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *drv_name = <span class="stringliteral">&quot;WMME&quot;</span>;</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *dev_name = <span class="stringliteral">&quot;Wave mapper&quot;</span>;</div><div class="line"><a class="code" href="group__s2__audio__device__reference.htm#ga20b636facbe0ed6ca914fb218b463db0">pjmedia_aud_dev_index</a> dev_idx;</div><div class="line"></div><div class="line">status = <a class="code" href="group__s2__audio__device__reference.htm#gaa4805db7a33603a1b136d8fc27e14c79">pjmedia_aud_dev_lookup</a>(drv_name, dev_name, &amp;dev_idx);</div><div class="line"><span class="keywordflow">if</span> (status==<a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>)</div><div class="line">    printf(<span class="stringliteral">&quot;Device index is %d\n&quot;</span>, dev_idx);</div></div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="caps"></a>
Device capabilities</h2>
<p>Capabilities are encoded as <a class="el" href="group__s2__audio__device__reference.htm#gac0056b89f06893c8a67885c4307e0737">pjmedia_aud_dev_cap</a> enumeration. Please see <a class="el" href="group__s2__audio__device__reference.htm#gac0056b89f06893c8a67885c4307e0737">pjmedia_aud_dev_cap</a> enumeration for more information.</p>
<ol type="1">
<li>The following snippet prints the capabilities supported by the device: <div class="fragment"><div class="line"><a class="code" href="structpjmedia__aud__dev__info.htm">pjmedia_aud_dev_info</a> <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__SYS__INFO.htm#ga5fdc2ee11d7ed4e87245acd50a87a838">info</a>;</div><div class="line"><a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> status;</div><div class="line"></div><div class="line">status = <a class="code" href="group__s2__audio__device__reference.htm#ga9fde03fa273453a8356cca94d3489d2a">pjmedia_aud_dev_get_info</a>(<a class="code" href="group__s2__audio__device__reference.htm#gae2a0dd608f19f6e03dad2333c3a5048d">PJMEDIA_AUD_DEFAULT_CAPTURE_DEV</a>, &amp;info);</div><div class="line"><span class="keywordflow">if</span> (status == <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bea312497101cf4a5d856e77d5302059935">PJ_SUCCESS</a>) {</div><div class="line">    <span class="keywordtype">unsigned</span> i;</div><div class="line">    <span class="comment">// Enumerate capability bits</span></div><div class="line">    printf(<span class="stringliteral">&quot;Device capabilities: &quot;</span>);</div><div class="line">    <span class="keywordflow">for</span> (i=0; i&lt;32; ++i) {</div><div class="line">        <span class="keywordflow">if</span> (info.<a class="code" href="structpjmedia__aud__dev__info.htm#af17e80948d0c324f52e98f1e4ded5c6c">caps</a> &amp; (1 &lt;&lt; i))</div><div class="line">            printf(<span class="stringliteral">&quot;%s &quot;</span>, <a class="code" href="group__s2__audio__device__reference.htm#ga8a6a3d99cdc773143267c6a06a1fae8c">pjmedia_aud_dev_cap_name</a>(1 &lt;&lt; i, NULL));</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><br />
</li>
<li>Info: You can set the device settings when opening audio stream by setting the flags and the appropriate setting in <a class="el" href="structpjmedia__aud__param.htm">pjmedia_aud_param</a> when calling <a class="el" href="group__s2__audio__device__reference.htm#ga476ecc42ccb9744bbc40e42d457ad1aa">pjmedia_aud_stream_create()</a><br />
</li>
<li>Info: Once the audio stream is running, you can retrieve or change the stream setting by specifying the capability in <a class="el" href="group__s2__audio__device__reference.htm#gaed63d8e0556db30e0f5b55212fc2f99d">pjmedia_aud_stream_get_cap()</a> and <a class="el" href="group__s2__audio__device__reference.htm#gaad35cd06ce7833540778eaa6b532422a">pjmedia_aud_stream_set_cap()</a> respectively.</li>
</ol>
<h2><a class="anchor" id="creating_stream"></a>
Creating audio streams</h2>
<p>The audio stream enables audio streaming to capture device, playback device, or both.</p>
<ol type="1">
<li>It is recommended to initialize the <a class="el" href="structpjmedia__aud__param.htm">pjmedia_aud_param</a> with its default values before using it: <div class="fragment"><div class="line"><a class="code" href="structpjmedia__aud__param.htm">pjmedia_aud_param</a> param;</div><div class="line"><a class="code" href="group__s2__audio__device__reference.htm#ga20b636facbe0ed6ca914fb218b463db0">pjmedia_aud_dev_index</a> dev_idx;</div><div class="line"><a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gab43ba3167bd2a2ab4580509dbf79200e">pj_status_t</a> status;</div><div class="line"></div><div class="line">dev_idx = <a class="code" href="group__s2__audio__device__reference.htm#gae2a0dd608f19f6e03dad2333c3a5048d">PJMEDIA_AUD_DEFAULT_CAPTURE_DEV</a>;</div><div class="line">status = <a class="code" href="group__s2__audio__device__reference.htm#gae5d2876a11402843e79ea7389ef7ffd9">pjmedia_aud_dev_default_param</a>(dev_idx, &amp;param);</div></div><!-- fragment --><br />
</li>
<li>Configure the mandatory parameters: <div class="fragment"><div class="line">param.<a class="code" href="structpjmedia__aud__param.htm#a3c6274304048a1fb90bc1be7a83ff881">dir</a> = <a class="code" href="group__PJMEDIA__TYPES.htm#ggaf19d0dce3e3c99a3b9514726c28baa30a3b05402141f2618ef2487dcb4c047fcd">PJMEDIA_DIR_CAPTURE_PLAYBACK</a>;</div><div class="line">param.<a class="code" href="structpjmedia__aud__param.htm#a11bb576eeaa70d8abf50eba03afad65f">rec_id</a> = <a class="code" href="group__s2__audio__device__reference.htm#gae2a0dd608f19f6e03dad2333c3a5048d">PJMEDIA_AUD_DEFAULT_CAPTURE_DEV</a>;</div><div class="line">param.<a class="code" href="structpjmedia__aud__param.htm#a2075dea3777c94250861c490c66fe767">play_id</a> = <a class="code" href="group__s2__audio__device__reference.htm#gaefbac16734d02910357221414a7707e8">PJMEDIA_AUD_DEFAULT_PLAYBACK_DEV</a>;</div><div class="line">param.<a class="code" href="structpjmedia__aud__param.htm#a24e3c2da905d0004e0651662b5186ac3">clock_rate</a> = 8000;</div><div class="line">param.<a class="code" href="structpjmedia__aud__param.htm#a162564f7e16f0bea20636bdcb9522afb">channel_count</a> = 1;</div><div class="line">param.<a class="code" href="structpjmedia__aud__param.htm#a63510095d7c0cf32ac1c4266e86169d4">samples_per_frame</a> = 160;</div><div class="line">param.<a class="code" href="structpjmedia__aud__param.htm#aefc7c46ad70e8f27e9c2c51b30fb0a57">bits_per_sample</a> = 16;</div></div><!-- fragment --><br />
</li>
<li>If you want the audio stream to use the device's built-in codec, specify the codec in the <a class="el" href="structpjmedia__aud__param.htm">pjmedia_aud_param</a>. You must make sure that the codec is supported by the device, by looking at its supported format list in the <a class="el" href="structpjmedia__aud__dev__info.htm">pjmedia_aud_dev_info</a>.<br />
 The snippet below sets the audio stream to use G.711 ULAW encoding: <div class="fragment"><div class="line"><span class="keywordtype">unsigned</span> i;</div><div class="line"></div><div class="line"><span class="comment">// Make sure Ulaw is supported</span></div><div class="line"><span class="keywordflow">if</span> ((info.<a class="code" href="structpjmedia__aud__dev__info.htm#af17e80948d0c324f52e98f1e4ded5c6c">caps</a> &amp; <a class="code" href="group__s2__audio__device__reference.htm#ggac0056b89f06893c8a67885c4307e0737afe7133324d436e89068737de6d07c129">PJMEDIA_AUD_DEV_CAP_EXT_FORMAT</a>) == 0)</div><div class="line">    error(<span class="stringliteral">&quot;Device does not support extended formats&quot;</span>);</div><div class="line"><span class="keywordflow">for</span> (i = 0; i &lt; info.<a class="code" href="structpjmedia__aud__dev__info.htm#a7d9bc92d476ce09e8f83d5177056e50f">ext_fmt_cnt</a>; ++i) {</div><div class="line">    <span class="keywordflow">if</span> (info.<a class="code" href="structpjmedia__aud__dev__info.htm#af1863249ee0535d9a28c7695914d02f4">ext_fmt</a>[i].<a class="code" href="structpjmedia__format.htm#a5115e0d9d35a8e8fb7ecbde8b772f700">id</a> == <a class="code" href="group__PJMEDIA__FORMAT.htm#gga7a0830cb291693cabb364a3403777bdaaf1e9b64bde93fc148980e98f09840ff5">PJMEDIA_FORMAT_ULAW</a>)</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">}</div><div class="line"><span class="keywordflow">if</span> (i == info.<a class="code" href="structpjmedia__aud__dev__info.htm#a7d9bc92d476ce09e8f83d5177056e50f">ext_fmt_cnt</a>)</div><div class="line">    error(<span class="stringliteral">&quot;Device does not support Ulaw format&quot;</span>);</div><div class="line"></div><div class="line"><span class="comment">// Set Ulaw format</span></div><div class="line">param.<a class="code" href="structpjmedia__aud__param.htm#a74897b8eb79ec3115da0a5cfc41b6827">flags</a> |= <a class="code" href="group__s2__audio__device__reference.htm#ggac0056b89f06893c8a67885c4307e0737afe7133324d436e89068737de6d07c129">PJMEDIA_AUD_DEV_CAP_EXT_FORMAT</a>;</div><div class="line">param.<a class="code" href="structpjmedia__aud__param.htm#aed424b8a4362d82be2d1d0ba20b1a5f0">ext_fmt</a>.<a class="code" href="structpjmedia__format.htm#a5115e0d9d35a8e8fb7ecbde8b772f700">id</a> = <a class="code" href="group__PJMEDIA__FORMAT.htm#gga7a0830cb291693cabb364a3403777bdaaf1e9b64bde93fc148980e98f09840ff5">PJMEDIA_FORMAT_ULAW</a>;</div><div class="line">param.<a class="code" href="structpjmedia__aud__param.htm#aed424b8a4362d82be2d1d0ba20b1a5f0">ext_fmt</a>.bitrate = 64000;</div><div class="line">param.<a class="code" href="structpjmedia__aud__param.htm#aed424b8a4362d82be2d1d0ba20b1a5f0">ext_fmt</a>.vad = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead95511b40a74f4625b161dd9e42c6e6e">PJ_FALSE</a>;</div></div><!-- fragment --><br />
</li>
<li>Note that if non-PCM format is configured on the audio stream, the capture and/or playback functions (<a class="el" href="group__s2__audio__device__reference.htm#ga991cbd7332b2701642866dcf56a9a72c">pjmedia_aud_rec_cb</a> and <a class="el" href="group__s2__audio__device__reference.htm#ga14ced272969fa7808e96e11e9c948af6">pjmedia_aud_play_cb</a> respectively) will report the audio frame as <a class="el" href="structpjmedia__frame__ext.htm">pjmedia_frame_ext</a> structure instead of the <a class="el" href="structpjmedia__frame.htm">pjmedia_frame</a>.</li>
<li>Optionally configure other device's capabilities. The following snippet shows how to enable echo cancellation on the device (note that this snippet may not be necessary since the setting may have been enabled when calling <a class="el" href="group__s2__audio__device__reference.htm#gae5d2876a11402843e79ea7389ef7ffd9">pjmedia_aud_dev_default_param()</a> above): <div class="fragment"><div class="line"><span class="keywordflow">if</span> (info.<a class="code" href="structpjmedia__aud__dev__info.htm#af17e80948d0c324f52e98f1e4ded5c6c">caps</a> &amp; <a class="code" href="group__s2__audio__device__reference.htm#ggac0056b89f06893c8a67885c4307e0737a954741eb973debd25c445a13ac98c358">PJMEDIA_AUD_DEV_CAP_EC</a>) {</div><div class="line">    param.<a class="code" href="structpjmedia__aud__param.htm#a74897b8eb79ec3115da0a5cfc41b6827">flags</a> |= <a class="code" href="group__s2__audio__device__reference.htm#ggac0056b89f06893c8a67885c4307e0737a954741eb973debd25c445a13ac98c358">PJMEDIA_AUD_DEV_CAP_EC</a>;</div><div class="line">    param.<a class="code" href="structpjmedia__aud__param.htm#a8acb56da0f66a0d813f5eebe1dfb17ea">ec_enabled</a> = <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__BASIC.htm#gga65c74a186d2c92fe9f088f3e1e8688bead235b21a623d982cc561fb12bffa87c0">PJ_TRUE</a>;</div><div class="line">}</div></div><!-- fragment --></li>
<li>Open the audio stream, specifying the capture and/or playback callback functions: <div class="fragment"><div class="line"><a class="code" href="structpjmedia__aud__stream.htm">pjmedia_aud_stream</a> *<a class="code" href="structstream.htm">stream</a>;</div><div class="line"></div><div class="line">status = <a class="code" href="group__s2__audio__device__reference.htm#ga476ecc42ccb9744bbc40e42d457ad1aa">pjmedia_aud_stream_create</a>(&amp;param, &amp;rec_cb, &amp;play_cb, </div><div class="line">                                   <a class="codeRef" doxygen="/home/nn/projects/pjproject/pjlib/docs/pjlib.tag:../../../pjlib/docs/html/" href="../../../pjlib/docs/html/group__PJ__IOQUEUE.htm#gab06c131ab29b37c027f2400bd5be6045">user_data</a>, &amp;stream);</div></div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="working_with_stream"></a>
Working with audio streams</h2>
<ol type="1">
<li>To start the audio stream: <div class="fragment"><div class="line">status = <a class="code" href="group__s2__audio__device__reference.htm#ga6ac019a8004fd7daac9c4f58ca0e8150">pjmedia_aud_stream_start</a>(stream);</div></div><!-- fragment --><br />
 To stop the stream: <div class="fragment"><div class="line">status = <a class="code" href="group__s2__audio__device__reference.htm#ga2b841241a7a29bcbc4cd006a9fd658c4">pjmedia_aud_stream_stop</a>(stream);</div></div><!-- fragment --><br />
 And to destroy the stream: <div class="fragment"><div class="line">status = <a class="code" href="group__s2__audio__device__reference.htm#ga78484b82ec18d32ff9408aee93a47415">pjmedia_aud_stream_destroy</a>(stream);</div></div><!-- fragment --><br />
</li>
<li>Info: The following shows how to retrieve the capability value of the stream (in this case, the current output volume setting). <div class="fragment"><div class="line"><span class="comment">// Volume setting is an unsigned integer showing the level in percent.</span></div><div class="line"><span class="keywordtype">unsigned</span> vol;</div><div class="line">status = <a class="code" href="group__s2__audio__device__reference.htm#gaed63d8e0556db30e0f5b55212fc2f99d">pjmedia_aud_stream_get_cap</a>(stream, </div><div class="line">                                    <a class="code" href="group__s2__audio__device__reference.htm#ggac0056b89f06893c8a67885c4307e0737a74517ada712d649fcc4e3aadc3d38531">PJMEDIA_AUD_DEV_CAP_OUTPUT_VOLUME_SETTING</a>,</div><div class="line">                                    &amp;vol);</div></div><!-- fragment --></li>
<li>Info: And following shows how to modify the capability value of the stream (in this case, the current output volume setting). <div class="fragment"><div class="line"><span class="comment">// Volume setting is an unsigned integer showing the level in percent.</span></div><div class="line"><span class="keywordtype">unsigned</span> vol = 50;</div><div class="line">status = <a class="code" href="group__s2__audio__device__reference.htm#gaad35cd06ce7833540778eaa6b532422a">pjmedia_aud_stream_set_cap</a>(stream, </div><div class="line">                                    <a class="code" href="group__s2__audio__device__reference.htm#ggac0056b89f06893c8a67885c4307e0737a74517ada712d649fcc4e3aadc3d38531">PJMEDIA_AUD_DEV_CAP_OUTPUT_VOLUME_SETTING</a>,</div><div class="line">                                    &amp;vol);</div></div><!-- fragment --> </li>
</ol>
</div><!-- contents -->
<p>&nbsp;</p>
<hr><center>
PJMEDIA small footprint Open Source media stack<br>
Copyright (C) 2006-2008 Teluu Inc.
</center>
<!--#include virtual="/footer.html" -->
</BODY>
</HTML>
